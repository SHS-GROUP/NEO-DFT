C 15 DEC 08 - NG,MWS - UKS_C_TPSS: FIX ALPHA/BETA TYPOS, FIX UKS_X_PBE2
C 20 NOV 08 - FZ  - UKS_X_PBE2,UKS_C_PBE2: FIX BETA=0 FOR HIGH-SPIN CASE
C 23 OCT 08 - FZ  - NEW MODULE FOR META-GGA FUNCTIONALS OF PERDEW ET AL.
C
C PERDEW AND CO. META-GGA: PKZB, TPSS, TPSSM (M=MOD), TPSSH (H=HYBRID),
C TOGETHER WITH TWO MODIFIED VERSIONS OF PBE: PBESOL AND RPBE
C
C A VERY NICE REVIEW OF THIS CLASS OF FUNCTIONALS EXPLAYNING
C THE GUIDING PRINCIPLES BEHIND THEIR DESIGN:
C J. P. PERDEW, A. RUZSINSZKY, J. TAO, V. N. STAROVEROV,
C G. E. SCUSERIA, AND G. I. CSONKA, J. CHEM. PHYS. 123,
C 062201 (2005).
C
C PKZB:
C J. P. PERDEW, S. KURTH, A. ZUPAN, AND P. BLAHA, PHYS.
C REV. LETT. 82, 2544 (1999).
C (THE PROTOTYPE OF TPSS)
C
C TPSS:
C J. TAO, J. P. PERDEW, V. N. STAROVEROV, AND G. E. SCUSERIA,
C PHYS. REV. LETT. 91, 146401 (2003).
C J. P. PERDEW, J. TAO, V. N. STAROVEROV, AND G. E. SCUSERIA,
C J. CHEM. PHYS. 120, 6898 (2004).
C (A GENERIC, NON-EMPIRICAL META-GGA FUNCTIONAL; A BASIS
C FOR FURTHER GENERALIZATIONS, SUCH AS HYPER-GGA)
C
C TPSSM (TPSSMOD):
C J. P. PERDEW, A. RUZSINSZKY, J. TAO, G. I. CSONKA, AND
C G. E. SCUSERIA,  PHYS. REV. A 76, 042506 (2007).
C (WITH MU=0.252, E=1.37 AND C=1.38496 FROM THE ABOVE
C ARTICLE; A NON-EMPIRICAL OPTIMIZATION OF TPSS; ATOMIZATION
C ENERGIES ARE SIGNIFICANTLY IMPROVED, ENERGY BARRIER HEIGHTS
C ARE SLIGHTLY IMPROVED)
C
C TPSSH:
C V. N. STAROVEROV, G. E. SCUSERIA, J. TAO, AND J. P. PERDEW,
C J. CHEM. PHYS. 119, 12129 (2003); 121, 11507(E) (2004).
C (A GLOBAL HYBRID VERSION OF TPSS: 0.1*HFX+0.9*TPSSX+TPSSC
C WITH FURTHER IMPROVEMENT FOR MOST PROPERTIES)
C
C PBESOL:
C J. P. PERDEW, A. RUZSINSZKY, G. I. CSONKA, O. A. VYDROV,
C G. E. SCUSERIA, L. A. CONSTANTIN, X. ZHOU, AND K. BURKE,
C PHYS. REV. LETT. 100, 136406 (2008).
C (COUNTERACTING THE BIAS OF GGA FUNCTIONALS TOWARD THE
C DESCRIPTION OF FREE-ATOM ENERGIES RESULTS IN THIS REVISION
C OF PBE; IMPROVES EQUILIBRIUM PROPERTIES OF DENSELY PACKED
C SOLIDS AND THEIR SURFACES)
C
C RPBE:
C B. HAMMER, L. B. HANSEN, AND J. K. NORSKOV,
C PHYS. REV. B 59, 7413 (1999).
C RPBE HAS ALL THE BENEFITS OF REVPBE FOR THE ATOMIZATION ENERGIES
C AND CHEMISORPTION BUT OBEYS THE LIEB-OXFORD CRITERION LOCALLY.
C
C*MODULE DFTXCE  *DECK TPSSXF
      SUBROUTINE TPSSXF(RHFGVB,UROHF,ROA,ROB,GRDAA,GRDBB,
     >        GRADXA,GRADYA,GRADZA,GRADXB,GRADYB,GRADZB,
     >        FTOTWT,XGRD,
     >        VXCA1,DUMAX,DUMAY,DUMAZ,DMGGA,
     >        VXCB1,DUMBX,DUMBY,DUMBZ,DMGGB,
     >        TAUXA,TAUYA,TAUZA,TAUXB,TAUYB,TAUZB)
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      LOGICAL UROHF, RHFGVB
      PARAMETER (GGALIM=1D-13)
C
      COMMON /CTPSSH/ CTPSSX
C
      IF(RHFGVB) THEN
C
         IDERIV   = 1
         NPT      = 1
         RHOA1    = 2.0D+00*ROA
         SIGMAAA1 = 4.0D+00*GRDAA
         TA1 = (TAUXA + TAUYA + TAUZA)
C
C          FOR EXPLANATION OF WORKAROUND, SEE THE UHF SECTION IN TPSSXF
C
         IF (SIGMAAA1.LE.GGALIM) THEN
           CALL RKS_X_PBE2(NPT,RHOA1,SIGMAAA1,ZK,VRHOA,VSIGMAAA)
           VTA=0.0D+00
         ELSE
           CALL RKS_X_TPSS(IDERIV,NPT,RHOA1,SIGMAAA1,TA1,ZK,
     *                     VRHOA,VSIGMAAA,VTA)
         END IF
C
         WAA = VSIGMAAA
         FTA = VTA
C
         VXCA1 = VXCA1 + VRHOA*CTPSSX
         DUMAX = DUMAX + 1.0D+00*(WAA*GRADXA)*CTPSSX
         DUMAY = DUMAY + 1.0D+00*(WAA*GRADYA)*CTPSSX
         DUMAZ = DUMAZ + 1.0D+00*(WAA*GRADZA)*CTPSSX
         DMGGA = DMGGA + 0.5D+00*FTA*CTPSSX
C
         XGRD = XGRD + ZK * FTOTWT*CTPSSX
C
      END IF
C
      IF(UROHF) THEN
C
         IDERIV   = 1
         NPT      = 1
         RHOA1    = ROA
         SIGMAAA1 = GRDAA
         RHOB1    = ROB
         SIGMABB1 = GRDBB
C
        TA1 = 0.5D+00*(TAUXA + TAUYA + TAUZA)
        TB1 = 0.5D+00*(TAUXB + TAUYB + TAUZB)
C
C          WORKAROUND FOR SINGULARITIES IN THE TPSS FUNCTIONAL FAMILY
C          IS TO USE A GGA IN THE LIMIT OF 'SLOWLY VARYING DENSITY'.
C
C          SIGMA(AA/BB)1 IS THE SQUARE OF THE GRADIENT OF THE UP/DOWN
C          DENSITY, AND VALUES AROUND 1D-20 CAUSE NUMERICAL ISSUES IN
C          THE TPSS CODE.  IN THE SLOWLY VARYING DENSITY LIMIT, A
C          META-GGA GOES INTO AN UNDERLYING GGA (AROUND 1D-11), AND
C          THEN TO AN LDA LIMIT (AROUND 1D-18).  SINCE THE LATTER IS
C          A BIT TOO CLOSE TO THE NUMERICAL PROBLEMS IN TPSS, AND WE
C          CAN'T KNOW IF ONE OF THE SIGMA'S ISN'T ONE OR TWO ORDERS OF
C          MAGNITUDE SMALLER THAN THE OTHER, DOWNSHIFT ONLY TO THE GGA.
C          NUMERICAL EXPERIMENTS SHOW THAT VALUES AROUND 1D-10 OR 1D-12
C          HAVE AN EFFECT ON THE 8TH DIGIT OF ENERGY, WHEREAS 1D-15
C          CAUSES NO OBSERVABLE CHANGE AT ALL.
C
        IF (MAX(SIGMAAA1,SIGMABB1).LE.GGALIM) THEN
           CALL UKS_X_PBE2(NPT,RHOA1,RHOB1,SIGMAAA1,SIGMABB1,
     &                     ZK,VRHOA,VRHOB,VSIGMAAA,VSIGMAAB,VSIGMABB)
           VTA=0.0D+00
           VTB=0.0D+00
        ELSE
           CALL UKS_X_TPSS(IDERIV,NPT,RHOA1,RHOB1,SIGMAAA1,SIGMABB1,
     *                     TA1,TB1,ZK,VRHOA,VRHOB,
     *                     VSIGMAAA,VSIGMAAB,VSIGMABB,VTA,VTB)
        END IF
C
              WAA = VSIGMAAA
              WBB = VSIGMABB
              WAB = VSIGMAAB
              FTA=VTA
              FTB=VTB
C
            VXCA1 = VXCA1 + VRHOA*CTPSSX
            DUMAX = DUMAX + 2.0D+00*(WAA*GRADXA)*CTPSSX +
     #(WAB*GRADXB)*CTPSSX
            DUMAY = DUMAY + 2.0D+00*(WAA*GRADYA)*CTPSSX +
     #(WAB*GRADYB)*CTPSSX
            DUMAZ = DUMAZ + 2.0D+00*(WAA*GRADZA)*CTPSSX +
     #(WAB*GRADZB)*CTPSSX
            DMGGA = DMGGA + .5D+00*FTA*CTPSSX
C
            VXCB1 = VXCB1 + VRHOB*CTPSSX
            DUMBX = DUMBX + 2.0D+00*(WBB*GRADXB)*CTPSSX +
     #(WAB*GRADXA)*CTPSSX
            DUMBY = DUMBY + 2.0D+00*(WBB*GRADYB)*CTPSSX +
     #(WAB*GRADYA)*CTPSSX
            DUMBZ = DUMBZ + 2.0D+00*(WBB*GRADZB)*CTPSSX +
     #(WAB*GRADZA)*CTPSSX
            DMGGB = DMGGB + .5D+00*FTB*CTPSSX
C
            XGRD = XGRD + ZK * FTOTWT*CTPSSX
C
      END IF
C
      END
C*MODULE DFTXCE  *DECK TPSSMXF
      SUBROUTINE TPSSMXF(RHFGVB,UROHF,ROA,ROB,GRDAA,GRDBB,
     >        GRADXA,GRADYA,GRADZA,GRADXB,GRADYB,GRADZB,
     >        FTOTWT,XGRD,
     >        VXCA1,DUMAX,DUMAY,DUMAZ,DMGGA,
     >        VXCB1,DUMBX,DUMBY,DUMBZ,DMGGB,
     >        TAUXA,TAUYA,TAUZA,TAUXB,TAUYB,TAUZB)
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      LOGICAL UROHF, RHFGVB
      PARAMETER (GGALIM=1D-13)
C
      IF(RHFGVB) THEN
C
         IDERIV   = 1
         NPT      = 1
         RHOA1    = 2.0D+00*ROA
         SIGMAAA1 = 4.0D+00*GRDAA
         TA1 = (TAUXA + TAUYA + TAUZA)
C
C          FOR EXPLANATION OF WORKAROUND, SEE THE UHF SECTION IN TPSSXF
C
        IF (SIGMAAA1.LE.GGALIM) THEN
           CALL RKS_X_PBE2 (NPT,RHOA1,SIGMAAA1,ZK,VRHOA,VSIGMAAA)
           VTA=0.0D+00
        ELSE
           CALL RKS_X_TPSSM(IDERIV,NPT,RHOA1,SIGMAAA1,TA1,ZK,
     *                      VRHOA,VSIGMAAA,VTA)
        END IF
C
              WAA = VSIGMAAA
              FTA = VTA
C
            VXCA1 = VXCA1 + VRHOA
            DUMAX = DUMAX + 1.0D+00*(WAA*GRADXA)
            DUMAY = DUMAY + 1.0D+00*(WAA*GRADYA)
            DUMAZ = DUMAZ + 1.0D+00*(WAA*GRADZA)
            DMGGA = DMGGA + 0.5D+00*FTA
C
            XGRD = XGRD + ZK * FTOTWT
C
      END IF
C
      IF(UROHF) THEN
C
         IDERIV   = 1
         NPT      = 1
         RHOA1    = ROA
         SIGMAAA1 = GRDAA
         RHOB1    = ROB
         SIGMABB1 = GRDBB
C
        TA1 = 0.5D+00*(TAUXA + TAUYA + TAUZA)
        TB1 = 0.5D+00*(TAUXB + TAUYB + TAUZB)
C
C          FOR EXPLANATION OF WORKAROUND, SEE THE UHF SECTION IN TPSSXF
C
        IF (MAX(SIGMAAA1,SIGMABB1).LE.GGALIM) THEN
           CALL UKS_X_PBE2 (NPT,RHOA1,RHOB1,SIGMAAA1,SIGMABB1,
     *                      ZK,VRHOA,VRHOB,VSIGMAAA,VSIGMAAB,VSIGMABB)
           VTA=0.0D+00
           VTB=0.0D+00
        ELSE
           CALL UKS_X_TPSSM(IDERIV,NPT,RHOA1,RHOB1,SIGMAAA1,SIGMABB1,
     *                      TA1,TB1,ZK,VRHOA,VRHOB,
     *                      VSIGMAAA,VSIGMAAB,VSIGMABB,VTA,VTB)
        END IF
C
              WAA = VSIGMAAA
              WBB = VSIGMABB
              WAB = VSIGMAAB
              FTA=VTA
              FTB=VTB
C
            VXCA1 = VXCA1 + VRHOA
            DUMAX = DUMAX + 2.0D+00*(WAA*GRADXA) + (WAB*GRADXB)*1.0D+00
            DUMAY = DUMAY + 2.0D+00*(WAA*GRADYA) + (WAB*GRADYB)*1.0D+00
            DUMAZ = DUMAZ + 2.0D+00*(WAA*GRADZA) + (WAB*GRADZB)*1.0D+00
            DMGGA = DMGGA + .5D+00*FTA
C
            VXCB1 = VXCB1 + VRHOB
            DUMBX = DUMBX + 2.0D+00*(WBB*GRADXB) + (WAB*GRADXA)*1.0D+00
            DUMBY = DUMBY + 2.0D+00*(WBB*GRADYB) + (WAB*GRADYA)*1.0D+00
            DUMBZ = DUMBZ + 2.0D+00*(WBB*GRADZB) + (WAB*GRADZA)*1.0D+00
            DMGGB = DMGGB + .5D+00*FTB
C
            XGRD = XGRD + ZK * FTOTWT
C
      END IF
C
      END
C*MODULE DFTXCE  *DECK TPSSCF
      SUBROUTINE TPSSCF(RHFGVB,UROHF,ROA,ROB,GRDAA,GRDBB,GRDAB,
     >        GRADXA,GRADYA,GRADZA,GRADXB,GRADYB,GRADZB,
     >        FTOTWT,ECF,
     >        VXCA1,DUMAX,DUMAY,DUMAZ,DMGGA,
     >        VXCB1,DUMBX,DUMBY,DUMBZ,DMGGB,
     >        TAUXA,TAUYA,TAUZA,TAUXB,TAUYB,TAUZB)
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      LOGICAL UROHF, RHFGVB
      PARAMETER (GGALIM=1D-13)
C
      IF(RHFGVB) THEN
C
         IDERIV   = 1
         NPT      = 1
         RHOA1    = 2.0D+00*ROA
         SIGMAAA1 = 4.0D+00*GRDAA
         TA1 = (TAUXA + TAUYA + TAUZA)
C
C          FOR EXPLANATION OF WORKAROUND, SEE THE UHF SECTION IN TPSSXF
C
        IF (SIGMAAA1.LE.GGALIM) THEN
           CALL RKS_C_PBE2 (NPT,RHOA1,SIGMAAA1,ZK,VRHOA,VSIGMAAA)
           VTA=0.0D+00
        ELSE
           CALL RKS_C_TPSS(IDERIV,NPT,RHOA1,SIGMAAA1,TA1,ZK,
     *                     VRHOA,VSIGMAAA,VTA)
        END IF
C
              WAA = VSIGMAAA
              FTA = VTA
C
            VXCA1 = VXCA1 + VRHOA
            DUMAX = DUMAX + 1.0D+00*(WAA*GRADXA)
            DUMAY = DUMAY + 1.0D+00*(WAA*GRADYA)
            DUMAZ = DUMAZ + 1.0D+00*(WAA*GRADZA)
            DMGGA = DMGGA + 0.5D+00*FTA
C
C            XGRD = XGRD + ZK * FTOTWT
            ECF = ECF + ZK * FTOTWT
C
      END IF
C
      IF(UROHF) THEN
C
         IDERIV   = 1
         NPT      = 1
         RHOA1    = ROA
         SIGMAAA1 = GRDAA
         RHOB1    = ROB
         SIGMABB1 = GRDBB
         SIGMAAB1 = GRDAB
C
         TA1 = .5D+00*(TAUXA + TAUYA + TAUZA)
         TB1 = .5D+00*(TAUXB + TAUYB + TAUZB)
C
C          FOR EXPLANATION OF WORKAROUND, SEE THE UHF SECTION IN TPSSXF
C
        IF (MAX(SIGMAAA1,SIGMABB1).LE.GGALIM) THEN
           CALL UKS_C_PBE2(NPT,RHOA1,RHOB1,SIGMAAA1,SIGMAAB1,SIGMABB1,
     *                     ZK,VRHOA,VRHOB,VSIGMAAA,VSIGMAAB,VSIGMABB)
           VTA=0.0D+00
           VTB=0.0D+00
        ELSE
           CALL UKS_C_TPSS(IDERIV,NPT,RHOA1,RHOB1,SIGMAAA1,
     *                     SIGMAAB1,SIGMABB1,TA1,TB1,ZK,VRHOA,VRHOB,
     *                     VSIGMAAA,VSIGMAAB,VSIGMABB,VTA,VTB)
        END IF
C
            WAA = VSIGMAAA
            WBB = VSIGMABB
            WAB = VSIGMAAB
            FTA = VTA
            FTB = VTB
C
            VXCA1 = VXCA1 + VRHOA
            DUMAX = DUMAX + 2.0D+00*(WAA*GRADXA) + (WAB*GRADXB)*1.0D+00
            DUMAY = DUMAY + 2.0D+00*(WAA*GRADYA) + (WAB*GRADYB)*1.0D+00
            DUMAZ = DUMAZ + 2.0D+00*(WAA*GRADZA) + (WAB*GRADZB)*1.0D+00
            DMGGA = DMGGA + .5D+00*FTA
C
            VXCB1 = VXCB1 + VRHOB
            DUMBX = DUMBX + 2.0D+00*(WBB*GRADXB) + (WAB*GRADXA)*1.0D+00
            DUMBY = DUMBY + 2.0D+00*(WBB*GRADYB) + (WAB*GRADYA)*1.0D+00
            DUMBZ = DUMBZ + 2.0D+00*(WBB*GRADZB) + (WAB*GRADZA)*1.0D+00
            DMGGB = DMGGB + .5D+00*FTB
C
            ECF = ECF + ZK * FTOTWT
C
      END IF
C
      END
C*MODULE DFTXCE  *DECK PKZBXF
      SUBROUTINE PKZBXF(RHFGVB,UROHF,ROA,ROB,GRDAA,GRDBB,
     >        GRADXA,GRADYA,GRADZA,GRADXB,GRADYB,GRADZB,
     >        FTOTWT,XGRD,
     >        VXCA1,DUMAX,DUMAY,DUMAZ,DMGGA,
     >        VXCB1,DUMBX,DUMBY,DUMBZ,DMGGB,
     >        TAUXA,TAUYA,TAUZA,TAUXB,TAUYB,TAUZB)
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      LOGICAL UROHF, RHFGVB
C
C
      IF(RHFGVB) THEN
C
         IDERIV   = 1
         NPT      = 1
         RHOA1    = 2.0D+00*ROA
         SIGMAAA1 = 4.0D+00*GRDAA
         TA1 = (TAUXA + TAUYA + TAUZA)
C
        CALL RKS_X_PKZB
     & (IDERIV,NPT,RHOA1,SIGMAAA1,
     &  TA1,ZK,VRHOA,VSIGMAAA,
     &  VTA)
C
              WAA = VSIGMAAA
              FTA = VTA
C
            VXCA1 = VXCA1 + VRHOA
            DUMAX = DUMAX + 1.0D+00*(WAA*GRADXA)
            DUMAY = DUMAY + 1.0D+00*(WAA*GRADYA)
            DUMAZ = DUMAZ + 1.0D+00*(WAA*GRADZA)
            DMGGA = DMGGA + 0.5D+00*FTA
C
            XGRD = XGRD + ZK * FTOTWT
C
      END IF
C
      IF(UROHF) THEN
C
         IDERIV   = 1
         NPT      = 1
         RHOA1    = ROA
         SIGMAAA1 = GRDAA
         RHOB1    = ROB
         SIGMABB1 = GRDBB
C
        TA1 = 0.5D+00*(TAUXA + TAUYA + TAUZA)
        TB1 = 0.5D+00*(TAUXB + TAUYB + TAUZB)
C
        CALL UKS_X_PKZB
     & (IDERIV,NPT,RHOA1,RHOB1,SIGMAAA1,SIGMABB1,
     &  TA1,TB1,
     &  ZK,VRHOA,VRHOB,VSIGMAAA,VSIGMAAB,VSIGMABB,
     &  VTA,VTB)
C
              WAA = VSIGMAAA
              WBB = VSIGMABB
              WAB = VSIGMAAB
              FTA=VTA
              FTB=VTB
C
            VXCA1 = VXCA1 + VRHOA
            DUMAX = DUMAX + 2.0D+00*(WAA*GRADXA) + (WAB*GRADXB)*1.0D+00
            DUMAY = DUMAY + 2.0D+00*(WAA*GRADYA) + (WAB*GRADYB)*1.0D+00
            DUMAZ = DUMAZ + 2.0D+00*(WAA*GRADZA) + (WAB*GRADZB)*1.0D+00
            DMGGA = DMGGA + .5D+00*FTA
C
            VXCB1 = VXCB1 + VRHOB
            DUMBX = DUMBX + 2.0D+00*(WBB*GRADXB) + (WAB*GRADXA)*1.0D+00
            DUMBY = DUMBY + 2.0D+00*(WBB*GRADYB) + (WAB*GRADYA)*1.0D+00
            DUMBZ = DUMBZ + 2.0D+00*(WBB*GRADZB) + (WAB*GRADZA)*1.0D+00
            DMGGB = DMGGB + .5D+00*FTB
C
            XGRD = XGRD + ZK * FTOTWT
C
      END IF
C
      END
C*MODULE DFTXCE  *DECK PKZBCF
      SUBROUTINE PKZBCF(RHFGVB,UROHF,ROA,ROB,GRDAA,GRDBB,GRDAB,
     >        GRADXA,GRADYA,GRADZA,GRADXB,GRADYB,GRADZB,
     >        FTOTWT,ECF,
     >        VXCA1,DUMAX,DUMAY,DUMAZ,DMGGA,
     >        VXCB1,DUMBX,DUMBY,DUMBZ,DMGGB,
     >        TAUXA,TAUYA,TAUZA,TAUXB,TAUYB,TAUZB)
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      LOGICAL UROHF, RHFGVB
C
C
      IF(RHFGVB) THEN
C
         IDERIV   = 1
         NPT      = 1
         RHOA1    = 2.0D+00*ROA
         SIGMAAA1 = 4.0D+00*GRDAA
         TA1 = (TAUXA + TAUYA + TAUZA)
C
       CALL RKS_C_PKZB
     & (IDERIV,NPT,RHOA1,SIGMAAA1,
     &  TA1,ZK,VRHOA,VSIGMAAA,
     &  VTA)
C
              WAA = VSIGMAAA
              FTA = VTA
C
            VXCA1 = VXCA1 + VRHOA
            DUMAX = DUMAX + 1.0D+00*(WAA*GRADXA)
            DUMAY = DUMAY + 1.0D+00*(WAA*GRADYA)
            DUMAZ = DUMAZ + 1.0D+00*(WAA*GRADZA)
            DMGGA = DMGGA + 0.5D+00*FTA
C
C            XGRD = XGRD + ZK * FTOTWT
            ECF = ECF + ZK * FTOTWT
C
      END IF
C
      IF(UROHF) THEN
C
         IDERIV   = 1
         NPT      = 1
         RHOA1    = ROA
         SIGMAAA1 = GRDAA
         RHOB1    = ROB
         SIGMABB1 = GRDBB
         SIGMAAB1 = GRDAB
C
        TA1 = .5D+00*(TAUXA + TAUYA + TAUZA)
        TB1 = .5D+00*(TAUXB + TAUYB + TAUZB)
C
       CALL UKS_C_PKZB
     & (IDERIV,NPT,RHOA1,RHOB1,SIGMAAA1,SIGMAAB1,SIGMABB1,
     &  TA1,TB1,
     &  ZK,VRHOA,VRHOB,VSIGMAAA,VSIGMAAB,VSIGMABB,
     &  VTA,VTB)
C
              WAA = VSIGMAAA
              WBB = VSIGMABB
              WAB = VSIGMAAB
              FTA = VTA
              FTB = VTB
C
            VXCA1 = VXCA1 + VRHOA
            DUMAX = DUMAX + 2.0D+00*(WAA*GRADXA) + (WAB*GRADXB)*1.0D+00
            DUMAY = DUMAY + 2.0D+00*(WAA*GRADYA) + (WAB*GRADYB)*1.0D+00
            DUMAZ = DUMAZ + 2.0D+00*(WAA*GRADZA) + (WAB*GRADZB)*1.0D+00
            DMGGA = DMGGA + .5D+00*FTA
C
            VXCB1 = VXCB1 + VRHOB
            DUMBX = DUMBX + 2.0D+00*(WBB*GRADXB) + (WAB*GRADXA)*1.0D+00
            DUMBY = DUMBY + 2.0D+00*(WBB*GRADYB) + (WAB*GRADYA)*1.0D+00
            DUMBZ = DUMBZ + 2.0D+00*(WBB*GRADZB) + (WAB*GRADZA)*1.0D+00
            DMGGB = DMGGB + .5D+00*FTB
C
            ECF = ECF + ZK * FTOTWT
C
      END IF
C
      END
C*MODULE DFTXCE  *DECK PBESXF
      SUBROUTINE PBESXF(RHFGVB,UROHF,ROA,ROB,GRDAA,GRDBB,
     >        GRADXA,GRADYA,GRADZA,GRADXB,GRADYB,GRADZB,
     >        FTOTWT,XGRD,
     >        VXCA1,DUMAX,DUMAY,DUMAZ,
     >        VXCB1,DUMBX,DUMBY,DUMBZ)
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      LOGICAL UROHF, RHFGVB
C
C
      IF(RHFGVB) THEN
C
         IDERIV   = 1
         NPT      = 1
         RHOA1    = 2.0D+00*ROA
         SIGMAAA1 = 4.0D+00*GRDAA
C
       CALL RKS_X_PBES
     & (IDERIV,NPT,RHOA1,SIGMAAA1,
     &  ZK,VRHOA,VSIGMAAA)
C
C
              WAA = VSIGMAAA
C
            VXCA1 = VXCA1 + VRHOA
            DUMAX = DUMAX + 1.0D+00*(WAA*GRADXA)
            DUMAY = DUMAY + 1.0D+00*(WAA*GRADYA)
            DUMAZ = DUMAZ + 1.0D+00*(WAA*GRADZA)
C
            XGRD = XGRD + ZK * FTOTWT
C
      END IF
C
      IF(UROHF) THEN
C
         IDERIV   = 1
         NPT      = 1
         RHOA1    = ROA
         SIGMAAA1 = GRDAA
         RHOB1    = ROB
         SIGMABB1 = GRDBB
C
       CALL UKS_X_PBES
     & (IDERIV,NPT,RHOA1,RHOB1,SIGMAAA1,SIGMABB1,
     &  ZK,VRHOA,VRHOB,VSIGMAAA,VSIGMAAB,VSIGMABB)
C
              WAA = VSIGMAAA
              WBB = VSIGMABB
              WAB = VSIGMAAB
C
            VXCA1 = VXCA1 + VRHOA
            DUMAX = DUMAX + 2.0D+00*(WAA*GRADXA) + (WAB*GRADXB)*1.0D+00
            DUMAY = DUMAY + 2.0D+00*(WAA*GRADYA) + (WAB*GRADYB)*1.0D+00
            DUMAZ = DUMAZ + 2.0D+00*(WAA*GRADZA) + (WAB*GRADZB)*1.0D+00
C
            VXCB1 = VXCB1 + VRHOB
            DUMBX = DUMBX + 2.0D+00*(WBB*GRADXB) + (WAB*GRADXA)*1.0D+00
            DUMBY = DUMBY + 2.0D+00*(WBB*GRADYB) + (WAB*GRADYA)*1.0D+00
            DUMBZ = DUMBZ + 2.0D+00*(WBB*GRADZB) + (WAB*GRADZA)*1.0D+00
C
            XGRD = XGRD + ZK * FTOTWT
C
      END IF
C
      END
C*MODULE DFTXCE  *DECK PBESCF
      SUBROUTINE PBESCF(RHFGVB,UROHF,ROA,ROB,GRDAA,GRDBB,GRDAB,
     >        GRADXA,GRADYA,GRADZA,GRADXB,GRADYB,GRADZB,
     >        FTOTWT,ECF,
     >        VXCA1,DUMAX,DUMAY,DUMAZ,
     >        VXCB1,DUMBX,DUMBY,DUMBZ)
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      LOGICAL UROHF, RHFGVB
C
C
      IF(RHFGVB) THEN
C
         IDERIV   = 1
         NPT      = 1
         RHOA1    = 2.0D+00*ROA
         SIGMAAA1 = 4.0D+00*GRDAA
C
       CALL  RKS_C_PBES
     & (IDERIV,NPT,RHOA1,SIGMAAA1,
     &  ZK,VRHOA,VSIGMAAA)
C
              WAA = VSIGMAAA
C
            VXCA1 = VXCA1 + VRHOA
            DUMAX = DUMAX + 1.0D+00*(WAA*GRADXA)
            DUMAY = DUMAY + 1.0D+00*(WAA*GRADYA)
            DUMAZ = DUMAZ + 1.0D+00*(WAA*GRADZA)
C
            ECF = ECF + ZK * FTOTWT
C
      END IF
C
      IF(UROHF) THEN
C
         IDERIV   = 1
         NPT      = 1
         RHOA1    = ROA
         SIGMAAA1 = GRDAA
         RHOB1    = ROB
         SIGMABB1 = GRDBB
         SIGMAAB1 = GRDAB
C
       CALL UKS_C_PBES
     & (IDERIV,NPT,RHOA1,RHOB1,SIGMAAA1,SIGMAAB1,SIGMABB1,
     &  ZK,VRHOA,VRHOB,VSIGMAAA,VSIGMAAB,VSIGMABB)
C
              WAA = VSIGMAAA
              WBB = VSIGMABB
              WAB = VSIGMAAB
C
            VXCA1 = VXCA1 + VRHOA
            DUMAX = DUMAX + 2.0D+00*(WAA*GRADXA) + (WAB*GRADXB)*1.0D+00
            DUMAY = DUMAY + 2.0D+00*(WAA*GRADYA) + (WAB*GRADYB)*1.0D+00
            DUMAZ = DUMAZ + 2.0D+00*(WAA*GRADZA) + (WAB*GRADZB)*1.0D+00
C
            VXCB1 = VXCB1 + VRHOB
            DUMBX = DUMBX + 2.0D+00*(WBB*GRADXB) + (WAB*GRADXA)*1.0D+00
            DUMBY = DUMBY + 2.0D+00*(WBB*GRADYB) + (WAB*GRADYA)*1.0D+00
            DUMBZ = DUMBZ + 2.0D+00*(WBB*GRADZB) + (WAB*GRADZA)*1.0D+00
C
            ECF = ECF + ZK * FTOTWT
C
      END IF
C
      END
C*MODULE DFTXCE  *DECK RPBEXF
      SUBROUTINE RPBEXF(RHFGVB,UROHF,ROA,ROB,GRDAA,GRDBB,
     >        GRADXA,GRADYA,GRADZA,GRADXB,GRADYB,GRADZB,
     >        FTOTWT,XGRD,
     >        VXCA1,DUMAX,DUMAY,DUMAZ,
     >        VXCB1,DUMBX,DUMBY,DUMBZ)
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      LOGICAL UROHF, RHFGVB
C
C
      IF(RHFGVB) THEN
C
         IDERIV   = 1
         NPT      = 1
         RHOA1    = 2.0D+00*ROA
         SIGMAAA1 = 4.0D+00*GRDAA
C
      CALL RKS_X_RPBE
     & (IDERIV,NPT,RHOA1,SIGMAAA1,
     &  ZK,VRHOA,VSIGMAAA)
C
C
              WAA = VSIGMAAA
C
            VXCA1 = VXCA1 + VRHOA
            DUMAX = DUMAX + 1.0D+00*(WAA*GRADXA)
            DUMAY = DUMAY + 1.0D+00*(WAA*GRADYA)
            DUMAZ = DUMAZ + 1.0D+00*(WAA*GRADZA)
C
            XGRD = XGRD + ZK * FTOTWT
C
      END IF
C
      IF(UROHF) THEN
C
         IDERIV   = 1
         NPT      = 1
         RHOA1    = ROA
         SIGMAAA1 = GRDAA
         RHOB1    = ROB
         SIGMABB1 = GRDBB
C
       CALL UKS_X_RPBE
     & (IDERIV,NPT,RHOA1,RHOB1,SIGMAAA1,SIGMABB1,
     &  ZK,VRHOA,VRHOB,VSIGMAAA,VSIGMAAB,VSIGMABB)
C
              WAA = VSIGMAAA
              WBB = VSIGMABB
              WAB = VSIGMAAB
C
            VXCA1 = VXCA1 + VRHOA
            DUMAX = DUMAX + 2.0D+00*(WAA*GRADXA) + (WAB*GRADXB)*1.0D+00
            DUMAY = DUMAY + 2.0D+00*(WAA*GRADYA) + (WAB*GRADYB)*1.0D+00
            DUMAZ = DUMAZ + 2.0D+00*(WAA*GRADZA) + (WAB*GRADZB)*1.0D+00
C
            VXCB1 = VXCB1 + VRHOB
            DUMBX = DUMBX + 2.0D+00*(WBB*GRADXB) + (WAB*GRADXA)*1.0D+00
            DUMBY = DUMBY + 2.0D+00*(WBB*GRADYB) + (WAB*GRADYA)*1.0D+00
            DUMBZ = DUMBZ + 2.0D+00*(WBB*GRADZB) + (WAB*GRADZA)*1.0D+00
C
            XGRD = XGRD + ZK * FTOTWT
C
      END IF
      RETURN
      END
C
C*MODULE DFTXCE  *DECK RKS_X_TPSS
      SUBROUTINE RKS_X_TPSS
     & (IDERIV,NPT,RHOA1,SIGMAAA1,
     &  TA1,ZK,VRHOA,VSIGMAAA,
     &  VTA)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      INTEGER IDERIV,NPT
      DOUBLE PRECISION RHOA1(NPT),TA1(NPT),SIGMAAA1(NPT)
      DOUBLE PRECISION ZK(NPT),VRHOA(NPT),VTA(NPT),VSIGMAAA(NPT)
      PARAMETER(TOL=1.0D-20)
C
      IF(IDERIV.EQ.0) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHO = 2.D+00*RHOA
      IF(RHO.GT.TOL) THEN
C      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
C     THE OUTSIDE IF-CONDITION GUARANTEES THE ABOVE
      SIGMAAA = SIGMAAA1(I)
C     IT PROBABLY GUARANTEES THE ONE BELOW AS WELL...
      TA = MAX(TOL,TA1(I))
C
      T1 = 1.0D+0*RHOA**((-8.0D+0)/3.0D+0)
      T2 = SIGMAAA**2
      T3 = 1.0D+0*RHOA**((-1.6D+1)/3.0D+0)
      T4 = 1.0D+0/RHOA**2
      T5 = 1.0D+0/TA**2
      T6 = 8.0D+0*RHOA*TA/SIGMAAA-1.0D+0
      T7 = 4.3535288308722675D-2*SIGMAAA*T1*T6-1.0D+0
      T8 = 4.5D-1*T7/SQRT(1.741411532348907D-2*SIGMAAA*T1*T6*T7+
     #1.0D+0)+1.741411532348907D-2*SIGMAAA*T1
      ZK(I) = -7.385587663820224D-1*(1.804D+0-8.04D-1/
     #(1.2437810945273631D+0*(6.013207674276903D-6*SIGMAAA**3/RHOA**8+
     #2.612117298523361D-2*T1*(2.485875D-2*T2*T4*T5/(1.5625D-2*T2*T4*T5+
     #1.0D+0)**2+1.2345679012345678D-1)*SIGMAAA+7.209876543209877D-2*T8*
     #*2-1.8024691358024691D-1*SQRT(2.8125000000000006D-3*T2*T4*T5+
     #3.411578390622491D-4*T2*T3)*T8+1.721886167929995D-3*T2*T4*T5+
     #1.2934786479970561D-5*T2*T3)/(3.238393424643389D-2*SIGMAAA*T1+
     #1.0D+0)**2+1.0D+0))*RHOA**(4.0D+0/3.0D+0)
C
      ELSE ! RHO
      ZK(I) = 0.0D0
      VRHOA(I) = 0.0D0
      VSIGMAAA(I) = 0.0D0
      VTA(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ELSE IF(IDERIV.EQ.1) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHO = 2.D+00*RHOA
      IF(RHO.GT.TOL) THEN
C      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
C     THE OUTSIDE IF-CONDITION GUARANTEES THE ABOVE
      SIGMAAA = SIGMAAA1(I)
C     IT PROBABLY GUARANTEES THE ONE BELOW AS WELL...
      TA = MAX(TOL,TA1(I))
C
      T1 = RHOA**(4.0D+0/3.0D+0)
      T2 = 1.0D+0*RHOA**((-8.0D+0)/3.0D+0)
      T3 = 3.238393424643389D-2*SIGMAAA*T2+1.0D+0
      T4 = 1.0D+0/T3**2
      T5 = SIGMAAA**3
      T6 = 1.0D+0/RHOA**8
      T7 = SIGMAAA**2
      T8 = 1.0D+0*RHOA**((-1.6D+1)/3.0D+0)
      T9 = 1.0D+0/RHOA**2
      T10 = 1.0D+0/TA**2
      T11 = 1.5625D-2*T7*T9*T10+1.0D+0
      T12 = 1.0D+0/T11**2
      T13 = 2.485875D-2*T7*T9*T12*T10+1.2345679012345678D-1
      T14 = SQRT(2.8125000000000006D-3*T7*T9*T10+
     #3.411578390622491D-4*T7*T8)
      T15 = 1.0D+0/SIGMAAA
      T16 = 8.0D+0*T15*RHOA*TA-1.0D+0
      T17 = 4.3535288308722675D-2*SIGMAAA*T2*T16-1.0D+0
      T18 = SQRT(1.741411532348907D-2*SIGMAAA*T2*T16*T17+1.0D+0)
      T19 = 1.0D+0/T18
      T20 = 1.741411532348907D-2*SIGMAAA*T2+4.5D-1*T17*T19
      T21 = 1.2934786479970561D-5*T7*T8+6.013207674276903D-6*T5*
     #T6+7.209876543209877D-2*T20**2-1.8024691358024691D-1*T14*T20+
     #2.612117298523361D-2*SIGMAAA*T2*T13+1.721886167929995D-3*T7*T9*T10
      T22 = 1.2437810945273631D+0*T4*T21+1.0D+0
      T23 = 1.804D+0-8.04D-1/T22
      T24 = 1.0D+0/T22**2
      T25 = 1.0D+0*RHOA**((-1.9D+1)/3.0D+0)
      T26 = 1.0D+0/RHOA**3
      T27 = SIGMAAA**4
      T28 = 1.0D+0/T11**3
      T29 = 1.0D+0/TA**4
      T30 = 1.0D+0*RHOA**((-1.1000000000000001D+1)/3.0D+0)
      T31 = 3.482823064697814D-1*T2*TA-1.160941021565938D-1*
     #SIGMAAA*T30*T16
      T32 = 1.0D+0/T18**3
      T33 = -2.25D-1*T17*(-4.6437640862637525D-2*SIGMAAA*T30*
     #T16*T17+1.3931292258791259D-1*T2*TA*T17+1.741411532348907D-2*
     #SIGMAAA*T2*T16*T31)*T32+4.5D-1*T19*T31-4.6437640862637525D-2*
     #SIGMAAA*T30
      T34 = 1.0D+0/T14
      T35 = 1.0D+0/T3**3
      T36 = 1.0D+0/RHOA**4
      T37 = 1.0D+0*RHOA**((-5.0D+0)/3.0D+0)
      T38 = 4.3535288308722675D-2*T2*T16-3.482823064697814D-1*
     #T15*T37*TA
      T39 = 4.5D-1*T19*T38-2.25D-1*T17*(1.741411532348907D-2*T2*
     #T16*T17-1.3931292258791259D-1*T15*T37*TA*T17+1.741411532348907D-2*
     #SIGMAAA*T2*T16*T38)*T32+1.741411532348907D-2*T2
      T40 = 1.0D+0/TA**3
      T41 = 1.5672703791140163D-1*T37*T19-2.25D-1*T17*T32*
     #(6.065028249995538D-3*T16*SIGMAAA*RHOA**((-1.3D+1)/3.0D+0)+
     #1.3931292258791259D-1*T37*T17)
      ZK(I) = -7.385587663820224D-1*T1*T23
      VRHOA(I) = -5.938012481711461D-1*T1*T24*
     #(1.2437810945273631D+0*T4*(2.612117298523361D-2*T2*SIGMAAA*
     #(1.553671875D-3*T27*T28*T29/RHOA**5-4.97175D-2*T7*T26*T12*T10)-
     #4.810566139421522D-5*T5/RHOA**9-9.012345679012346D-2*
     #(-5.625000000000001D-3*T7*T26*T10-1.819508474998662D-3*T7*T25)*
     #T20*T34+1.4419753086419754D-1*T20*T33-1.8024691358024691D-1*T14*
     #T33-6.898552789317631D-5*T7*T25-6.96564612939563D-2*SIGMAAA*T30*
     #T13-3.44377233585999D-3*T7*T26*T10)+2.1481880097136907D-1*SIGMAAA*
     #T35*T30*T21)-9.847450218426965D-1*RHOA**(1.0D+0/3.0D+0)*T23
      VSIGMAAA(I) = -2.3752049926845845D+0*T1*T24*
     #(1.2437810945273631D+0*T4*(2.5869572959941123D-5*SIGMAAA*T8+
     #1.8039623022830706D-5*T7*T6+1.4419753086419754D-1*T20*T39-
     #1.8024691358024691D-1*T14*T39-9.012345679012346D-2*
     #(5.625000000000001D-3*SIGMAAA*T9*T10+6.823156781244982D-4*SIGMAAA*
     #T8)*T20*T34+2.612117298523361D-2*T2*T13+2.612117298523361D-2*
     #SIGMAAA*T2*(4.97175D-2*SIGMAAA*T9*T12*T10-1.553671875D-3*T5*T36*
     #T28*T29)+3.44377233585999D-3*SIGMAAA*T9*T10)-8.05570503642634D-2*
     #T35*T2*T21)
      VTA(I) = -7.385587663820224D-1*T1*T24*T4*
     #(2.612117298523361D-2*T2*SIGMAAA*(1.553671875D-3*T27*T28*T36/TA**
     #5-4.97175D-2*T7*T9*T12*T40)+1.4419753086419754D-1*T20*T41-
     #1.8024691358024691D-1*T14*T41-3.44377233585999D-3*T7*T9*T40+
     #5.069444444444446D-4*T7*T9*T34*T40*T20)
C
      ELSE ! RHO
      ZK(I) = 0.0D0
      VRHOA(I) = 0.0D0
      VSIGMAAA(I) = 0.0D0
      VTA(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ENDIF
      RETURN
      END
C*MODULE DFTXCE  *DECK UKS_X_TPSS
      SUBROUTINE UKS_X_TPSS
     & (IDERIV,NPT,RHOA1,RHOB1,SIGMAAA1,SIGMABB1,
     &  TA1,TB1,
     &  ZK,VRHOA,VRHOB,VSIGMAAA,VSIGMAAB,VSIGMABB,
     &  VTA,VTB)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      INTEGER NPT
      DOUBLE PRECISION RHOA1(NPT),RHOB1(NPT)
      DOUBLE PRECISION TA1(NPT),TB1(NPT)
      DOUBLE PRECISION SIGMAAA1(NPT),SIGMABB1(NPT)
      DOUBLE PRECISION ZK(NPT),VRHOA(NPT),VRHOB(NPT)
      DOUBLE PRECISION VTA(NPT),VTB(NPT)
      DOUBLE PRECISION VSIGMAAA(NPT),VSIGMAAB(NPT),VSIGMABB(NPT)
      PARAMETER(TOL=1.0D-20)
C
      IF (IDERIV.EQ.0) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHOB = MAX(0.D0,RHOB1(I))
      RHO = RHOA+RHOB
      IF(RHO.GT.TOL) THEN
      IF(RHOA.LT.TOL) THEN
C     THE FOLLOWING GUARANTEES STRICTLY POSITIVE VALUES
      SIGMABB = MAX(TOL,SIGMABB1(I))
      TB = MAX(TOL,TB1(I))
C
      T1 = 6.299605249474366D-1
      T2 = 1.0D+0*RHOB**((-8.0D+0)/3.0D+0)
      T3 = SIGMABB**2
      T4 = 1.0D+0*RHOB**((-1.6D+1)/3.0D+0)
      T5 = 1.0D+0/RHOB**2
      T6 = 1.0D+0/TB**2
      T7 = 8.0D+0*RHOB*TB/SIGMABB-1.0D+0
      T8 = 4.3535288308722675D-2*T1*SIGMABB*T2*T7-1.0D+0
      T9 = 4.5D-1*T8/SQRT(1.741411532348907D-2*T1*SIGMABB*T2*T7*
     #T8+1.0D+0)+1.741411532348907D-2*T1*SIGMABB*T2
      ZK(I) = -9.305257363491D-1*(1.804D+0-8.04D-1/
     #(1.2437810945273631D+0*(1.5033019185692256D-6*SIGMABB**3/RHOB**8+
     #2.612117298523361D-2*T1*T2*(2.485875D-2*T3*T5*T6/(1.5625D-2*T3*T5*
     #T6+1.0D+0)**2+1.2345679012345678D-1)*SIGMABB+7.209876543209877D-2*
     #T9**2-1.8024691358024691D-1*SQRT(2.8125D-3*T3*T5*T6+
     #1.3538857815365302D-4*T3*T4)*T9+1.7218861679299946D-3*T3*T5*T6+
     #5.133173416322327D-6*T3*T4)/(3.238393424643389D-2*T1*SIGMABB*T2+
     #1.0D+0)**2+1.0D+0))*RHOB**(4.0D+0/3.0D+0)
C
      ELSEIF(RHOB.LT.TOL) THEN
C     THE FOLLOWING GUARANTEES STRICTLY POSITIVE VALUES
      SIGMAAA = MAX(TOL,SIGMAAA1(I))
      TA = MAX(TOL,TA1(I))
C
      T1 = 6.299605249474366D-1
      T2 = 1.0D+0*RHOA**((-8.0D+0)/3.0D+0)
      T3 = SIGMAAA**2
      T4 = 1.0D+0*RHOA**((-1.6D+1)/3.0D+0)
      T5 = 1.0D+0/RHOA**2
      T6 = 1.0D+0/TA**2
      T7 = 8.0D+0*RHOA*TA/SIGMAAA-1.0D+0
      T8 = 4.3535288308722675D-2*T1*SIGMAAA*T2*T7-1.0D+0
      T9 = 4.5D-1*T8/SQRT(1.741411532348907D-2*T1*SIGMAAA*T2*T7*
     #T8+1.0D+0)+1.741411532348907D-2*T1*SIGMAAA*T2
      ZK(I) = -9.305257363491D-1*(1.804D+0-8.04D-1/
     #(1.2437810945273631D+0*(1.5033019185692256D-6*SIGMAAA**3/RHOA**8+
     #2.612117298523361D-2*T1*T2*(2.485875D-2*T3*T5*T6/(1.5625D-2*T3*T5*
     #T6+1.0D+0)**2+1.2345679012345678D-1)*SIGMAAA+7.209876543209877D-2*
     #T9**2-1.8024691358024691D-1*SQRT(2.8125D-3*T3*T5*T6+
     #1.3538857815365302D-4*T3*T4)*T9+1.7218861679299946D-3*T3*T5*T6+
     #5.133173416322327D-6*T3*T4)/(3.238393424643389D-2*T1*SIGMAAA*T2+
     #1.0D+0)**2+1.0D+0))*RHOA**(4.0D+0/3.0D+0)
C
      ELSE ! (.NOT.(RHOA.LT.TOL).AND..NOT.(RHOB.LT.TOL))
C     THE FOLLOWING GUARANTEES STRICTLY POSITIVE VALUES
      SIGMAAA = MAX(TOL,SIGMAAA1(I))
      SIGMABB = MAX(TOL,SIGMABB1(I))
      TA = MAX(TOL,TA1(I))
      TB = MAX(TOL,TB1(I))
C
      T1 = 6.299605249474366D-1
      T2 = 1.0D+0*RHOA**((-8.0D+0)/3.0D+0)
      T3 = 7.937005259840997D-1
      T4 = SIGMAAA**2
      T5 = 1.0D+0*RHOA**((-1.6D+1)/3.0D+0)
      T6 = 1.0D+0/RHOA**2
      T7 = 1.0D+0/TA**2
      T8 = 3.9685026299204995D-1
      T9 = 8.0D+0*RHOA*TA/SIGMAAA-1.0D+0
      T10 = 4.3535288308722675D-2*T1*SIGMAAA*T2*T9-1.0D+0
      T11 = 1.741411532348907D-2*T1*SIGMAAA*T2+4.5D-1*T10/
     #SQRT(1.741411532348907D-2*T1*SIGMAAA*T2*T9*T10+1.0D+0)
      T12 = 1.0D+0*RHOB**((-8.0D+0)/3.0D+0)
      T13 = SIGMABB**2
      T14 = 1.0D+0*RHOB**((-1.6D+1)/3.0D+0)
      T15 = 1.0D+0/RHOB**2
      T16 = 8.0D+0*RHOB*TA/SIGMABB-1.0D+0
      T17 = 4.3535288308722675D-2*T1*SIGMABB*T12*T16-1.0D+0
      T18 = 4.5D-1*T17/SQRT(1.741411532348907D-2*T1*SIGMABB*T12*
     #T16*T17+1.0D+0)+1.741411532348907D-2*T1*SIGMABB*T12
      ZK(I) = -9.305257363491D-1*(1.804D+0-8.04D-1/
     #(1.2437810945273631D+0*(1.5033019185692256D-6*SIGMABB**3/RHOB**8+
     #2.612117298523361D-2*T1*T12*(2.485875D-2*T13*T15*T7/(1.5625D-2*
     #T13*T15*T7+1.0D+0)**2+1.2345679012345678D-1)*SIGMABB-
     #1.8024691358024691D-1*T18*SQRT(2.8125D-3*T13*T15*T7+
     #3.411578390622491D-4*T8*T13*T14)+1.7218861679299946D-3*T13*T15*T7+
     #7.209876543209877D-2*T18**2+6.46739323998528D-6*T3*T13*T14)/
     #(3.238393424643389D-2*T1*SIGMABB*T12+1.0D+0)**2+1.0D+0))*RHOB**
     #(4.0D+0/3.0D+0)-9.305257363491D-1*(1.804D+0-8.04D-1/
     #(1.2437810945273631D+0*(1.5033019185692256D-6*SIGMAAA**3/RHOA**8+
     #2.612117298523361D-2*T1*T2*(2.485875D-2*T4*T6*T7/(1.5625D-2*T4*T6*
     #T7+1.0D+0)**2+1.2345679012345678D-1)*SIGMAAA-
     #1.8024691358024691D-1*T11*SQRT(2.8125D-3*T4*T6*T7+
     #3.411578390622491D-4*T8*T4*T5)+1.7218861679299946D-3*T4*T6*T7+
     #6.46739323998528D-6*T3*T4*T5+7.209876543209877D-2*T11**2)/
     #(3.238393424643389D-2*T1*SIGMAAA*T2+1.0D+0)**2+1.0D+0))*RHOA**
     #(4.0D+0/3.0D+0)
C
      ENDIF ! RHOA,RHOB
      ELSE ! RHO
      ZK(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ELSE IF(IDERIV.EQ.1) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHOB = MAX(0.D0,RHOB1(I))
      RHO = RHOA+RHOB
      IF(RHO.GT.TOL) THEN
      IF(RHOA.LT.TOL) THEN
C     THE FOLLOWING GUARANTEES STRICTLY POSITIVE VALUES
      SIGMABB = MAX(TOL,SIGMABB1(I))
      TB = MAX(TOL,TB1(I))
C
      T1 = RHOB**(4.0D+0/3.0D+0)
      T2 = 6.299605249474366D-1
      T3 = 1.0D+0*RHOB**((-8.0D+0)/3.0D+0)
      T4 = 3.238393424643389D-2*T2*SIGMABB*T3+1.0D+0
      T5 = 1.0D+0/T4**2
      T6 = SIGMABB**3
      T7 = 1.0D+0/RHOB**8
      T8 = 7.937005259840997D-1
      T9 = SIGMABB**2
      T10 = 1.0D+0*RHOB**((-1.6D+1)/3.0D+0)
      T11 = 1.0D+0/RHOB**2
      T12 = 1.0D+0/TB**2
      T13 = 1.5625D-2*T11*T12*T9+1.0D+0
      T14 = 1.0D+0/T13**2
      T15 = 2.485875D-2*T9*T11*T14*T12+1.2345679012345678D-1
      T16 = 3.9685026299204995D-1
      T17 = SQRT(2.8125D-3*T11*T12*T9+3.411578390622491D-4*T16*
     #T9*T10)
      T18 = 1.0D+0/SIGMABB
      T19 = 8.0D+0*T18*RHOB*TB-1.0D+0
      T20 = 4.3535288308722675D-2*T2*SIGMABB*T3*T19-1.0D+0
      T21 = SQRT(1.741411532348907D-2*T2*SIGMABB*T3*T19*T20+
     #1.0D+0)
      T22 = 1.0D+0/T21
      T23 = 1.741411532348907D-2*T2*SIGMABB*T3+4.5D-1*T20*T22
      T24 = 1.5033019185692256D-6*T6*T7+7.209876543209877D-2*
     #T23**2-1.8024691358024691D-1*T17*T23+2.612117298523361D-2*T2*
     #SIGMABB*T3*T15+1.7218861679299946D-3*T9*T11*T12+
     #6.46739323998528D-6*T8*T9*T10
      T25 = 1.2437810945273631D+0*T5*T24+1.0D+0
      T26 = 1.804D+0-8.04D-1/T25
      T27 = 1.0D+0/T25**2
      T28 = 1.0D+0*RHOB**((-1.9D+1)/3.0D+0)
      T29 = 1.0D+0/RHOB**3
      T30 = SIGMABB**4
      T31 = 1.0D+0/T13**3
      T32 = 1.0D+0/TB**4
      T33 = 1.0D+0*RHOB**((-1.1000000000000001D+1)/3.0D+0)
      T34 = 3.482823064697814D-1*T2*T3*TB-1.160941021565938D-1*
     #T2*SIGMABB*T33*T19
      T35 = 1.0D+0/T21**3
      T36 = -2.25D-1*T20*(-4.6437640862637525D-2*T2*SIGMABB*T33*
     #T19*T20+1.3931292258791259D-1*T2*T3*TB*T20+1.741411532348907D-2*
     #T2*SIGMABB*T3*T19*T34)*T35+4.5D-1*T22*T34-4.6437640862637525D-2*
     #T2*SIGMABB*T33
      T37 = 1.0D+0/T17
      T38 = 1.0D+0/T4**3
      T39 = 1.0D+0/RHOB**4
      T40 = 1.0D+0*RHOB**((-5.0D+0)/3.0D+0)
      T41 = 4.3535288308722675D-2*T2*T3*T19-
     #3.482823064697814D-1*T2*T18*T40*TB
      T42 = 4.5D-1*T22*T41-2.25D-1*T20*(1.741411532348907D-2*T2*
     #T3*T19*T20-1.3931292258791259D-1*T2*T18*T40*TB*T20+
     #1.741411532348907D-2*T2*SIGMABB*T3*T19*T41)*T35+
     #1.741411532348907D-2*T2*T3
      T43 = 1.0D+0/TB**3
      T44 = 1.5672703791140163D-1*T2*T40*T22-2.25D-1*T20*T35*
     #(3.032514124997769D-3*T19*T8*SIGMABB*RHOB**((-1.3D+1)/3.0D+0)+
     #1.3931292258791259D-1*T2*T40*T20)
      ZK(I) = -9.305257363491D-1*T1*T26
      VRHOA(I) = 0.0D+0
      VRHOB(I) = -7.481426920246764D-1*T1*T27*
     #(1.2437810945273631D+0*T5*(2.612117298523361D-2*T2*T3*SIGMABB*
     #(1.553671875D-3*T30*T31*T32/RHOB**5-4.97175D-2*T9*T29*T14*T12)-
     #1.2026415348553805D-5*T6/RHOB**9-9.012345679012346D-2*T23*T37*
     #(-5.625D-3*T12*T29*T9-1.819508474998662D-3*T16*T9*T28)+
     #1.4419753086419754D-1*T23*T36-1.8024691358024691D-1*T17*T36-
     #3.4492763946588156D-5*T8*T9*T28-6.96564612939563D-2*T2*SIGMABB*
     #T33*T15-3.443772335859989D-3*T9*T29*T12)+2.1481880097136907D-1*T2*
     #SIGMABB*T38*T33*T24)-1.2407009817987999D+0*RHOB**(1.0D+0/3.0D+0)*
     #T26
      VSIGMAAA(I) = 0.0D+0
      VSIGMAAB(I) = 0.0D+0
      VSIGMABB(I) = -7.481426920246764D-1*T1*T27*
     #(1.2437810945273631D+0*T5*(-9.012345679012346D-2*T23*T37*
     #(5.625D-3*T11*T12*SIGMABB+6.823156781244982D-4*T16*SIGMABB*T10)+
     #4.5099057557076766D-6*T9*T7+1.4419753086419754D-1*T23*T42-
     #1.8024691358024691D-1*T17*T42+2.612117298523361D-2*T2*T3*T15+
     #2.612117298523361D-2*T2*SIGMABB*T3*(4.97175D-2*SIGMABB*T11*T14*
     #T12-1.553671875D-3*T6*T39*T31*T32)+3.443772335859989D-3*SIGMABB*
     #T11*T12+1.2934786479970561D-5*T8*SIGMABB*T10)-8.05570503642634D-2*
     #T2*T38*T3*T24)
      VTA(I) = 0.0D+0
      VTB(I) = -9.305257363491D-1*T1*T27*T5*
     #(2.612117298523361D-2*T2*T3*SIGMABB*(1.553671875D-3*T30*T31*T39/
     #TB**5-4.97175D-2*T9*T11*T14*T43)+5.069444444444444D-4*T11*T23*T37*
     #T43*T9+1.4419753086419754D-1*T23*T44-1.8024691358024691D-1*T17*
     #T44-3.443772335859989D-3*T9*T11*T43)
C
      ELSEIF(RHOB.LT.TOL) THEN
C     THE FOLLOWING GUARANTEES STRICTLY POSITIVE VALUES
      SIGMAAA = MAX(TOL,SIGMAAA1(I))
      TA = MAX(TOL,TA1(I))
C
      T1 = RHOA**(4.0D+0/3.0D+0)
      T2 = 6.299605249474366D-1
      T3 = 1.0D+0*RHOA**((-8.0D+0)/3.0D+0)
      T4 = 3.238393424643389D-2*T2*SIGMAAA*T3+1.0D+0
      T5 = 1.0D+0/T4**2
      T6 = SIGMAAA**3
      T7 = 1.0D+0/RHOA**8
      T8 = 7.937005259840997D-1
      T9 = SIGMAAA**2
      T10 = 1.0D+0*RHOA**((-1.6D+1)/3.0D+0)
      T11 = 1.0D+0/RHOA**2
      T12 = 1.0D+0/TA**2
      T13 = 1.5625D-2*T11*T12*T9+1.0D+0
      T14 = 1.0D+0/T13**2
      T15 = 2.485875D-2*T9*T11*T14*T12+1.2345679012345678D-1
      T16 = 3.9685026299204995D-1
      T17 = SQRT(2.8125D-3*T11*T12*T9+3.411578390622491D-4*T16*
     #T9*T10)
      T18 = 1.0D+0/SIGMAAA
      T19 = 8.0D+0*T18*RHOA*TA-1.0D+0
      T20 = 4.3535288308722675D-2*T2*SIGMAAA*T3*T19-1.0D+0
      T21 = SQRT(1.741411532348907D-2*T2*SIGMAAA*T3*T19*T20+
     #1.0D+0)
      T22 = 1.0D+0/T21
      T23 = 1.741411532348907D-2*T2*SIGMAAA*T3+4.5D-1*T20*T22
      T24 = 1.5033019185692256D-6*T6*T7+7.209876543209877D-2*
     #T23**2-1.8024691358024691D-1*T17*T23+2.612117298523361D-2*T2*
     #SIGMAAA*T3*T15+1.7218861679299946D-3*T9*T11*T12+
     #6.46739323998528D-6*T8*T9*T10
      T25 = 1.2437810945273631D+0*T5*T24+1.0D+0
      T26 = 1.804D+0-8.04D-1/T25
      T27 = 1.0D+0/T25**2
      T28 = 1.0D+0*RHOA**((-1.9D+1)/3.0D+0)
      T29 = 1.0D+0/RHOA**3
      T30 = SIGMAAA**4
      T31 = 1.0D+0/T13**3
      T32 = 1.0D+0/TA**4
      T33 = 1.0D+0*RHOA**((-1.1000000000000001D+1)/3.0D+0)
      T34 = 3.482823064697814D-1*T2*T3*TA-1.160941021565938D-1*
     #T2*SIGMAAA*T33*T19
      T35 = 1.0D+0/T21**3
      T36 = -2.25D-1*T20*(-4.6437640862637525D-2*T2*SIGMAAA*T33*
     #T19*T20+1.3931292258791259D-1*T2*T3*TA*T20+1.741411532348907D-2*
     #T2*SIGMAAA*T3*T19*T34)*T35+4.5D-1*T22*T34-4.6437640862637525D-2*
     #T2*SIGMAAA*T33
      T37 = 1.0D+0/T17
      T38 = 1.0D+0/T4**3
      T39 = 1.0D+0/RHOA**4
      T40 = 1.0D+0*RHOA**((-5.0D+0)/3.0D+0)
      T41 = 4.3535288308722675D-2*T2*T3*T19-
     #3.482823064697814D-1*T2*T18*T40*TA
      T42 = 4.5D-1*T22*T41-2.25D-1*T20*(1.741411532348907D-2*T2*
     #T3*T19*T20-1.3931292258791259D-1*T2*T18*T40*TA*T20+
     #1.741411532348907D-2*T2*SIGMAAA*T3*T19*T41)*T35+
     #1.741411532348907D-2*T2*T3
      T43 = 1.0D+0/TA**3
      T44 = 1.5672703791140163D-1*T2*T40*T22-2.25D-1*T20*T35*
     #(3.032514124997769D-3*T19*T8*SIGMAAA*RHOA**((-1.3D+1)/3.0D+0)+
     #1.3931292258791259D-1*T2*T40*T20)
      ZK(I) = -9.305257363491D-1*T1*T26
      VRHOA(I) = -7.481426920246764D-1*T1*T27*
     #(1.2437810945273631D+0*T5*(2.612117298523361D-2*T2*T3*SIGMAAA*
     #(1.553671875D-3*T30*T31*T32/RHOA**5-4.97175D-2*T9*T29*T14*T12)-
     #1.2026415348553805D-5*T6/RHOA**9-9.012345679012346D-2*T23*T37*
     #(-5.625D-3*T12*T29*T9-1.819508474998662D-3*T16*T9*T28)+
     #1.4419753086419754D-1*T23*T36-1.8024691358024691D-1*T17*T36-
     #3.4492763946588156D-5*T8*T9*T28-6.96564612939563D-2*T2*SIGMAAA*
     #T33*T15-3.443772335859989D-3*T9*T29*T12)+2.1481880097136907D-1*T2*
     #SIGMAAA*T38*T33*T24)-1.2407009817987999D+0*RHOA**(1.0D+0/3.0D+0)*
     #T26
      VRHOB(I) = 0.0D+0
      VSIGMAAA(I) = -7.481426920246764D-1*T1*T27*
     #(1.2437810945273631D+0*T5*(-9.012345679012346D-2*T23*T37*
     #(5.625D-3*T11*T12*SIGMAAA+6.823156781244982D-4*T16*SIGMAAA*T10)+
     #4.5099057557076766D-6*T9*T7+1.4419753086419754D-1*T23*T42-
     #1.8024691358024691D-1*T17*T42+2.612117298523361D-2*T2*T3*T15+
     #2.612117298523361D-2*T2*SIGMAAA*T3*(4.97175D-2*SIGMAAA*T11*T14*
     #T12-1.553671875D-3*T6*T39*T31*T32)+3.443772335859989D-3*SIGMAAA*
     #T11*T12+1.2934786479970561D-5*T8*SIGMAAA*T10)-8.05570503642634D-2*
     #T2*T38*T3*T24)
      VSIGMAAB(I) = 0.0D+0
      VSIGMABB(I) = 0.0D+0
      VTA(I) = -9.305257363491D-1*T1*T27*T5*
     #(2.612117298523361D-2*T2*T3*SIGMAAA*(1.553671875D-3*T30*T31*T39/
     #TA**5-4.97175D-2*T9*T11*T14*T43)+5.069444444444444D-4*T11*T23*T37*
     #T43*T9+1.4419753086419754D-1*T23*T44-1.8024691358024691D-1*T17*
     #T44-3.443772335859989D-3*T9*T11*T43)
      VTB(I) = 0.0D+0
C
      ELSE ! (.NOT.(RHOA.LT.TOL).AND..NOT.(RHOB.LT.TOL))
C     THE FOLLOWING GUARANTEES STRICTLY POSITIVE VALUES
      SIGMAAA = MAX(TOL,SIGMAAA1(I))
      SIGMABB = MAX(TOL,SIGMABB1(I))
      TA = MAX(TOL,TA1(I))
      TB = MAX(TOL,TB1(I))
C
      T1 = RHOA**(4.0D+0/3.0D+0)
      T2 = 6.299605249474366D-1
      T3 = 1.0D+0*RHOA**((-8.0D+0)/3.0D+0)
      T4 = 3.238393424643389D-2*T2*SIGMAAA*T3+1.0D+0
      T5 = 1.0D+0/T4**2
      T6 = SIGMAAA**3
      T7 = 1.0D+0/RHOA**8
      T8 = 7.937005259840997D-1
      T9 = SIGMAAA**2
      T10 = 1.0D+0*RHOA**((-1.6D+1)/3.0D+0)
      T11 = 1.0D+0/RHOA**2
      T12 = 1.0D+0/TA**2
      T13 = 1.5625D-2*T11*T12*T9+1.0D+0
      T14 = 1.0D+0/T13**2
      T15 = 2.485875D-2*T9*T11*T14*T12+1.2345679012345678D-1
      T16 = 3.9685026299204995D-1
      T17 = SQRT(2.8125D-3*T11*T12*T9+3.411578390622491D-4*T16*
     #T9*T10)
      T18 = 1.0D+0/SIGMAAA
      T19 = 8.0D+0*T18*RHOA*TA-1.0D+0
      T20 = 4.3535288308722675D-2*T2*SIGMAAA*T3*T19-1.0D+0
      T21 = SQRT(1.741411532348907D-2*T2*SIGMAAA*T3*T19*T20+
     #1.0D+0)
      T22 = 1.0D+0/T21
      T23 = 1.741411532348907D-2*T2*SIGMAAA*T3+4.5D-1*T20*T22
      T24 = 1.5033019185692256D-6*T6*T7+7.209876543209877D-2*
     #T23**2-1.8024691358024691D-1*T17*T23+2.612117298523361D-2*T2*
     #SIGMAAA*T3*T15+1.7218861679299946D-3*T9*T11*T12+
     #6.46739323998528D-6*T8*T9*T10
      T25 = 1.2437810945273631D+0*T5*T24+1.0D+0
      T26 = 1.804D+0-8.04D-1/T25
      T27 = RHOB**(4.0D+0/3.0D+0)
      T28 = 1.0D+0*RHOB**((-8.0D+0)/3.0D+0)
      T29 = 3.238393424643389D-2*T2*SIGMABB*T28+1.0D+0
      T30 = 1.0D+0/T29**2
      T31 = SIGMABB**3
      T32 = 1.0D+0/RHOB**8
      T33 = SIGMABB**2
      T34 = 1.0D+0*RHOB**((-1.6D+1)/3.0D+0)
      T35 = 1.0D+0/RHOB**2
      T36 = 1.0D+0/TB**2
      T37 = 1.5625D-2*T33*T35*T36+1.0D+0
      T38 = 1.0D+0/T37**2
      T39 = 2.485875D-2*T33*T35*T38*T36+1.2345679012345678D-1
      T40 = SQRT(2.8125D-3*T33*T35*T36+3.411578390622491D-4*T16*
     #T33*T34)
      T41 = 1.0D+0/SIGMABB
      T42 = 8.0D+0*T41*RHOB*TB-1.0D+0
      T43 = 4.3535288308722675D-2*T2*SIGMABB*T28*T42-1.0D+0
      T44 = SQRT(1.741411532348907D-2*T2*SIGMABB*T28*T42*T43+
     #1.0D+0)
      T45 = 1.0D+0/T44
      T46 = 4.5D-1*T43*T45+1.741411532348907D-2*T2*SIGMABB*T28
      T47 = 7.209876543209877D-2*T46**2-1.8024691358024691D-1*
     #T40*T46+2.612117298523361D-2*T2*SIGMABB*T28*T39+
     #1.7218861679299946D-3*T33*T35*T36+6.46739323998528D-6*T8*T33*T34+
     #1.5033019185692256D-6*T31*T32
      T48 = 1.2437810945273631D+0*T30*T47+1.0D+0
      T49 = 1.804D+0-8.04D-1/T48
      T50 = 1.0D+0/T25**2
      T51 = 1.0D+0*RHOA**((-1.9D+1)/3.0D+0)
      T52 = 1.0D+0/RHOA**3
      T53 = SIGMAAA**4
      T54 = 1.0D+0/T13**3
      T55 = 1.0D+0/TA**4
      T56 = 1.0D+0*RHOA**((-1.1000000000000001D+1)/3.0D+0)
      T57 = 3.482823064697814D-1*T2*T3*TA-1.160941021565938D-1*
     #T2*SIGMAAA*T56*T19
      T58 = 1.0D+0/T21**3
      T59 = -2.25D-1*T20*(-4.6437640862637525D-2*T2*SIGMAAA*T56*
     #T19*T20+1.3931292258791259D-1*T2*T3*TA*T20+1.741411532348907D-2*
     #T2*SIGMAAA*T3*T19*T57)*T58+4.5D-1*T22*T57-4.6437640862637525D-2*
     #T2*SIGMAAA*T56
      T60 = 1.0D+0/T17
      T61 = 1.0D+0/T4**3
      T62 = 1.0D+0/T48**2
      T63 = 1.0D+0*RHOB**((-1.9D+1)/3.0D+0)
      T64 = 1.0D+0/RHOB**3
      T65 = SIGMABB**4
      T66 = 1.0D+0/T37**3
      T67 = 1.0D+0/TB**4
      T68 = 1.0D+0*RHOB**((-1.1000000000000001D+1)/3.0D+0)
      T69 = 3.482823064697814D-1*T2*T28*TB-1.160941021565938D-1*
     #T2*SIGMABB*T68*T42
      T70 = 1.0D+0/T44**3
      T71 = -2.25D-1*T43*(-4.6437640862637525D-2*T2*SIGMABB*T68*
     #T42*T43+1.3931292258791259D-1*T2*T28*TB*T43+1.741411532348907D-2*
     #T2*SIGMABB*T28*T42*T69)*T70+4.5D-1*T45*T69-4.6437640862637525D-2*
     #T2*SIGMABB*T68
      T72 = 1.0D+0/T40
      T73 = 1.0D+0/T29**3
      T74 = 1.0D+0/RHOA**4
      T75 = 1.0D+0*RHOA**((-5.0D+0)/3.0D+0)
      T76 = 4.3535288308722675D-2*T2*T3*T19-
     #3.482823064697814D-1*T2*T18*T75*TA
      T77 = 4.5D-1*T22*T76-2.25D-1*T20*(1.741411532348907D-2*T2*
     #T3*T19*T20-1.3931292258791259D-1*T2*T18*T75*TA*T20+
     #1.741411532348907D-2*T2*SIGMAAA*T3*T19*T76)*T58+
     #1.741411532348907D-2*T2*T3
      T78 = 1.0D+0/RHOB**4
      T79 = 1.0D+0*RHOB**((-5.0D+0)/3.0D+0)
      T80 = 4.3535288308722675D-2*T2*T28*T42-
     #3.482823064697814D-1*T2*T41*T79*TB
      T81 = 4.5D-1*T45*T80-2.25D-1*T43*(1.741411532348907D-2*T2*
     #T28*T42*T43-1.3931292258791259D-1*T2*T41*T79*TB*T43+
     #1.741411532348907D-2*T2*SIGMABB*T28*T42*T80)*T70+
     #1.741411532348907D-2*T2*T28
      T82 = 1.0D+0/TA**3
      T83 = 1.5672703791140163D-1*T2*T75*T22-2.25D-1*T20*T58*
     #(3.032514124997769D-3*T19*T8*SIGMAAA*RHOA**((-1.3D+1)/3.0D+0)+
     #1.3931292258791259D-1*T2*T75*T20)
      T84 = 1.0D+0/TB**3
      T85 = 1.5672703791140163D-1*T2*T79*T45-2.25D-1*T43*T70*
     #(3.032514124997769D-3*T42*T8*SIGMABB*RHOB**((-1.3D+1)/3.0D+0)+
     #1.3931292258791259D-1*T2*T79*T43)
      ZK(I) = -9.305257363491D-1*T27*T49-9.305257363491D-1*T1*
     #T26
      VRHOA(I) = -7.481426920246764D-1*T1*T50*
     #(1.2437810945273631D+0*T5*(2.612117298523361D-2*T2*T3*SIGMAAA*
     #(1.553671875D-3*T53*T54*T55/RHOA**5-4.97175D-2*T9*T52*T14*T12)-
     #1.2026415348553805D-5*T6/RHOA**9-9.012345679012346D-2*T23*T60*
     #(-5.625D-3*T12*T52*T9-1.819508474998662D-3*T16*T9*T51)+
     #1.4419753086419754D-1*T23*T59-1.8024691358024691D-1*T17*T59-
     #3.4492763946588156D-5*T8*T9*T51-6.96564612939563D-2*T2*SIGMAAA*
     #T56*T15-3.443772335859989D-3*T9*T52*T12)+2.1481880097136907D-1*T2*
     #SIGMAAA*T61*T56*T24)-1.2407009817987999D+0*RHOA**(1.0D+0/3.0D+0)*
     #T26
      VRHOB(I) = -7.481426920246764D-1*T27*T62*
     #(1.2437810945273631D+0*T30*(2.612117298523361D-2*T2*T28*SIGMABB*
     #(1.553671875D-3*T65*T66*T67/RHOB**5-4.97175D-2*T33*T64*T38*T36)-
     #1.2026415348553805D-5*T31/RHOB**9-9.012345679012346D-2*T46*
     #(-5.625D-3*T33*T36*T64-1.819508474998662D-3*T16*T33*T63)*T72+
     #1.4419753086419754D-1*T46*T71-1.8024691358024691D-1*T40*T71-
     #3.4492763946588156D-5*T8*T33*T63-6.96564612939563D-2*T2*SIGMABB*
     #T68*T39-3.443772335859989D-3*T33*T64*T36)+2.1481880097136907D-1*
     #T2*SIGMABB*T73*T68*T47)-1.2407009817987999D+0*RHOB**(1.0D+0/
     #3.0D+0)*T49
      VSIGMAAA(I) = -7.481426920246764D-1*T1*T50*
     #(1.2437810945273631D+0*T5*(-9.012345679012346D-2*T23*T60*
     #(5.625D-3*T11*T12*SIGMAAA+6.823156781244982D-4*T16*SIGMAAA*T10)+
     #1.4419753086419754D-1*T23*T77-1.8024691358024691D-1*T17*T77+
     #4.5099057557076766D-6*T9*T7+2.612117298523361D-2*T2*T3*T15+
     #2.612117298523361D-2*T2*SIGMAAA*T3*(4.97175D-2*SIGMAAA*T11*T14*
     #T12-1.553671875D-3*T6*T74*T54*T55)+3.443772335859989D-3*SIGMAAA*
     #T11*T12+1.2934786479970561D-5*T8*SIGMAAA*T10)-8.05570503642634D-2*
     #T2*T61*T3*T24)
      VSIGMAAB(I) = 0.0D0
      VSIGMABB(I) = -7.481426920246764D-1*T27*T62*
     #(1.2437810945273631D+0*T30*(-9.012345679012346D-2*T46*T72*
     #(5.625D-3*T35*T36*SIGMABB+6.823156781244982D-4*T16*SIGMABB*T34)+
     #1.4419753086419754D-1*T46*T81-1.8024691358024691D-1*T40*T81+
     #2.612117298523361D-2*T2*T28*T39+2.612117298523361D-2*T2*SIGMABB*
     #T28*(4.97175D-2*SIGMABB*T35*T38*T36-1.553671875D-3*T31*T78*T66*
     #T67)+3.443772335859989D-3*SIGMABB*T35*T36+1.2934786479970561D-5*
     #T8*SIGMABB*T34+4.5099057557076766D-6*T33*T32)-8.05570503642634D-2*
     #T2*T73*T28*T47)
      VTA(I) = -9.305257363491D-1*T1*T5*T50*
     #(2.612117298523361D-2*T2*T3*SIGMAAA*(1.553671875D-3*T53*T54*T74/
     #TA**5-4.97175D-2*T9*T11*T14*T82)+5.069444444444444D-4*T11*T23*T60*
     #T82*T9+1.4419753086419754D-1*T23*T83-1.8024691358024691D-1*T17*
     #T83-3.443772335859989D-3*T9*T11*T82)
      VTB(I) = -9.305257363491D-1*T27*T30*T62*
     #(2.612117298523361D-2*T2*T28*SIGMABB*(1.553671875D-3*T65*T66*T78/
     #TB**5-4.97175D-2*T33*T35*T38*T84)+1.4419753086419754D-1*T46*T85-
     #1.8024691358024691D-1*T40*T85+5.069444444444444D-4*T33*T35*T46*
     #T72*T84-3.443772335859989D-3*T33*T35*T84)
C
      ENDIF ! RHOA,RHOB
      ELSE ! RHO
      ZK(I) = 0.0D0
      VRHOA(I) = 0.0D0
      VRHOB(I) = 0.0D0
      VSIGMAAA(I) = 0.0D0
      VSIGMAAB(I) = 0.0D0
      VSIGMABB(I) = 0.0D0
      VTA(I) = 0.0D0
      VTB(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ENDIF ! IDERIV
      RETURN
      END
C*MODULE DFTXCE  *DECK RKS_X_TPSSM
      SUBROUTINE RKS_X_TPSSM
     & (IDERIV,NPT,RHOA1,SIGMAAA1,
     &  TA1,ZK,VRHOA,VSIGMAAA,
     &  VTA)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      INTEGER IDERIV,NPT
      DOUBLE PRECISION RHOA1(NPT),TA1(NPT),SIGMAAA1(NPT)
      DOUBLE PRECISION ZK(NPT),VRHOA(NPT),VTA(NPT),VSIGMAAA(NPT)
      PARAMETER(TOL=1.0D-20)
C
      IF(IDERIV.EQ.0) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHO = 2.D+00*RHOA
      IF(RHO.GT.TOL) THEN
C      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
C     THE OUTSIDE IF-CONDITION GUARANTEES THE ABOVE
      SIGMAAA = SIGMAAA1(I)
C     IT PROBABLY GUARANTEES THE ONE BELOW AS WELL...
      TA = MAX(TOL,TA1(I))
C
      T1 = 1.0D+0*RHOA**((-8.0D+0)/3.0D+0)
      T2 = SIGMAAA**2
      T3 = 1.0D+0*RHOA**((-1.6D+1)/3.0D+0)
      T4 = 1.0D+0/RHOA**2
      T5 = 1.0D+0/TA**2
      T6 = 8.0D+0*RHOA*TA/SIGMAAA-1.0D+0
      T7 = 4.3535288308722675D-2*SIGMAAA*T1*T6-1.0D+0
      T8 = 4.5D-1*T7/SQRT(1.741411532348907D-2*SIGMAAA*T1*T6*T7+
     #1.0D+0)+1.741411532348907D-2*SIGMAAA*T1
      ZK(I) = -7.385587663820224D-1*(1.804D+0-8.04D-1/
     #(1.2437810945273631D+0*(6.153173113901433D-6*SIGMAAA**3/RHOA**8+
     #2.612117298523361D-2*T1*(2.1639999999999998D-2*T2*T4*T5/
     #(1.5625D-2*T2*T4*T5+1.0D+0)**2+1.2345679012345678D-1)*SIGMAAA+
     #7.209876543209877D-2*T8**2-1.8024691358024691D-1*
     #SQRT(2.8125000000000006D-3*T2*T4*T5+3.411578390622491D-4*T2*T3)*
     #T8+1.625652765377726D-3*T2*T4*T5+1.2934786479970561D-5*T2*T3)/
     #(3.057404911081557D-2*SIGMAAA*T1+1.0D+0)**2+1.0D+0))*RHOA**
     #(4.0D+0/3.0D+0)
C
      ELSE ! RHO
      ZK(I) = 0.0D0
      VRHOA(I) = 0.0D0
      VSIGMAAA(I) = 0.0D0
      VTA(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ELSE IF(IDERIV.EQ.1) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHO = 2.D+00*RHOA
      IF(RHO.GT.TOL) THEN
C      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
C     THE OUTSIDE IF-CONDITION GUARANTEES THE ABOVE
      SIGMAAA = SIGMAAA1(I)
C     IT PROBABLY GUARANTEES THE ONE BELOW AS WELL...
      TA = MAX(TOL,TA1(I))
C
      T1 = RHOA**(4.0D+0/3.0D+0)
      T2 = 1.0D+0*RHOA**((-8.0D+0)/3.0D+0)
      T3 = 3.057404911081557D-2*SIGMAAA*T2+1.0D+0
      T4 = 1.0D+0/T3**2
      T5 = SIGMAAA**3
      T6 = 1.0D+0/RHOA**8
      T7 = SIGMAAA**2
      T8 = 1.0D+0*RHOA**((-1.6D+1)/3.0D+0)
      T9 = 1.0D+0/RHOA**2
      T10 = 1.0D+0/TA**2
      T11 = 1.5625D-2*T7*T9*T10+1.0D+0
      T12 = 1.0D+0/T11**2
      T13 = 2.1639999999999998D-2*T7*T9*T12*T10+
     #1.2345679012345678D-1
      T14 = SQRT(2.8125000000000006D-3*T7*T9*T10+
     #3.411578390622491D-4*T7*T8)
      T15 = 1.0D+0/SIGMAAA
      T16 = 8.0D+0*T15*RHOA*TA-1.0D+0
      T17 = 4.3535288308722675D-2*SIGMAAA*T2*T16-1.0D+0
      T18 = SQRT(1.741411532348907D-2*SIGMAAA*T2*T16*T17+1.0D+0)
      T19 = 1.0D+0/T18
      T20 = 1.741411532348907D-2*SIGMAAA*T2+4.5D-1*T17*T19
      T21 = 1.2934786479970561D-5*T7*T8+6.153173113901433D-6*T5*
     #T6+7.209876543209877D-2*T20**2-1.8024691358024691D-1*T14*T20+
     #2.612117298523361D-2*SIGMAAA*T2*T13+1.625652765377726D-3*T7*T9*T10
      T22 = 1.2437810945273631D+0*T4*T21+1.0D+0
      T23 = 1.804D+0-8.04D-1/T22
      T24 = 1.0D+0/T22**2
      T25 = 1.0D+0*RHOA**((-1.9D+1)/3.0D+0)
      T26 = 1.0D+0/RHOA**3
      T27 = SIGMAAA**4
      T28 = 1.0D+0/T11**3
      T29 = 1.0D+0/TA**4
      T30 = 1.0D+0*RHOA**((-1.1000000000000001D+1)/3.0D+0)
      T31 = 3.482823064697814D-1*T2*TA-1.160941021565938D-1*
     #SIGMAAA*T30*T16
      T32 = 1.0D+0/T18**3
      T33 = -2.25D-1*T17*(-4.6437640862637525D-2*SIGMAAA*T30*
     #T16*T17+1.3931292258791259D-1*T2*TA*T17+1.741411532348907D-2*
     #SIGMAAA*T2*T16*T31)*T32+4.5D-1*T19*T31-4.6437640862637525D-2*
     #SIGMAAA*T30
      T34 = 1.0D+0/T14
      T35 = 1.0D+0/T3**3
      T36 = 1.0D+0/RHOA**4
      T37 = 1.0D+0*RHOA**((-5.0D+0)/3.0D+0)
      T38 = 4.3535288308722675D-2*T2*T16-3.482823064697814D-1*
     #T15*T37*TA
      T39 = 4.5D-1*T19*T38-2.25D-1*T17*(1.741411532348907D-2*T2*
     #T16*T17-1.3931292258791259D-1*T15*T37*TA*T17+1.741411532348907D-2*
     #SIGMAAA*T2*T16*T38)*T32+1.741411532348907D-2*T2
      T40 = 1.0D+0/TA**3
      T41 = 1.5672703791140163D-1*T37*T19-2.25D-1*T17*T32*
     #(6.065028249995538D-3*T16*SIGMAAA*RHOA**((-1.3D+1)/3.0D+0)+
     #1.3931292258791259D-1*T37*T17)
      ZK(I) = -7.385587663820224D-1*T1*T23
      VRHOA(I) = -5.938012481711461D-1*T1*T24*
     #(1.2437810945273631D+0*T4*(2.612117298523361D-2*T2*SIGMAAA*
     #(1.3524999999999998D-3*T27*T28*T29/RHOA**5-4.3279999999999996D-2*
     #T7*T26*T12*T10)-4.9225384911211467D-5*T5/RHOA**9-
     #9.012345679012346D-2*(-5.625000000000001D-3*T7*T26*T10-
     #1.819508474998662D-3*T7*T25)*T20*T34+1.4419753086419754D-1*T20*
     #T33-1.8024691358024691D-1*T14*T33-6.898552789317631D-5*T7*T25-
     #6.96564612939563D-2*SIGMAAA*T30*T13-3.251305530755452D-3*T7*T26*
     #T10)+2.028129294249789D-1*SIGMAAA*T35*T30*T21)-
     #9.847450218426965D-1*RHOA**(1.0D+0/3.0D+0)*T23
      VSIGMAAA(I) = -2.3752049926845845D+0*T1*T24*
     #(1.2437810945273631D+0*T4*(2.5869572959941123D-5*SIGMAAA*T8+
     #1.8459519341704297D-5*T7*T6+1.4419753086419754D-1*T20*T39-
     #1.8024691358024691D-1*T14*T39-9.012345679012346D-2*
     #(5.625000000000001D-3*SIGMAAA*T9*T10+6.823156781244982D-4*SIGMAAA*
     #T8)*T20*T34+2.612117298523361D-2*T2*T13+2.612117298523361D-2*
     #SIGMAAA*T2*(4.3279999999999996D-2*SIGMAAA*T9*T12*T10-
     #1.3524999999999998D-3*T5*T36*T28*T29)+3.251305530755452D-3*
     #SIGMAAA*T9*T10)-7.60548485343671D-2*T35*T2*T21)
      VTA(I) = -7.385587663820224D-1*T1*T24*T4*
     #(2.612117298523361D-2*T2*SIGMAAA*(1.3524999999999998D-3*T27*T28*
     #T36/TA**5-4.3279999999999996D-2*T7*T9*T12*T40)+
     #1.4419753086419754D-1*T20*T41-1.8024691358024691D-1*T14*T41-
     #3.251305530755452D-3*T7*T9*T40+5.069444444444446D-4*T7*T9*T34*T40*
     #T20)
C
      ELSE ! RHO
      ZK(I) = 0.0D0
      VRHOA(I) = 0.0D0
      VSIGMAAA(I) = 0.0D0
      VTA(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ENDIF
      RETURN
      END
C*MODULE DFTXCE  *DECK UKS_X_TPSSM
      SUBROUTINE UKS_X_TPSSM
     & (IDERIV,NPT,RHOA1,RHOB1,SIGMAAA1,SIGMABB1,
     &  TA1,TB1,
     &  ZK,VRHOA,VRHOB,VSIGMAAA,VSIGMAAB,VSIGMABB,
     &  VTA,VTB)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      INTEGER NPT
      DOUBLE PRECISION RHOA1(NPT),RHOB1(NPT)
      DOUBLE PRECISION TA1(NPT),TB1(NPT)
      DOUBLE PRECISION SIGMAAA1(NPT),SIGMABB1(NPT)
      DOUBLE PRECISION ZK(NPT),VRHOA(NPT),VRHOB(NPT)
      DOUBLE PRECISION VTA(NPT),VTB(NPT)
      DOUBLE PRECISION VSIGMAAA(NPT),VSIGMAAB(NPT),VSIGMABB(NPT)
      PARAMETER(TOL=1.0D-20)
C
      IF (IDERIV.EQ.0) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHOB = MAX(0.D0,RHOB1(I))
      RHO = RHOA+RHOB
      IF(RHO.GT.TOL) THEN
      IF(RHOA.LT.TOL) THEN
C     THE FOLLOWING GUARANTEES STRICTLY POSITIVE VALUES
      SIGMABB = MAX(TOL,SIGMABB1(I))
      TB = MAX(TOL,TB1(I))
C
      T1 = 6.299605249474366D-1
      T2 = 1.0D+0*RHOB**((-8.0D+0)/3.0D+0)
      T3 = SIGMABB**2
      T4 = 1.0D+0*RHOB**((-1.6D+1)/3.0D+0)
      T5 = 1.0D+0/RHOB**2
      T6 = 1.0D+0/TB**2
      T7 = 8.0D+0*RHOB*TB/SIGMABB-1.0D+0
      T8 = 4.3535288308722675D-2*T1*SIGMABB*T2*T7-1.0D+0
      T9 = 4.5D-1*T8/SQRT(1.741411532348907D-2*T1*SIGMABB*T2*T7*
     #T8+1.0D+0)+1.741411532348907D-2*T1*SIGMABB*T2
      ZK(I) = -9.305257363491D-1*(1.804D+0-8.04D-1/
     #(1.2437810945273631D+0*(1.5382932784753583D-6*SIGMABB**3/RHOB**8+
     #2.612117298523361D-2*T1*T2*(2.1639999999999998D-2*T3*T5*T6/
     #(1.5625D-2*T3*T5*T6+1.0D+0)**2+1.2345679012345678D-1)*SIGMABB+
     #7.209876543209877D-2*T9**2-1.8024691358024691D-1*SQRT(2.8125D-3*
     #T3*T5*T6+1.3538857815365302D-4*T3*T4)*T9+1.6256527653777256D-3*T3*
     #T5*T6+5.133173416322327D-6*T3*T4)/(3.057404911081557D-2*T1*
     #SIGMABB*T2+1.0D+0)**2+1.0D+0))*RHOB**(4.0D+0/3.0D+0)
C
      ELSEIF(RHOB.LT.TOL) THEN
C     THE FOLLOWING GUARANTEES STRICTLY POSITIVE VALUES
      SIGMAAA = MAX(TOL,SIGMAAA1(I))
      TA = MAX(TOL,TA1(I))
C
      T1 = 6.299605249474366D-1
      T2 = 1.0D+0*RHOA**((-8.0D+0)/3.0D+0)
      T3 = SIGMAAA**2
      T4 = 1.0D+0*RHOA**((-1.6D+1)/3.0D+0)
      T5 = 1.0D+0/RHOA**2
      T6 = 1.0D+0/TA**2
      T7 = 8.0D+0*RHOA*TA/SIGMAAA-1.0D+0
      T8 = 4.3535288308722675D-2*T1*SIGMAAA*T2*T7-1.0D+0
      T9 = 4.5D-1*T8/SQRT(1.741411532348907D-2*T1*SIGMAAA*T2*T7*
     #T8+1.0D+0)+1.741411532348907D-2*T1*SIGMAAA*T2
      ZK(I) = -9.305257363491D-1*(1.804D+0-8.04D-1/
     #(1.2437810945273631D+0*(1.5382932784753583D-6*SIGMAAA**3/RHOA**8+
     #2.612117298523361D-2*T1*T2*(2.1639999999999998D-2*T3*T5*T6/
     #(1.5625D-2*T3*T5*T6+1.0D+0)**2+1.2345679012345678D-1)*SIGMAAA+
     #7.209876543209877D-2*T9**2-1.8024691358024691D-1*SQRT(2.8125D-3*
     #T3*T5*T6+1.3538857815365302D-4*T3*T4)*T9+1.6256527653777256D-3*T3*
     #T5*T6+5.133173416322327D-6*T3*T4)/(3.057404911081557D-2*T1*
     #SIGMAAA*T2+1.0D+0)**2+1.0D+0))*RHOA**(4.0D+0/3.0D+0)
C
      ELSE ! (.NOT.(RHOA.LT.TOL).AND..NOT.(RHOB.LT.TOL))
C     THE FOLLOWING GUARANTEES STRICTLY POSITIVE VALUES
      SIGMAAA = MAX(TOL,SIGMAAA1(I))
      SIGMABB = MAX(TOL,SIGMABB1(I))
      TA = MAX(TOL,TA1(I))
      TB = MAX(TOL,TB1(I))
C
      T1 = 6.299605249474366D-1
      T2 = 1.0D+0*RHOA**((-8.0D+0)/3.0D+0)
      T3 = 7.937005259840997D-1
      T4 = SIGMAAA**2
      T5 = 1.0D+0*RHOA**((-1.6D+1)/3.0D+0)
      T6 = 1.0D+0/RHOA**2
      T7 = 1.0D+0/TA**2
      T8 = 3.9685026299204995D-1
      T9 = 8.0D+0*RHOA*TA/SIGMAAA-1.0D+0
      T10 = 4.3535288308722675D-2*T1*SIGMAAA*T2*T9-1.0D+0
      T11 = 1.741411532348907D-2*T1*SIGMAAA*T2+4.5D-1*T10/
     #SQRT(1.741411532348907D-2*T1*SIGMAAA*T2*T9*T10+1.0D+0)
      T12 = 1.0D+0*RHOB**((-8.0D+0)/3.0D+0)
      T13 = SIGMABB**2
      T14 = 1.0D+0*RHOB**((-1.6D+1)/3.0D+0)
      T15 = 1.0D+0/RHOB**2
      T16 = 8.0D+0*RHOB*TA/SIGMABB-1.0D+0
      T17 = 4.3535288308722675D-2*T1*SIGMABB*T12*T16-1.0D+0
      T18 = 4.5D-1*T17/SQRT(1.741411532348907D-2*T1*SIGMABB*T12*
     #T16*T17+1.0D+0)+1.741411532348907D-2*T1*SIGMABB*T12
      ZK(I) = -9.305257363491D-1*(1.804D+0-8.04D-1/
     #(1.2437810945273631D+0*(1.5382932784753583D-6*SIGMABB**3/RHOB**8+
     #2.612117298523361D-2*T1*T12*(2.1639999999999998D-2*T13*T15*T7/
     #(1.5625D-2*T13*T15*T7+1.0D+0)**2+1.2345679012345678D-1)*SIGMABB-
     #1.8024691358024691D-1*T18*SQRT(2.8125D-3*T13*T15*T7+
     #3.411578390622491D-4*T8*T13*T14)+1.6256527653777256D-3*T13*T15*T7+
     #7.209876543209877D-2*T18**2+6.46739323998528D-6*T3*T13*T14)/
     #(3.057404911081557D-2*T1*SIGMABB*T12+1.0D+0)**2+1.0D+0))*RHOB**
     #(4.0D+0/3.0D+0)-9.305257363491D-1*(1.804D+0-8.04D-1/
     #(1.2437810945273631D+0*(1.5382932784753583D-6*SIGMAAA**3/RHOA**8+
     #2.612117298523361D-2*T1*T2*(2.1639999999999998D-2*T4*T6*T7/
     #(1.5625D-2*T4*T6*T7+1.0D+0)**2+1.2345679012345678D-1)*SIGMAAA-
     #1.8024691358024691D-1*T11*SQRT(2.8125D-3*T4*T6*T7+
     #3.411578390622491D-4*T8*T4*T5)+1.6256527653777256D-3*T4*T6*T7+
     #6.46739323998528D-6*T3*T4*T5+7.209876543209877D-2*T11**2)/
     #(3.057404911081557D-2*T1*SIGMAAA*T2+1.0D+0)**2+1.0D+0))*RHOA**
     #(4.0D+0/3.0D+0)
C
      ENDIF ! RHOA,RHOB
      ELSE ! RHO
      ZK(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ELSE IF(IDERIV.EQ.1) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHOB = MAX(0.D0,RHOB1(I))
      RHO = RHOA+RHOB
      IF(RHO.GT.TOL) THEN
      IF(RHOA.LT.TOL) THEN
C     THE FOLLOWING GUARANTEES STRICTLY POSITIVE VALUES
      SIGMABB = MAX(TOL,SIGMABB1(I))
      TB = MAX(TOL,TB1(I))
C
      T1 = RHOB**(4.0D+0/3.0D+0)
      T2 = 6.299605249474366D-1
      T3 = 1.0D+0*RHOB**((-8.0D+0)/3.0D+0)
      T4 = 3.057404911081557D-2*T2*SIGMABB*T3+1.0D+0
      T5 = 1.0D+0/T4**2
      T6 = SIGMABB**3
      T7 = 1.0D+0/RHOB**8
      T8 = 7.937005259840997D-1
      T9 = SIGMABB**2
      T10 = 1.0D+0*RHOB**((-1.6D+1)/3.0D+0)
      T11 = 1.0D+0/RHOB**2
      T12 = 1.0D+0/TB**2
      T13 = 1.5625D-2*T11*T12*T9+1.0D+0
      T14 = 1.0D+0/T13**2
      T15 = 2.1639999999999998D-2*T9*T11*T14*T12+
     #1.2345679012345678D-1
      T16 = 3.9685026299204995D-1
      T17 = SQRT(2.8125D-3*T11*T12*T9+3.411578390622491D-4*T16*
     #T9*T10)
      T18 = 1.0D+0/SIGMABB
      T19 = 8.0D+0*T18*RHOB*TB-1.0D+0
      T20 = 4.3535288308722675D-2*T2*SIGMABB*T3*T19-1.0D+0
      T21 = SQRT(1.741411532348907D-2*T2*SIGMABB*T3*T19*T20+
     #1.0D+0)
      T22 = 1.0D+0/T21
      T23 = 1.741411532348907D-2*T2*SIGMABB*T3+4.5D-1*T20*T22
      T24 = 1.5382932784753583D-6*T6*T7+7.209876543209877D-2*
     #T23**2-1.8024691358024691D-1*T17*T23+2.612117298523361D-2*T2*
     #SIGMABB*T3*T15+1.6256527653777256D-3*T9*T11*T12+
     #6.46739323998528D-6*T8*T9*T10
      T25 = 1.2437810945273631D+0*T5*T24+1.0D+0
      T26 = 1.804D+0-8.04D-1/T25
      T27 = 1.0D+0/T25**2
      T28 = 1.0D+0*RHOB**((-1.9D+1)/3.0D+0)
      T29 = 1.0D+0/RHOB**3
      T30 = SIGMABB**4
      T31 = 1.0D+0/T13**3
      T32 = 1.0D+0/TB**4
      T33 = 1.0D+0*RHOB**((-1.1000000000000001D+1)/3.0D+0)
      T34 = 3.482823064697814D-1*T2*T3*TB-1.160941021565938D-1*
     #T2*SIGMABB*T33*T19
      T35 = 1.0D+0/T21**3
      T36 = -2.25D-1*T20*(-4.6437640862637525D-2*T2*SIGMABB*T33*
     #T19*T20+1.3931292258791259D-1*T2*T3*TB*T20+1.741411532348907D-2*
     #T2*SIGMABB*T3*T19*T34)*T35+4.5D-1*T22*T34-4.6437640862637525D-2*
     #T2*SIGMABB*T33
      T37 = 1.0D+0/T17
      T38 = 1.0D+0/T4**3
      T39 = 1.0D+0/RHOB**4
      T40 = 1.0D+0*RHOB**((-5.0D+0)/3.0D+0)
      T41 = 4.3535288308722675D-2*T2*T3*T19-
     #3.482823064697814D-1*T2*T18*T40*TB
      T42 = 4.5D-1*T22*T41-2.25D-1*T20*(1.741411532348907D-2*T2*
     #T3*T19*T20-1.3931292258791259D-1*T2*T18*T40*TB*T20+
     #1.741411532348907D-2*T2*SIGMABB*T3*T19*T41)*T35+
     #1.741411532348907D-2*T2*T3
      T43 = 1.0D+0/TB**3
      T44 = 1.5672703791140163D-1*T2*T40*T22-2.25D-1*T20*T35*
     #(3.032514124997769D-3*T19*T8*SIGMABB*RHOB**((-1.3D+1)/3.0D+0)+
     #1.3931292258791259D-1*T2*T40*T20)
      ZK(I) = -9.305257363491D-1*T1*T26
      VRHOA(I) = 0.0D+0
      VRHOB(I) = -7.481426920246764D-1*T1*T27*
     #(1.2437810945273631D+0*T5*(2.612117298523361D-2*T2*T3*SIGMABB*
     #(1.3524999999999998D-3*T30*T31*T32/RHOB**5-4.3279999999999996D-2*
     #T9*T29*T14*T12)-1.2306346227802867D-5*T6/RHOB**9-
     #9.012345679012346D-2*T23*T37*(-5.625D-3*T12*T29*T9-
     #1.819508474998662D-3*T16*T9*T28)+1.4419753086419754D-1*T23*T36-
     #1.8024691358024691D-1*T17*T36-3.4492763946588156D-5*T8*T9*T28-
     #6.96564612939563D-2*T2*SIGMABB*T33*T15-3.251305530755451D-3*T9*
     #T29*T12)+2.028129294249789D-1*T2*SIGMABB*T38*T33*T24)-
     #1.2407009817987999D+0*RHOB**(1.0D+0/3.0D+0)*T26
      VSIGMAAA(I) = 0.0D+0
      VSIGMAAB(I) = 0.0D+0
      VSIGMABB(I) = -7.481426920246764D-1*T1*T27*
     #(1.2437810945273631D+0*T5*(-9.012345679012346D-2*T23*T37*
     #(5.625D-3*T11*T12*SIGMABB+6.823156781244982D-4*T16*SIGMABB*T10)+
     #4.6148798354260745D-6*T9*T7+1.4419753086419754D-1*T23*T42-
     #1.8024691358024691D-1*T17*T42+2.612117298523361D-2*T2*T3*T15+
     #2.612117298523361D-2*T2*SIGMABB*T3*(4.3279999999999996D-2*SIGMABB*
     #T11*T14*T12-1.3524999999999998D-3*T6*T39*T31*T32)+
     #3.251305530755451D-3*SIGMABB*T11*T12+1.2934786479970561D-5*T8*
     #SIGMABB*T10)-7.60548485343671D-2*T2*T38*T3*T24)
      VTA(I) = 0.0D+0
      VTB(I) = -9.305257363491D-1*T1*T27*T5*
     #(2.612117298523361D-2*T2*T3*SIGMAAA*(1.3524999999999998D-3*T30*
     #T31*T39/TA**5-4.3279999999999996D-2*T9*T11*T14*T43)+
     #5.069444444444444D-4*T11*T23*T37*T43*T9+1.4419753086419754D-1*T23*
     #T44-1.8024691358024691D-1*T17*T44-3.251305530755451D-3*T9*T11*T43)
C
      ELSEIF(RHOB.LT.TOL) THEN
C     THE FOLLOWING GUARANTEES STRICTLY POSITIVE VALUES
      SIGMAAA = MAX(TOL,SIGMAAA1(I))
      TA = MAX(TOL,TA1(I))
C
      T1 = RHOA**(4.0D+0/3.0D+0)
      T2 = 6.299605249474366D-1
      T3 = 1.0D+0*RHOA**((-8.0D+0)/3.0D+0)
      T4 = 3.057404911081557D-2*T2*SIGMAAA*T3+1.0D+0
      T5 = 1.0D+0/T4**2
      T6 = SIGMAAA**3
      T7 = 1.0D+0/RHOA**8
      T8 = 7.937005259840997D-1
      T9 = SIGMAAA**2
      T10 = 1.0D+0*RHOA**((-1.6D+1)/3.0D+0)
      T11 = 1.0D+0/RHOA**2
      T12 = 1.0D+0/TA**2
      T13 = 1.5625D-2*T11*T12*T9+1.0D+0
      T14 = 1.0D+0/T13**2
      T15 = 2.1639999999999998D-2*T9*T11*T14*T12+
     #1.2345679012345678D-1
      T16 = 3.9685026299204995D-1
      T17 = SQRT(2.8125D-3*T11*T12*T9+3.411578390622491D-4*T16*
     #T9*T10)
      T18 = 1.0D+0/SIGMAAA
      T19 = 8.0D+0*T18*RHOA*TA-1.0D+0
      T20 = 4.3535288308722675D-2*T2*SIGMAAA*T3*T19-1.0D+0
      T21 = SQRT(1.741411532348907D-2*T2*SIGMAAA*T3*T19*T20+
     #1.0D+0)
      T22 = 1.0D+0/T21
      T23 = 1.741411532348907D-2*T2*SIGMAAA*T3+4.5D-1*T20*T22
      T24 = 1.5382932784753583D-6*T6*T7+7.209876543209877D-2*
     #T23**2-1.8024691358024691D-1*T17*T23+2.612117298523361D-2*T2*
     #SIGMAAA*T3*T15+1.6256527653777256D-3*T9*T11*T12+
     #6.46739323998528D-6*T8*T9*T10
      T25 = 1.2437810945273631D+0*T5*T24+1.0D+0
      T26 = 1.804D+0-8.04D-1/T25
      T27 = 1.0D+0/T25**2
      T28 = 1.0D+0*RHOA**((-1.9D+1)/3.0D+0)
      T29 = 1.0D+0/RHOA**3
      T30 = SIGMAAA**4
      T31 = 1.0D+0/T13**3
      T32 = 1.0D+0/TA**4
      T33 = 1.0D+0*RHOA**((-1.1000000000000001D+1)/3.0D+0)
      T34 = 3.482823064697814D-1*T2*T3*TA-1.160941021565938D-1*
     #T2*SIGMAAA*T33*T19
      T35 = 1.0D+0/T21**3
      T36 = -2.25D-1*T20*(-4.6437640862637525D-2*T2*SIGMAAA*T33*
     #T19*T20+1.3931292258791259D-1*T2*T3*TA*T20+1.741411532348907D-2*
     #T2*SIGMAAA*T3*T19*T34)*T35+4.5D-1*T22*T34-4.6437640862637525D-2*
     #T2*SIGMAAA*T33
      T37 = 1.0D+0/T17
      T38 = 1.0D+0/T4**3
      T39 = 1.0D+0/RHOA**4
      T40 = 1.0D+0*RHOA**((-5.0D+0)/3.0D+0)
      T41 = 4.3535288308722675D-2*T2*T3*T19-
     #3.482823064697814D-1*T2*T18*T40*TA
      T42 = 4.5D-1*T22*T41-2.25D-1*T20*(1.741411532348907D-2*T2*
     #T3*T19*T20-1.3931292258791259D-1*T2*T18*T40*TA*T20+
     #1.741411532348907D-2*T2*SIGMAAA*T3*T19*T41)*T35+
     #1.741411532348907D-2*T2*T3
      T43 = 1.0D+0/TA**3
      T44 = 1.5672703791140163D-1*T2*T40*T22-2.25D-1*T20*T35*
     #(3.032514124997769D-3*T19*T8*SIGMAAA*RHOA**((-1.3D+1)/3.0D+0)+
     #1.3931292258791259D-1*T2*T40*T20)
      ZK(I) = -9.305257363491D-1*T1*T26
      VRHOA(I) = -7.481426920246764D-1*T1*T27*
     #(1.2437810945273631D+0*T5*(2.612117298523361D-2*T2*T3*SIGMAAA*
     #(1.3524999999999998D-3*T30*T31*T32/RHOA**5-4.3279999999999996D-2*
     #T9*T29*T14*T12)-1.2306346227802867D-5*T6/RHOA**9-
     #9.012345679012346D-2*T23*T37*(-5.625D-3*T12*T29*T9-
     #1.819508474998662D-3*T16*T9*T28)+1.4419753086419754D-1*T23*T36-
     #1.8024691358024691D-1*T17*T36-3.4492763946588156D-5*T8*T9*T28-
     #6.96564612939563D-2*T2*SIGMAAA*T33*T15-3.251305530755451D-3*T9*
     #T29*T12)+2.028129294249789D-1*T2*SIGMAAA*T38*T33*T24)-
     #1.2407009817987999D+0*RHOA**(1.0D+0/3.0D+0)*T26
      VRHOB(I) = 0.0D+0
      VSIGMAAA(I) = -7.481426920246764D-1*T1*T27*
     #(1.2437810945273631D+0*T5*(-9.012345679012346D-2*T23*T37*
     #(5.625D-3*T11*T12*SIGMAAA+6.823156781244982D-4*T16*SIGMAAA*T10)+
     #4.6148798354260745D-6*T9*T7+1.4419753086419754D-1*T23*T42-
     #1.8024691358024691D-1*T17*T42+2.612117298523361D-2*T2*T3*T15+
     #2.612117298523361D-2*T2*SIGMAAA*T3*(4.3279999999999996D-2*SIGMAAA*
     #T11*T14*T12-1.3524999999999998D-3*T6*T39*T31*T32)+
     #3.251305530755451D-3*SIGMAAA*T11*T12+1.2934786479970561D-5*T8*
     #SIGMAAA*T10)-7.60548485343671D-2*T2*T38*T3*T24)
      VSIGMAAB(I) = 0.0D+0
      VSIGMABB(I) = 0.0D+0
      VTA(I) = -9.305257363491D-1*T1*T27*T5*
     #(2.612117298523361D-2*T2*T3*SIGMAAA*(1.3524999999999998D-3*T30*
     #T31*T39/TA**5-4.3279999999999996D-2*T9*T11*T14*T43)+
     #5.069444444444444D-4*T11*T23*T37*T43*T9+1.4419753086419754D-1*T23*
     #T44-1.8024691358024691D-1*T17*T44-3.251305530755451D-3*T9*T11*T43)
      VTB(I) = 0.0D+0
C
      ELSE ! (.NOT.(RHOA.LT.TOL).AND..NOT.(RHOB.LT.TOL))
C     THE FOLLOWING GUARANTEES STRICTLY POSITIVE VALUES
      SIGMAAA = MAX(TOL,SIGMAAA1(I))
      SIGMABB = MAX(TOL,SIGMABB1(I))
      TA = MAX(TOL,TA1(I))
      TB = MAX(TOL,TB1(I))
C
      T1 = RHOA**(4.0D+0/3.0D+0)
      T2 = 6.299605249474366D-1
      T3 = 1.0D+0*RHOA**((-8.0D+0)/3.0D+0)
      T4 = 3.057404911081557D-2*T2*SIGMAAA*T3+1.0D+0
      T5 = 1.0D+0/T4**2
      T6 = SIGMAAA**3
      T7 = 1.0D+0/RHOA**8
      T8 = 7.937005259840997D-1
      T9 = SIGMAAA**2
      T10 = 1.0D+0*RHOA**((-1.6D+1)/3.0D+0)
      T11 = 1.0D+0/RHOA**2
      T12 = 1.0D+0/TA**2
      T13 = 1.5625D-2*T11*T12*T9+1.0D+0
      T14 = 1.0D+0/T13**2
      T15 = 2.1639999999999998D-2*T9*T11*T14*T12+
     #1.2345679012345678D-1
      T16 = 3.9685026299204995D-1
      T17 = SQRT(2.8125D-3*T11*T12*T9+3.411578390622491D-4*T16*
     #T9*T10)
      T18 = 1.0D+0/SIGMAAA
      T19 = 8.0D+0*T18*RHOA*TA-1.0D+0
      T20 = 4.3535288308722675D-2*T2*SIGMAAA*T3*T19-1.0D+0
      T21 = SQRT(1.741411532348907D-2*T2*SIGMAAA*T3*T19*T20+
     #1.0D+0)
      T22 = 1.0D+0/T21
      T23 = 1.741411532348907D-2*T2*SIGMAAA*T3+4.5D-1*T20*T22
      T24 = 1.5382932784753583D-6*T6*T7+7.209876543209877D-2*
     #T23**2-1.8024691358024691D-1*T17*T23+2.612117298523361D-2*T2*
     #SIGMAAA*T3*T15+1.6256527653777256D-3*T9*T11*T12+
     #6.46739323998528D-6*T8*T9*T10
      T25 = 1.2437810945273631D+0*T5*T24+1.0D+0
      T26 = 1.804D+0-8.04D-1/T25
      T27 = RHOB**(4.0D+0/3.0D+0)
      T28 = 1.0D+0*RHOB**((-8.0D+0)/3.0D+0)
      T29 = 3.057404911081557D-2*T2*SIGMABB*T28+1.0D+0
      T30 = 1.0D+0/T29**2
      T31 = SIGMABB**3
      T32 = 1.0D+0/RHOB**8
      T33 = SIGMABB**2
      T34 = 1.0D+0*RHOB**((-1.6D+1)/3.0D+0)
      T35 = 1.0D+0/RHOB**2
      T36 = 1.0D+0/TB**2
      T37 = 1.5625D-2*T33*T35*T36+1.0D+0
      T38 = 1.0D+0/T37**2
      T39 = 2.1639999999999998D-2*T33*T35*T38*T36+
     #1.2345679012345678D-1
      T40 = SQRT(2.8125D-3*T33*T35*T36+3.411578390622491D-4*T16*
     #T33*T34)
      T41 = 1.0D+0/SIGMABB
      T42 = 8.0D+0*T41*RHOB*TB-1.0D+0
      T43 = 4.3535288308722675D-2*T2*SIGMABB*T28*T42-1.0D+0
      T44 = SQRT(1.741411532348907D-2*T2*SIGMABB*T28*T42*T43+
     #1.0D+0)
      T45 = 1.0D+0/T44
      T46 = 4.5D-1*T43*T45+1.741411532348907D-2*T2*SIGMABB*T28
      T47 = 7.209876543209877D-2*T46**2-1.8024691358024691D-1*
     #T40*T46+2.612117298523361D-2*T2*SIGMABB*T28*T39+
     #1.6256527653777256D-3*T33*T35*T36+6.46739323998528D-6*T8*T33*T34+
     #1.5382932784753583D-6*T31*T32
      T48 = 1.2437810945273631D+0*T30*T47+1.0D+0
      T49 = 1.804D+0-8.04D-1/T48
      T50 = 1.0D+0/T25**2
      T51 = 1.0D+0*RHOA**((-1.9D+1)/3.0D+0)
      T52 = 1.0D+0/RHOA**3
      T53 = SIGMAAA**4
      T54 = 1.0D+0/T13**3
      T55 = 1.0D+0/TA**4
      T56 = 1.0D+0*RHOA**((-1.1000000000000001D+1)/3.0D+0)
      T57 = 3.482823064697814D-1*T2*T3*TA-1.160941021565938D-1*
     #T2*SIGMAAA*T56*T19
      T58 = 1.0D+0/T21**3
      T59 = -2.25D-1*T20*(-4.6437640862637525D-2*T2*SIGMAAA*T56*
     #T19*T20+1.3931292258791259D-1*T2*T3*TA*T20+1.741411532348907D-2*
     #T2*SIGMAAA*T3*T19*T57)*T58+4.5D-1*T22*T57-4.6437640862637525D-2*
     #T2*SIGMAAA*T56
      T60 = 1.0D+0/T17
      T61 = 1.0D+0/T4**3
      T62 = 1.0D+0/T48**2
      T63 = 1.0D+0*RHOB**((-1.9D+1)/3.0D+0)
      T64 = 1.0D+0/RHOB**3
      T65 = SIGMABB**4
      T66 = 1.0D+0/T37**3
      T67 = 1.0D+0/TB**4
      T68 = 1.0D+0*RHOB**((-1.1000000000000001D+1)/3.0D+0)
      T69 = 3.482823064697814D-1*T2*T28*TB-1.160941021565938D-1*
     #T2*SIGMABB*T68*T42
      T70 = 1.0D+0/T44**3
      T71 = -2.25D-1*T43*(-4.6437640862637525D-2*T2*SIGMABB*T68*
     #T42*T43+1.3931292258791259D-1*T2*T28*TB*T43+1.741411532348907D-2*
     #T2*SIGMABB*T28*T42*T69)*T70+4.5D-1*T45*T69-4.6437640862637525D-2*
     #T2*SIGMABB*T68
      T72 = 1.0D+0/T40
      T73 = 1.0D+0/T29**3
      T74 = 1.0D+0/RHOA**4
      T75 = 1.0D+0*RHOA**((-5.0D+0)/3.0D+0)
      T76 = 4.3535288308722675D-2*T2*T3*T19-
     #3.482823064697814D-1*T2*T18*T75*TA
      T77 = 4.5D-1*T22*T76-2.25D-1*T20*(1.741411532348907D-2*T2*
     #T3*T19*T20-1.3931292258791259D-1*T2*T18*T75*TA*T20+
     #1.741411532348907D-2*T2*SIGMAAA*T3*T19*T76)*T58+
     #1.741411532348907D-2*T2*T3
      T78 = 1.0D+0/RHOB**4
      T79 = 1.0D+0*RHOB**((-5.0D+0)/3.0D+0)
      T80 = 4.3535288308722675D-2*T2*T28*T42-
     #3.482823064697814D-1*T2*T41*T79*TB
      T81 = 4.5D-1*T45*T80-2.25D-1*T43*(1.741411532348907D-2*T2*
     #T28*T42*T43-1.3931292258791259D-1*T2*T41*T79*TB*T43+
     #1.741411532348907D-2*T2*SIGMABB*T28*T42*T80)*T70+
     #1.741411532348907D-2*T2*T28
      T82 = 1.0D+0/TA**3
      T83 = 1.5672703791140163D-1*T2*T75*T22-2.25D-1*T20*T58*
     #(3.032514124997769D-3*T19*T8*SIGMAAA*RHOA**((-1.3D+1)/3.0D+0)+
     #1.3931292258791259D-1*T2*T75*T20)
      T84 = 1.0D+0/TB**3
      T85 = 1.5672703791140163D-1*T2*T79*T45-2.25D-1*T43*T70*
     #(3.032514124997769D-3*T42*T8*SIGMABB*RHOB**((-1.3D+1)/3.0D+0)+
     #1.3931292258791259D-1*T2*T79*T43)
      ZK(I) = -9.305257363491D-1*T27*T49-9.305257363491D-1*T1*
     #T26
      VRHOA(I) = -7.481426920246764D-1*T1*T50*
     #(1.2437810945273631D+0*T5*(2.612117298523361D-2*T2*T3*SIGMAAA*
     #(1.3524999999999998D-3*T53*T54*T55/RHOA**5-4.3279999999999996D-2*
     #T9*T52*T14*T12)-1.2306346227802867D-5*T6/RHOA**9-
     #9.012345679012346D-2*T23*T60*(-5.625D-3*T12*T52*T9-
     #1.819508474998662D-3*T16*T9*T51)+1.4419753086419754D-1*T23*T59-
     #1.8024691358024691D-1*T17*T59-3.4492763946588156D-5*T8*T9*T51-
     #6.96564612939563D-2*T2*SIGMAAA*T56*T15-3.251305530755451D-3*T9*
     #T52*T12)+2.028129294249789D-1*T2*SIGMAAA*T61*T56*T24)-
     #1.2407009817987999D+0*RHOA**(1.0D+0/3.0D+0)*T26
      VRHOB(I) = -7.481426920246764D-1*T27*T62*
     #(1.2437810945273631D+0*T30*(2.612117298523361D-2*T2*T28*SIGMABB*
     #(1.3524999999999998D-3*T65*T66*T67/RHOB**5-4.3279999999999996D-2*
     #T33*T64*T38*T36)-1.2306346227802867D-5*T31/RHOB**9-
     #9.012345679012346D-2*T46*(-5.625D-3*T33*T36*T64-
     #1.819508474998662D-3*T16*T33*T63)*T72+1.4419753086419754D-1*T46*
     #T71-1.8024691358024691D-1*T40*T71-3.4492763946588156D-5*T8*T33*
     #T63-6.96564612939563D-2*T2*SIGMABB*T68*T39-3.251305530755451D-3*
     #T33*T64*T36)+2.028129294249789D-1*T2*SIGMABB*T73*T68*T47)-
     #1.2407009817987999D+0*RHOB**(1.0D+0/3.0D+0)*T49
      VSIGMAAA(I) = -7.481426920246764D-1*T1*T50*
     #(1.2437810945273631D+0*T5*(-9.012345679012346D-2*T23*T60*
     #(5.625D-3*T11*T12*SIGMAAA+6.823156781244982D-4*T16*SIGMAAA*T10)+
     #1.4419753086419754D-1*T23*T77-1.8024691358024691D-1*T17*T77+
     #4.6148798354260745D-6*T9*T7+2.612117298523361D-2*T2*T3*T15+
     #2.612117298523361D-2*T2*SIGMAAA*T3*(4.3279999999999996D-2*SIGMAAA*
     #T11*T14*T12-1.3524999999999998D-3*T6*T74*T54*T55)+
     #3.251305530755451D-3*SIGMAAA*T11*T12+1.2934786479970561D-5*T8*
     #SIGMAAA*T10)-7.60548485343671D-2*T2*T61*T3*T24)
      VSIGMAAB(I) = 0.0D+0
      VSIGMABB(I) = -7.481426920246764D-1*T27*T62*
     #(1.2437810945273631D+0*T30*(-9.012345679012346D-2*T46*T72*
     #(5.625D-3*T35*T36*SIGMABB+6.823156781244982D-4*T16*SIGMABB*T34)+
     #1.4419753086419754D-1*T46*T81-1.8024691358024691D-1*T40*T81+
     #2.612117298523361D-2*T2*T28*T39+2.612117298523361D-2*T2*SIGMABB*
     #T28*(4.3279999999999996D-2*SIGMABB*T35*T38*T36-
     #1.3524999999999998D-3*T31*T78*T66*T67)+3.251305530755451D-3*
     #SIGMABB*T35*T36+1.2934786479970561D-5*T8*SIGMABB*T34+
     #4.6148798354260745D-6*T33*T32)-7.60548485343671D-2*T2*T73*T28*T47)
      VTA(I) = -9.305257363491D-1*T1*T5*T50*
     #(2.612117298523361D-2*T2*T3*SIGMAAA*(1.3524999999999998D-3*T53*
     #T54*T74/TA**5-4.3279999999999996D-2*T9*T11*T14*T82)+
     #5.069444444444444D-4*T11*T23*T60*T82*T9+1.4419753086419754D-1*T23*
     #T83-1.8024691358024691D-1*T17*T83-3.251305530755451D-3*T9*T11*T82)
      VTB(I) = -9.305257363491D-1*T27*T30*T62*
     #(2.612117298523361D-2*T2*T28*SIGMABB*(1.3524999999999998D-3*T65*
     #T66*T78/TB**5-4.3279999999999996D-2*T33*T35*T38*T84)+
     #1.4419753086419754D-1*T46*T85-1.8024691358024691D-1*T40*T85+
     #5.069444444444444D-4*T33*T35*T46*T72*T84-3.251305530755451D-3*T33*
     #T35*T84)
C
      ENDIF ! RHOA,RHOB
      ELSE ! RHO
      ZK(I) = 0.0D0
      VRHOA(I) = 0.0D0
      VRHOB(I) = 0.0D0
      VSIGMAAA(I) = 0.0D0
      VSIGMAAB(I) = 0.0D0
      VSIGMABB(I) = 0.0D0
      VTA(I) = 0.0D0
      VTB(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ENDIF ! IDERIV
      RETURN
      END
C*MODULE DFTXCE  *DECK RKS_C_TPSS
      SUBROUTINE RKS_C_TPSS
     & (IDERIV,NPT,RHOA1,SIGMAAA1,
     &  TA1,ZK,VRHOA,VSIGMAAA,
     &  VTA)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      INTEGER IDERIV,NPT
      DOUBLE PRECISION RHOA1(NPT),TA1(NPT),SIGMAAA1(NPT)
      DOUBLE PRECISION ZK(NPT),VRHOA(NPT),VTA(NPT),VSIGMAAA(NPT)
      PARAMETER(TOL=1.0D-20)
C
      IF(IDERIV.EQ.0) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHO = 2.D+00*RHOA
      IF(RHO.GT.TOL) THEN
C      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
C     THE OUTSIDE IF-CONDITION GUARANTEES THE ABOVE
      SIGMAAA = SIGMAAA1(I)
C     IT PROBABLY GUARANTEES THE ONE BELOW AS WELL...
      TA = MAX(TOL,TA1(I))
C
      T1 = SIGMAAA**2
      T2 = 1.0D+0/RHOA**2
      T3 = 1.923661050931536D+0
      T4 = 1.0D+0*RHOA**((-2.0D+0)/3.0D+0)
      T5 = 1.0D+0/SQRT(RHOA)
      T6 = 1.0D+0*RHOA**((-1.0D+0)/3.0D+0)
      T7 = 1.0D+0*RHOA**((-1.0D+0)/6.0D+0)
      T8 = LOG(1.6081979498692536D+1/(6.715185816249738D+0*T7+
     #2.8040417617100993D+0*T6+1.1319770313278835D+0*T5+
     #3.011306662279899D-1*T4)+1.0D+0)
      T9 = 1.6702634755197018D-1*T6+1.0D+0
      T10 = 6.21814D-2*T8*T9
      T11 = T10-3.10907D-2*(1.606016560364007D-1*T6+1.0D+0)*
     #LOG(3.216395899738507D+1/(1.2482198746797324D+1*T7+
     #4.8440767160638537D+0*T6+2.3260048119008184D+0*T5+
     #3.819082618690966D-1*T4)+1.0D+0)
      T12 = 5.198420997897459D-1*T3*T11
      T13 = -6.21814D-2*T8*T9
      T14 = 3.068528194400547D-1
      T15 = 1.0D+0/T14
      T16 = 1.0D+0*RHOA**((-7.0D+0)/3.0D+0)
      T17 = -5.198420997897459D-1*T3*T11
      T18 = 2.718281828459045D+0**(1.9739208802178723D+1*T15*
     #(T10+T17))-1.0D+0
      T19 = 8.359332919770112D-2*T15*T16*SIGMAAA/T18
      T20 = 1.0D+0/T14**2
      T21 = 1.0D+0*RHOA**((-1.3999999999999999D+1)/3.0D+0)
      T22 = LOG(8.359332919770112D-2*T15*T16*(T19+1.0D+0)*
     #SIGMAAA/(6.987844686355229D-3*T1*T20*T21/T18**2+T19+1.0D+0)+
     #1.0D+0)
      T23 = 5.066059182116887D-2*T14*T22
      T24 = LOG(1.6081979498692536D+1/(5.982550435771079D+0*T7+
     #2.2255694211506874D+0*T6+8.004286349993636D-1*T5+
     #1.8970043257475583D-1*T4)+1.0D+0)
      T25 = 1.3256889990520176D-1*T6+1.0D+0
      T26 = 2.718281828459045D+0**(6.137058191058978D-1*T15*T24*
     #T25)-1.0D+0
      T27 = 4.179666459885054D-2*T15*T16*SIGMAAA/T26
      T28 = LOG(4.1796664598850536D-2*T15*T16*(T27+1.0D+0)*
     #SIGMAAA/(T27+1.746961171588806D-3*T1*T20*T21/T26**2+1.0D+0)+
     #1.0D+0)
      T29 = -6.21814D-2*T24*T25
      T30 = 1.0132118364233778D-1*T14*T28
      T31 = T30-5.066059182116887D-2*T14*T22+T10+T29+T17
      T32 = 1.0D+0/ABS(T31)
      T33 = T30+T29
      T34 = 1.0D+0/TA**2
      T35 = T33*(8.28125D-3*T1*T2*T34+1.0D+0)-
     #2.3906249999999998D-2*T1*T2*(5.0D-1*(T31*T32+1.0D+0)*T33+5.0D-1*
     #(T23+T13+T12)*((-1.0132118364233778D-1*T14*T28+T23+T13+6.21814D-2*
     #T24*T25+T12)*T32+1.0D+0))*T34
      ZK(I) = T35*RHOA*(5.46875D-3*T35*SIGMAAA**3/(RHOA**3*TA**
     #3)+1.0D+0)
C
      ELSE ! RHO
      ZK(I) = 0.0D0
      VRHOA(I) = 0.0D0
      VSIGMAAA(I) = 0.0D0
      VTA(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ELSE IF(IDERIV.EQ.1) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHO = 2.D+00*RHOA
      IF(RHO.GT.TOL) THEN
C      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
C     THE OUTSIDE IF-CONDITION GUARANTEES THE ABOVE
      SIGMAAA = SIGMAAA1(I)
C     IT PROBABLY GUARANTEES THE ONE BELOW AS WELL...
      TA = MAX(TOL,TA1(I))
C
      T1 = SIGMAAA**3
      T2 = 1.0D+0/RHOA**3
      T3 = SIGMAAA**2
      T4 = 1.0D+0/RHOA**2
      T5 = 1.923661050931536D+0
      T6 = 1.0D+0*RHOA**((-2.0D+0)/3.0D+0)
      T7 = SQRT(RHOA)
      T8 = 1.0D+0/T7
      T9 = 1.0D+0*RHOA**((-1.0D+0)/3.0D+0)
      T10 = 1.0D+0*RHOA**((-1.0D+0)/6.0D+0)
      T11 = 1.2482198746797324D+1*T10+4.8440767160638537D+0*T9+
     #2.3260048119008184D+0*T8+3.819082618690966D-1*T6
      T12 = 3.216395899738507D+1/T11+1.0D+0
      T13 = LOG(T12)
      T14 = 1.606016560364007D-1*T9+1.0D+0
      T15 = 6.715185816249738D+0*T10+2.8040417617100993D+0*T9+
     #1.1319770313278835D+0*T8+3.011306662279899D-1*T6
      T16 = 1.6081979498692536D+1/T15+1.0D+0
      T17 = LOG(T16)
      T18 = 1.6702634755197018D-1*T9+1.0D+0
      T19 = 6.21814D-2*T17*T18
      T20 = T19-3.10907D-2*T13*T14
      T21 = 5.198420997897459D-1*T5*T20
      T22 = -6.21814D-2*T17*T18
      T23 = 3.068528194400547D-1
      T24 = 1.0D+0/T23
      T25 = 1.0D+0*RHOA**((-7.0D+0)/3.0D+0)
      T26 = -5.198420997897459D-1*T5*T20
      T27 = 2.718281828459045D+0**(1.9739208802178723D+1*T24*
     #(T19+T26))
      T28 = T27-1.0D+0
      T29 = 1.0D+0/T28
      T30 = 8.359332919770112D-2*T24*SIGMAAA*T25*T29
      T31 = T30+1.0D+0
      T32 = 1.0D+0/T23**2
      T33 = 1.0D+0*RHOA**((-1.3999999999999999D+1)/3.0D+0)
      T34 = 1.0D+0/T28**2
      T35 = 6.987844686355229D-3*T32*T3*T33*T34+T30+1.0D+0
      T36 = 1.0D+0/T35
      T37 = 8.359332919770112D-2*T24*SIGMAAA*T25*T31*T36+1.0D+0
      T38 = LOG(T37)
      T39 = 5.066059182116887D-2*T23*T38
      T40 = T39+T22+T21
      T41 = 5.982550435771079D+0*T10+2.2255694211506874D+0*T9+
     #8.004286349993636D-1*T8+1.8970043257475583D-1*T6
      T42 = 1.6081979498692536D+1/T41+1.0D+0
      T43 = LOG(T42)
      T44 = 1.3256889990520176D-1*T9+1.0D+0
      T45 = 2.718281828459045D+0**(6.137058191058978D-1*T24*T43*
     #T44)
      T46 = T45-1.0D+0
      T47 = 1.0D+0/T46
      T48 = 4.179666459885054D-2*T24*SIGMAAA*T25*T47
      T49 = T48+1.0D+0
      T50 = 1.0D+0/T46**2
      T51 = 1.746961171588806D-3*T32*T3*T33*T50+T48+1.0D+0
      T52 = 1.0D+0/T51
      T53 = 4.1796664598850536D-2*T24*SIGMAAA*T25*T49*T52+1.0D+0
      T54 = LOG(T53)
      T55 = -1.0132118364233778D-1*T23*T54+T39+T22+6.21814D-2*
     #T43*T44+T21
      T56 = -6.21814D-2*T43*T44
      T57 = 1.0132118364233778D-1*T23*T54
      T58 = T57-5.066059182116887D-2*T23*T38+T19+T56+T26
      T59 = 1.0D+0/ABS(T58)
      T60 = T55*T59+1.0D+0
      T61 = T57+T56
      T62 = T58*T59+1.0D+0
      T63 = 5.0D-1*T61*T62+5.0D-1*T40*T60
      T64 = 1.0D+0/TA**2
      T65 = 8.28125D-3*T3*T4*T64+1.0D+0
      T66 = T61*T65-2.3906249999999998D-2*T3*T4*T63*T64
      T67 = 1.0D+0/TA**3
      T68 = 5.46875D-3*T1*T2*T66*T67+1.0D+0
      T69 = 1.0D+0/T16
      T70 = 1.0D+0*RHOA**((-5.0D+0)/3.0D+0)
      T71 = 1.0D+0/T7**3
      T72 = 1.0D+0*RHOA**((-4.0D+0)/3.0D+0)
      T73 = 1.0D+0*RHOA**((-7.0D+0)/6.0D+0)
      T74 = -1.119197636041623D+0*T73-9.346805872366997D-1*T72-
     #5.659885156639417D-1*T71-2.0075377748532658D-1*T70
      T75 = 1.0D+0/T15**2
      T76 = -1.0D+0*T69*T74*T18*T75
      T77 = -3.461977375889359D-3*T17*T72
      T78 = T77+T76+1.0D+0*T14*(-2.0803664577995534D+0*T73-
     #1.6146922386879511D+0*T72-1.1630024059504092D+0*T71-
     #2.5460550791273107D-1*T70)/(T11**2*T12)+1.6644059691103075D-3*T13*
     #T72
      T79 = 5.198420997897459D-1*T5*T78
      T80 = 1.0D+0*T69*T74*T18*T75
      T81 = 3.461977375889359D-3*T17*T72
      T82 = 1.0D+0/T37
      T83 = 1.0D+0*RHOA**((-1.0D+1)/3.0D+0)
      T84 = -1.950511014613026D-1*T24*SIGMAAA*T83*T29
      T85 = -5.198420997897459D-1*T5*T78
      T86 = T77+T76+T85
      T87 = -1.6500661795026855D+0*T32*SIGMAAA*T86*T25*T34*T27
      T88 = 1.0D+0/T35**2
      T89 = 1.0D+0*RHOA**((-1.6999999999999998D+1)/3.0D+0)
      T90 = -8.359332919770112D-2*T24*T25*T31*(T87-
     #2.758690506823219D-1*T27*T3*T33*T86/(T23**3*T28**3)+T84-
     #3.260994186965774D-2*T32*T3*T89*T34)*T88*SIGMAAA+
     #8.359332919770112D-2*T24*SIGMAAA*T25*T36*(T87+T84)-
     #1.950511014613026D-1*T24*SIGMAAA*T83*T31*T36
      T91 = 5.066059182116887D-2*T23*T82*T90
      T92 = 1.0D+0/T42
      T93 = -9.970917392951799D-1*T73-7.418564737168958D-1*T72-
     #4.002143174996818D-1*T71-1.264669550498372D-1*T70
      T94 = 1.0D+0/T41**2
      T95 = 1.0D+0/T53
      T96 = -9.752555073065128D-2*T24*SIGMAAA*T83*T47
      T97 = -2.7119435101429873D-2*T24*T43*T72-
     #9.86960440108936D+0*T24*T92*T93*T44*T94
      T98 = -4.179666459885054D-2*T24*SIGMAAA*T97*T25*T50*T45
      T99 = 1.0D+0/T51**2
      T100 = -4.1796664598850536D-2*T24*T25*T49*(T98-
     #3.493922343177612D-3*T3*T32*T33*T45*T97/T46**3+T96-
     #8.152485467414428D-3*T32*T3*T89*T50)*T99*SIGMAAA+
     #4.1796664598850536D-2*T24*SIGMAAA*T25*T52*(T98+T96)-
     #9.752555073065126D-2*T24*SIGMAAA*T83*T49*T52
      T101 = 1.0D+0*T92*T93*T44*T94
      T102 = 2.747773264188437D-3*T43*T72
      T103 = 1.0132118364233778D-1*T23*T95*T100
      T104 = 1.0D+0/T58
      T105 = T103+T102+T101
      T106 = T105*T65+4.7812499999999997D-2*T3*T2*T63*T64-
     #2.3906249999999998D-2*T3*T4*(5.0D-1*T105*T62+5.0D-1*(T91+T81+T80+
     #T79)*T60+5.0D-1*T40*((-1.0132118364233778D-1*T23*T95*T100+T91+T81-
     #2.747773264188437D-3*T43*T72+T80-1.0D+0*T92*T93*T44*T94+T79)*T59-
     #1.0D+0*(T103-5.066059182116887D-2*T23*T82*T90+T77+T102+T76+T101+
     #T85)*T104*T55*T59))*T64-1.65625D-2*T3*T2*T61*T64
      T107 = 6.987844686355229D-3*T32*SIGMAAA*T33*T36*T29+
     #8.359332919770112D-2*T24*T25*T31*T36-8.359332919770112D-2*T24*
     #SIGMAAA*T25*(8.359332919770112D-2*T24*T25*T29+
     #1.3975689372710456D-2*T32*SIGMAAA*T33*T34)*T31*T88
      T108 = 1.746961171588806D-3*T32*SIGMAAA*T33*T52*T47+
     #4.1796664598850536D-2*T24*T25*T49*T52-4.1796664598850536D-2*T24*
     #SIGMAAA*T25*(4.179666459885054D-2*T24*T25*T47+
     #3.493922343177612D-3*T32*SIGMAAA*T33*T50)*T49*T99
      T109 = 1.0132118364233778D-1*T23*T95*T108*T65-
     #4.7812499999999997D-2*SIGMAAA*T4*T63*T64-2.3906249999999998D-2*T3*
     #T4*(5.066059182116889D-2*T23*T95*T108*T62+2.533029591058443D-2*
     #T23*T82*T107*T60+5.0D-1*T40*((5.066059182116887D-2*T23*T82*T107-
     #1.0132118364233778D-1*T23*T95*T108)*T59-1.0D+0*T104*
     #(1.0132118364233778D-1*T23*T95*T108-5.066059182116887D-2*T23*T82*
     #T107)*T55*T59))*T64+1.65625D-2*SIGMAAA*T4*T61*T64
      T110 = 4.7812499999999997D-2*T3*T4*T63*T67-1.65625D-2*T3*
     #T4*T61*T67
      ZK(I) = RHOA*T68*T66
      VRHOA(I) = T66*(5.46875D-3*T1*T2*T106*T67-
     #1.6406249999999997D-2*T1*T66*T67/RHOA**4)*RHOA+T68*T66+RHOA*T68*
     #T106
      VSIGMAAA(I) = 4.0D+0*(RHOA*(1.6406249999999997D-2*T3*T2*
     #T66*T67+5.46875D-3*T1*T2*T109*T67)*T66+RHOA*T68*T109)
      VTA(I) = T66*RHOA*(5.46875D-3*T1*T2*T110*T67-
     #1.6406249999999997D-2*T1*T2*T66/TA**4)+RHOA*T110*T68
C
      ELSE ! RHO
      ZK(I) = 0.0D0
      VRHOA(I) = 0.0D0
      VSIGMAAA(I) = 0.0D0
      VTA(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ENDIF
      RETURN
      END
C*MODULE DFTXCE  *DECK UKS_C_TPSS
      SUBROUTINE UKS_C_TPSS
     & (IDERIV,NPT,RHOA1,RHOB1,SIGMAAA1,SIGMAAB1,SIGMABB1,
     &  TA1,TB1,
     &  ZK,VRHOA,VRHOB,VSIGMAAA,VSIGMAAB,VSIGMABB,
     &  VTA,VTB)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      INTEGER NPT
      DOUBLE PRECISION RHOA1(NPT),RHOB1(NPT)
      DOUBLE PRECISION TA1(NPT),TB1(NPT)
      DOUBLE PRECISION SIGMAAA1(NPT),SIGMABB1(NPT),SIGMAAB1(NPT)
      DOUBLE PRECISION ZK(NPT),VRHOA(NPT),VRHOB(NPT)
      DOUBLE PRECISION VTA(NPT),VTB(NPT)
      DOUBLE PRECISION VSIGMAAA(NPT),VSIGMAAB(NPT),VSIGMABB(NPT)
      PARAMETER(TOL=1.0D-20)
C
      IF (IDERIV.EQ.0) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHOB = MAX(0.D0,RHOB1(I))
      RHO = RHOA+RHOB
      IF(RHO.GT.TOL) THEN
      IF(RHOA.LT.TOL) THEN
C     THE FOLLOWING GUARANTEES STRICTLY POSITIVE VALUES
      SIGMABB = MAX(TOL,SIGMABB1(I))
      TB = MAX(TOL,TB1(I))
C
      T1 = 1.0D+0*RHOB**((-1.0D+0)/3.0D+0)
      T2 = LOG(3.216395899738507D+1/
     *      (1.1120374863094687D+1*RHOB**((-1.0D+0)/6.0D+0)
     *    + 1.6447337755676092D+0/SQRT(RHOB)
     *    + 2.4058712912881913D-1*RHOB**((-2.0D+0)/3.0D+0)
     *    + 3.8447462374472113D+0*T1)+1.0D+0)
      T3 = 1.274696188700087D-1*T1+1.0D+0
      T4 = 3.068528194400547D-1
      T5 = 7.937005259840997D-1
      T6 = 1.0D+0/T4
      T7 = 1.0D+0*RHOB**((-7.0D+0)/3.0D+0)
      T8 = 2.718281828459045D+0**(6.137058191058978D-1*T6*T2*
     #T3)-1.0D+0
      T9 = 8.359332919770108D-2*T5*T6*T7*SIGMABB/T8
      T10 = SIGMABB**2
      T11 = 5.066059182116889D-2*T4*LOG(8.359332919770107D-2*T5*
     #T6*T7*(T9+1.0D+0)*SIGMABB/(4.402066306867492D-3*T10*RHOB**
     #((-1.3999999999999999D+1)/3.0D+0)/(T4**2*T8**2)+T9+1.0D+0)+
     #1.0D+0)-3.10907D-2*T2*T3
      T12 = 1.0D+0-1.5625D-2*T10/(RHOB**2*TB**2)
      ZK(I) = T11*T12*RHOB*(5.46875D-3*T11*T12*SIGMABB**3/
     *     (RHOB**3*TB**3)+1.0D+0)
C
      ELSEIF(RHOB.LT.TOL) THEN
C     THE FOLLOWING GUARANTEES STRICTLY POSITIVE VALUES
      SIGMAAA = MAX(TOL,SIGMAAA1(I))
      TA = MAX(TOL,TA1(I))
C
      T1 = 1.0D+0*RHOA**((-1.0D+0)/3.0D+0)
      T2 = LOG(3.216395899738507D+1/
     *    (1.1120374863094687D+1*RHOA**((-1.0D+0)/6.0D+0)
     *    +1.6447337755676092D+0/SQRT(RHOA)+
     #     2.4058712912881913D-1*RHOA**((-2.0D+0)/3.0D+0)
     #    +3.8447462374472113D+0*T1)+1.0D+0)
      T3 = 1.274696188700087D-1*T1+1.0D+0
      T4 = 3.068528194400547D-1
      T5 = 7.937005259840997D-1
      T6 = 1.0D+0/T4
      T7 = 1.0D+0*RHOA**((-7.0D+0)/3.0D+0)
      T8 = 2.718281828459045D+0**(6.137058191058978D-1*T6*T2*
     #T3)-1.0D+0
      T9 = 8.359332919770108D-2*T5*T6*T7*SIGMAAA/T8
      T10 = SIGMAAA**2
      T11 = 5.066059182116889D-2*T4*LOG(8.359332919770107D-2*T5*
     #T6*T7*(T9+1.0D+0)*SIGMAAA/(4.402066306867492D-3*T10*RHOA**
     #((-1.3999999999999999D+1)/3.0D+0)/(T4**2*T8**2)+T9+1.0D+0)+
     #1.0D+0)-3.10907D-2*T2*T3
      T12 = 1.0D+0-1.5625D-2*T10/(RHOA**2*TA**2)
      ZK(I) = T11*T12*RHOA*(5.46875D-3*T11*T12*SIGMAAA**3/
     *        (RHOA**3*TA**3)+1.0D+0)
C
      ELSE ! (.NOT.(RHOA.LT.TOL).AND..NOT.(RHOB.LT.TOL))
      SIGMAAB = SIGMAAB1(I)
C     THE FOLLOWING GUARANTEES STRICTLY POSITIVE VALUES
      SIGMAAA = MAX(TOL,SIGMAAA1(I))
      SIGMABB = MAX(TOL,SIGMABB1(I))
      TA = MAX(TOL,TA1(I))
      TB = MAX(TOL,TB1(I))
C
      T1 = RHOB+RHOA
      T2 = SIGMABB+SIGMAAA+2.0D+0*SIGMAAB
      T3 = T2**2
      T4 = 1.0D+0/T1**3
      T5 = RHOA-1.0D+0*RHOB
      T6 = T5**4
      T7 = 1.0D+0/T1**4
      T8 = 1.0D+0/T1**2
      T9 = 8.7D-1*T5**2*T8+5.0D-1*T6*T7+2.2599999999999998D+0*
     #T5**6/T1**6+5.3D-1
      T10 = 1.0D+0*T1**((-1.3999999999999999D+1)/3.0D+0)
      T11 = 1.0D+0/T1
      T12 = 1.0D+0-1.0D+0*T11*T5
      T13 = T12**(4.0D+0/3.0D+0)
      T14 = T5*T11+1.0D+0
      T15 = T14**(4.0D+0/3.0D+0)
      T16 = 1.0D+0/(5.224234597046721D-2*T10*(1.0D+0/T15+1.0D+0/
     #T13)*(SIGMAAA*RHOB**2-2.0D+0*SIGMAAB*RHOA*RHOB+SIGMABB*RHOA**2)+
     #1.0D+0)**4
      T17 = 1.0D+0*RHOA**((-1.0D+0)/3.0D+0)
      T18 = LOG(3.216395899738507D+1/(1.1120374863094687D+1*
     #RHOA**((-1.0D+0)/6.0D+0)+1.6447337755676092D+0/SQRT(RHOA)+
     #2.4058712912881913D-1*RHOA**((-2.0D+0)/3.0D+0)+
     #3.8447462374472113D+0*T17)+1.0D+0)
      T19 = 1.274696188700087D-1*T17+1.0D+0
      T20 = -3.10907D-2*T18*T19
      T21 = 3.068528194400547D-1
      T22 = 1.2599210498948732D+0
      T23 = 1.0D+0/T22
      T24 = 1.0D+0/T21
      T25 = 1.0D+0*RHOA**((-7.0D+0)/3.0D+0)
      T26 = 2.718281828459045D+0**(6.137058191058978D-1*T24*T18*
     #T19)-1.0D+0
      T27 = 8.359332919770108D-2*T23*T24*T25*SIGMAAA/T26
      T28 = 6.299605249474366D-1
      T29 = 1.0D+0/T21**2
      T30 = LOG(8.359332919770107D-2*T23*T24*T25*(T27+1.0D+0)*
     #SIGMAAA/(6.987844686355223D-3*T28*T29*SIGMAAA**2*RHOA**
     #((-1.3999999999999999D+1)/3.0D+0)/T26**2+T27+1.0D+0)+1.0D+0)
      T31 = 5.066059182116889D-2*T21*T30
      T32 = 1.0D+0*T1**((-1.0D+0)/3.0D+0)
      T33 = 1.3256889990520176D-1*T32+1.0D+0
      T34 = 1.0D+0*T1**((-2.0D+0)/3.0D+0)
      T35 = 1.0D+0/SQRT(T1)
      T36 = 1.0D+0*T1**((-1.0D+0)/6.0D+0)
      T37 = LOG(1.6081979498692536D+1/(5.982550435771079D+0*T36+
     #2.2255694211506874D+0*T32+8.004286349993636D-1*T35+
     #1.8970043257475583D-1*T34)+1.0D+0)
      T38 = 6.21814D-2*T33*T37
      T39 = 1.0D+0/(2.0D+0*T22-2.0D+0)
      T40 = 9.0D+0*T22-9.0D+0
      T41 = 1.0D+0-1.0D+0*T6*T7
      T42 = 6.901399211255825D-2*T32+1.0D+0
      T43 = T15+T13-2.0D+0
      T44 = LOG(2.9608749977793436D+1/(8.157414703487641D+0*T36+
     #2.247591863577616D+0*T32+4.3009724712766434D-1*T35+
     #1.9115125951273373D-1*T34)+1.0D+0)
      T45 = -8.443449999999999D-3*T39*T40*T41*T42*T43*T44
      T46 = T38-3.10907D-2*(1.274696188700087D-1*T32+1.0D+0)*
     #LOG(3.216395899738507D+1/(1.1120374863094687D+1*T36+
     #3.8447462374472113D+0*T32+1.6447337755676092D+0*T35+
     #2.4058712912881913D-1*T34)+1.0D+0)
      T47 = -1.0D+0*T39*T43*T46*T6*T7
      T48 = 5.0D-1*T14**(2.0D+0/3.0D+0)+5.0D-1*T12**(2.0D+0/
     #3.0D+0)
      T49 = T48**3
      T50 = 1.0D+0*T1**((-7.0D+0)/3.0D+0)
      T51 = 1.0D+0/T48**2
      T52 = 2.718281828459045D+0**(9.869604401089358D+0*T24*
     #(T47+T45+T38)/T49)-1.0D+0
      T53 = 4.179666459885054D-2*T2*T24*T50*T51/T52
      T54 = LOG(4.1796664598850536D-2*T2*T24*T50*T51*(T53+
     #1.0D+0)/(T53+1.746961171588806D-3*T10*T29*T3/(T48**4*T52**2)+
     #1.0D+0)+1.0D+0)
      T55 = -1.0132118364233778D-1*T21*T49*T54
      T56 = -6.21814D-2*T33*T37
      T57 = 8.443449999999999D-3*T39*T40*T41*T42*T43*T44
      T58 = T39*T6*T7*T43*T46
      T59 = 1.0132118364233778D-1*T21*T49*T54
      T60 = T59+T58+T57+T56-5.066059182116889D-2*T21*T30+
     #3.10907D-2*T18*T19
      T61 = 1.0D+0/ABS(T60)
      T62 = T59+T58+T57+T56
      T63 = 1.0D+0*RHOB**((-1.0D+0)/3.0D+0)
      T64 = LOG(3.216395899738507D+1/(1.1120374863094687D+1*
     #RHOB**((-1.0D+0)/6.0D+0)+1.6447337755676092D+0/SQRT(RHOB)+
     #2.4058712912881913D-1*RHOB**((-2.0D+0)/3.0D+0)+
     #3.8447462374472113D+0*T63)+1.0D+0)
      T65 = 1.274696188700087D-1*T63+1.0D+0
      T66 = -3.10907D-2*T64*T65
      T67 = 1.0D+0*RHOB**((-7.0D+0)/3.0D+0)
      T68 = 2.718281828459045D+0**(6.137058191058978D-1*T24*T64*
     #T65)-1.0D+0
      T69 = 8.359332919770108D-2*T23*T24*T67*SIGMABB/T68
      T70 = LOG(8.359332919770107D-2*T23*T24*T67*(T69+1.0D+0)*
     #SIGMABB/(6.987844686355223D-3*T28*T29*SIGMABB**2*RHOB**
     #((-1.3999999999999999D+1)/3.0D+0)/T68**2+T69+1.0D+0)+1.0D+0)
      T71 = 5.066059182116889D-2*T21*T70
      T72 = T59-5.066059182116889D-2*T21*T70+T58+T57+T56+
     #3.10907D-2*T64*T65
      T73 = 1.0D+0/ABS(T72)
      T74 = TB+TA
      T75 = 1.0D+0/T74**2
      T76 = T62*(1.5625D-2*T16*T3*T75*T8*T9+1.0D+0)-1.5625D-2*
     #(T9*T16+1.0D+0)*T3*T4*T75*((5.0D-1*T62*(T72*T73+1.0D+0)+5.0D-1*
     #(T71+T66)*((T55+T71+T47+T45+T38+T66)*T73+1.0D+0))*RHOB+(5.0D-1*
     #(T60*T61+1.0D+0)*T62+5.0D-1*(T31+T20)*((T55+T47+T45+T38+T31+T20)*
     #T61+1.0D+0))*RHOA)
      ZK(I) = T1*T76*(5.46875D-3*T2**3*T4*T76/T74**3+1.0D+0)
C
      ENDIF ! RHOA,RHOB
      ELSE ! RHO
      ZK(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ELSE IF(IDERIV.EQ.1) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHOB = MAX(0.D0,RHOB1(I))
      RHO = RHOA+RHOB
      IF(RHO.GT.TOL) THEN
      IF(RHOA.LT.TOL) THEN
C     THE FOLLOWING GUARANTEES STRICTLY POSITIVE VALUES
      SIGMABB = MAX(TOL,SIGMABB1(I))
      TB = MAX(TOL,TB1(I))
C
      T1 = SQRT(RHOB)
      T2 = 1.0D+0*RHOB**((-1.0D+0)/3.0D+0)
      T3 = 1.1120374863094687D+1*RHOB**((-1.0D+0)/6.0D+0)+
     #2.4058712912881913D-1*RHOB**((-2.0D+0)/3.0D+0)+
     #3.8447462374472113D+0*T2+1.6447337755676092D+0/T1
      T4 = 3.216395899738507D+1/T3+1.0D+0
      T5 = LOG(T4)
      T6 = 1.274696188700087D-1*T2+1.0D+0
      T7 = 3.068528194400547D-1
      T8 = 7.937005259840997D-1
      T9 = 1.0D+0/T7
      T10 = 1.0D+0*RHOB**((-7.0D+0)/3.0D+0)
      T11 = 2.718281828459045D+0**(6.137058191058978D-1*T9*T5*
     #T6)
      T12 = T11-1.0D+0
      T13 = 1.0D+0/T12
      T14 = 8.359332919770108D-2*T8*T9*SIGMABB*T10*T13
      T15 = T14+1.0D+0
      T16 = 6.299605249474366D-1
      T17 = 1.0D+0/T7**2
      T18 = SIGMABB**2
      T19 = 1.0D+0*RHOB**((-1.3999999999999999D+1)/3.0D+0)
      T20 = 1.0D+0/T12**2
      T21 = 6.987844686355223D-3*T16*T17*T18*T19*T20+T14+1.0D+0
      T22 = 1.0D+0/T21
      T23 = 8.359332919770107D-2*T8*T9*SIGMABB*T10*T15*T22+
     #1.0D+0
      T24 = 5.066059182116889D-2*T7*LOG(T23)-3.10907D-2*T5*T6
      T25 = SIGMABB**3
      T26 = 1.0D+0/RHOB**3
      T27 = 1.0D+0/RHOB**2
      T28 = 1.0D+0/TB**2
      T29 = 1.0D+0-1.5625D-2*T18*T27*T28
      T30 = 1.0D+0/TB**3
      T31 = 5.46875D-3*T25*T26*T24*T29*T30+1.0D+0
      T32 = SIGMABB**5
      T33 = 1.0D+0/TB**5
      T34 = 1.0D+0/T4
      T35 = 1.0D+0*RHOB**((-4.0D+0)/3.0D+0)
      T36 = -1.8533958105157808D+0*RHOB**((-7.0D+0)/6.0D+0)-
     #1.6039141941921276D-1*RHOB**((-5.0D+0)/3.0D+0)-
     #1.2815820791490704D+0*T35-8.223668877838046D-1/T1**3
      T37 = 1.0D+0/T3**2
      T38 = 1.0D+0/T23
      T39 = 1.0D+0*RHOB**((-1.0D+1)/3.0D+0)
      T40 = -1.9505110146130256D-1*T8*T9*SIGMABB*T39*T13
      T41 = -2.6076282286578434D-2*T9*T5*T35-
     #1.973920880217872D+1*T9*T34*T36*T6*T37
      T42 = -8.359332919770108D-2*T8*T9*SIGMABB*T41*T10*T20*T11
      T43 = 1.0D+0/T21**2
      T44 = 5.066059182116889D-2*T38*T7*(-8.359332919770107D-2*
     #T10*T15*T43*T8*T9*SIGMABB*(-3.260994186965771D-2*T16*T17*T18*T20*
     #RHOB**((-1.6999999999999998D+1)/3.0D+0)+T42-1.3975689372710445D-2*
     #T11*T16*T17*T18*T19*T41/T12**3+T40)+8.359332919770107D-2*T8*T9*
     #SIGMABB*T10*T22*(T42+T40)-1.950511014613025D-1*T8*T9*SIGMABB*T39*
     #T15*T22)+1.0D+0*T34*T36*T6*T37+1.3210398931339262D-3*T5*T35
      T45 = 1.0D+0/RHOB
      T46 = 1.0D+0/RHOB**5
      T47 = 6.987844686355223D-3*T16*T17*SIGMABB*T19*T22*T13+
     #8.359332919770107D-2*T8*T9*T10*T15*T22-8.359332919770107D-2*T8*T9*
     #SIGMABB*T10*(8.359332919770108D-2*T8*T9*T10*T13+
     #1.3975689372710445D-2*T16*T17*SIGMABB*T19*T20)*T15*T43
      ZK(I) = RHOB*T24*T31*T29
      VRHOA(I) = 0.0D+0
      VRHOB(I) = T24*T29*(-1.6406249999999997D-2*T24*T25*T29*
     #T30/RHOB**4+1.7089843749999997D-4*T24*T32*T33/RHOB**6+5.46875D-3*
     #T25*T26*T44*T29*T30)*RHOB+3.125D-2*T18*T24*T27*T28*T31+RHOB*T44*
     #T31*T29+T24*T31*T29
      VSIGMAAA(I) = 0.0D+0
      VSIGMAAB(I) = 0.0D+0
      VSIGMABB(I) = -3.125D-2*T24*T28*T31*T45*SIGMABB+
     #5.066059182116889D-2*T7*RHOB*T38*T47*T31*T29+RHOB*T24*
     #(1.6406249999999997D-2*T18*T26*T24*T29*T30+2.7705011152201736D-4*
     #T7*T25*T26*T38*T47*T29*T30-1.7089843749999997D-4*SIGMABB**4*T46*
     #T24*T33)*T29
      VTA(I) = 0.0D+0
      VTB(I) = T24*T29*RHOB*(1.7089843749999997D-4*T24*T32*T46/
     #TB**6-1.6406249999999997D-2*T24*T25*T26*T29/TB**4)+3.125D-2*T18*
     #T24*T30*T31*T45
C
      ELSEIF(RHOB.LT.TOL) THEN
C     THE FOLLOWING GUARANTEES STRICTLY POSITIVE VALUES
      SIGMAAA = MAX(TOL,SIGMAAA1(I))
      TA = MAX(TOL,TA1(I))
C
      T1 = SQRT(RHOA)
      T2 = 1.0D+0*RHOA**((-1.0D+0)/3.0D+0)
      T3 = 1.1120374863094687D+1*RHOA**((-1.0D+0)/6.0D+0)+
     #2.4058712912881913D-1*RHOA**((-2.0D+0)/3.0D+0)+
     #3.8447462374472113D+0*T2+1.6447337755676092D+0/T1
      T4 = 3.216395899738507D+1/T3+1.0D+0
      T5 = LOG(T4)
      T6 = 1.274696188700087D-1*T2+1.0D+0
      T7 = 3.068528194400547D-1
      T8 = 7.937005259840997D-1
      T9 = 1.0D+0/T7
      T10 = 1.0D+0*RHOA**((-7.0D+0)/3.0D+0)
      T11 = 2.718281828459045D+0**(6.137058191058978D-1*T9*T5*
     #T6)
      T12 = T11-1.0D+0
      T13 = 1.0D+0/T12
      T14 = 8.359332919770108D-2*T8*T9*SIGMAAA*T10*T13
      T15 = T14+1.0D+0
      T16 = 6.299605249474366D-1
      T17 = 1.0D+0/T7**2
      T18 = SIGMAAA**2
      T19 = 1.0D+0*RHOA**((-1.3999999999999999D+1)/3.0D+0)
      T20 = 1.0D+0/T12**2
      T21 = 6.987844686355223D-3*T16*T17*T18*T19*T20+T14+1.0D+0
      T22 = 1.0D+0/T21
      T23 = 8.359332919770107D-2*T8*T9*SIGMAAA*T10*T15*T22+
     #1.0D+0
      T24 = 5.066059182116889D-2*T7*LOG(T23)-3.10907D-2*T5*T6
      T25 = SIGMAAA**3
      T26 = 1.0D+0/RHOA**3
      T27 = 1.0D+0/RHOA**2
      T28 = 1.0D+0/TA**2
      T29 = 1.0D+0-1.5625D-2*T18*T27*T28
      T30 = 1.0D+0/TA**3
      T31 = 5.46875D-3*T25*T26*T24*T29*T30+1.0D+0
      T32 = SIGMAAA**5
      T33 = 1.0D+0/TA**5
      T34 = 1.0D+0/T4
      T35 = 1.0D+0*RHOA**((-4.0D+0)/3.0D+0)
      T36 = -1.8533958105157808D+0*RHOA**((-7.0D+0)/6.0D+0)-
     #1.6039141941921276D-1*RHOA**((-5.0D+0)/3.0D+0)-
     #1.2815820791490704D+0*T35-8.223668877838046D-1/T1**3
      T37 = 1.0D+0/T3**2
      T38 = 1.0D+0/T23
      T39 = 1.0D+0*RHOA**((-1.0D+1)/3.0D+0)
      T40 = -1.9505110146130256D-1*T8*T9*SIGMAAA*T39*T13
      T41 = -2.6076282286578434D-2*T9*T5*T35-
     #1.973920880217872D+1*T9*T34*T36*T6*T37
      T42 = -8.359332919770108D-2*T8*T9*SIGMAAA*T41*T10*T20*T11
      T43 = 1.0D+0/T21**2
      T44 = 5.066059182116889D-2*T38*T7*(-8.359332919770107D-2*
     #T10*T15*T43*T8*T9*SIGMAAA*(-3.260994186965771D-2*T16*T17*T18*T20*
     #RHOA**((-1.6999999999999998D+1)/3.0D+0)+T42-1.3975689372710445D-2*
     #T11*T16*T17*T18*T19*T41/T12**3+T40)+8.359332919770107D-2*T8*T9*
     #SIGMAAA*T10*T22*(T42+T40)-1.950511014613025D-1*T8*T9*SIGMAAA*T39*
     #T15*T22)+1.0D+0*T34*T36*T6*T37+1.3210398931339262D-3*T5*T35
      T45 = 1.0D+0/RHOA
      T46 = 1.0D+0/RHOA**5
      T47 = 6.987844686355223D-3*T16*T17*SIGMAAA*T19*T22*T13+
     #8.359332919770107D-2*T8*T9*T10*T15*T22-8.359332919770107D-2*T8*T9*
     #SIGMAAA*T10*(8.359332919770108D-2*T8*T9*T10*T13+
     #1.3975689372710445D-2*T16*T17*SIGMAAA*T19*T20)*T15*T43
      ZK(I) = RHOA*T24*T31*T29
      VRHOA(I) = T24*T29*(-1.6406249999999997D-2*T24*T25*T29*
     #T30/RHOA**4+1.7089843749999997D-4*T24*T32*T33/RHOA**6+5.46875D-3*
     #T25*T26*T44*T29*T30)*RHOA+3.125D-2*T18*T24*T27*T28*T31+RHOA*T44*
     #T31*T29+T24*T31*T29
      VRHOB(I) = 0.0D+0
      VSIGMAAA(I) = -3.125D-2*T24*T28*T31*T45*SIGMAAA+
     #5.066059182116889D-2*T7*RHOA*T38*T47*T31*T29+RHOA*T24*
     #(1.6406249999999997D-2*T18*T26*T24*T29*T30+2.7705011152201736D-4*
     #T7*T25*T26*T38*T47*T29*T30-1.7089843749999997D-4*SIGMAAA**4*T46*
     #T24*T33)*T29
      VSIGMABB(I) = 0.0D+0
      VSIGMAAB(I) = 0.0D+0
      VTA(I) = T24*T29*RHOA*(1.7089843749999997D-4*T24*T32*T46/
     #TA**6-1.6406249999999997D-2*T24*T25*T26*T29/TA**4)+3.125D-2*T18*
     #T24*T30*T31*T45
      VTB(I) = 0.0D+0
C
      ELSE ! (.NOT.(RHOA.LT.TOL).AND..NOT.(RHOB.LT.TOL))
      SIGMAAB = SIGMAAB1(I)
C     THE FOLLOWING GUARANTEES STRICTLY POSITIVE VALUES
      SIGMAAA = MAX(TOL,SIGMAAA1(I))
      SIGMABB = MAX(TOL,SIGMABB1(I))
      TA = MAX(TOL,TA1(I))
      TB = MAX(TOL,TB1(I))
C
      T1 = RHOB+RHOA
      T2 = SIGMABB+SIGMAAA+2.0D+0*SIGMAAB
      T3 = T2**2
      T4 = 1.0D+0/T1**3
      T5 = RHOA-1.0D+0*RHOB
      T6 = T5**6
      T7 = 1.0D+0/T1**6
      T8 = T5**4
      T9 = 1.0D+0/T1**4
      T10 = T5**2
      T11 = 1.0D+0/T1**2
      T12 = 8.7D-1*T10*T11+5.0D-1*T8*T9+2.2599999999999998D+0*
     #T6*T7+5.3D-1
      T13 = 1.0D+0*T1**((-1.3999999999999999D+1)/3.0D+0)
      T14 = RHOA**2
      T15 = RHOB**2
      T16 = -2.0D+0*SIGMAAB*RHOA*RHOB+SIGMAAA*T15+SIGMABB*T14
      T17 = 1.0D+0/T1
      T18 = 1.0D+0-1.0D+0*T17*T5
      T19 = T18**(4.0D+0/3.0D+0)
      T20 = T5*T17+1.0D+0
      T21 = T20**(4.0D+0/3.0D+0)
      T22 = 1.0D+0/T21+1.0D+0/T19
      T23 = 5.224234597046721D-2*T13*T16*T22+1.0D+0
      T24 = 1.0D+0/T23**4
      T25 = T12*T24+1.0D+0
      T26 = SQRT(RHOA)
      T27 = 1.0D+0*RHOA**((-1.0D+0)/3.0D+0)
      T28 = 1.1120374863094687D+1*RHOA**((-1.0D+0)/6.0D+0)+
     #2.4058712912881913D-1*RHOA**((-2.0D+0)/3.0D+0)+
     #3.8447462374472113D+0*T27+1.6447337755676092D+0/T26
      T29 = 3.216395899738507D+1/T28+1.0D+0
      T30 = LOG(T29)
      T31 = 1.274696188700087D-1*T27+1.0D+0
      T32 = -3.10907D-2*T30*T31
      T33 = 3.068528194400547D-1
      T34 = 1.2599210498948732D+0
      T35 = 1.0D+0/T34
      T36 = 1.0D+0/T33
      T37 = 1.0D+0*RHOA**((-7.0D+0)/3.0D+0)
      T38 = 2.718281828459045D+0**(6.137058191058978D-1*T36*T30*
     #T31)
      T39 = T38-1.0D+0
      T40 = 1.0D+0/T39
      T41 = 8.359332919770108D-2*T35*T36*SIGMAAA*T37*T40
      T42 = T41+1.0D+0
      T43 = 6.299605249474366D-1
      T44 = 1.0D+0/T33**2
      T45 = SIGMAAA**2
      T46 = 1.0D+0*RHOA**((-1.3999999999999999D+1)/3.0D+0)
      T47 = 1.0D+0/T39**2
      T48 = 6.987844686355223D-3*T43*T44*T45*T46*T47+T41+1.0D+0
      T49 = 1.0D+0/T48
      T50 = 8.359332919770107D-2*T35*T36*SIGMAAA*T37*T42*T49+
     #1.0D+0
      T51 = LOG(T50)
      T52 = 5.066059182116889D-2*T33*T51
      T53 = T52+T32
      T54 = 1.0D+0*T1**((-1.0D+0)/3.0D+0)
      T55 = 1.3256889990520176D-1*T54+1.0D+0
      T56 = 1.0D+0*T1**((-2.0D+0)/3.0D+0)
      T57 = SQRT(T1)
      T58 = 1.0D+0/T57
      T59 = 1.0D+0*T1**((-1.0D+0)/6.0D+0)
      T60 = 5.982550435771079D+0*T59+2.2255694211506874D+0*T54+
     #8.004286349993636D-1*T58+1.8970043257475583D-1*T56
      T61 = 1.6081979498692536D+1/T60+1.0D+0
      T62 = LOG(T61)
      T63 = 6.21814D-2*T55*T62
      T64 = 1.0D+0/(2.0D+0*T34-2.0D+0)
      T65 = 9.0D+0*T34-9.0D+0
      T66 = 1.0D+0-1.0D+0*T8*T9
      T67 = 6.901399211255825D-2*T54+1.0D+0
      T68 = T21+T19-2.0D+0
      T69 = 8.157414703487641D+0*T59+2.247591863577616D+0*T54+
     #4.3009724712766434D-1*T58+1.9115125951273373D-1*T56
      T70 = 2.9608749977793436D+1/T69+1.0D+0
      T71 = LOG(T70)
      T72 = -8.443449999999999D-3*T64*T65*T66*T67*T68*T71
      T73 = 1.274696188700087D-1*T54+1.0D+0
      T74 = 1.1120374863094687D+1*T59+3.8447462374472113D+0*T54+
     #1.6447337755676092D+0*T58+2.4058712912881913D-1*T56
      T75 = 3.216395899738507D+1/T74+1.0D+0
      T76 = LOG(T75)
      T77 = T63-3.10907D-2*T73*T76
      T78 = -1.0D+0*T64*T68*T77*T8*T9
      T79 = 5.0D-1*T20**(2.0D+0/3.0D+0)+5.0D-1*T18**(2.0D+0/
     #3.0D+0)
      T80 = T79**3
      T81 = 1.0D+0*T1**((-7.0D+0)/3.0D+0)
      T82 = T79**2
      T83 = 1.0D+0/T82
      T84 = 1.0D+0/T80
      T85 = T78+T72+T63
      T86 = 2.718281828459045D+0**(9.869604401089358D+0*T36*T84*
     #T85)
      T87 = T86-1.0D+0
      T88 = 1.0D+0/T87
      T89 = 4.179666459885054D-2*T36*T2*T81*T83*T88
      T90 = T89+1.0D+0
      T91 = 1.0D+0/T79**4
      T92 = 1.0D+0/T87**2
      T93 = 1.746961171588806D-3*T44*T3*T13*T91*T92+T89+1.0D+0
      T94 = 1.0D+0/T93
      T95 = 4.1796664598850536D-2*T36*T2*T81*T83*T90*T94+1.0D+0
      T96 = LOG(T95)
      T97 = -1.0132118364233778D-1*T33*T80*T96
      T98 = T97+T78+T72+T63+T52+T32
      T99 = -6.21814D-2*T55*T62
      T100 = 8.443449999999999D-3*T64*T65*T66*T67*T68*T71
      T101 = T64*T8*T9*T68*T77
      T102 = 1.0132118364233778D-1*T33*T80*T96
      T103 = T102+T101+T100+T99-5.066059182116889D-2*T33*T51+
     #3.10907D-2*T30*T31
      T104 = 1.0D+0/ABS(T103)
      T105 = T98*T104+1.0D+0
      T106 = 5.0D-1*T53*T105
      T107 = T102+T101+T100+T99
      T108 = T103*T104+1.0D+0
      T109 = 5.0D-1*T107*T108
      T110 = SQRT(RHOB)
      T111 = 1.0D+0*RHOB**((-1.0D+0)/3.0D+0)
      T112 = 1.1120374863094687D+1*RHOB**((-1.0D+0)/6.0D+0)+
     #2.4058712912881913D-1*RHOB**((-2.0D+0)/3.0D+0)+
     #3.8447462374472113D+0*T111+1.6447337755676092D+0/T110
      T113 = 3.216395899738507D+1/T112+1.0D+0
      T114 = LOG(T113)
      T115 = 1.274696188700087D-1*T111+1.0D+0
      T116 = -3.10907D-2*T114*T115
      T117 = 1.0D+0*RHOB**((-7.0D+0)/3.0D+0)
      T118 = 2.718281828459045D+0**(6.137058191058978D-1*T36*
     #T114*T115)
      T119 = T118-1.0D+0
      T120 = 1.0D+0/T119
      T121 = 8.359332919770108D-2*T35*T36*SIGMABB*T117*T120
      T122 = T121+1.0D+0
      T123 = SIGMABB**2
      T124 = 1.0D+0*RHOB**((-1.3999999999999999D+1)/3.0D+0)
      T125 = 1.0D+0/T119**2
      T126 = 6.987844686355223D-3*T43*T44*T123*T124*T125+T121+
     #1.0D+0
      T127 = 1.0D+0/T126
      T128 = 8.359332919770107D-2*T35*T36*SIGMABB*T117*T122*
     #T127+1.0D+0
      T129 = LOG(T128)
      T130 = 5.066059182116889D-2*T33*T129
      T131 = T130+T116
      T132 = T97+T130+T78+T72+T63+T116
      T133 = T102-5.066059182116889D-2*T33*T129+T101+T100+T99+
     #3.10907D-2*T114*T115
      T134 = 1.0D+0/ABS(T133)
      T135 = T132*T134+1.0D+0
      T136 = 5.0D-1*T131*T135
      T137 = T133*T134+1.0D+0
      T138 = 5.0D-1*T107*T137
      T139 = RHOB*(T138+T136)+RHOA*(T109+T106)
      T140 = TB+TA
      T141 = 1.0D+0/T140**2
      T142 = 1.5625D-2*T11*T12*T141*T24*T3+1.0D+0
      T143 = T107*T142-1.5625D-2*T139*T141*T25*T3*T4
      T144 = T2**3
      T145 = 1.0D+0/T140**3
      T146 = 5.46875D-3*T144*T4*T145*T143+1.0D+0
      T147 = 1.0D+0/T29
      T148 = 1.0D+0*RHOA**((-4.0D+0)/3.0D+0)
      T149 = -1.8533958105157808D+0*RHOA**((-7.0D+0)/6.0D+0)-
     #1.6039141941921276D-1*RHOA**((-5.0D+0)/3.0D+0)-
     #8.223668877838046D-1/T26**3-1.2815820791490704D+0*T148
      T150 = 1.0D+0/T28**2
      T151 = 1.0D+0*T147*T149*T31*T150
      T152 = 1.3210398931339262D-3*T30*T148
      T153 = 1.0D+0/T50
      T154 = 1.0D+0*RHOA**((-1.0D+1)/3.0D+0)
      T155 = -1.9505110146130256D-1*T35*T36*SIGMAAA*T154*T40
      T156 = -2.6076282286578434D-2*T36*T30*T148-
     #1.973920880217872D+1*T36*T147*T149*T31*T150
      T157 = -8.359332919770108D-2*T35*T36*SIGMAAA*T156*T37*T47*
     #T38
      T158 = 1.0D+0/T48**2
      T159 = -8.359332919770107D-2*T158*T35*T36*T37*T42*SIGMAAA*
     #(-3.260994186965771D-2*T43*T44*T45*T47*RHOA**
     #((-1.6999999999999998D+1)/3.0D+0)-1.3975689372710445D-2*T156*T38*
     #T43*T44*T45*T46/T39**3+T157+T155)-1.950511014613025D-1*T35*T36*
     #SIGMAAA*T154*T42*T49+8.359332919770107D-2*T35*T36*SIGMAAA*T37*T49*
     #(T157+T155)
      T160 = 5.066059182116889D-2*T33*T153*T159
      T161 = 1.0D+0*T1**((-5.0D+0)/3.0D+0)
      T162 = 1.0D+0/T57**3
      T163 = 1.0D+0*T1**((-4.0D+0)/3.0D+0)
      T164 = 1.0D+0*T1**((-7.0D+0)/6.0D+0)
      T165 = -9.970917392951799D-1*T164-7.418564737168958D-1*
     #T163-4.002143174996818D-1*T162-1.264669550498372D-1*T161
      T166 = 1.0D+0/T60**2
      T167 = 1.0D+0/T61
      T168 = -1.0D+0*T165*T55*T166*T167
      T169 = -1.3595691172479402D+0*T164-7.491972878592053D-1*
     #T163-2.1504862356383217D-1*T162-1.2743417300848914D-1*T161
      T170 = 1.0D+0/T69**2
      T171 = 1.0D+0/T70
      T172 = 2.5D-1*T64*T65*T66*T169*T67*T170*T68*T171
      T173 = -2.747773264188437D-3*T163*T62
      T174 = T5*T11
      T175 = -1.0D+0*T17
      T176 = T175+T174
      T177 = T18**(1.0D+0/3.0D+0)
      T178 = -1.0D+0*T11*T5
      T179 = T17+T178
      T180 = T20**(1.0D+0/3.0D+0)
      T181 = 1.3333333333333333D+0*T179*T180+
     #1.3333333333333333D+0*T176*T177
      T182 = -8.443449999999999D-3*T64*T65*T66*T67*T181*T71
      T183 = 1.942387305675933D-4*T64*T65*T163*T66*T68*T71
      T184 = 1.0D+0/T1**5
      T185 = 4.0D+0*T184*T8
      T186 = T5**3
      T187 = T185-4.0D+0*T186*T9
      T188 = -8.443449999999999D-3*T64*T65*T187*T67*T68*T71
      T189 = 1.3210398931339262D-3*T163*T76+1.0D+0*
     #(-1.8533958105157808D+0*T164-1.2815820791490704D+0*T163-
     #8.223668877838046D-1*T162-1.6039141941921276D-1*T161)*T73/(T74**2*
     #T75)+T173+T168
      T190 = -1.0D+0*T189*T64*T68*T8*T9
      T191 = -1.0D+0*T181*T64*T77*T8*T9
      T192 = 4.0D+0*T184*T64*T68*T77*T8
      T193 = -4.0D+0*T186*T64*T68*T77*T9
      T194 = 1.0D+0/T95
      T195 = 1.0D+0/T177
      T196 = 1.0D+0/T180
      T197 = 3.333333333333333D-1*T179*T196+
     #3.333333333333333D-1*T176*T195
      T198 = 1.0D+0*T1**((-1.0D+1)/3.0D+0)
      T199 = -9.752555073065126D-2*T36*T2*T198*T83*T90*T94
      T200 = -8.359332919770108D-2*T36*T2*T81*T197*T84*T88
      T201 = -9.752555073065128D-2*T36*T2*T198*T83*T88
      T202 = 9.869604401089358D+0*T36*T84*(T193+T192+T191+T190+
     #T188+T183+T182+T173+T172+T168)-2.9608813203268075D+1*T36*T197*T91*
     #T85
      T203 = -4.179666459885054D-2*T36*T2*T81*T83*T202*T92*T86
      T204 = 1.0D+0/T93**2
      T205 = 1.0D+0/T79**5
      T206 = 1.0D+0*T1**((-1.6999999999999998D+1)/3.0D+0)
      T207 = -8.152485467414428D-3*T44*T3*T206*T91*T92
      T208 = 1.0D+0/T87**3
      T209 = -4.1796664598850536D-2*T36*T2*T81*T83*T90*T204*
     #(T203-3.493922343177612D-3*T44*T3*T13*T91*T202*T208*T86+T201+T200+
     #T207-6.987844686355223D-3*T44*T3*T13*T197*T205*T92)+
     #4.1796664598850536D-2*T36*T2*T81*T83*T94*(T203+T201+T200)+T199-
     #8.359332919770107D-2*T36*T2*T81*T197*T84*T90*T94
      T210 = -1.0132118364233778D-1*T33*T80*T194*T209
      T211 = -3.039635509270133D-1*T33*T197*T82*T96
      T212 = 1.0D+0*T165*T55*T166*T167
      T213 = -2.5D-1*T64*T65*T66*T169*T67*T170*T68*T171
      T214 = 2.747773264188437D-3*T163*T62
      T215 = 8.443449999999999D-3*T64*T65*T66*T67*T181*T71
      T216 = -1.942387305675933D-4*T64*T65*T163*T66*T68*T71
      T217 = 8.443449999999999D-3*T64*T65*T187*T67*T68*T71
      T218 = T64*T8*T9*T68*T189
      T219 = T64*T8*T9*T181*T77
      T220 = -4.0D+0*T184*T64*T68*T77*T8
      T221 = 4.0D+0*T186*T64*T68*T77*T9
      T222 = 1.0132118364233778D-1*T33*T80*T194*T209
      T223 = 3.039635509270133D-1*T33*T197*T82*T96
      T224 = 1.0D+0/T103
      T225 = T223+T222+T221+T220+T219+T218+T217+T216+T215+T214+
     #T213+T212
      T226 = 1.0D+0/T133
      T227 = 1.0D+0*T18**((-7.0D+0)/3.0D+0)
      T228 = 1.0D+0*T20**((-7.0D+0)/3.0D+0)
      T229 = -2.43797614528847D-1*T206*T16*T22
      T230 = 5.224234597046721D-2*T13*T22*(2.0D+0*SIGMABB*RHOA-
     #2.0D+0*SIGMAAB*RHOB)+T229+5.224234597046721D-2*T13*T16*
     #(-1.3333333333333333D+0*T179*T228-1.3333333333333333D+0*T176*T227)
      T231 = 1.0D+0/T23**5
      T232 = -1.356D+1*T6/T1**7
      T233 = T5**5
      T234 = -2.0D+0*T8*T184
      T235 = -1.74D+0*T10*T4
      T236 = 1.74D+0*T5*T11+T235+2.0D+0*T186*T9+T234+1.356D+1*
     #T233*T7+T232
      T237 = 4.6875D-2*T139*T141*T25*T3*T9
      T238 = -3.125D-2*T12*T141*T24*T3*T4
      T239 = -1.5625D-2*T141*T25*T3*T4*((5.0D-1*T131*((T211+
     #T210+T193+T192+T191+T190+T188+T183+T182+T173+T172+T168)*T134-
     #1.0D+0*T132*T134*T225*T226)+5.0D-1*T225*T137)*RHOB+(5.0D-1*T53*
     #((T211+T210+T193+T192+T191+T190+T188+T183+T182+T173+T172+T168+
     #T160+T152+T151)*T104-1.0D+0*T104*(T223+T222+T221+T220+T219+T218+
     #T217+T216+T215+T214+T213+T212-5.066059182116889D-2*T33*T153*T159-
     #1.3210398931339262D-3*T30*T148-1.0D+0*T147*T149*T31*T150)*T224*
     #T98)+5.0D-1*T225*T108+5.0D-1*(T160+T152+T151)*T105)*RHOA+T109+
     #T106)-1.5625D-2*T139*T141*(T236*T24-4.0D+0*T12*T230*T231)*T3*T4+
     #T107*(1.5625D-2*T11*T141*T236*T24*T3-6.25D-2*T11*T12*T141*T230*
     #T231*T3+T238)+T237+T225*T142
      T240 = -1.6406249999999997D-2*T144*T9*T145*T143
      T241 = T143*T146
      T242 = T17+T174
      T243 = T175+T178
      T244 = 1.3333333333333333D+0*T180*T243+
     #1.3333333333333333D+0*T177*T242
      T245 = -8.443449999999999D-3*T64*T65*T66*T67*T244*T71
      T246 = 4.0D+0*T186*T9+T185
      T247 = -8.443449999999999D-3*T64*T65*T246*T67*T68*T71
      T248 = -1.0D+0*T244*T64*T77*T8*T9
      T249 = 3.333333333333333D-1*T196*T243+
     #3.333333333333333D-1*T195*T242
      T250 = -8.359332919770108D-2*T36*T2*T81*T249*T84*T88
      T251 = 9.869604401089358D+0*T36*T84*(T221+T192+T248+T190+
     #T247+T183+T245+T173+T172+T168)-2.9608813203268075D+1*T36*T249*T91*
     #T85
      T252 = -4.179666459885054D-2*T36*T2*T81*T83*T251*T92*T86
      T253 = -4.1796664598850536D-2*T36*T2*T81*T83*T90*T204*
     #(T252-3.493922343177612D-3*T44*T3*T13*T91*T251*T208*T86+T201+T250+
     #T207-6.987844686355223D-3*T44*T3*T13*T249*T205*T92)+
     #4.1796664598850536D-2*T36*T2*T81*T83*T94*(T252+T201+T250)+T199-
     #8.359332919770107D-2*T36*T2*T81*T249*T84*T90*T94
      T254 = -1.0132118364233778D-1*T33*T80*T194*T253
      T255 = -3.039635509270133D-1*T33*T249*T82*T96
      T256 = 8.443449999999999D-3*T64*T65*T66*T67*T244*T71
      T257 = 8.443449999999999D-3*T64*T65*T246*T67*T68*T71
      T258 = T64*T8*T9*T244*T77
      T259 = 1.0132118364233778D-1*T33*T80*T194*T253
      T260 = 3.039635509270133D-1*T33*T249*T82*T96
      T261 = T260+T259+T193+T220+T258+T218+T257+T216+T256+T214+
     #T213+T212
      T262 = 1.0D+0/T113
      T263 = 1.0D+0*RHOB**((-4.0D+0)/3.0D+0)
      T264 = -1.8533958105157808D+0*RHOB**((-7.0D+0)/6.0D+0)-
     #1.6039141941921276D-1*RHOB**((-5.0D+0)/3.0D+0)-
     #1.2815820791490704D+0*T263-8.223668877838046D-1/T110**3
      T265 = 1.0D+0/T112**2
      T266 = 1.0D+0*T262*T264*T115*T265
      T267 = 1.3210398931339262D-3*T114*T263
      T268 = 1.0D+0/T128
      T269 = 1.0D+0*RHOB**((-1.0D+1)/3.0D+0)
      T270 = -1.9505110146130256D-1*T35*T36*SIGMABB*T269*T120
      T271 = -2.6076282286578434D-2*T36*T114*T263-
     #1.973920880217872D+1*T36*T262*T264*T115*T265
      T272 = -8.359332919770108D-2*T35*T36*SIGMABB*T271*T117*
     #T125*T118
      T273 = 1.0D+0/T126**2
      T274 = -8.359332919770107D-2*T117*T122*T273*T35*T36*
     #SIGMABB*(-3.260994186965771D-2*T123*T125*T43*T44*RHOB**
     #((-1.6999999999999998D+1)/3.0D+0)-1.3975689372710445D-2*T118*T123*
     #T124*T271*T43*T44/T119**3+T272+T270)+8.359332919770107D-2*T35*T36*
     #SIGMABB*T117*T127*(T272+T270)-1.950511014613025D-1*T35*T36*
     #SIGMABB*T269*T122*T127
      T275 = 5.066059182116889D-2*T33*T268*T274
      T276 = 5.224234597046721D-2*T13*T22*(2.0D+0*SIGMAAA*RHOB-
     #2.0D+0*SIGMAAB*RHOA)+5.224234597046721D-2*T13*T16*
     #(-1.3333333333333333D+0*T228*T243-1.3333333333333333D+0*T227*
     #T242)+T229
      T277 = -1.74D+0*T5*T11+T235-2.0D+0*T186*T9+T234-1.356D+1*
     #T233*T7+T232
      T278 = -1.5625D-2*T141*T25*T3*T4*((5.0D-1*T131*((T255+
     #T254+T221+T192+T248+T190+T247+T183+T245+T173+T275+T172+T168+T267+
     #T266)*T134-1.0D+0*T132*T134*T226*(T260+T259+T193+T220+T258+T218+
     #T257+T216+T256+T214-5.066059182116889D-2*T33*T268*T274+T213+T212-
     #1.3210398931339262D-3*T114*T263-1.0D+0*T262*T264*T115*T265))+
     #5.0D-1*T261*T137+5.0D-1*(T275+T267+T266)*T135)*RHOB+(5.0D-1*T53*
     #((T255+T254+T221+T192+T248+T190+T247+T183+T245+T173+T172+T168)*
     #T104-1.0D+0*T104*T224*T261*T98)+5.0D-1*T261*T108)*RHOA+T138+T136)-
     #1.5625D-2*T139*T141*(T277*T24-4.0D+0*T12*T231*T276)*T3*T4+T107*
     #(1.5625D-2*T11*T141*T24*T277*T3-6.25D-2*T11*T12*T141*T231*T276*T3+
     #T238)+T237+T261*T142
      T279 = 6.987844686355223D-3*T43*T44*SIGMAAA*T46*T49*T40+
     #8.359332919770107D-2*T35*T36*T37*T42*T49-8.359332919770107D-2*T35*
     #T36*SIGMAAA*T37*(8.359332919770108D-2*T35*T36*T37*T40+
     #1.3975689372710445D-2*T43*T44*SIGMAAA*T46*T47)*T42*T158
      T280 = 1.746961171588806D-3*T44*T2*T13*T91*T94*T88+
     #4.1796664598850536D-2*T36*T81*T83*T90*T94-4.1796664598850536D-2*
     #T36*T2*T81*T83*(4.179666459885054D-2*T36*T81*T83*T88+
     #3.493922343177612D-3*T44*T2*T13*T91*T92)*T90*T204
      T281 = -1.0132118364233778D-1*T33*T80*T194*T280
      T282 = 1.0132118364233778D-1*T33*T80*T194*T280
      T283 = 5.066059182116889D-2*T33*T80*T194*T280*T108
      T284 = 5.066059182116889D-2*T33*T80*T194*T280*T137
      T285 = 1.0D+0*T1**((-2.2999999999999998D+1)/3.0D+0)
      T286 = -3.125D-2*T139*T141*T2*T25*T4
      T287 = 1.0D+0*T1**((-2.0D+1)/3.0D+0)
      T288 = 3.125D-2*T11*T12*T141*T2*T24
      T289 = 1.0132118364233778D-1*T33*T80*T194*T280*T142
      T290 = -1.5625D-2*T141*T25*T3*T4*((5.0D-1*T53*((T281+
     #5.066059182116889D-2*T33*T153*T279)*T104-1.0D+0*T104*T224*(T282-
     #5.066059182116889D-2*T33*T153*T279)*T98)+T283+
     #2.5330295910584444D-2*T33*T153*T279*T105)*RHOA+RHOB*(T284+5.0D-1*
     #T131*(-1.0132118364233778D-1*T33*T80*T194*T280*T132*T226*T134-
     #1.0132118364233778D-1*T33*T80*T194*T280*T134)))+T289+T107*(T288-
     #3.2651466231542003D-3*T3*T15*T287*T12*T22*T231*T141)+T286+
     #3.2651466231542003D-3*T3*T15*T285*T12*T22*T231*T139*T141
      T291 = 1.6406249999999997D-2*T3*T4*T145*T143
      T292 = 6.987844686355223D-3*T43*T44*SIGMABB*T124*T127*
     #T120+8.359332919770107D-2*T35*T36*T117*T122*T127-
     #8.359332919770107D-2*T35*T36*SIGMABB*T117*(8.359332919770108D-2*
     #T35*T36*T117*T120+1.3975689372710445D-2*T43*T44*SIGMABB*T124*
     #T125)*T122*T273
      T293 = -1.5625D-2*T141*T25*T3*T4*((T284+5.0D-1*T131*
     #((T281+5.066059182116889D-2*T33*T268*T292)*T134-1.0D+0*T132*T134*
     #T226*(T282-5.066059182116889D-2*T33*T268*T292))+
     #2.5330295910584444D-2*T33*T268*T292*T135)*RHOB+RHOA*(T283+5.0D-1*
     #T53*(-1.0132118364233778D-1*T33*T80*T194*T280*T98*T224*T104-
     #1.0132118364233778D-1*T33*T80*T194*T280*T104)))+T289+T107*(T288-
     #3.2651466231542003D-3*T3*T14*T287*T12*T22*T231*T141)+T286+
     #3.2651466231542003D-3*T3*T14*T285*T12*T22*T231*T139*T141
      T294 = 3.493922343177612D-3*T44*T2*T13*T91*T94*T88+
     #8.359332919770107D-2*T36*T81*T83*T90*T94-4.1796664598850536D-2*
     #T36*T2*T81*T83*(8.359332919770108D-2*T36*T81*T83*T88+
     #6.987844686355223D-3*T44*T2*T13*T91*T92)*T90*T204
      T295 = -1.5625D-2*(RHOB*(5.066059182116889D-2*T33*T80*
     #T194*T294*T137+5.0D-1*T131*(-1.0132118364233778D-1*T33*T80*T194*
     #T294*T132*T226*T134-1.0132118364233778D-1*T33*T80*T194*T294*
     #T134))+RHOA*(5.066059182116889D-2*T33*T80*T194*T294*T108+5.0D-1*
     #T53*(-1.0132118364233778D-1*T33*T80*T194*T294*T98*T224*T104-
     #1.0132118364233778D-1*T33*T80*T194*T294*T104)))*T141*T25*T3*T4-
     #6.25D-2*T139*T141*T2*T25*T4+T107*(6.25D-2*T11*T12*T141*T2*T24+
     #6.530293246308401D-3*T3*RHOA*RHOB*T287*T12*T22*T231*T141)+
     #1.0132118364233778D-1*T33*T80*T194*T294*T142-6.530293246308401D-3*
     #T3*RHOA*RHOB*T285*T12*T22*T231*T139*T141
      T296 = 3.125D-2*T139*T145*T25*T3*T4-3.125D-2*T107*T11*T12*
     #T145*T24*T3
      T297 = T1*T143*(5.46875D-3*T144*T4*T145*T296-
     #1.6406249999999997D-2*T143*T144*T4/T140**4)+T1*T296*T146
      ZK(I) = T1*T143*T146
      VRHOA(I) = T241+T1*T239*T146+T1*T143*(T240+5.46875D-3*
     #T144*T4*T145*T239)
      VRHOB(I) = T241+T1*T278*T146+T1*T143*(T240+5.46875D-3*
     #T144*T4*T145*T278)
      VSIGMAAA(I) = T1*T290*T146+T1*T143*(T291+5.46875D-3*T144*
     #T4*T145*T290)
      VSIGMABB(I) = T1*T293*T146+T1*T143*(T291+5.46875D-3*T144*
     #T4*T145*T293)
      VSIGMAAB(I) = T1*T295*T146+T1*T143*(3.2812499999999994D-2*
     #T3*T4*T145*T143+5.46875D-3*T144*T4*T145*T295)
      VTA(I) = T297
      VTB(I) = T297
C
      ENDIF ! RHOA,RHOB
      ELSE ! RHO
      ZK(I) = 0.0D0
      VRHOA(I) = 0.0D0
      VRHOB(I) = 0.0D0
      VSIGMAAA(I) = 0.0D0
      VSIGMAAB(I) = 0.0D0
      VSIGMABB(I) = 0.0D0
      VTA(I) = 0.0D0
      VTB(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ENDIF ! IDERIV
      RETURN
      END
C*MODULE DFTXCE  *DECK RKS_X_PKZB
      SUBROUTINE RKS_X_PKZB
     & (IDERIV,NPT,RHOA1,SIGMAAA1,
     &  TA1,ZK,VRHOA,VSIGMAAA,
     &  VTA)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      INTEGER IDERIV,NPT
      DOUBLE PRECISION RHOA1(NPT),TA1(NPT),SIGMAAA1(NPT)
      DOUBLE PRECISION ZK(NPT),VRHOA(NPT),VTA(NPT),VSIGMAAA(NPT)
      PARAMETER(TOL=1.0D-20)
C
      IF(IDERIV.EQ.0) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHO = 20*RHOA
      IF(RHO.GT.TOL) THEN
      TA = MAX(0.D0,TA1(I))
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
C
      T1 = 1.0D+0*RHOA**((-8.0D+0)/3.0D+0)
      T2 = 1.5672703791140166D-1*RHOA**((-5.0D+0)/3.0D+0)*TA-
     #2.176764415436134D-3*SIGMAAA*T1-4.5D-1
      ZK(I) = -7.385587663820224D-1*(1.804D+0-8.04D-1/
     #(1.2437810945273631D+0*(9.003645810803886D-5*SIGMAAA**2*RHOA**
     #((-1.6D+1)/3.0D+0)+7.209876543209877D-2*T2**2-
     #4.7082608096840833D-3*SIGMAAA*T1*T2+3.224836171016495D-3*SIGMAAA*
     #T1)+1.0D+0))*RHOA**(4.0D+0/3.0D+0)
C
      ELSE ! RHO
      ZK(I) = 0.0D0
      VRHOA(I) = 0.0D0
      VSIGMAAA(I) = 0.0D0
      VTA(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ELSE IF(IDERIV.EQ.1) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHO = 2.D+00*RHOA
      IF(RHO.GT.TOL) THEN
      TA = MAX(0.D0,TA1(I))
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
C
      T1 = RHOA**(4.0D+0/3.0D+0)
      T2 = SIGMAAA**2
      T3 = 1.0D+0*RHOA**((-1.6D+1)/3.0D+0)
      T4 = 1.0D+0*RHOA**((-8.0D+0)/3.0D+0)
      T5 = 1.0D+0*RHOA**((-5.0D+0)/3.0D+0)
      T6 = 1.5672703791140166D-1*T5*TA-2.176764415436134D-3*
     #SIGMAAA*T4-4.5D-1
      T7 = 1.2437810945273631D+0*(7.209876543209877D-2*T6**2-
     #4.7082608096840833D-3*SIGMAAA*T4*T6+3.224836171016495D-3*SIGMAAA*
     #T4+9.003645810803886D-5*T2*T3)+1.0D+0
      T8 = 1.804D+0-8.04D-1/T7
      T9 = 1.0D+0*RHOA**((-1.1000000000000001D+1)/3.0D+0)
      T10 = 5.804705107829691D-3*SIGMAAA*T9-
     #2.612117298523361D-1*T4*TA
      T11 = 1.0D+0/T7**2
      ZK(I) = -7.385587663820224D-1*T1*T8
      VRHOA(I) = -7.385587663820224D-1*T1*T11*
     #(-4.801944432428739D-4*T2*RHOA**((-1.9D+1)/3.0D+0)-
     #8.599563122710653D-3*SIGMAAA*T9+1.2555362159157554D-2*SIGMAAA*T9*
     #T6+1.4419753086419754D-1*T10*T6-4.7082608096840833D-3*SIGMAAA*T4*
     #T10)-9.847450218426965D-1*RHOA**(1.0D+0/3.0D+0)*T8
      VSIGMAAA(I) = -2.9542350655280897D+0*T1*
     #(-5.022144863663022D-3*T4*T6+3.224836171016495D-3*T4+
     #1.9032169080519054D-4*SIGMAAA*T3)*T11
      VTA(I) = -7.385587663820224D-1*T1*T11*
     #(2.25996518864836D-2*T5*T6-7.379117704161241D-4*SIGMAAA*RHOA**
     #((-1.3D+1)/3.0D+0))
C
      ELSE ! RHO
      ZK(I) = 0.0D0
      VRHOA(I) = 0.0D0
      VSIGMAAA(I) = 0.0D0
      VTA(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ENDIF
      RETURN
      END
C*MODULE DFTXCE  *DECK UKS_X_PKZB
      SUBROUTINE UKS_X_PKZB
     & (IDERIV,NPT,RHOA1,RHOB1,SIGMAAA1,SIGMABB1,
     &  TA1,TB1,
     &  ZK,VRHOA,VRHOB,VSIGMAAA,VSIGMAAB,VSIGMABB,
     &  VTA,VTB)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      INTEGER NPT
      DOUBLE PRECISION RHOA1(NPT),RHOB1(NPT)
      DOUBLE PRECISION TA1(NPT),TB1(NPT)
      DOUBLE PRECISION SIGMAAA1(NPT),SIGMABB1(NPT)
      DOUBLE PRECISION ZK(NPT),VRHOA(NPT),VRHOB(NPT)
      DOUBLE PRECISION VTA(NPT),VTB(NPT)
      DOUBLE PRECISION VSIGMAAA(NPT),VSIGMAAB(NPT),VSIGMABB(NPT)
      PARAMETER(TOL=1.0D-20)
C
      IF (IDERIV.EQ.0) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHOB = MAX(0.D0,RHOB1(I))
      RHO = RHOA+RHOB
      IF(RHO.GT.TOL) THEN
      IF(RHOA.LT.TOL) THEN
      SIGMABB = MAX(0.D0,SIGMABB1(I))
      TB = MAX(0.D0,TB1(I))
C
      T1 = 6.299605249474366D-1
      T2 = 1.0D+0*RHOB**((-8.0D+0)/3.0D+0)
      T3 = 1.5672703791140166D-1*T1*RHOB**((-5.0D+0)/3.0D+0)*TB-
     #1.371275653835047D-3*T2*SIGMABB-4.5D-1
      ZK(I) = -9.305257363491D-1*(1.804D+0-8.04D-1/
     #(1.2437810945273631D+0*(3.57309920790479D-5*SIGMABB**2*RHOB**
     #((-1.6D+1)/3.0D+0)+7.209876543209877D-2*T3**2-
     #4.7082608096840833D-3*T1*SIGMABB*T2*T3+3.224836171016495D-3*T1*
     #SIGMABB*T2)+1.0D+0))*RHOB**(4.0D+0/3.0D+0)
C
      ELSEIF(RHOB.LT.TOL) THEN
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
      TA = MAX(0.D0,TA1(I))
C
      T1 = 6.299605249474366D-1
      T2 = 1.0D+0*RHOA**((-8.0D+0)/3.0D+0)
      T3 = 1.5672703791140166D-1*T1*RHOA**((-5.0D+0)/3.0D+0)*TA-
     #1.371275653835047D-3*T2*SIGMAAA-4.5D-1
      ZK(I) = -9.305257363491D-1*(1.804D+0-8.04D-1/
     #(1.2437810945273631D+0*(3.57309920790479D-5*SIGMAAA**2*RHOA**
     #((-1.6D+1)/3.0D+0)+7.209876543209877D-2*T3**2-
     #4.7082608096840833D-3*T1*SIGMAAA*T2*T3+3.224836171016495D-3*T1*
     #SIGMAAA*T2)+1.0D+0))*RHOA**(4.0D+0/3.0D+0)
C
      ELSE ! (.NOT.(RHOA.LT.TOL).AND..NOT.(RHOB.LT.TOL))
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
      SIGMABB = MAX(0.D0,SIGMABB1(I))
      TA = MAX(0.D0,TA1(I))
      TB = MAX(0.D0,TB1(I))
C
      T1 = 7.937005259840997D-1
      T2 = 6.299605249474366D-1
      T3 = 1.0D+0*RHOA**((-8.0D+0)/3.0D+0)
      T4 = 5.249671041228637D-2
      T5 = 1.5672703791140166D-1*T2*RHOA**((-5.0D+0)/3.0D+0)*TA-
     #2.612117298523361D-2*T4*SIGMAAA*T3-4.5D-1
      T6 = 1.0D+0*RHOB**((-8.0D+0)/3.0D+0)
      T7 = 1.5672703791140166D-1*T2*RHOB**((-5.0D+0)/3.0D+0)*TA-
     #2.612117298523361D-2*T4*SIGMABB*T6-4.5D-1
      ZK(I) = -9.305257363491D-1*(1.804D+0-8.04D-1/
     #(1.2437810945273631D+0*(4.501822905401943D-5*T1*SIGMABB**2*RHOB**
     #((-1.6D+1)/3.0D+0)+7.209876543209877D-2*T7**2-
     #4.7082608096840833D-3*T2*SIGMABB*T6*T7+3.224836171016495D-3*T2*
     #SIGMABB*T6)+1.0D+0))*RHOB**(4.0D+0/3.0D+0)-9.305257363491D-1*
     #(1.804D+0-8.04D-1/(1.2437810945273631D+0*(4.501822905401943D-5*T1*
     #SIGMAAA**2*RHOA**((-1.6D+1)/3.0D+0)+7.209876543209877D-2*T5**2-
     #4.7082608096840833D-3*T2*SIGMAAA*T3*T5+3.224836171016495D-3*T2*
     #SIGMAAA*T3)+1.0D+0))*RHOA**(4.0D+0/3.0D+0)
C
      ENDIF ! RHOA,RHOB
      ELSE ! RHO
      ZK(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ELSE IF(IDERIV.EQ.1) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHOB = MAX(0.D0,RHOB1(I))
      RHO = RHOA+RHOB
      IF(RHO.GT.TOL) THEN
      IF(RHOA.LT.TOL) THEN
      SIGMABB = MAX(0.D0,SIGMABB1(I))
      TB = MAX(0.D0,TB1(I))
C
      T1 = RHOB**(4.0D+0/3.0D+0)
      T2 = 7.937005259840997D-1
      T3 = SIGMABB**2
      T4 = 1.0D+0*RHOB**((-1.6D+1)/3.0D+0)
      T5 = 6.299605249474366D-1
      T6 = 1.0D+0*RHOB**((-8.0D+0)/3.0D+0)
      T7 = 1.5749013123685915D-1
      T8 = 1.0D+0*RHOB**((-5.0D+0)/3.0D+0)
      T9 = 1.5672703791140166D-1*T5*T8*TB-8.707057661744535D-3*
     #T6*T7*SIGMABB-4.5D-1
      T10 = 1.2437810945273631D+0*(7.209876543209877D-2*T9**2-
     #4.7082608096840833D-3*T5*SIGMABB*T6*T9+3.224836171016495D-3*T5*
     #SIGMABB*T6+4.501822905401943D-5*T2*T3*T4)+1.0D+0
      T11 = 1.804D+0-8.04D-1/T10
      T12 = 1.0D+0*RHOB**((-1.1000000000000001D+1)/3.0D+0)
      T13 = 2.3218820431318762D-2*T7*SIGMABB*T12-
     #2.612117298523361D-1*T5*T6*TB
      T14 = 1.0D+0/T10**2
      ZK(I) = -9.305257363491D-1*T1*T11
      VRHOA(I) = 0.0D+0
      VRHOB(I) = -9.305257363491D-1*T1*T14*
     #(-2.4009722162143696D-4*T2*T3*RHOB**((-1.9D+1)/3.0D+0)+
     #1.4419753086419754D-1*T13*T9+1.2555362159157554D-2*T5*SIGMABB*T12*
     #T9-4.7082608096840833D-3*T5*SIGMABB*T6*T13-8.599563122710653D-3*
     #T5*SIGMABB*T12)-1.2407009817987999D+0*RHOB**(1.0D+0/3.0D+0)*T11
      VSIGMAAA(I) = 0.0D+0
      VSIGMAAB(I) = 0.0D+0
      VSIGMABB(I) = -9.305257363491D-1*T1*
     #(-4.7082608096840833D-3*T5*T6*T9-1.2555362159157554D-3*T7*T6*T9+
     #3.224836171016495D-3*T5*T6+9.516084540259527D-5*T2*SIGMABB*T4)*T14
      VTA(I) = 0.0D+0
      VTB(I) = -9.305257363491D-1*T1*T14*(2.25996518864836D-2*
     #T5*T8*T9-3.6895588520806205D-4*T2*SIGMABB*RHOB**((-1.3D+1)/
     #3.0D+0))
C
      ELSEIF(RHOB.LT.TOL) THEN
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
      TA = MAX(0.D0,TA1(I))
C
      T1 = RHOA**(4.0D+0/3.0D+0)
      T2 = 7.937005259840997D-1
      T3 = SIGMAAA**2
      T4 = 1.0D+0*RHOA**((-1.6D+1)/3.0D+0)
      T5 = 6.299605249474366D-1
      T6 = 1.0D+0*RHOA**((-8.0D+0)/3.0D+0)
      T7 = 1.5749013123685915D-1
      T8 = 1.0D+0*RHOA**((-5.0D+0)/3.0D+0)
      T9 = 1.5672703791140166D-1*T5*T8*TA-8.707057661744535D-3*
     #T6*T7*SIGMAAA-4.5D-1
      T10 = 1.2437810945273631D+0*(7.209876543209877D-2*T9**2-
     #4.7082608096840833D-3*T5*SIGMAAA*T6*T9+3.224836171016495D-3*T5*
     #SIGMAAA*T6+4.501822905401943D-5*T2*T3*T4)+1.0D+0
      T11 = 1.804D+0-8.04D-1/T10
      T12 = 1.0D+0*RHOA**((-1.1000000000000001D+1)/3.0D+0)
      T13 = 2.3218820431318762D-2*T7*SIGMAAA*T12-
     #2.612117298523361D-1*T5*T6*TA
      T14 = 1.0D+0/T10**2
      ZK(I) = -9.305257363491D-1*T1*T11
      VRHOA(I) = -9.305257363491D-1*T1*T14*
     #(-2.4009722162143696D-4*T2*T3*RHOA**((-1.9D+1)/3.0D+0)+
     #1.4419753086419754D-1*T13*T9+1.2555362159157554D-2*T5*SIGMAAA*T12*
     #T9-4.7082608096840833D-3*T5*SIGMAAA*T6*T13-8.599563122710653D-3*
     #T5*SIGMAAA*T12)-1.2407009817987999D+0*RHOA**(1.0D+0/3.0D+0)*T11
      VRHOB(I) = 0.0D+0
      VSIGMAAA(I) = -9.305257363491D-1*T1*
     #(-4.7082608096840833D-3*T5*T6*T9-1.2555362159157554D-3*T7*T6*T9+
     #3.224836171016495D-3*T5*T6+9.516084540259527D-5*T2*SIGMAAA*T4)*T14
      VSIGMAAB(I) = 0.0D+0
      VSIGMABB(I) = 0.0D+0
      VTA(I) = -9.305257363491D-1*T1*T14*(2.25996518864836D-2*
     #T5*T8*T9-3.6895588520806205D-4*T2*SIGMAAA*RHOA**((-1.3D+1)/
     #3.0D+0))
      VTB(I) = 0.0D+0
C
      ELSE ! (.NOT.(RHOA.LT.TOL).AND..NOT.(RHOB.LT.TOL))
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
      SIGMABB = MAX(0.D0,SIGMABB1(I))
      TA = MAX(0.D0,TA1(I))
      TB = MAX(0.D0,TB1(I))
C
      T1 = RHOA**(4.0D+0/3.0D+0)
      T2 = 7.937005259840997D-1
      T3 = SIGMAAA**2
      T4 = 1.0D+0*RHOA**((-1.6D+1)/3.0D+0)
      T5 = 6.299605249474366D-1
      T6 = 1.0D+0*RHOA**((-8.0D+0)/3.0D+0)
      T7 = 1.5749013123685915D-1
      T8 = 3.333333333333333D-1*T7
      T9 = 1.0D+0*RHOA**((-5.0D+0)/3.0D+0)
      T10 = 1.5672703791140166D-1*T5*T9*TA-2.612117298523361D-2*
     #T8*SIGMAAA*T6-4.5D-1
      T11 = 1.2437810945273631D+0*(3.224836171016495D-3*T5*
     #SIGMAAA*T6+4.501822905401943D-5*T2*T3*T4+7.209876543209877D-2*T10*
     #*2-4.7082608096840833D-3*T5*SIGMAAA*T6*T10)+1.0D+0
      T12 = 1.804D+0-8.04D-1/T11
      T13 = RHOB**(4.0D+0/3.0D+0)
      T14 = SIGMABB**2
      T15 = 1.0D+0*RHOB**((-1.6D+1)/3.0D+0)
      T16 = 1.0D+0*RHOB**((-8.0D+0)/3.0D+0)
      T17 = 1.0D+0*RHOB**((-5.0D+0)/3.0D+0)
      T18 = 1.5672703791140166D-1*T5*T17*TB-
     #2.612117298523361D-2*T8*SIGMABB*T16-4.5D-1
      T19 = 1.2437810945273631D+0*(7.209876543209877D-2*T18**2-
     #4.7082608096840833D-3*T5*SIGMABB*T16*T18+3.224836171016495D-3*T5*
     #SIGMABB*T16+4.501822905401943D-5*T2*T14*T15)+1.0D+0
      T20 = 1.804D+0-8.04D-1/T19
      T21 = 1.0D+0*RHOA**((-1.1000000000000001D+1)/3.0D+0)
      T22 = 2.3218820431318762D-2*T7*SIGMAAA*T21-
     #2.612117298523361D-1*T5*T6*TA
      T23 = 1.0D+0/T11**2
      T24 = 1.0D+0*RHOB**((-1.1000000000000001D+1)/3.0D+0)
      T25 = 2.3218820431318762D-2*T7*SIGMABB*T24-
     #2.612117298523361D-1*T5*T16*TB
      T26 = 1.0D+0/T19**2
      ZK(I) = -9.305257363491D-1*T13*T20-9.305257363491D-1*T1*
     #T12
      VRHOA(I) = -9.305257363491D-1*T1*T23*
     #(-2.4009722162143696D-4*T2*T3*RHOA**((-1.9D+1)/3.0D+0)-
     #4.7082608096840833D-3*T5*SIGMAAA*T6*T22+1.4419753086419754D-1*T10*
     #T22-8.599563122710653D-3*T5*SIGMAAA*T21+1.2555362159157554D-2*T5*
     #SIGMAAA*T21*T10)-1.2407009817987999D+0*RHOA**(1.0D+0/3.0D+0)*T12
      VRHOB(I) = -9.305257363491D-1*T13*T26*
     #(-2.4009722162143696D-4*T14*T2*RHOB**((-1.9D+1)/3.0D+0)+
     #1.4419753086419754D-1*T18*T25-4.7082608096840833D-3*T5*SIGMABB*
     #T16*T25-8.599563122710653D-3*T5*SIGMABB*T24+1.2555362159157554D-2*
     #T5*SIGMABB*T24*T18)-1.2407009817987999D+0*RHOB**(1.0D+0/3.0D+0)*
     #T20
      VSIGMAAA(I) = -9.305257363491D-1*T1*
     #(-4.7082608096840833D-3*T5*T6*T10-1.2555362159157554D-3*T7*T6*T10+
     #3.224836171016495D-3*T5*T6+9.516084540259527D-5*T2*SIGMAAA*T4)*T23
      VSIGMAAB(I) = 0.0D+0
      VSIGMABB(I) = -9.305257363491D-1*T13*
     #(-4.7082608096840833D-3*T5*T16*T18-1.2555362159157554D-3*T7*T16*
     #T18+3.224836171016495D-3*T5*T16+9.516084540259527D-5*T2*SIGMABB*
     #T15)*T26
      VTA(I) = -9.305257363491D-1*T1*T23*(2.25996518864836D-2*
     #T5*T9*T10-3.6895588520806205D-4*T2*SIGMAAA*RHOA**((-1.3D+1)/
     #3.0D+0))
      VTB(I) = -9.305257363491D-1*T13*T26*(2.25996518864836D-2*
     #T5*T17*T18-3.6895588520806205D-4*T2*SIGMABB*RHOB**((-1.3D+1)/
     #3.0D+0))
C
      ENDIF ! RHOA,RHOB
      ELSE ! RHO
      ZK(I) = 0.0D0
      VRHOA(I) = 0.0D0
      VRHOB(I) = 0.0D0
      VSIGMAAA(I) = 0.0D0
      VSIGMAAB(I) = 0.0D0
      VSIGMABB(I) = 0.0D0
      VTA(I) = 0.0D0
      VTB(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ENDIF ! IDERIV
      RETURN
      END
C*MODULE DFTXCE  *DECK RKS_C_PKZB
      SUBROUTINE RKS_C_PKZB
     & (IDERIV,NPT,RHOA1,SIGMAAA1,
     &  TA1,ZK,VRHOA,VSIGMAAA,
     &  VTA)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      INTEGER IDERIV,NPT
      DOUBLE PRECISION RHOA1(NPT),TA1(NPT),SIGMAAA1(NPT)
      DOUBLE PRECISION ZK(NPT),VRHOA(NPT),VTA(NPT),VSIGMAAA(NPT)
      PARAMETER(TOL=1.0D-20)
C
      IF(IDERIV.EQ.0) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHO = 2.D+00*RHOA
      IF(RHO.GT.TOL) THEN
      TA = MAX(0.D0,TA1(I))
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
C
      T1 = SIGMAAA**2
      T2 = 1.923661050931536D+0
      T3 = 1.0D+0*RHOA**((-2.0D+0)/3.0D+0)
      T4 = 1.0D+0/SQRT(RHOA)
      T5 = 1.0D+0*RHOA**((-1.0D+0)/3.0D+0)
      T6 = 1.0D+0*RHOA**((-1.0D+0)/6.0D+0)
      T7 = LOG(1.6081979498692536D+1/(6.715185816249738D+0*T6+
     #2.8040417617100993D+0*T5+1.1319770313278835D+0*T4+
     #3.011306662279899D-1*T3)+1.0D+0)
      T8 = 1.6702634755197018D-1*T5+1.0D+0
      T9 = 6.21814D-2*T7*T8
      T10 = T9-3.10907D-2*(1.606016560364007D-1*T5+1.0D+0)*
     #LOG(3.216395899738507D+1/(1.2482198746797324D+1*T6+
     #4.8440767160638537D+0*T5+2.3260048119008184D+0*T4+
     #3.819082618690966D-1*T3)+1.0D+0)
      T11 = 3.068528194400547D-1
      T12 = 1.0D+0/T11
      T13 = 1.0D+0*RHOA**((-7.0D+0)/3.0D+0)
      T14 = 2.718281828459045D+0**(1.9739208802178723D+1*T12*
     #(T9-5.198420997897459D-1*T2*T10))-1.0D+0
      T15 = 8.359332919770112D-2*T12*T13*SIGMAAA/T14
      T16 = 1.0D+0/T11**2
      T17 = 1.0D+0*RHOA**((-1.3999999999999999D+1)/3.0D+0)
      T18 = 1.0D+0/TA**2
      T19 = LOG(1.6081979498692536D+1/(5.982550435771079D+0*T6+
     #2.2255694211506874D+0*T5+8.004286349993636D-1*T4+
     #1.8970043257475583D-1*T3)+1.0D+0)
      T20 = 1.3256889990520176D-1*T5+1.0D+0
      T21 = 2.718281828459045D+0**(6.137058191058978D-1*T12*T19*
     #T20)-1.0D+0
      T22 = 4.179666459885054D-2*T12*T13*SIGMAAA/T21
      ZK(I) = (1.0132118364233778D-1*T11*
     #LOG(4.1796664598850536D-2*T12*T13*(T22+1.0D+0)*SIGMAAA/(T22+
     #1.746961171588806D-3*T1*T16*T17/T21**2+1.0D+0)+1.0D+0)-6.21814D-2*
     #T19*T20)*(8.28125D-3*T1*T18/RHOA**2+1.0D+0)*RHOA-
     #2.3906249999999998D-2*T1*T18*(5.066059182116887D-2*T11*
     #LOG(8.359332919770112D-2*T12*T13*(T15+1.0D+0)*SIGMAAA/
     #(6.987844686355229D-3*T1*T16*T17/T14**2+T15+1.0D+0)+1.0D+0)-
     #6.21814D-2*T7*T8+5.198420997897459D-1*T2*T10)/RHOA
C
      ELSE ! RHO
      ZK(I) = 0.0D0
      VRHOA(I) = 0.0D0
      VSIGMAAA(I) = 0.0D0
      VTA(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ELSE IF(IDERIV.EQ.1) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHO = 2.D+00*RHOA
      IF(RHO.GT.TOL) THEN
      TA = MAX(0.D0,TA1(I))
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
C
      T1 = SIGMAAA**2
      T2 = 1.0D+0/RHOA
      T3 = 1.923661050931536D+0
      T4 = 1.0D+0*RHOA**((-2.0D+0)/3.0D+0)
      T5 = SQRT(RHOA)
      T6 = 1.0D+0/T5
      T7 = 1.0D+0*RHOA**((-1.0D+0)/3.0D+0)
      T8 = 1.0D+0*RHOA**((-1.0D+0)/6.0D+0)
      T9 = 1.2482198746797324D+1*T8+4.8440767160638537D+0*T7+
     #2.3260048119008184D+0*T6+3.819082618690966D-1*T4
      T10 = 3.216395899738507D+1/T9+1.0D+0
      T11 = LOG(T10)
      T12 = 1.606016560364007D-1*T7+1.0D+0
      T13 = 6.715185816249738D+0*T8+2.8040417617100993D+0*T7+
     #1.1319770313278835D+0*T6+3.011306662279899D-1*T4
      T14 = 1.6081979498692536D+1/T13+1.0D+0
      T15 = LOG(T14)
      T16 = 1.6702634755197018D-1*T7+1.0D+0
      T17 = 6.21814D-2*T15*T16
      T18 = T17-3.10907D-2*T11*T12
      T19 = 3.068528194400547D-1
      T20 = 1.0D+0/T19
      T21 = 1.0D+0*RHOA**((-7.0D+0)/3.0D+0)
      T22 = 2.718281828459045D+0**(1.9739208802178723D+1*T20*
     #(T17-5.198420997897459D-1*T3*T18))
      T23 = T22-1.0D+0
      T24 = 1.0D+0/T23
      T25 = 8.359332919770112D-2*T20*SIGMAAA*T21*T24
      T26 = T25+1.0D+0
      T27 = 1.0D+0/T19**2
      T28 = 1.0D+0*RHOA**((-1.3999999999999999D+1)/3.0D+0)
      T29 = 1.0D+0/T23**2
      T30 = 6.987844686355229D-3*T27*T1*T28*T29+T25+1.0D+0
      T31 = 1.0D+0/T30
      T32 = 8.359332919770112D-2*T20*SIGMAAA*T21*T26*T31+1.0D+0
      T33 = 5.066059182116887D-2*T19*LOG(T32)-6.21814D-2*T15*
     #T16+5.198420997897459D-1*T3*T18
      T34 = 1.0D+0/TA**2
      T35 = 5.982550435771079D+0*T8+2.2255694211506874D+0*T7+
     #8.004286349993636D-1*T6+1.8970043257475583D-1*T4
      T36 = 1.6081979498692536D+1/T35+1.0D+0
      T37 = LOG(T36)
      T38 = 1.3256889990520176D-1*T7+1.0D+0
      T39 = 2.718281828459045D+0**(6.137058191058978D-1*T20*T37*
     #T38)
      T40 = T39-1.0D+0
      T41 = 1.0D+0/T40
      T42 = 4.179666459885054D-2*T20*SIGMAAA*T21*T41
      T43 = T42+1.0D+0
      T44 = 1.0D+0/T40**2
      T45 = 1.746961171588806D-3*T27*T1*T28*T44+T42+1.0D+0
      T46 = 1.0D+0/T45
      T47 = 4.1796664598850536D-2*T20*SIGMAAA*T21*T43*T46+1.0D+0
      T48 = 1.0132118364233778D-1*T19*LOG(T47)-6.21814D-2*T37*
     #T38
      T49 = 1.0D+0/RHOA**2
      T50 = 8.28125D-3*T1*T49*T34+1.0D+0
      T51 = 1.0D+0/T14
      T52 = 1.0D+0*RHOA**((-5.0D+0)/3.0D+0)
      T53 = 1.0D+0/T5**3
      T54 = 1.0D+0*RHOA**((-4.0D+0)/3.0D+0)
      T55 = 1.0D+0*RHOA**((-7.0D+0)/6.0D+0)
      T56 = -1.119197636041623D+0*T55-9.346805872366997D-1*T54-
     #5.659885156639417D-1*T53-2.0075377748532658D-1*T52
      T57 = 1.0D+0/T13**2
      T58 = -1.0D+0*T51*T56*T16*T57
      T59 = -3.461977375889359D-3*T15*T54
      T60 = 1.0D+0*T12*(-2.0803664577995534D+0*T55-
     #1.6146922386879511D+0*T54-1.1630024059504092D+0*T53-
     #2.5460550791273107D-1*T52)/(T10*T9**2)+T59+T58+
     #1.6644059691103075D-3*T11*T54
      T61 = 1.0D+0/T32
      T62 = 1.0D+0*RHOA**((-1.0D+1)/3.0D+0)
      T63 = -1.950511014613026D-1*T20*SIGMAAA*T62*T24
      T64 = T59+T58-5.198420997897459D-1*T3*T60
      T65 = -1.6500661795026855D+0*T27*SIGMAAA*T64*T21*T29*T22
      T66 = 1.0D+0/T30**2
      T67 = 1.0D+0*RHOA**((-1.6999999999999998D+1)/3.0D+0)
      T68 = 1.0D+0/T36
      T69 = -9.970917392951799D-1*T55-7.418564737168958D-1*T54-
     #4.002143174996818D-1*T53-1.264669550498372D-1*T52
      T70 = 1.0D+0/T35**2
      T71 = 1.0D+0/T47
      T72 = -9.752555073065128D-2*T20*SIGMAAA*T62*T41
      T73 = -2.7119435101429873D-2*T20*T37*T54-
     #9.86960440108936D+0*T20*T68*T69*T38*T70
      T74 = -4.179666459885054D-2*T20*SIGMAAA*T73*T21*T44*T39
      T75 = 1.0D+0/T45**2
      T76 = 1.0D+0/TA**3
      ZK(I) = RHOA*T48*T50-2.3906249999999998D-2*T1*T2*T33*T34
      VRHOA(I) = T50*(1.0132118364233778D-1*T19*T71*
     #(-4.1796664598850536D-2*T20*T21*T43*(T74-3.493922343177612D-3*T1*
     #T27*T28*T39*T73/T40**3+T72-8.152485467414428D-3*T27*T1*T67*T44)*
     #T75*SIGMAAA+4.1796664598850536D-2*T20*SIGMAAA*T21*T46*(T74+T72)-
     #9.752555073065126D-2*T20*SIGMAAA*T62*T43*T46)+1.0D+0*T68*T69*T38*
     #T70+2.747773264188437D-3*T37*T54)*RHOA-2.3906249999999998D-2*T1*
     #T2*T34*(5.066059182116887D-2*T19*T61*(-8.359332919770112D-2*T20*
     #T21*T26*(T65-2.758690506823219D-1*T1*T22*T28*T64/(T19**3*T23**3)+
     #T63-3.260994186965774D-2*T27*T1*T67*T29)*T66*SIGMAAA+
     #8.359332919770112D-2*T20*SIGMAAA*T21*T31*(T65+T63)-
     #1.950511014613026D-1*T20*SIGMAAA*T62*T26*T31)+
     #5.198420997897459D-1*T3*T60+1.0D+0*T51*T56*T16*T57+
     #3.461977375889359D-3*T15*T54)+T48*T50-1.65625D-2*T1*T49*T48*T34+
     #2.3906249999999998D-2*T1*T49*T33*T34
      VSIGMAAA(I) = 4.0D+0*(1.0132118364233778D-1*T19*RHOA*T71*
     #(1.746961171588806D-3*T27*SIGMAAA*T28*T46*T41+
     #4.1796664598850536D-2*T20*T21*T43*T46-4.1796664598850536D-2*T20*
     #SIGMAAA*T21*(4.179666459885054D-2*T20*T21*T41+
     #3.493922343177612D-3*T27*SIGMAAA*T28*T44)*T43*T75)*T50+1.65625D-2*
     #SIGMAAA*T2*T48*T34-4.7812499999999997D-2*SIGMAAA*T2*T33*T34-
     #1.2111047732248183D-3*T19*T1*T2*T61*(6.987844686355229D-3*T27*
     #SIGMAAA*T28*T31*T24+8.359332919770112D-2*T20*T21*T26*T31-
     #8.359332919770112D-2*T20*SIGMAAA*T21*(8.359332919770112D-2*T20*
     #T21*T24+1.3975689372710456D-2*T27*SIGMAAA*T28*T29)*T26*T66)*T34)
      VTA(I) = 4.7812499999999997D-2*T1*T2*T33*T76-1.65625D-2*
     #T1*T2*T48*T76
C
      ELSE ! RHO
      ZK(I) = 0.0D0
      VRHOA(I) = 0.0D0
      VSIGMAAA(I) = 0.0D0
      VTA(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ENDIF
      RETURN
      END
C*MODULE DFTXCE  *DECK UKS_C_PKZB
      SUBROUTINE UKS_C_PKZB
     & (IDERIV,NPT,RHOA1,RHOB1,SIGMAAA1,SIGMAAB1,SIGMABB1,
     &  TA1,TB1,
     &  ZK,VRHOA,VRHOB,VSIGMAAA,VSIGMAAB,VSIGMABB,
     &  VTA,VTB)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      INTEGER NPT
      DOUBLE PRECISION RHOA1(NPT),RHOB1(NPT)
      DOUBLE PRECISION TA1(NPT),TB1(NPT)
      DOUBLE PRECISION SIGMAAA1(NPT),SIGMABB1(NPT),SIGMAAB1(NPT)
      DOUBLE PRECISION ZK(NPT),VRHOA(NPT),VRHOB(NPT)
      DOUBLE PRECISION VTA(NPT),VTB(NPT)
      DOUBLE PRECISION VSIGMAAA(NPT),VSIGMAAB(NPT),VSIGMABB(NPT)
      PARAMETER(TOL=1.0D-20)
C
      IF (IDERIV.EQ.0) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHOB = MAX(0.D0,RHOB1(I))
      RHO = RHOA+RHOB
      IF(RHO.GT.TOL) THEN
      IF(RHOA.LT.TOL) THEN
      SIGMABB = MAX(0.D0,SIGMABB1(I))
      TB = MAX(0.D0,TB1(I))
C
      T1 = SIGMABB**2
      T2 = 1.0D+0*RHOB**((-1.0D+0)/3.0D+0)
      T3 = LOG(3.216395899738507D+1/(1.1120374863094687D+1*RHOB**
     #((-1.0D+0)/6.0D+0)+1.6447337755676092D+0/SQRT(RHOB)+
     #2.4058712912881913D-1*RHOB**((-2.0D+0)/3.0D+0)+
     #3.8447462374472113D+0*T2)+1.0D+0)
      T4 = 1.274696188700087D-1*T2+1.0D+0
      T5 = 3.068528194400547D-1
      T6 = 7.937005259840997D-1
      T7 = 1.0D+0/T5
      T8 = 1.0D+0*RHOB**((-7.0D+0)/3.0D+0)
      T9 = 2.718281828459045D+0**(6.137058191058978D-1*T7*T3*
     #T4)-1.0D+0
      T10 = 8.359332919770108D-2*T6*T7*T8*SIGMABB/T9
      T11 = 5.066059182116889D-2*T5*LOG(8.359332919770107D-2*
     #(T10+1.0D+0)*T6*T7*T8*SIGMABB/(4.402066306867492D-3*T1*RHOB**
     #((-1.3999999999999999D+1)/3.0D+0)/(T5**2*T9**2)+T10+1.0D+0)+
     #1.0D+0)-3.10907D-2*T3*T4
      T12 = 1.0D+0/TB**2
      ZK(I) = T11*(8.28125D-3*T1*T12/RHOB**2+1.0D+0)*RHOB-
     #2.3906249999999998D-2*T1*T11*T12/RHOB
C
      ELSEIF(RHOB.LT.TOL) THEN
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
      TA = MAX(0.D0,TA1(I))
C
      T1 = SIGMAAA**2
      T2 = 1.0D+0*RHOA**((-1.0D+0)/3.0D+0)
      T3 = LOG(3.216395899738507D+1/(1.1120374863094687D+1*RHOA**
     #((-1.0D+0)/6.0D+0)+1.6447337755676092D+0/SQRT(RHOA)+
     #2.4058712912881913D-1*RHOA**((-2.0D+0)/3.0D+0)+
     #3.8447462374472113D+0*T2)+1.0D+0)
      T4 = 1.274696188700087D-1*T2+1.0D+0
      T5 = 3.068528194400547D-1
      T6 = 7.937005259840997D-1
      T7 = 1.0D+0/T5
      T8 = 1.0D+0*RHOA**((-7.0D+0)/3.0D+0)
      T9 = 2.718281828459045D+0**(6.137058191058978D-1*T7*T3*
     #T4)-1.0D+0
      T10 = 8.359332919770108D-2*T6*T7*T8*SIGMAAA/T9
      T11 = 5.066059182116889D-2*T5*LOG(8.359332919770107D-2*
     #(T10+1.0D+0)*T6*T7*T8*SIGMAAA/(4.402066306867492D-3*T1*RHOA**
     #((-1.3999999999999999D+1)/3.0D+0)/(T5**2*T9**2)+T10+1.0D+0)+
     #1.0D+0)-3.10907D-2*T3*T4
      T12 = 1.0D+0/TA**2
      ZK(I) = T11*(8.28125D-3*T1*T12/RHOA**2+1.0D+0)*RHOA-
     #2.3906249999999998D-2*T1*T11*T12/RHOA
C
      ELSE ! (.NOT.(RHOA.LT.TOL).AND..NOT.(RHOB.LT.TOL))
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
      SIGMAAB = SIGMAAB1(I)
      SIGMABB = MAX(0.D0,SIGMABB1(I))
      TA = MAX(0.D0,TA1(I))
      TB = MAX(0.D0,TB1(I))
C
      T1 = SIGMAAA**2
      T2 = 1.0D+0/RHOA
      T3 = 1.0D+0*RHOA**((-1.0D+0)/3.0D+0)
      T4 = LOG(3.216395899738507D+1/(1.1120374863094687D+1*RHOA**
     #((-1.0D+0)/6.0D+0)+1.6447337755676092D+0/SQRT(RHOA)+
     #2.4058712912881913D-1*RHOA**((-2.0D+0)/3.0D+0)+
     #3.8447462374472113D+0*T3)+1.0D+0)
      T5 = 1.274696188700087D-1*T3+1.0D+0
      T6 = 3.068528194400547D-1
      T7 = 1.2599210498948732D+0
      T8 = 1.0D+0/T7
      T9 = 1.0D+0/T6
      T10 = 1.0D+0*RHOA**((-7.0D+0)/3.0D+0)
      T11 = 2.718281828459045D+0**(6.137058191058978D-1*T9*T4*
     #T5)-1.0D+0
      T12 = 8.359332919770108D-2*T10*T8*T9*SIGMAAA/T11
      T13 = 6.299605249474366D-1
      T14 = 1.0D+0/T6**2
      T15 = SIGMABB**2
      T16 = 1.0D+0/RHOB
      T17 = 1.0D+0*RHOB**((-1.0D+0)/3.0D+0)
      T18 = LOG(3.216395899738507D+1/(1.1120374863094687D+1*
     #RHOB**((-1.0D+0)/6.0D+0)+1.6447337755676092D+0/SQRT(RHOB)+
     #2.4058712912881913D-1*RHOB**((-2.0D+0)/3.0D+0)+
     #3.8447462374472113D+0*T17)+1.0D+0)
      T19 = 1.274696188700087D-1*T17+1.0D+0
      T20 = 1.0D+0*RHOB**((-7.0D+0)/3.0D+0)
      T21 = 2.718281828459045D+0**(6.137058191058978D-1*T9*T18*
     #T19)-1.0D+0
      T22 = 8.359332919770108D-2*T20*T8*T9*SIGMABB/T21
      T23 = RHOB+RHOA
      T24 = 1.0D+0*T23**((-1.0D+0)/3.0D+0)
      T25 = 1.3256889990520176D-1*T24+1.0D+0
      T26 = 1.0D+0*T23**((-2.0D+0)/3.0D+0)
      T27 = 1.0D+0/SQRT(T23)
      T28 = 1.0D+0*T23**((-1.0D+0)/6.0D+0)
      T29 = LOG(1.6081979498692536D+1/(5.982550435771079D+0*T28+
     #2.2255694211506874D+0*T24+8.004286349993636D-1*T27+
     #1.8970043257475583D-1*T26)+1.0D+0)
      T30 = 1.0D+0/(2.0D+0*T7-2.0D+0)
      T31 = 9.0D+0*T7-9.0D+0
      T32 = RHOA-1.0D+0*RHOB
      T33 = T32**4
      T34 = 1.0D+0/T23**4
      T35 = 1.0D+0-1.0D+0*T33*T34
      T36 = 6.901399211255825D-2*T24+1.0D+0
      T37 = 1.0D+0/T23
      T38 = 1.0D+0-1.0D+0*T32*T37
      T39 = T32*T37+1.0D+0
      T40 = T39**(4.0D+0/3.0D+0)+T38**(4.0D+0/3.0D+0)-2.0D+0
      T41 = LOG(2.9608749977793436D+1/(8.157414703487641D+0*T28+
     #2.247591863577616D+0*T24+4.3009724712766434D-1*T27+
     #1.9115125951273373D-1*T26)+1.0D+0)
      T42 = 6.21814D-2*T25*T29
      T43 = T42-3.10907D-2*(1.274696188700087D-1*T24+1.0D+0)*
     #LOG(3.216395899738507D+1/(1.1120374863094687D+1*T28+
     #3.8447462374472113D+0*T24+1.6447337755676092D+0*T27+
     #2.4058712912881913D-1*T26)+1.0D+0)
      T44 = 5.0D-1*T39**(2.0D+0/3.0D+0)+5.0D-1*T38**(2.0D+0/
     #3.0D+0)
      T45 = T44**3
      T46 = SIGMABB+SIGMAAA+2.0D+0*SIGMAAB
      T47 = 1.0D+0*T23**((-7.0D+0)/3.0D+0)
      T48 = 1.0D+0/T44**2
      T49 = 2.718281828459045D+0**(9.869604401089358D+0*T9*
     #(-T30*T33*T34*T40*T43-8.443449999999999D-3*T30*T31*T35*T36*T40*
     #T41+T42)/T45)-1.0D+0
      T50 = 4.179666459885054D-2*T46*T47*T48*T9/T49
      ZK(I) = T23*(1.0132118364233778D-1*T45*T6*
     #LOG(4.1796664598850536D-2*T46*T47*T48*(T50+1.0D+0)*T9/(T50+
     #1.746961171588806D-3*T14*T23**((-1.3999999999999999D+1)/3.0D+0)*
     #T46**2/(T44**4*T49**2)+1.0D+0)+1.0D+0)+T30*T33*T34*T40*T43+
     #8.443449999999999D-3*T30*T31*T35*T36*T40*T41-6.21814D-2*T25*T29)*
     #(5.3D-1*(1.25D-1*T16*SIGMABB+1.25D-1*T2*SIGMAAA)**2/(TB+TA)**2+
     #1.0D+0)-1.53D+0*(1.5625D-2*T15*T16*(5.066059182116889D-2*T6*
     #LOG(8.359332919770107D-2*T20*(T22+1.0D+0)*T8*T9*SIGMABB/
     #(6.987844686355223D-3*T13*T14*T15*RHOB**((-1.3999999999999999D+1)/
     #3.0D+0)/T21**2+T22+1.0D+0)+1.0D+0)-3.10907D-2*T18*T19)/TB**2+
     #1.5625D-2*T1*T2*(5.066059182116889D-2*T6*LOG(8.359332919770107D-2*
     #T10*(T12+1.0D+0)*T8*T9*SIGMAAA/(6.987844686355223D-3*T1*T13*T14*
     #RHOA**((-1.3999999999999999D+1)/3.0D+0)/T11**2+T12+1.0D+0)+
     #1.0D+0)-3.10907D-2*T4*T5)/TA**2)
C
      ENDIF ! RHOA,RHOB
      ELSE ! RHO
      ZK(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ELSE IF(IDERIV.EQ.1) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHOB = MAX(0.D0,RHOB1(I))
      RHO = RHOA+RHOB
      IF(RHO.GT.TOL) THEN
      IF(RHOA.LT.TOL) THEN
      SIGMABB = MAX(0.D0,SIGMABB1(I))
      TB = MAX(0.D0,TB1(I))
C
      T1 = SIGMABB**2
      T2 = 1.0D+0/RHOB
      T3 = SQRT(RHOB)
      T4 = 1.0D+0*RHOB**((-1.0D+0)/3.0D+0)
      T5 = 1.1120374863094687D+1*RHOB**((-1.0D+0)/6.0D+0)+
     #2.4058712912881913D-1*RHOB**((-2.0D+0)/3.0D+0)+
     #3.8447462374472113D+0*T4+1.6447337755676092D+0/T3
      T6 = 3.216395899738507D+1/T5+1.0D+0
      T7 = LOG(T6)
      T8 = 1.274696188700087D-1*T4+1.0D+0
      T9 = 3.068528194400547D-1
      T10 = 7.937005259840997D-1
      T11 = 1.0D+0/T9
      T12 = 1.0D+0*RHOB**((-7.0D+0)/3.0D+0)
      T13 = 2.718281828459045D+0**(6.137058191058978D-1*T11*T7*
     #T8)
      T14 = T13-1.0D+0
      T15 = 1.0D+0/T14
      T16 = 8.359332919770108D-2*T10*T11*SIGMABB*T12*T15
      T17 = T16+1.0D+0
      T18 = 6.299605249474366D-1
      T19 = 1.0D+0/T9**2
      T20 = 1.0D+0*RHOB**((-1.3999999999999999D+1)/3.0D+0)
      T21 = 1.0D+0/T14**2
      T22 = 6.987844686355223D-3*T18*T19*T1*T20*T21+T16+1.0D+0
      T23 = 1.0D+0/T22
      T24 = 8.359332919770107D-2*T10*T11*SIGMABB*T12*T17*T23+
     #1.0D+0
      T25 = 5.066059182116889D-2*T9*LOG(T24)-3.10907D-2*T7*T8
      T26 = 1.0D+0/TB**2
      T27 = 1.0D+0/RHOB**2
      T28 = 8.28125D-3*T1*T27*T26+1.0D+0
      T29 = 1.0D+0/T6
      T30 = 1.0D+0*RHOB**((-4.0D+0)/3.0D+0)
      T31 = -1.8533958105157808D+0*RHOB**((-7.0D+0)/6.0D+0)-
     #1.6039141941921276D-1*RHOB**((-5.0D+0)/3.0D+0)-
     #1.2815820791490704D+0*T30-8.223668877838046D-1/T3**3
      T32 = 1.0D+0/T5**2
      T33 = 1.0D+0/T24
      T34 = 1.0D+0*RHOB**((-1.0D+1)/3.0D+0)
      T35 = -1.9505110146130256D-1*T10*T11*SIGMABB*T34*T15
      T36 = -2.6076282286578434D-2*T11*T7*T30-
     #1.973920880217872D+1*T11*T29*T31*T8*T32
      T37 = -8.359332919770108D-2*T10*T11*SIGMABB*T36*T12*T21*
     #T13
      T38 = 1.0D+0/T22**2
      T39 = 5.066059182116889D-2*T33*T9*(-8.359332919770107D-2*
     #T10*T11*T12*T17*T38*SIGMABB*(-3.260994186965771D-2*T1*T18*T19*T21*
     #RHOB**((-1.6999999999999998D+1)/3.0D+0)+T37-1.3975689372710445D-2*
     #T1*T13*T18*T19*T20*T36/T14**3+T35)+8.359332919770107D-2*T10*T11*
     #SIGMABB*T12*T23*(T37+T35)-1.950511014613025D-1*T10*T11*SIGMABB*
     #T34*T17*T23)+1.0D+0*T29*T31*T8*T32+1.3210398931339262D-3*T7*T30
      T40 = 6.987844686355223D-3*T18*T19*SIGMABB*T20*T23*T15+
     #8.359332919770107D-2*T10*T11*T12*T17*T23-8.359332919770107D-2*T10*
     #T11*SIGMABB*T12*(8.359332919770108D-2*T10*T11*T12*T15+
     #1.3975689372710445D-2*T18*T19*SIGMABB*T20*T21)*T17*T38
      ZK(I) = RHOB*T25*T28-2.3906249999999998D-2*T1*T2*T25*T26
      VRHOA(I) = 0.0D+0
      VRHOB(I) = T25*T28+RHOB*T39*T28+7.343749999999999D-3*T1*
     #T27*T25*T26-2.3906249999999998D-2*T1*T2*T39*T26
      VSIGMAAA(I) = 0.0D+0
      VSIGMAAB(I) = 0.0D+0
      VSIGMABB(I) = 5.066059182116889D-2*T9*RHOB*T33*T40*T28-
     #3.125D-2*SIGMABB*T2*T25*T26-1.2111047732248187D-3*T9*T1*T2*T33*
     #T40*T26
      VTA(I) = 0.0D+0
      VTB(I) = 3.125D-2*T1*T2*T25/TB**3
C
      ELSEIF(RHOB.LT.TOL) THEN
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
      TA = MAX(0.D0,TA1(I))
C
      T1 = SIGMAAA**2
      T2 = 1.0D+0/RHOA
      T3 = SQRT(RHOA)
      T4 = 1.0D+0*RHOA**((-1.0D+0)/3.0D+0)
      T5 = 1.1120374863094687D+1*RHOA**((-1.0D+0)/6.0D+0)+
     #2.4058712912881913D-1*RHOA**((-2.0D+0)/3.0D+0)+
     #3.8447462374472113D+0*T4+1.6447337755676092D+0/T3
      T6 = 3.216395899738507D+1/T5+1.0D+0
      T7 = LOG(T6)
      T8 = 1.274696188700087D-1*T4+1.0D+0
      T9 = 3.068528194400547D-1
      T10 = 7.937005259840997D-1
      T11 = 1.0D+0/T9
      T12 = 1.0D+0*RHOA**((-7.0D+0)/3.0D+0)
      T13 = 2.718281828459045D+0**(6.137058191058978D-1*T11*T7*
     #T8)
      T14 = T13-1.0D+0
      T15 = 1.0D+0/T14
      T16 = 8.359332919770108D-2*T10*T11*SIGMAAA*T12*T15
      T17 = T16+1.0D+0
      T18 = 6.299605249474366D-1
      T19 = 1.0D+0/T9**2
      T20 = 1.0D+0*RHOA**((-1.3999999999999999D+1)/3.0D+0)
      T21 = 1.0D+0/T14**2
      T22 = 6.987844686355223D-3*T18*T19*T1*T20*T21+T16+1.0D+0
      T23 = 1.0D+0/T22
      T24 = 8.359332919770107D-2*T10*T11*SIGMAAA*T12*T17*T23+
     #1.0D+0
      T25 = 5.066059182116889D-2*T9*LOG(T24)-3.10907D-2*T7*T8
      T26 = 1.0D+0/TA**2
      T27 = 1.0D+0/RHOA**2
      T28 = 8.28125D-3*T1*T27*T26+1.0D+0
      T29 = 1.0D+0/T6
      T30 = 1.0D+0*RHOA**((-4.0D+0)/3.0D+0)
      T31 = -1.8533958105157808D+0*RHOA**((-7.0D+0)/6.0D+0)-
     #1.6039141941921276D-1*RHOA**((-5.0D+0)/3.0D+0)-
     #1.2815820791490704D+0*T30-8.223668877838046D-1/T3**3
      T32 = 1.0D+0/T5**2
      T33 = 1.0D+0/T24
      T34 = 1.0D+0*RHOA**((-1.0D+1)/3.0D+0)
      T35 = -1.9505110146130256D-1*T10*T11*SIGMAAA*T34*T15
      T36 = -2.6076282286578434D-2*T11*T7*T30-
     #1.973920880217872D+1*T11*T29*T31*T8*T32
      T37 = -8.359332919770108D-2*T10*T11*SIGMAAA*T36*T12*T21*
     #T13
      T38 = 1.0D+0/T22**2
      T39 = 5.066059182116889D-2*T33*T9*(-8.359332919770107D-2*
     #T10*T11*T12*T17*T38*SIGMAAA*(-3.260994186965771D-2*T1*T18*T19*T21*
     #RHOA**((-1.6999999999999998D+1)/3.0D+0)+T37-1.3975689372710445D-2*
     #T1*T13*T18*T19*T20*T36/T14**3+T35)+8.359332919770107D-2*T10*T11*
     #SIGMAAA*T12*T23*(T37+T35)-1.950511014613025D-1*T10*T11*SIGMAAA*
     #T34*T17*T23)+1.0D+0*T29*T31*T8*T32+1.3210398931339262D-3*T7*T30
      T40 = 6.987844686355223D-3*T18*T19*SIGMAAA*T20*T23*T15+
     #8.359332919770107D-2*T10*T11*T12*T17*T23-8.359332919770107D-2*T10*
     #T11*SIGMAAA*T12*(8.359332919770108D-2*T10*T11*T12*T15+
     #1.3975689372710445D-2*T18*T19*SIGMAAA*T20*T21)*T17*T38
      ZK(I) = RHOA*T25*T28-2.3906249999999998D-2*T1*T2*T25*T26
      VRHOA(I) = T25*T28+RHOA*T39*T28+7.343749999999999D-3*T1*
     #T27*T25*T26-2.3906249999999998D-2*T1*T2*T39*T26
      VRHOB(I) = 0.0D+0
      VSIGMAAA(I) = 5.066059182116889D-2*T9*RHOA*T33*T40*T28-
     #3.125D-2*SIGMAAA*T2*T25*T26-1.2111047732248187D-3*T9*T1*T2*T33*
     #T40*T26
      VSIGMAAB(I) = 0.0D+0
      VSIGMABB(I) = 0.0D+0
      VTA(I) = 3.125D-2*T1*T2*T25/TA**3
      VTB(I) = 0.0D+0
C
      ELSE ! (.NOT.(RHOA.LT.TOL).AND..NOT.(RHOB.LT.TOL))
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
      SIGMAAB = SIGMAAB1(I)
      SIGMABB = MAX(0.D0,SIGMABB1(I))
      TA = MAX(0.D0,TA1(I))
      TB = MAX(0.D0,TB1(I))
C
      T1 = SIGMAAA**2
      T2 = 1.0D+0/RHOA
      T3 = SQRT(RHOA)
      T4 = 1.0D+0*RHOA**((-1.0D+0)/3.0D+0)
      T5 = 1.1120374863094687D+1*RHOA**((-1.0D+0)/6.0D+0)+
     #2.4058712912881913D-1*RHOA**((-2.0D+0)/3.0D+0)+
     #3.8447462374472113D+0*T4+1.6447337755676092D+0/T3
      T6 = 3.216395899738507D+1/T5+1.0D+0
      T7 = LOG(T6)
      T8 = 1.274696188700087D-1*T4+1.0D+0
      T9 = 3.068528194400547D-1
      T10 = 1.2599210498948732D+0
      T11 = 1.0D+0/T10
      T12 = 1.0D+0/T9
      T13 = 1.0D+0*RHOA**((-7.0D+0)/3.0D+0)
      T14 = 2.718281828459045D+0**(6.137058191058978D-1*T12*T7*
     #T8)
      T15 = T14-1.0D+0
      T16 = 1.0D+0/T15
      T17 = 8.359332919770108D-2*T11*T12*SIGMAAA*T13*T16
      T18 = T17+1.0D+0
      T19 = 6.299605249474366D-1
      T20 = 1.0D+0/T9**2
      T21 = 1.0D+0*RHOA**((-1.3999999999999999D+1)/3.0D+0)
      T22 = 1.0D+0/T15**2
      T23 = 6.987844686355223D-3*T19*T20*T1*T21*T22+T17+1.0D+0
      T24 = 1.0D+0/T23
      T25 = 8.359332919770107D-2*T11*T12*SIGMAAA*T13*T18*T24+
     #1.0D+0
      T26 = 5.066059182116889D-2*T9*LOG(T25)-3.10907D-2*T7*T8
      T27 = 1.0D+0/TA**2
      T28 = SIGMABB**2
      T29 = 1.0D+0/RHOB
      T30 = SQRT(RHOB)
      T31 = 1.0D+0*RHOB**((-1.0D+0)/3.0D+0)
      T32 = 1.1120374863094687D+1*RHOB**((-1.0D+0)/6.0D+0)+
     #2.4058712912881913D-1*RHOB**((-2.0D+0)/3.0D+0)+
     #3.8447462374472113D+0*T31+1.6447337755676092D+0/T30
      T33 = 3.216395899738507D+1/T32+1.0D+0
      T34 = LOG(T33)
      T35 = 1.274696188700087D-1*T31+1.0D+0
      T36 = 1.0D+0*RHOB**((-7.0D+0)/3.0D+0)
      T37 = 2.718281828459045D+0**(6.137058191058978D-1*T12*T34*
     #T35)
      T38 = T37-1.0D+0
      T39 = 1.0D+0/T38
      T40 = 8.359332919770108D-2*T11*T12*SIGMABB*T36*T39
      T41 = T40+1.0D+0
      T42 = 1.0D+0*RHOB**((-1.3999999999999999D+1)/3.0D+0)
      T43 = 1.0D+0/T38**2
      T44 = 6.987844686355223D-3*T19*T20*T28*T42*T43+T40+1.0D+0
      T45 = 1.0D+0/T44
      T46 = 8.359332919770107D-2*T11*T12*SIGMABB*T36*T41*T45+
     #1.0D+0
      T47 = 5.066059182116889D-2*T9*LOG(T46)-3.10907D-2*T34*T35
      T48 = 1.0D+0/TB**2
      T49 = RHOB+RHOA
      T50 = 1.0D+0*T49**((-1.0D+0)/3.0D+0)
      T51 = 1.3256889990520176D-1*T50+1.0D+0
      T52 = 1.0D+0*T49**((-2.0D+0)/3.0D+0)
      T53 = SQRT(T49)
      T54 = 1.0D+0/T53
      T55 = 1.0D+0*T49**((-1.0D+0)/6.0D+0)
      T56 = 5.982550435771079D+0*T55+2.2255694211506874D+0*T50+
     #8.004286349993636D-1*T54+1.8970043257475583D-1*T52
      T57 = 1.6081979498692536D+1/T56+1.0D+0
      T58 = LOG(T57)
      T59 = 1.0D+0/(2.0D+0*T10-2.0D+0)
      T60 = 9.0D+0*T10-9.0D+0
      T61 = RHOA-1.0D+0*RHOB
      T62 = T61**4
      T63 = 1.0D+0/T49**4
      T64 = 1.0D+0-1.0D+0*T62*T63
      T65 = 6.901399211255825D-2*T50+1.0D+0
      T66 = 1.0D+0/T49
      T67 = 1.0D+0-1.0D+0*T61*T66
      T68 = T61*T66+1.0D+0
      T69 = T68**(4.0D+0/3.0D+0)+T67**(4.0D+0/3.0D+0)-2.0D+0
      T70 = 8.157414703487641D+0*T55+2.247591863577616D+0*T50+
     #4.3009724712766434D-1*T54+1.9115125951273373D-1*T52
      T71 = 2.9608749977793436D+1/T70+1.0D+0
      T72 = LOG(T71)
      T73 = 6.21814D-2*T51*T58
      T74 = 1.274696188700087D-1*T50+1.0D+0
      T75 = 1.1120374863094687D+1*T55+3.8447462374472113D+0*T50+
     #1.6447337755676092D+0*T54+2.4058712912881913D-1*T52
      T76 = 3.216395899738507D+1/T75+1.0D+0
      T77 = LOG(T76)
      T78 = T73-3.10907D-2*T74*T77
      T79 = 5.0D-1*T68**(2.0D+0/3.0D+0)+5.0D-1*T67**(2.0D+0/
     #3.0D+0)
      T80 = T79**3
      T81 = SIGMABB+SIGMAAA+2.0D+0*SIGMAAB
      T82 = 1.0D+0*T49**((-7.0D+0)/3.0D+0)
      T83 = T79**2
      T84 = 1.0D+0/T83
      T85 = 1.0D+0/T80
      T86 = -1.0D+0*T59*T62*T63*T69*T78+T73-
     #8.443449999999999D-3*T59*T60*T64*T65*T69*T72
      T87 = 2.718281828459045D+0**(9.869604401089358D+0*T12*T85*
     #T86)
      T88 = T87-1.0D+0
      T89 = 1.0D+0/T88
      T90 = 4.179666459885054D-2*T12*T81*T82*T84*T89
      T91 = T90+1.0D+0
      T92 = T81**2
      T93 = 1.0D+0*T49**((-1.3999999999999999D+1)/3.0D+0)
      T94 = 1.0D+0/T79**4
      T95 = 1.0D+0/T88**2
      T96 = 1.746961171588806D-3*T20*T92*T93*T94*T95+T90+1.0D+0
      T97 = 1.0D+0/T96
      T98 = 4.1796664598850536D-2*T12*T81*T82*T84*T91*T97+1.0D+0
      T99 = LOG(T98)
      T100 = 1.0132118364233778D-1*T9*T80*T99+T59*T62*T63*T69*
     #T78+8.443449999999999D-3*T59*T60*T64*T65*T69*T72-6.21814D-2*T51*
     #T58
      T101 = 1.25D-1*T29*SIGMABB+1.25D-1*T2*SIGMAAA
      T102 = T101**2
      T103 = TB+TA
      T104 = 1.0D+0/T103**2
      T105 = 5.3D-1*T102*T104+1.0D+0
      T106 = 1.0D+0/T6
      T107 = 1.0D+0*RHOA**((-4.0D+0)/3.0D+0)
      T108 = -1.8533958105157808D+0*RHOA**((-7.0D+0)/6.0D+0)-
     #1.6039141941921276D-1*RHOA**((-5.0D+0)/3.0D+0)-
     #8.223668877838046D-1/T3**3-1.2815820791490704D+0*T107
      T109 = 1.0D+0/T5**2
      T110 = 1.0D+0/T25
      T111 = 1.0D+0*RHOA**((-1.0D+1)/3.0D+0)
      T112 = -1.9505110146130256D-1*T11*T12*SIGMAAA*T111*T16
      T113 = -2.6076282286578434D-2*T12*T7*T107-
     #1.973920880217872D+1*T12*T106*T108*T8*T109
      T114 = -8.359332919770108D-2*T11*T12*SIGMAAA*T113*T13*T22*
     #T14
      T115 = 1.0D+0/T23**2
      T116 = 1.0D+0/RHOA**2
      T117 = 1.0D+0*T49**((-5.0D+0)/3.0D+0)
      T118 = 1.0D+0/T53**3
      T119 = 1.0D+0*T49**((-4.0D+0)/3.0D+0)
      T120 = 1.0D+0*T49**((-7.0D+0)/6.0D+0)
      T121 = -9.970917392951799D-1*T120-7.418564737168958D-1*
     #T119-4.002143174996818D-1*T118-1.264669550498372D-1*T117
      T122 = 1.0D+0/T56**2
      T123 = 1.0D+0/T57
      T124 = 1.0D+0*T121*T51*T122*T123
      T125 = -1.3595691172479402D+0*T120-7.491972878592053D-1*
     #T119-2.1504862356383217D-1*T118-1.2743417300848914D-1*T117
      T126 = 1.0D+0/T70**2
      T127 = 1.0D+0/T71
      T128 = -2.5D-1*T59*T60*T64*T125*T65*T126*T69*T127
      T129 = 2.747773264188437D-3*T119*T58
      T130 = 1.0D+0/T49**2
      T131 = T61*T130
      T132 = -1.0D+0*T66
      T133 = T132+T131
      T134 = T67**(1.0D+0/3.0D+0)
      T135 = -1.0D+0*T130*T61
      T136 = T66+T135
      T137 = T68**(1.0D+0/3.0D+0)
      T138 = 1.3333333333333333D+0*T136*T137+
     #1.3333333333333333D+0*T133*T134
      T139 = -1.942387305675933D-4*T59*T60*T119*T64*T69*T72
      T140 = 1.0D+0/T49**5
      T141 = 4.0D+0*T140*T62
      T142 = T61**3
      T143 = T141-4.0D+0*T142*T63
      T144 = -1.0D+0*T121*T51*T122*T123
      T145 = -2.747773264188437D-3*T119*T58
      T146 = 1.3210398931339262D-3*T119*T77+1.0D+0*
     #(-1.8533958105157808D+0*T120-1.2815820791490704D+0*T119-
     #8.223668877838046D-1*T118-1.6039141941921276D-1*T117)*T74/(T75**2*
     #T76)+T145+T144
      T147 = T59*T62*T63*T69*T146
      T148 = -4.0D+0*T140*T59*T62*T69*T78
      T149 = 4.0D+0*T142*T59*T63*T69*T78
      T150 = 1.0D+0/T98
      T151 = 1.0D+0/T134
      T152 = 1.0D+0/T137
      T153 = 3.333333333333333D-1*T136*T152+
     #3.333333333333333D-1*T133*T151
      T154 = 1.0D+0*T49**((-1.0D+1)/3.0D+0)
      T155 = -9.752555073065126D-2*T12*T81*T154*T84*T91*T97
      T156 = -8.359332919770108D-2*T12*T81*T82*T153*T85*T89
      T157 = -9.752555073065128D-2*T12*T81*T154*T84*T89
      T158 = 2.5D-1*T59*T60*T64*T125*T65*T126*T69*T127
      T159 = 1.942387305675933D-4*T59*T60*T119*T64*T69*T72
      T160 = -1.0D+0*T146*T59*T62*T63*T69
      T161 = 4.0D+0*T140*T59*T62*T69*T78
      T162 = -4.0D+0*T142*T59*T63*T69*T78
      T163 = 9.869604401089358D+0*T12*(-1.0D+0*T138*T59*T62*T63*
     #T78-8.443449999999999D-3*T59*T60*T143*T65*T69*T72-
     #8.443449999999999D-3*T59*T60*T64*T65*T138*T72+T162+T161+T160+T159+
     #T158+T145+T144)*T85-2.9608813203268075D+1*T12*T153*T94*T86
      T164 = -4.179666459885054D-2*T12*T81*T82*T84*T163*T95*T87
      T165 = 1.0D+0/T96**2
      T166 = 1.0D+0/T79**5
      T167 = -8.152485467414428D-3*T20*T49**
     #((-1.6999999999999998D+1)/3.0D+0)*T92*T94*T95
      T168 = 1.0D+0/T88**3
      T169 = T100*T105
      T170 = 1.0D+0/T33
      T171 = 1.0D+0*RHOB**((-4.0D+0)/3.0D+0)
      T172 = -1.8533958105157808D+0*RHOB**((-7.0D+0)/6.0D+0)-
     #1.6039141941921276D-1*RHOB**((-5.0D+0)/3.0D+0)-
     #8.223668877838046D-1/T30**3-1.2815820791490704D+0*T171
      T173 = 1.0D+0/T32**2
      T174 = 1.0D+0/T46
      T175 = 1.0D+0*RHOB**((-1.0D+1)/3.0D+0)
      T176 = -1.9505110146130256D-1*T11*T12*SIGMABB*T175*T39
      T177 = -2.6076282286578434D-2*T12*T34*T171-
     #1.973920880217872D+1*T12*T170*T172*T35*T173
      T178 = -8.359332919770108D-2*T11*T12*SIGMABB*T177*T36*T43*
     #T37
      T179 = 1.0D+0/T44**2
      T180 = 1.0D+0/RHOB**2
      T181 = T66+T131
      T182 = T132+T135
      T183 = 1.3333333333333333D+0*T137*T182+
     #1.3333333333333333D+0*T134*T181
      T184 = 4.0D+0*T142*T63+T141
      T185 = 3.333333333333333D-1*T152*T182+
     #3.333333333333333D-1*T151*T181
      T186 = -8.359332919770108D-2*T12*T81*T82*T185*T85*T89
      T187 = 9.869604401089358D+0*T12*(-1.0D+0*T183*T59*T62*T63*
     #T78-8.443449999999999D-3*T59*T60*T184*T65*T69*T72-
     #8.443449999999999D-3*T59*T60*T64*T65*T183*T72+T161+T160+T159+T158+
     #T149+T145+T144)*T85-2.9608813203268075D+1*T12*T185*T94*T86
      T188 = -4.179666459885054D-2*T12*T81*T82*T84*T187*T95*T87
      T189 = 1.0132118364233778D-1*T9*T49*T80*T150*
     #(1.746961171588806D-3*T20*T81*T93*T94*T97*T89+
     #4.1796664598850536D-2*T12*T82*T84*T91*T97-4.1796664598850536D-2*
     #T12*T81*T82*T84*(4.179666459885054D-2*T12*T82*T84*T89+
     #3.493922343177612D-3*T20*T81*T93*T94*T95)*T91*T165)*T105
      T190 = -1.0600000000000001D+0*T100*T102*T49/T103**3
      ZK(I) = T49*T100*T105-1.53D+0*(1.5625D-2*T28*T29*T47*T48+
     #1.5625D-2*T1*T2*T26*T27)
      VRHOA(I) = -1.53D+0*(1.5625D-2*T1*T2*T27*
     #(5.066059182116889D-2*T110*T9*(-8.359332919770107D-2*T11*T115*T12*
     #T13*T18*SIGMAAA*(-3.260994186965771D-2*T1*T19*T20*T22*RHOA**
     #((-1.6999999999999998D+1)/3.0D+0)-1.3975689372710445D-2*T1*T113*
     #T14*T19*T20*T21/T15**3+T114+T112)-1.950511014613025D-1*T11*T12*
     #SIGMAAA*T111*T18*T24+8.359332919770107D-2*T11*T12*SIGMAAA*T13*T24*
     #(T114+T112))+1.0D+0*T106*T108*T8*T109+1.3210398931339262D-3*T7*
     #T107)-1.5625D-2*T1*T116*T26*T27)+T169+T49*(3.039635509270133D-1*
     #T9*T153*T83*T99+1.0132118364233778D-1*T9*T80*T150*
     #(-4.1796664598850536D-2*T12*T81*T82*T84*T91*T165*(T164-
     #3.493922343177612D-3*T20*T92*T93*T94*T163*T168*T87+T157+T156+T167-
     #6.987844686355223D-3*T20*T92*T93*T153*T166*T95)+
     #4.1796664598850536D-2*T12*T81*T82*T84*T97*(T164+T157+T156)+T155-
     #8.359332919770107D-2*T12*T81*T82*T153*T85*T91*T97)+T149+T148+T59*
     #T62*T63*T138*T78+T147+8.443449999999999D-3*T59*T60*T143*T65*T69*
     #T72+T139+8.443449999999999D-3*T59*T60*T64*T65*T138*T72+T129+T128+
     #T124)*T105-1.325D-1*SIGMAAA*T116*T101*T49*T100*T104
      VRHOB(I) = -1.53D+0*(1.5625D-2*T28*T29*T48*
     #(5.066059182116889D-2*T174*T9*(-8.359332919770107D-2*T11*T12*T179*
     #T36*T41*SIGMABB*(-3.260994186965771D-2*T19*T20*T28*T43*RHOB**
     #((-1.6999999999999998D+1)/3.0D+0)-1.3975689372710445D-2*T177*T19*
     #T20*T28*T37*T42/T38**3+T178+T176)-1.950511014613025D-1*T11*T12*
     #SIGMABB*T175*T41*T45+8.359332919770107D-2*T11*T12*SIGMABB*T36*T45*
     #(T178+T176))+1.0D+0*T170*T172*T35*T173+1.3210398931339262D-3*T34*
     #T171)-1.5625D-2*T180*T28*T47*T48)+T169+T49*(3.039635509270133D-1*
     #T9*T185*T83*T99+1.0132118364233778D-1*T9*T80*T150*
     #(-4.1796664598850536D-2*T12*T81*T82*T84*T91*T165*(T188-
     #3.493922343177612D-3*T20*T92*T93*T94*T187*T168*T87+T157+T186+T167-
     #6.987844686355223D-3*T20*T92*T93*T185*T166*T95)+
     #4.1796664598850536D-2*T12*T81*T82*T84*T97*(T188+T157+T186)+T155-
     #8.359332919770107D-2*T12*T81*T82*T185*T85*T91*T97)+T162+T148+T59*
     #T62*T63*T183*T78+T147+8.443449999999999D-3*T59*T60*T184*T65*T69*
     #T72+T139+8.443449999999999D-3*T59*T60*T64*T65*T183*T72+T129+T128+
     #T124)*T105-1.325D-1*SIGMABB*T101*T180*T49*T100*T104
      VSIGMAAA(I) = -1.53D+0*(3.125D-2*T2*T26*T27*SIGMAAA+
     #7.915717472057638D-4*T9*T1*T2*T110*(6.987844686355223D-3*T19*T20*
     #SIGMAAA*T21*T24*T16+8.359332919770107D-2*T11*T12*T13*T18*T24-
     #8.359332919770107D-2*T11*T12*SIGMAAA*T13*(8.359332919770108D-2*
     #T11*T12*T13*T16+1.3975689372710445D-2*T19*T20*SIGMAAA*T21*T22)*
     #T18*T115)*T27)+T189+1.325D-1*T2*T101*T49*T100*T104
      VSIGMAAB(I) = 1.0132118364233778D-1*T9*T49*T80*T150*
     #(3.493922343177612D-3*T20*T81*T93*T94*T97*T89+
     #8.359332919770107D-2*T12*T82*T84*T91*T97-4.1796664598850536D-2*
     #T12*T81*T82*T84*(8.359332919770108D-2*T12*T82*T84*T89+
     #6.987844686355223D-3*T20*T81*T93*T94*T95)*T91*T165)*T105
      VSIGMABB(I) = -1.53D+0*(3.125D-2*T29*T47*T48*SIGMABB+
     #7.915717472057638D-4*T9*T28*T29*T174*(6.987844686355223D-3*T19*
     #T20*SIGMABB*T42*T45*T39+8.359332919770107D-2*T11*T12*T36*T41*T45-
     #8.359332919770107D-2*T11*T12*SIGMABB*T36*(8.359332919770108D-2*
     #T11*T12*T36*T39+1.3975689372710445D-2*T19*T20*SIGMABB*T42*T43)*
     #T41*T179)*T48)+T189+1.325D-1*T101*T29*T49*T100*T104
      VTA(I) = 4.7812499999999997D-2*T1*T2*T26/TA**3+T190
      VTB(I) = 4.7812499999999997D-2*T28*T29*T47/TB**3+T190
C
      ENDIF ! RHOA,RHOB
      ELSE ! RHO
      ZK(I) = 0.0D0
      VRHOA(I) = 0.0D0
      VRHOB(I) = 0.0D0
      VSIGMAAA(I) = 0.0D0
      VSIGMAAB(I) = 0.0D0
      VSIGMABB(I) = 0.0D0
      VTA(I) = 0.0D0
      VTB(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ENDIF ! IDERIV
      RETURN
      END
C*MODULE DFTXCE  *DECK RKS_X_PBES
      SUBROUTINE RKS_X_PBES(IDERIV,NPT,RHOA1,SIGMAAA1,ZK,VRHOA,VSIGMAAA)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      INTEGER IDERIV,NPT
      DOUBLE PRECISION RHOA1(NPT),SIGMAAA1(NPT)
      DOUBLE PRECISION ZK(NPT),VRHOA(NPT),VSIGMAAA(NPT)
      PARAMETER(TOL=1.0D-20)
C
      IF(IDERIV.EQ.0) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHO = 2.D+00*RHOA
      IF(RHO.GT.TOL) THEN
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
C
      ZK(I) = -7.385587663820223D-1*(1.804D+0-8.04D-1/
     #(4.0109902624583255D-3*SIGMAAA*RHOA**((-8.0D+0)/3.0D+0)+1.0D+0))*
     #RHOA**(4.0D+0/3.0D+0)
C
      ELSE ! RHO
      ZK(I) = 0.0D0
      VRHOA(I) = 0.0D0
      VSIGMAAA(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ELSE IF(IDERIV.EQ.1) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHO = 2.D+00*RHOA
      IF(RHO.GT.TOL) THEN
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
C
      T1 = 4.0109902624583255D-3*SIGMAAA*RHOA**((-8.0D+0)/
     #3.0D+0)+1.0D+0
      T2 = 1.804D+0-8.04D-1/T1
      T3 = RHOA**(4.0D+0/3.0D+0)
      T4 = 1.0D+0/T1**2
      ZK(I) = -7.385587663820223D-1*T2*T3
      VRHOA(I) = 6.351282731333509D-3*T4*SIGMAAA*RHOA**
     #((-7.0D+0)/3.0D+0)-9.847450218426964D-1*T2*RHOA**(1.0D+0/3.0D+0)
      VSIGMAAA(I) = -9.526924097000264D-3*T4/T3
C
      ELSE ! RHO
      ZK(I) = 0.0D0
      VRHOA(I) = 0.0D0
      VSIGMAAA(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ENDIF
      RETURN
      END
C*MODULE DFTXCE  *DECK UKS_X_PBES
      SUBROUTINE UKS_X_PBES(IDERIV,NPT,RHOA1,RHOB1,SIGMAAA1,SIGMABB1,
     *                      ZK,VRHOA,VRHOB,VSIGMAAA,VSIGMAAB,VSIGMABB)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      INTEGER NPT
      DOUBLE PRECISION RHOA1(NPT),RHOB1(NPT)
      DOUBLE PRECISION SIGMAAA1(NPT),SIGMABB1(NPT)
      DOUBLE PRECISION ZK(NPT),VRHOA(NPT),VRHOB(NPT)
      DOUBLE PRECISION VSIGMAAA(NPT),VSIGMAAB(NPT),VSIGMABB(NPT)
      PARAMETER(TOL=1.0D-20)
C
      IF (IDERIV.EQ.0) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHOB = MAX(0.D0,RHOB1(I))
      RHO = RHOA+RHOB
      IF(RHO.GT.TOL) THEN
      IF(RHOA.LT.TOL) THEN
      SIGMABB = MAX(0.D0,SIGMABB1(I))
C
      T1 = 6.299605249474366D-1
      ZK(I) = -1.4771175327640446D+0*T1*(1.804D+0-8.04D-1/
     #(4.0109902624583255D-3*T1*SIGMABB*RHOB**((-8.0D+0)/3.0D+0)+
     #1.0D+0))*RHOB**(4.0D+0/3.0D+0)
C
      ELSEIF(RHOB.LT.TOL) THEN
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
C
      T1 = 6.299605249474366D-1
      ZK(I) = -1.4771175327640446D+0*T1*(1.804D+0-8.04D-1/
     #(4.0109902624583255D-3*T1*SIGMAAA*RHOA**((-8.0D+0)/3.0D+0)+
     #1.0D+0))*RHOA**(4.0D+0/3.0D+0)
C
      ELSE ! (.NOT.(RHOA.LT.TOL).AND..NOT.(RHOB.LT.TOL))
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
      SIGMABB = MAX(0.D0,SIGMABB1(I))
C
      T1 = 1.2599210498948732D+0
      T2 = 6.299605249474366D-1
      ZK(I) = 5.0D-1*(-1.4771175327640446D+0*T1*(1.804D+0-
     #8.04D-1/(4.0109902624583255D-3*T2*SIGMABB*RHOB**((-8.0D+0)/
     #3.0D+0)+1.0D+0))*RHOB**(4.0D+0/3.0D+0)-1.4771175327640446D+0*T1*
     #(1.804D+0-8.04D-1/(4.0109902624583255D-3*T2*SIGMAAA*RHOA**
     #((-8.0D+0)/3.0D+0)+1.0D+0))*RHOA**(4.0D+0/3.0D+0))
C
      ENDIF ! RHOA,RHOB
      ELSE ! RHO
      ZK(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ELSE IF(IDERIV.EQ.1) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHOB = MAX(0.D0,RHOB1(I))
      RHO = RHOA+RHOB
      IF(RHO.GT.TOL) THEN
      IF(RHOA.LT.TOL) THEN
      SIGMABB = MAX(0.D0,SIGMABB1(I))
C
      T1 = 6.299605249474366D-1
      T2 = 4.0109902624583255D-3*T1*SIGMABB*RHOB**((-8.0D+0)/
     #3.0D+0)+1.0D+0
      T3 = 1.804D+0-8.04D-1/T2
      T4 = RHOB**(4.0D+0/3.0D+0)
      T5 = 7.937005259840997D-1
      T6 = 1.0D+0/T2**2
      ZK(I) = -1.4771175327640446D+0*T1*T3*T4
      VRHOA(I) = 0.0D+0
      VRHOB(I) = 6.351282731333509D-3*T5*T6*SIGMABB*RHOB**
     #((-7.0D+0)/3.0D+0)-1.969490043685393D+0*T1*T3*RHOB**(1.0D+0/
     #3.0D+0)
      VSIGMAAA(I) = 0.0D+0
      VSIGMAAB(I) = 0.0D+0
      VSIGMABB(I) = -2.381731024250066D-3*T5*T6/T4
C
      ELSEIF(RHOB.LT.TOL) THEN
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
C
      T1 = 6.299605249474366D-1
      T2 = 4.0109902624583255D-3*T1*SIGMAAA*RHOA**((-8.0D+0)/
     #3.0D+0)+1.0D+0
      T3 = 1.804D+0-8.04D-1/T2
      T4 = RHOA**(4.0D+0/3.0D+0)
      T5 = 7.937005259840997D-1
      T6 = 1.0D+0/T2**2
      ZK(I) = -1.4771175327640446D+0*T1*T3*T4
      VRHOA(I) = 6.351282731333509D-3*T5*T6*SIGMAAA*RHOA**
     #((-7.0D+0)/3.0D+0)-1.969490043685393D+0*T1*T3*RHOA**(1.0D+0/
     #3.0D+0)
      VRHOB(I) = 0.0D+0
      VSIGMAAA(I) = -2.381731024250066D-3*T5*T6/T4
      VSIGMAAB(I) = 0.0D+0
      VSIGMABB(I) = 0.0D+0
C
      ELSE ! (.NOT.(RHOA.LT.TOL).AND..NOT.(RHOB.LT.TOL))
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
      SIGMABB = MAX(0.D0,SIGMABB1(I))
C
      T1 = 1.2599210498948732D+0
      T2 = 6.299605249474366D-1
      T3 = 4.0109902624583255D-3*T2*SIGMAAA*RHOA**((-8.0D+0)/
     #3.0D+0)+1.0D+0
      T4 = 1.804D+0-8.04D-1/T3
      T5 = RHOA**(4.0D+0/3.0D+0)
      T6 = 4.0109902624583255D-3*T2*SIGMABB*RHOB**((-8.0D+0)/
     #3.0D+0)+1.0D+0
      T7 = 1.804D+0-8.04D-1/T6
      T8 = RHOB**(4.0D+0/3.0D+0)
      T9 = 1.0D+0/T1
      T10 = 1.0D+0/T3**2
      T11 = 1.0D+0/T6**2
      ZK(I) = 5.0D-1*(-1.4771175327640446D+0*T1*T7*T8-
     #1.4771175327640446D+0*T1*T4*T5)
      VRHOA(I) = 5.0D-1*(1.2702565462667018D-2*T10*T9*SIGMAAA*
     #RHOA**((-7.0D+0)/3.0D+0)-1.969490043685393D+0*T1*T4*RHOA**(1.0D+0/
     #3.0D+0))
      VRHOB(I) = 5.0D-1*(1.2702565462667018D-2*T11*T9*SIGMABB*
     #RHOB**((-7.0D+0)/3.0D+0)-1.969490043685393D+0*T1*T7*RHOB**(1.0D+0/
     #3.0D+0))
      VSIGMAAA(I) = -2.381731024250066D-3*T10*T9/T5
      VSIGMAAB(I) = 0.0D+0
      VSIGMABB(I) = -2.381731024250066D-3*T11*T9/T8
C
      ENDIF ! RHOA,RHOB
      ELSE ! RHO
      ZK(I) = 0.0D0
      VRHOA(I) = 0.0D0
      VRHOB(I) = 0.0D0
      VSIGMAAA(I) = 0.0D0
      VSIGMAAB(I) = 0.0D0
      VSIGMABB(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ENDIF ! IDERIV
      RETURN
      END
C*MODULE DFTXCE  *DECK RKS_C_PBES
      SUBROUTINE RKS_C_PBES(IDERIV,NPT,RHOA1,SIGMAAA1,ZK,VRHOA,VSIGMAAA)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      INTEGER IDERIV,NPT
      DOUBLE PRECISION RHOA1(NPT),SIGMAAA1(NPT)
      DOUBLE PRECISION ZK(NPT),VRHOA(NPT),VSIGMAAA(NPT)
      PARAMETER(TOL=1.0D-20)
C
      IF(IDERIV.EQ.0) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHO = 2.D+00*RHOA
      IF(RHO.GT.TOL) THEN
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
C
      T1 = 1.0D+0*RHOA**((-1.0D+0)/3.0D+0)
      T2 = LOG(1.6081979498692536D+1/(5.982550435771079D+0*RHOA**
     #((-1.0D+0)/6.0D+0)+8.004286349993636D-1/SQRT(RHOA)+
     #1.8970043257475583D-1*RHOA**((-2.0D+0)/3.0D+0)+
     #2.2255694211506874D+0*T1)+1.0D+0)
      T3 = 1.3256889990520176D-1*T1+1.0D+0
      T4 = 3.068528194400547D-1
      T5 = 1.0D+0/T4
      T6 = 1.0D+0*RHOA**((-7.0D+0)/3.0D+0)
      T7 = 2.718281828459045D+0**(6.137058191058978D-1*T5*T2*
     #T3)-1.0D+0
      T8 = 2.8814679966632567D-2*T5*T6*SIGMAAA/T7
      ZK(I) = (1.0132118364233778D-1*T4*
     #LOG(2.8814679966632567D-2*T5*T6*(T8+1.0D+0)*SIGMAAA/
     #(8.302857815794561D-4*SIGMAAA**2*RHOA**((-1.3999999999999999D+1)/
     #3.0D+0)/(T4**2*T7**2)+T8+1.0D+0)+1.0D+0)-6.21814D-2*T2*T3)*RHOA
C
      ELSE ! RHO
      ZK(I) = 0.0D0
      VRHOA(I) = 0.0D0
      VSIGMAAA(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ELSE IF(IDERIV.EQ.1) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHO = 2.D+00*RHOA
      IF(RHO.GT.TOL) THEN
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
C
      T1 = SQRT(RHOA)
      T2 = 1.0D+0*RHOA**((-1.0D+0)/3.0D+0)
      T3 = 5.982550435771079D+0*RHOA**((-1.0D+0)/6.0D+0)+
     #1.8970043257475583D-1*RHOA**((-2.0D+0)/3.0D+0)+
     #2.2255694211506874D+0*T2+8.004286349993636D-1/T1
      T4 = 1.6081979498692536D+1/T3+1.0D+0
      T5 = LOG(T4)
      T6 = 1.3256889990520176D-1*T2+1.0D+0
      T7 = -6.21814D-2*T5*T6
      T8 = 3.068528194400547D-1
      T9 = 1.0D+0/T8
      T10 = 1.0D+0*RHOA**((-7.0D+0)/3.0D+0)
      T11 = 2.718281828459045D+0**(6.137058191058978D-1*T9*T5*
     #T6)
      T12 = T11-1.0D+0
      T13 = 1.0D+0/T12
      T14 = 2.8814679966632567D-2*T9*SIGMAAA*T10*T13
      T15 = T14+1.0D+0
      T16 = 1.0D+0/T8**2
      T17 = SIGMAAA**2
      T18 = 1.0D+0*RHOA**((-1.3999999999999999D+1)/3.0D+0)
      T19 = 1.0D+0/T12**2
      T20 = 8.302857815794561D-4*T16*T17*T18*T19+T14+1.0D+0
      T21 = 1.0D+0/T20
      T22 = 2.8814679966632567D-2*T9*SIGMAAA*T10*T15*T21+1.0D+0
      T23 = 1.0132118364233778D-1*T8*LOG(T22)
      T24 = 1.0D+0/T4
      T25 = 1.0D+0*RHOA**((-4.0D+0)/3.0D+0)
      T26 = -9.970917392951799D-1*RHOA**((-7.0D+0)/6.0D+0)-
     #1.264669550498372D-1*RHOA**((-5.0D+0)/3.0D+0)-
     #7.418564737168958D-1*T25-4.002143174996818D-1/T1**3
      T27 = 1.0D+0/T3**2
      T28 = 1.0D+0/T22
      T29 = 1.0D+0*RHOA**((-1.0D+1)/3.0D+0)
      T30 = -6.7234253255476D-2*T9*SIGMAAA*T29*T13
      T31 = -2.7119435101429873D-2*T9*T5*T25-
     #9.86960440108936D+0*T9*T24*T26*T6*T27
      T32 = -2.8814679966632567D-2*T9*SIGMAAA*T31*T10*T19*T11
      T33 = 1.0D+0/T20**2
      ZK(I) = RHOA*(T23+T7)
      VRHOA(I) = (1.0132118364233778D-1*T28*T8*
     #(-2.8814679966632567D-2*T10*T15*T33*T9*SIGMAAA*
     #(-3.874666980704129D-3*T16*T17*T19*RHOA**
     #((-1.6999999999999998D+1)/3.0D+0)+T32-1.6605715631589124D-3*T11*
     #T16*T17*T18*T31/T12**3+T30)+2.8814679966632567D-2*T9*SIGMAAA*T10*
     #T21*(T32+T30)-6.7234253255476D-2*T9*SIGMAAA*T29*T15*T21)+1.0D+0*
     #T24*T26*T6*T27+2.747773264188437D-3*T5*T25)*RHOA+T7+T23
      VSIGMAAA(I) = 4.052847345693511D-1*T8*RHOA*T28*
     #(8.302857815794562D-4*T16*SIGMAAA*T18*T21*T13+
     #2.8814679966632567D-2*T9*T10*T15*T21-2.8814679966632567D-2*T9*
     #SIGMAAA*T10*(2.8814679966632567D-2*T9*T10*T13+
     #1.6605715631589124D-3*T16*SIGMAAA*T18*T19)*T15*T33)
C
      ELSE ! RHO
      ZK(I) = 0.0D0
      VRHOA(I) = 0.0D0
      VSIGMAAA(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ENDIF
      RETURN
      END
C*MODULE DFTXCE  *DECK UKS_C_PBES
      SUBROUTINE UKS_C_PBES(IDERIV,NPT,RHOA1,RHOB1,SIGMAAA1,
     *                      SIGMAAB1,SIGMABB1,ZK,VRHOA,VRHOB,
     *                      VSIGMAAA,VSIGMAAB,VSIGMABB)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      INTEGER NPT
      DOUBLE PRECISION RHOA1(NPT),RHOB1(NPT)
      DOUBLE PRECISION SIGMAAA1(NPT),SIGMABB1(NPT),SIGMAAB1(NPT)
      DOUBLE PRECISION ZK(NPT),VRHOA(NPT),VRHOB(NPT)
      DOUBLE PRECISION VSIGMAAA(NPT),VSIGMAAB(NPT),VSIGMABB(NPT)
      PARAMETER(TOL=1.0D-20)
C
      IF (IDERIV.EQ.0) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHOB = MAX(0.D0,RHOB1(I))
      RHO = RHOA+RHOB
      IF(RHO.GT.TOL) THEN
      IF(RHOA.LT.TOL) THEN
      SIGMABB = MAX(0.D0,SIGMABB1(I))
C
      T1 = 1.0D+0*RHOB**((-1.0D+0)/3.0D+0)
      T2 = LOG(3.216395899738507D+1/(1.1120374863094687D+1*RHOB**
     #((-1.0D+0)/6.0D+0)+1.6447337755676092D+0/SQRT(RHOB)+
     #2.4058712912881913D-1*RHOB**((-2.0D+0)/3.0D+0)+
     #3.8447462374472113D+0*T1)+1.0D+0)
      T3 = 1.274696188700087D-1*T1+1.0D+0
      T4 = 3.068528194400547D-1
      T5 = 7.937005259840997D-1
      T6 = 1.0D+0/T4
      T7 = 1.0D+0*RHOB**((-7.0D+0)/3.0D+0)
      T8 = 2.718281828459045D+0**(6.137058191058978D-1*T6*T2*
     #T3)-1.0D+0
      T9 = 5.762935993326513D-2*T5*T6*T7*SIGMABB/T8
      ZK(I) = (5.066059182116889D-2*T4*LOG(5.762935993326513D-2*
     #T5*T6*T7*(T9+1.0D+0)*SIGMABB/(2.0921890672807472D-3*SIGMABB**2*
     #RHOB**((-1.3999999999999999D+1)/3.0D+0)/(T4**2*T8**2)+T9+1.0D+0)+
     #1.0D+0)-3.10907D-2*T2*T3)*RHOB
C
      ELSEIF(RHOB.LT.TOL) THEN
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
C
      T1 = 1.0D+0*RHOA**((-1.0D+0)/3.0D+0)
      T2 = LOG(3.216395899738507D+1/(1.1120374863094687D+1*RHOA**
     #((-1.0D+0)/6.0D+0)+1.6447337755676092D+0/SQRT(RHOA)+
     #2.4058712912881913D-1*RHOA**((-2.0D+0)/3.0D+0)+
     #3.8447462374472113D+0*T1)+1.0D+0)
      T3 = 1.274696188700087D-1*T1+1.0D+0
      T4 = 3.068528194400547D-1
      T5 = 7.937005259840997D-1
      T6 = 1.0D+0/T4
      T7 = 1.0D+0*RHOA**((-7.0D+0)/3.0D+0)
      T8 = 2.718281828459045D+0**(6.137058191058978D-1*T6*T2*
     #T3)-1.0D+0
      T9 = 5.762935993326513D-2*T5*T6*T7*SIGMAAA/T8
      ZK(I) = (5.066059182116889D-2*T4*LOG(5.762935993326513D-2*
     #T5*T6*T7*(T9+1.0D+0)*SIGMAAA/(2.0921890672807472D-3*SIGMAAA**2*
     #RHOA**((-1.3999999999999999D+1)/3.0D+0)/(T4**2*T8**2)+T9+1.0D+0)+
     #1.0D+0)-3.10907D-2*T2*T3)*RHOA
C
      ELSE ! (.NOT.(RHOA.LT.TOL).AND..NOT.(RHOB.LT.TOL))
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
      SIGMAAB = SIGMAAB1(I)
      SIGMABB = MAX(0.D0,SIGMABB1(I))
C
      T1 = RHOB+RHOA
      T2 = 1.0D+0*T1**((-1.0D+0)/3.0D+0)
      T3 = 1.3256889990520176D-1*T2+1.0D+0
      T4 = 1.0D+0*T1**((-2.0D+0)/3.0D+0)
      T5 = 1.0D+0/SQRT(T1)
      T6 = 1.0D+0*T1**((-1.0D+0)/6.0D+0)
      T7 = LOG(1.6081979498692536D+1/(5.982550435771079D+0*T6+
     #2.2255694211506874D+0*T2+8.004286349993636D-1*T5+
     #1.8970043257475583D-1*T4)+1.0D+0)
      T8 = 1.2599210498948732D+0
      T9 = 1.0D+0/(2.0D+0*T8-2.0D+0)
      T10 = 9.0D+0*T8-9.0D+0
      T11 = RHOA-1.0D+0*RHOB
      T12 = T11**4
      T13 = 1.0D+0/T1**4
      T14 = 1.0D+0-1.0D+0*T12*T13
      T15 = 6.901399211255825D-2*T2+1.0D+0
      T16 = 1.0D+0/T1
      T17 = 1.0D+0-1.0D+0*T11*T16
      T18 = T11*T16+1.0D+0
      T19 = T18**(4.0D+0/3.0D+0)+T17**(4.0D+0/3.0D+0)-2.0D+0
      T20 = LOG(2.9608749977793436D+1/(8.157414703487641D+0*T6+
     #2.247591863577616D+0*T2+4.3009724712766434D-1*T5+
     #1.9115125951273373D-1*T4)+1.0D+0)
      T21 = 6.21814D-2*T3*T7
      T22 = T21-3.10907D-2*(1.274696188700087D-1*T2+1.0D+0)*
     #LOG(3.216395899738507D+1/(1.1120374863094687D+1*T6+
     #3.8447462374472113D+0*T2+1.6447337755676092D+0*T5+
     #2.4058712912881913D-1*T4)+1.0D+0)
      T23 = 3.068528194400547D-1
      T24 = 5.0D-1*T18**(2.0D+0/3.0D+0)+5.0D-1*T17**(2.0D+0/
     #3.0D+0)
      T25 = T24**3
      T26 = 1.0D+0/T23
      T27 = SIGMABB+SIGMAAA+2.0D+0*SIGMAAB
      T28 = 1.0D+0*T1**((-7.0D+0)/3.0D+0)
      T29 = 1.0D+0/T24**2
      T30 = 2.718281828459045D+0**(9.869604401089358D+0*T26*
     #(-T9*T12*T13*T19*T22-8.443449999999999D-3*T9*T10*T14*T15*T19*T20+
     #T21)/T25)-1.0D+0
      T31 = 2.8814679966632567D-2*T26*T27*T28*T29/T30
      ZK(I) = T1*(-6.21814D-2*T3*T7+1.0132118364233778D-1*T23*
     #T25*LOG(2.8814679966632567D-2*T26*T27*T28*T29*(T31+1.0D+0)/(T31+
     #8.302857815794561D-4*T1**((-1.3999999999999999D+1)/3.0D+0)*T27**2/
     #(T23**2*T24**4*T30**2)+1.0D+0)+1.0D+0)+T9*T12*T13*T19*T22+
     #8.443449999999999D-3*T9*T10*T14*T15*T19*T20)
C
      ENDIF ! RHOA,RHOB
      ELSE ! RHO
      ZK(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ELSE IF(IDERIV.EQ.1) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHOB = MAX(0.D0,RHOB1(I))
      RHO = RHOA+RHOB
      IF(RHO.GT.TOL) THEN
      IF(RHOA.LT.TOL) THEN
      SIGMABB = MAX(0.D0,SIGMABB1(I))
C
      T1 = SQRT(RHOB)
      T2 = 1.0D+0*RHOB**((-1.0D+0)/3.0D+0)
      T3 = 1.1120374863094687D+1*RHOB**((-1.0D+0)/6.0D+0)+
     #2.4058712912881913D-1*RHOB**((-2.0D+0)/3.0D+0)+
     #3.8447462374472113D+0*T2+1.6447337755676092D+0/T1
      T4 = 3.216395899738507D+1/T3+1.0D+0
      T5 = LOG(T4)
      T6 = 1.274696188700087D-1*T2+1.0D+0
      T7 = -3.10907D-2*T5*T6
      T8 = 3.068528194400547D-1
      T9 = 7.937005259840997D-1
      T10 = 1.0D+0/T8
      T11 = 1.0D+0*RHOB**((-7.0D+0)/3.0D+0)
      T12 = 2.718281828459045D+0**(6.137058191058978D-1*T10*T5*
     #T6)
      T13 = T12-1.0D+0
      T14 = 1.0D+0/T13
      T15 = 5.762935993326513D-2*T9*T10*SIGMABB*T11*T14
      T16 = T15+1.0D+0
      T17 = 6.299605249474366D-1
      T18 = 1.0D+0/T8**2
      T19 = SIGMABB**2
      T20 = 1.0D+0*RHOB**((-1.3999999999999999D+1)/3.0D+0)
      T21 = 1.0D+0/T13**2
      T22 = 3.321143126317825D-3*T17*T18*T19*T20*T21+T15+1.0D+0
      T23 = 1.0D+0/T22
      T24 = 5.762935993326513D-2*T9*T10*SIGMABB*T11*T16*T23+
     #1.0D+0
      T25 = 5.066059182116889D-2*T8*LOG(T24)
      T26 = 1.0D+0/T4
      T27 = 1.0D+0*RHOB**((-4.0D+0)/3.0D+0)
      T28 = -1.8533958105157808D+0*RHOB**((-7.0D+0)/6.0D+0)-
     #1.6039141941921276D-1*RHOB**((-5.0D+0)/3.0D+0)-
     #1.2815820791490704D+0*T27-8.223668877838046D-1/T1**3
      T29 = 1.0D+0/T3**2
      T30 = 1.0D+0/T24
      T31 = 1.0D+0*RHOB**((-1.0D+1)/3.0D+0)
      T32 = -1.34468506510952D-1*T9*T10*SIGMABB*T31*T14
      T33 = -2.6076282286578434D-2*T10*T5*T27-
     #1.973920880217872D+1*T10*T26*T28*T6*T29
      T34 = -5.762935993326513D-2*T9*T10*SIGMABB*T33*T11*T21*T12
      T35 = 1.0D+0/T22**2
      ZK(I) = RHOB*(T25+T7)
      VRHOA(I) = 0.0D+0
      VRHOB(I) = (5.066059182116889D-2*T30*T8*
     #(-5.762935993326513D-2*T10*T11*T16*T35*T9*SIGMABB*
     #(-1.5498667922816517D-2*T17*T18*T19*T21*RHOB**
     #((-1.6999999999999998D+1)/3.0D+0)+T34-6.64228625263565D-3*T12*T17*
     #T18*T19*T20*T33/T13**3+T32)+5.762935993326513D-2*T9*T10*SIGMABB*
     #T11*T23*(T34+T32)-1.34468506510952D-1*T9*T10*SIGMABB*T31*T16*T23)+
     #1.0D+0*T26*T28*T6*T29+1.3210398931339262D-3*T5*T27)*RHOB+T7+T25
      VSIGMAAA(I) = 0.0D+0
      VSIGMAAB(I) = 0.0D+0
      VSIGMABB(I) = 5.066059182116889D-2*T8*RHOB*T30*
     #(3.321143126317825D-3*T17*T18*SIGMABB*T20*T23*T14+
     #5.762935993326513D-2*T9*T10*T11*T16*T23-5.762935993326513D-2*T9*
     #T10*SIGMABB*T11*(5.762935993326513D-2*T9*T10*T11*T14+
     #6.64228625263565D-3*T17*T18*SIGMABB*T20*T21)*T16*T35)
C
      ELSEIF(RHOB.LT.TOL) THEN
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
C
      T1 = SQRT(RHOA)
      T2 = 1.0D+0*RHOA**((-1.0D+0)/3.0D+0)
      T3 = 1.1120374863094687D+1*RHOA**((-1.0D+0)/6.0D+0)+
     #2.4058712912881913D-1*RHOA**((-2.0D+0)/3.0D+0)+
     #3.8447462374472113D+0*T2+1.6447337755676092D+0/T1
      T4 = 3.216395899738507D+1/T3+1.0D+0
      T5 = LOG(T4)
      T6 = 1.274696188700087D-1*T2+1.0D+0
      T7 = -3.10907D-2*T5*T6
      T8 = 3.068528194400547D-1
      T9 = 7.937005259840997D-1
      T10 = 1.0D+0/T8
      T11 = 1.0D+0*RHOA**((-7.0D+0)/3.0D+0)
      T12 = 2.718281828459045D+0**(6.137058191058978D-1*T10*T5*
     #T6)
      T13 = T12-1.0D+0
      T14 = 1.0D+0/T13
      T15 = 5.762935993326513D-2*T9*T10*SIGMAAA*T11*T14
      T16 = T15+1.0D+0
      T17 = 6.299605249474366D-1
      T18 = 1.0D+0/T8**2
      T19 = SIGMAAA**2
      T20 = 1.0D+0*RHOA**((-1.3999999999999999D+1)/3.0D+0)
      T21 = 1.0D+0/T13**2
      T22 = 3.321143126317825D-3*T17*T18*T19*T20*T21+T15+1.0D+0
      T23 = 1.0D+0/T22
      T24 = 5.762935993326513D-2*T9*T10*SIGMAAA*T11*T16*T23+
     #1.0D+0
      T25 = 5.066059182116889D-2*T8*LOG(T24)
      T26 = 1.0D+0/T4
      T27 = 1.0D+0*RHOA**((-4.0D+0)/3.0D+0)
      T28 = -1.8533958105157808D+0*RHOA**((-7.0D+0)/6.0D+0)-
     #1.6039141941921276D-1*RHOA**((-5.0D+0)/3.0D+0)-
     #1.2815820791490704D+0*T27-8.223668877838046D-1/T1**3
      T29 = 1.0D+0/T3**2
      T30 = 1.0D+0/T24
      T31 = 1.0D+0*RHOA**((-1.0D+1)/3.0D+0)
      T32 = -1.34468506510952D-1*T9*T10*SIGMAAA*T31*T14
      T33 = -2.6076282286578434D-2*T10*T5*T27-
     #1.973920880217872D+1*T10*T26*T28*T6*T29
      T34 = -5.762935993326513D-2*T9*T10*SIGMAAA*T33*T11*T21*T12
      T35 = 1.0D+0/T22**2
      ZK(I) = RHOA*(T25+T7)
      VRHOA(I) = (5.066059182116889D-2*T30*T8*
     #(-5.762935993326513D-2*T10*T11*T16*T35*T9*SIGMAAA*
     #(-1.5498667922816517D-2*T17*T18*T19*T21*RHOA**
     #((-1.6999999999999998D+1)/3.0D+0)+T34-6.64228625263565D-3*T12*T17*
     #T18*T19*T20*T33/T13**3+T32)+5.762935993326513D-2*T9*T10*SIGMAAA*
     #T11*T23*(T34+T32)-1.34468506510952D-1*T9*T10*SIGMAAA*T31*T16*T23)+
     #1.0D+0*T26*T28*T6*T29+1.3210398931339262D-3*T5*T27)*RHOA+T7+T25
      VRHOB(I) = 0.0D+0
      VSIGMAAA(I) = 5.066059182116889D-2*T8*RHOA*T30*
     #(3.321143126317825D-3*T17*T18*SIGMAAA*T20*T23*T14+
     #5.762935993326513D-2*T9*T10*T11*T16*T23-5.762935993326513D-2*T9*
     #T10*SIGMAAA*T11*(5.762935993326513D-2*T9*T10*T11*T14+
     #6.64228625263565D-3*T17*T18*SIGMAAA*T20*T21)*T16*T35)
      VSIGMAAB(I) = 0.0D+0
      VSIGMABB(I) = 0.0D+0
C
      ELSE ! (.NOT.(RHOA.LT.TOL).AND..NOT.(RHOB.LT.TOL))
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
      SIGMAAB = SIGMAAB1(I)
      SIGMABB = MAX(0.D0,SIGMABB1(I))
C
      T1 = RHOB+RHOA
      T2 = 1.0D+0*T1**((-1.0D+0)/3.0D+0)
      T3 = 1.3256889990520176D-1*T2+1.0D+0
      T4 = 1.0D+0*T1**((-2.0D+0)/3.0D+0)
      T5 = SQRT(T1)
      T6 = 1.0D+0/T5
      T7 = 1.0D+0*T1**((-1.0D+0)/6.0D+0)
      T8 = 5.982550435771079D+0*T7+2.2255694211506874D+0*T2+
     #8.004286349993636D-1*T6+1.8970043257475583D-1*T4
      T9 = 1.6081979498692536D+1/T8+1.0D+0
      T10 = LOG(T9)
      T11 = -6.21814D-2*T3*T10
      T12 = 1.2599210498948732D+0
      T13 = 1.0D+0/(2.0D+0*T12-2.0D+0)
      T14 = 9.0D+0*T12-9.0D+0
      T15 = RHOA-1.0D+0*RHOB
      T16 = T15**4
      T17 = 1.0D+0/T1**4
      T18 = 1.0D+0-1.0D+0*T16*T17
      T19 = 6.901399211255825D-2*T2+1.0D+0
      T20 = 1.0D+0/T1
      T21 = 1.0D+0-1.0D+0*T15*T20
      T22 = T15*T20+1.0D+0
      T23 = T22**(4.0D+0/3.0D+0)+T21**(4.0D+0/3.0D+0)-2.0D+0
      T24 = 8.157414703487641D+0*T7+2.247591863577616D+0*T2+
     #4.3009724712766434D-1*T6+1.9115125951273373D-1*T4
      T25 = 2.9608749977793436D+1/T24+1.0D+0
      T26 = LOG(T25)
      T27 = 8.443449999999999D-3*T13*T14*T18*T19*T23*T26
      T28 = 6.21814D-2*T3*T10
      T29 = 1.274696188700087D-1*T2+1.0D+0
      T30 = 1.1120374863094687D+1*T7+3.8447462374472113D+0*T2+
     #1.6447337755676092D+0*T6+2.4058712912881913D-1*T4
      T31 = 3.216395899738507D+1/T30+1.0D+0
      T32 = LOG(T31)
      T33 = T28-3.10907D-2*T29*T32
      T34 = T13*T16*T17*T23*T33
      T35 = 3.068528194400547D-1
      T36 = 5.0D-1*T22**(2.0D+0/3.0D+0)+5.0D-1*T21**(2.0D+0/
     #3.0D+0)
      T37 = T36**3
      T38 = 1.0D+0/T35
      T39 = SIGMABB+SIGMAAA+2.0D+0*SIGMAAB
      T40 = 1.0D+0*T1**((-7.0D+0)/3.0D+0)
      T41 = T36**2
      T42 = 1.0D+0/T41
      T43 = 1.0D+0/T37
      T44 = -1.0D+0*T13*T16*T17*T23*T33+T28-
     #8.443449999999999D-3*T13*T14*T18*T19*T23*T26
      T45 = 2.718281828459045D+0**(9.869604401089358D+0*T38*T43*
     #T44)
      T46 = T45-1.0D+0
      T47 = 1.0D+0/T46
      T48 = 2.8814679966632567D-2*T38*T39*T40*T42*T47
      T49 = T48+1.0D+0
      T50 = 1.0D+0/T35**2
      T51 = T39**2
      T52 = 1.0D+0*T1**((-1.3999999999999999D+1)/3.0D+0)
      T53 = 1.0D+0/T36**4
      T54 = 1.0D+0/T46**2
      T55 = 8.302857815794561D-4*T50*T51*T52*T53*T54+T48+1.0D+0
      T56 = 1.0D+0/T55
      T57 = 2.8814679966632567D-2*T38*T39*T40*T42*T49*T56+1.0D+0
      T58 = LOG(T57)
      T59 = 1.0132118364233778D-1*T35*T37*T58
      T60 = 1.0D+0*T1**((-5.0D+0)/3.0D+0)
      T61 = 1.0D+0/T5**3
      T62 = 1.0D+0*T1**((-4.0D+0)/3.0D+0)
      T63 = 1.0D+0*T1**((-7.0D+0)/6.0D+0)
      T64 = -9.970917392951799D-1*T63-7.418564737168958D-1*T62-
     #4.002143174996818D-1*T61-1.264669550498372D-1*T60
      T65 = 1.0D+0/T8**2
      T66 = 1.0D+0/T9
      T67 = 1.0D+0*T64*T3*T65*T66
      T68 = -1.3595691172479402D+0*T63-7.491972878592053D-1*T62-
     #2.1504862356383217D-1*T61-1.2743417300848914D-1*T60
      T69 = 1.0D+0/T24**2
      T70 = 1.0D+0/T25
      T71 = -2.5D-1*T13*T14*T18*T68*T19*T69*T23*T70
      T72 = 2.747773264188437D-3*T62*T10
      T73 = 1.0D+0/T1**2
      T74 = T15*T73
      T75 = -1.0D+0*T20
      T76 = T75+T74
      T77 = T21**(1.0D+0/3.0D+0)
      T78 = -1.0D+0*T15*T73
      T79 = T20+T78
      T80 = T22**(1.0D+0/3.0D+0)
      T81 = 1.3333333333333333D+0*T79*T80+1.3333333333333333D+0*
     #T76*T77
      T82 = -1.942387305675933D-4*T13*T14*T62*T18*T23*T26
      T83 = 1.0D+0/T1**5
      T84 = 4.0D+0*T16*T83
      T85 = T15**3
      T86 = T84-4.0D+0*T17*T85
      T87 = -1.0D+0*T64*T3*T65*T66
      T88 = -2.747773264188437D-3*T62*T10
      T89 = T88+T87+1.0D+0*T29*(-1.8533958105157808D+0*T63-
     #1.2815820791490704D+0*T62-8.223668877838046D-1*T61-
     #1.6039141941921276D-1*T60)/(T30**2*T31)+1.3210398931339262D-3*T62*
     #T32
      T90 = T13*T16*T17*T23*T89
      T91 = -4.0D+0*T13*T16*T23*T33*T83
      T92 = 4.0D+0*T13*T17*T23*T33*T85
      T93 = 1.0D+0/T57
      T94 = 1.0D+0/T77
      T95 = 1.0D+0/T80
      T96 = 3.333333333333333D-1*T79*T95+3.333333333333333D-1*
     #T76*T94
      T97 = 1.0D+0*T1**((-1.0D+1)/3.0D+0)
      T98 = -6.7234253255476D-2*T38*T39*T97*T42*T49*T56
      T99 = -5.762935993326513D-2*T38*T39*T40*T96*T43*T47
      T100 = -6.7234253255476D-2*T38*T39*T97*T42*T47
      T101 = 2.5D-1*T13*T14*T18*T68*T19*T69*T23*T70
      T102 = 1.942387305675933D-4*T13*T14*T62*T18*T23*T26
      T103 = -1.0D+0*T13*T16*T17*T23*T89
      T104 = 4.0D+0*T13*T16*T23*T33*T83
      T105 = -4.0D+0*T13*T17*T23*T33*T85
      T106 = 9.869604401089358D+0*T38*T43*(T88+T87-1.0D+0*T13*
     #T16*T17*T33*T81-8.443449999999999D-3*T13*T14*T18*T19*T81*T26-
     #8.443449999999999D-3*T13*T14*T86*T19*T23*T26+T105+T104+T103+T102+
     #T101)-2.9608813203268075D+1*T38*T96*T53*T44
      T107 = -2.8814679966632567D-2*T38*T39*T40*T42*T106*T54*T45
      T108 = 1.0D+0/T55**2
      T109 = 1.0D+0/T36**5
      T110 = -3.874666980704129D-3*T1**
     #((-1.6999999999999998D+1)/3.0D+0)*T50*T51*T53*T54
      T111 = 1.0D+0/T46**3
      T112 = T20+T74
      T113 = T75+T78
      T114 = 1.3333333333333333D+0*T113*T80+
     #1.3333333333333333D+0*T112*T77
      T115 = 4.0D+0*T17*T85+T84
      T116 = 3.333333333333333D-1*T113*T95+3.333333333333333D-1*
     #T112*T94
      T117 = -5.762935993326513D-2*T38*T39*T40*T116*T43*T47
      T118 = 9.869604401089358D+0*T38*T43*(T92+T88+T87-1.0D+0*
     #T114*T13*T16*T17*T33-8.443449999999999D-3*T13*T14*T115*T19*T23*
     #T26-8.443449999999999D-3*T13*T14*T18*T19*T114*T26+T104+T103+T102+
     #T101)-2.9608813203268075D+1*T38*T116*T53*T44
      T119 = -2.8814679966632567D-2*T38*T39*T40*T42*T118*T54*T45
      T120 = 1.0132118364233778D-1*T35*T1*T37*T93*
     #(8.302857815794562D-4*T50*T39*T52*T53*T56*T47+
     #2.8814679966632567D-2*T38*T40*T42*T49*T56-2.8814679966632567D-2*
     #T38*T39*T40*T42*(2.8814679966632567D-2*T38*T40*T42*T47+
     #1.6605715631589124D-3*T50*T39*T52*T53*T54)*T49*T108)
      ZK(I) = T1*(T59+T34+T27+T11)
      VRHOA(I) = T1*(3.039635509270133D-1*T35*T96*T41*T58+
     #1.0132118364233778D-1*T35*T37*T93*(-2.8814679966632567D-2*T38*T39*
     #T40*T42*T49*T108*(T107-1.6605715631589124D-3*T50*T51*T52*T53*T106*
     #T111*T45+T100+T99+T110-3.321143126317825D-3*T50*T51*T52*T96*T109*
     #T54)+2.8814679966632567D-2*T38*T39*T40*T42*T56*(T107+T100+T99)+
     #T98-5.762935993326513D-2*T38*T39*T40*T96*T43*T49*T56)+T92+T91+T13*
     #T16*T17*T81*T33+T90+8.443449999999999D-3*T13*T14*T86*T19*T23*T26+
     #T82+8.443449999999999D-3*T13*T14*T18*T19*T81*T26+T72+T71+T67)+T59+
     #T34+T27+T11
      VRHOB(I) = T1*(3.039635509270133D-1*T35*T116*T41*T58+
     #1.0132118364233778D-1*T35*T37*T93*(-2.8814679966632567D-2*T38*T39*
     #T40*T42*T49*T108*(T119-1.6605715631589124D-3*T50*T51*T52*T53*T118*
     #T111*T45+T100+T117+T110-3.321143126317825D-3*T50*T51*T52*T116*
     #T109*T54)+2.8814679966632567D-2*T38*T39*T40*T42*T56*(T119+T100+
     #T117)+T98-5.762935993326513D-2*T38*T39*T40*T116*T43*T49*T56)+T105+
     #T91+T13*T16*T17*T114*T33+T90+8.443449999999999D-3*T13*T14*T115*
     #T19*T23*T26+T82+8.443449999999999D-3*T13*T14*T18*T19*T114*T26+T72+
     #T71+T67)+T59+T34+T27+T11
      VSIGMAAA(I) = T120
      VSIGMAAB(I) = 1.0132118364233778D-1*T35*T1*T37*T93*
     #(1.6605715631589124D-3*T50*T39*T52*T53*T56*T47+
     #5.762935993326513D-2*T38*T40*T42*T49*T56-2.8814679966632567D-2*
     #T38*T39*T40*T42*(5.762935993326513D-2*T38*T40*T42*T47+
     #3.321143126317825D-3*T50*T39*T52*T53*T54)*T49*T108)
      VSIGMABB(I) = T120
C
      ENDIF ! RHOA,RHOB
      ELSE ! RHO
      ZK(I) = 0.0D0
      VRHOA(I) = 0.0D0
      VRHOB(I) = 0.0D0
      VSIGMAAA(I) = 0.0D0
      VSIGMAAB(I) = 0.0D0
      VSIGMABB(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ENDIF ! IDERIV
      RETURN
      END
C*MODULE DFTXCE  *DECK RKS_X_RPBE
      SUBROUTINE RKS_X_RPBE(IDERIV,NPT,RHOA1,SIGMAAA1,ZK,VRHOA,VSIGMAAA)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      INTEGER IDERIV,NPT
      DOUBLE PRECISION RHOA1(NPT),SIGMAAA1(NPT)
      DOUBLE PRECISION ZK(NPT),VRHOA(NPT),VSIGMAAA(NPT)
      PARAMETER(TOL=1.0D-20)
C
      IF(IDERIV.EQ.0) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHO = 2.D+00*RHOA
      IF(RHO.GT.TOL) THEN
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
C
      ZK(I) = -7.385587663820223D-1*RHOA**(4.0D+0/3.0D+0)*
     #(8.04D-1*(1.0D+0-1.0D+0/2.718281828459045D+0**
     #(7.131826587600489D-3*SIGMAAA*RHOA**((-8.0D+0)/3.0D+0)))+
     #1.0D+0)
C
      ELSE ! RHO
      ZK(I) = 0.0D0
      VRHOA(I) = 0.0D0
      VSIGMAAA(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ELSE IF(IDERIV.EQ.1) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHO = 2.D+00*RHOA
      IF(RHO.GT.TOL) THEN
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
C
      T1 = RHOA**(4.0D+0/3.0D+0)
      T2 = 1.0D+0/2.718281828459045D+0**(7.131826587600489D-3*
     #SIGMAAA/RHOA**(8.0D+0/3.0D+0))
      T3 = 8.04D-1*(1.0D+0-1.0D+0*T2)+1.0D+0
      ZK(I) = -7.385587663820223D-1*T1*T3
      VRHOA(I) = 1.1293033411886227D-2*T2*SIGMAAA*RHOA**
     #((-7.0D+0)/3.0D+0)-9.847450218426964D-1*RHOA**(1.0D+0/3.0D+0)*T3
      VSIGMAAA(I) = -1.6939550117829344D-2*T2/T1
C
      ELSE ! RHO
      ZK(I) = 0.0D0
      VRHOA(I) = 0.0D0
      VSIGMAAA(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ENDIF
      RETURN
      END
C*MODULE DFTXCE  *DECK UKS_X_RPBE
      SUBROUTINE UKS_X_RPBE(IDERIV,NPT,RHOA1,RHOB1,SIGMAAA1,SIGMABB1,
     *                      ZK,VRHOA,VRHOB,VSIGMAAA,VSIGMAAB,VSIGMABB)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      INTEGER NPT
      DOUBLE PRECISION RHOA1(NPT),RHOB1(NPT)
      DOUBLE PRECISION SIGMAAA1(NPT),SIGMABB1(NPT)
      DOUBLE PRECISION ZK(NPT),VRHOA(NPT),VRHOB(NPT)
      DOUBLE PRECISION VSIGMAAA(NPT),VSIGMAAB(NPT),VSIGMABB(NPT)
      PARAMETER(TOL=1.0D-20)
C
      IF (IDERIV.EQ.0) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHOB = MAX(0.D0,RHOB1(I))
      RHO = RHOA+RHOB
      IF(RHO.GT.TOL) THEN
      IF(RHOA.LT.TOL) THEN
      SIGMABB = MAX(0.D0,SIGMABB1(I))
C
      T1 = 6.299605249474366D-1
      ZK(I) = -1.4771175327640446D+0*T1*RHOB**(4.0D+0/3.0D+0)*
     #(8.04D-1*(1.0D+0-1.0D+0/2.718281828459045D+0**
     #(7.131826587600489D-3*T1*SIGMABB/RHOB**(8.0D+0/3.0D+0)))+1.0D+0)
C
      ELSEIF(RHOB.LT.TOL) THEN
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
C
      T1 = 6.299605249474366D-1
      ZK(I) = -1.4771175327640446D+0*T1*RHOA**(4.0D+0/3.0D+0)*
     #(8.04D-1*(1.0D+0-1.0D+0/2.718281828459045D+0**
     #(7.131826587600489D-3*T1*SIGMAAA/RHOA**(8.0D+0/3.0D+0)))+1.0D+0)
C
      ELSE ! (.NOT.(RHOA.LT.TOL).AND..NOT.(RHOB.LT.TOL))
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
      SIGMABB = MAX(0.D0,SIGMABB1(I))
C
      T1 = 1.2599210498948732D+0
      T2 = 6.299605249474366D-1
      ZK(I) = 5.0D-1*(-1.4771175327640446D+0*T1*RHOB**(4.0D+0/
     #3.0D+0)*(8.04D-1*(1.0D+0-1.0D+0/2.718281828459045D+0**
     #(7.131826587600489D-3*T2*SIGMABB/RHOB**(8.0D+0/3.0D+0)))+1.0D+0)-
     #1.4771175327640446D+0*T1*RHOA**(4.0D+0/3.0D+0)*(8.04D-1*(1.0D+0-
     #1.0D+0/2.718281828459045D+0**(7.131826587600489D-3*T2*SIGMAAA/
     #RHOA**(8.0D+0/3.0D+0)))+1.0D+0))
C
      ENDIF ! RHOA,RHOB
      ELSE ! RHO
      ZK(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ELSE IF(IDERIV.EQ.1) THEN
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHOB = MAX(0.D0,RHOB1(I))
      RHO = RHOA+RHOB
      IF(RHO.GT.TOL) THEN
      IF(RHOA.LT.TOL) THEN
      SIGMABB = MAX(0.D0,SIGMABB1(I))
C
      T1 = 6.299605249474366D-1
      T2 = RHOB**(4.0D+0/3.0D+0)
      T3 = 1.0D+0/2.718281828459045D+0**(7.131826587600489D-3*
     #T1*SIGMABB/RHOB**(8.0D+0/3.0D+0))
      T4 = 8.04D-1*(1.0D+0-1.0D+0*T3)+1.0D+0
      T5 = 7.937005259840997D-1
      ZK(I) = -1.4771175327640446D+0*T1*T2*T4
      VRHOA(I) = 0.0D+0
      VRHOB(I) = 1.1293033411886227D-2*T3*T5*SIGMABB*RHOB**
     #((-7.0D+0)/3.0D+0)-1.969490043685393D+0*T1*RHOB**(1.0D+0/3.0D+0)/
     #T4
      VSIGMAAA(I) = 0.0D+0
      VSIGMAAB(I) = 0.0D0
      VSIGMABB(I) = -4.234887529457336D-3*T3*T5/T2
C
      ELSEIF(RHOB.LT.TOL) THEN
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
C
      T1 = 6.299605249474366D-1
      T2 = RHOA**(4.0D+0/3.0D+0)
      T3 = 1.0D+0/2.718281828459045D+0**(7.131826587600489D-3*
     #T1*SIGMAAA/RHOA**(8.0D+0/3.0D+0))
      T4 = 8.04D-1*(1.0D+0-1.0D+0*T3)+1.0D+0
      T5 = 7.937005259840997D-1
      ZK(I) = -1.4771175327640446D+0*T1*T2*T4
      VRHOA(I) = 1.1293033411886227D-2*T3*T5*SIGMAAA*RHOA**
     #((-7.0D+0)/3.0D+0)-1.969490043685393D+0*T1*RHOA**(1.0D+0/3.0D+0)*
     #T4
      VRHOB(I) = 0.0D+0
      VSIGMAAA(I) = -4.234887529457336D-3*T3*T5/T2
      VSIGMAAB(I) = 0.0D0
      VSIGMABB(I) = 0.0D+0
C
      ELSE ! (.NOT.(RHOA.LT.TOL).AND..NOT.(RHOB.LT.TOL))
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
      SIGMABB = MAX(0.D0,SIGMABB1(I))
C
      T1 = 1.2599210498948732D+0
      T2 = RHOA**(4.0D+0/3.0D+0)
      T3 = 6.299605249474366D-1
      T4 = 1.0D+0/2.718281828459045D+0**(7.131826587600489D-3*
     #T3*SIGMAAA/RHOA**(8.0D+0/3.0D+0))
      T5 = 8.04D-1*(1.0D+0-1.0D+0*T4)+1.0D+0
      T6 = RHOB**(4.0D+0/3.0D+0)
      T7 = 1.0D+0/2.718281828459045D+0**(7.131826587600489D-3*
     #T3*SIGMABB/RHOB**(8.0D+0/3.0D+0))
      T8 = 8.04D-1*(1.0D+0-1.0D+0*T7)+1.0D+0
      T9 = 1.0D+0/T1
      ZK(I) = 5.0D-1*(-1.4771175327640446D+0*T1*T6*T8-
     #1.4771175327640446D+0*T1*T2*T5)
      VRHOA(I) = 5.0D-1*(2.2586066823772455D-2*T4*T9*SIGMAAA*
     #RHOA**((-7.0D+0)/3.0D+0)-1.969490043685393D+0*T1*RHOA**(1.0D+0/
     #3.0D+0)*T5)
      VRHOB(I) = 5.0D-1*(2.2586066823772455D-2*T7*T9*SIGMABB*
     #RHOB**((-7.0D+0)/3.0D+0)-1.969490043685393D+0*T1*RHOB**(1.0D+0/
     #3.0D+0)*T8)
      VSIGMAAA(I) = -4.234887529457336D-3*T4*T9/T2
      VSIGMAAB(I) = 0.0D0
      VSIGMABB(I) = -4.234887529457336D-3*T7*T9/T6
C
      ENDIF ! RHOA,RHOB
      ELSE ! RHO
      ZK(I) = 0.0D0
      VRHOA(I) = 0.0D0
      VRHOB(I) = 0.0D0
      VSIGMAAA(I) = 0.0D0
      VSIGMAAB(I) = 0.0D0
      VSIGMABB(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      ENDIF ! IDERIV
      RETURN
      END
C*MODULE DFTXCE  *DECK RKS_X_PBE2
      SUBROUTINE RKS_X_PBE2(NPT,RHOA1,SIGMAAA1,ZK,VRHOA,VSIGMAAA)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      INTEGER NPT
      DOUBLE PRECISION RHOA1(NPT),SIGMAAA1(NPT)
      DOUBLE PRECISION ZK(NPT),VRHOA(NPT),VSIGMAAA(NPT)
      PARAMETER(TOL=1.0D-20)
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHO = 2.D+00*RHOA
      IF(RHO.GT.TOL) THEN
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
C
      T1 = 7.131826587600489D-3*SIGMAAA*RHOA**((-8.0D+0)/
     #3.0D+0)+1.0D+0
      T2 = 1.804D+0-8.04D-1/T1
      T3 = RHOA**(4.0D+0/3.0D+0)
      T4 = 1.0D+0/T1**2
      ZK(I) = -7.385587663820223D-1*T2*T3
      VRHOA(I) = 1.1293033411886227D-2*T4*SIGMAAA*RHOA**
     #((-7.0D+0)/3.0D+0)-9.847450218426964D-1*T2*RHOA
     #**(1.0D+0/3.0D+0)
      VSIGMAAA(I) = -1.6939550117829344D-2*T4/T3
C
      ELSE ! RHO
      ZK(I) = 0.0D0
      VRHOA(I) = 0.0D0
      VSIGMAAA(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      RETURN
      END
C*MODULE DFTXCE  *DECK UKS_X_PBE2
      SUBROUTINE UKS_X_PBE2(NPT,RHOA1,RHOB1,SIGMAAA1,SIGMABB1,
     *                      ZK,VRHOA,VRHOB,VSIGMAAA,VSIGMAAB,VSIGMABB)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      INTEGER NPT
      DOUBLE PRECISION RHOA1(NPT),RHOB1(NPT)
      DOUBLE PRECISION SIGMAAA1(NPT),SIGMABB1(NPT)
      DOUBLE PRECISION ZK(NPT),VRHOA(NPT),VRHOB(NPT)
      DOUBLE PRECISION VSIGMAAA(NPT),VSIGMAAB(NPT),VSIGMABB(NPT)
      PARAMETER(TOL=1.0D-20)
C
      DO I=1,NPT
      RHOA = MAX(TOL,RHOA1(I))
      RHOB = MAX(TOL,RHOB1(I))
      RHO = RHOA+RHOB
      IF(RHO.GT.TOL) THEN
C
C         CASE WHERE ALPHA IS SMALL (AND BETA ISN'T SMALL)
C
      IF(RHOA.LT.TOL) THEN
      SIGMABB = MAX(TOL,SIGMABB1(I))
C
      T1 = 6.299605249474366D-1
      T2 = 4.0109902624583255D-3*T1*SIGMABB*RHOB**((-8.0D+0)/
     #3.0D+0)+1.0D+0
      T3 = 1.804D+0-8.04D-1/T2
      T4 = RHOB**(4.0D+0/3.0D+0)
      T5 = 7.937005259840997D-1
      T6 = 1.0D+0/T2**2
      ZK(I) = -1.4771175327640446D+0*T1*T3*T4
      VRHOA(I) = 0.0D+0
      VRHOB(I) = 6.351282731333509D-3*T5*T6*SIGMABB*RHOB**
     #((-7.0D+0)/3.0D+0)-1.969490043685393D+0*T1*T3*RHOB**(1.0D+0/
     #3.0D+0)
      VSIGMAAA(I) = 0.0D+0
      VSIGMAAB(I) = 0.0D+0
      VSIGMABB(I) = -2.381731024250066D-3*T5*T6/T4
C
C         CASE WHERE BETA IS SMALL (AND ALPHA ISN'T SMALL)
C
      ELSEIF(RHOB.LT.TOL) THEN
      SIGMAAA = MAX(TOL,SIGMAAA1(I))
C
      T1 = 6.299605249474366D-1
      T2 = 4.0109902624583255D-3*T1*SIGMAAA*RHOA**((-8.0D+0)/
     #3.0D+0)+1.0D+0
      T3 = 1.804D+0-8.04D-1/T2
      T4 = RHOA**(4.0D+0/3.0D+0)
      T5 = 7.937005259840997D-1
      T6 = 1.0D+0/T2**2
      ZK(I) = -1.4771175327640446D+0*T1*T3*T4
      VRHOA(I) = 6.351282731333509D-3*T5*T6*SIGMAAA*RHOA**
     #((-7.0D+0)/3.0D+0)-1.969490043685393D+0*T1*T3*RHOA**(1.0D+0/
     #3.0D+0)
      VRHOB(I) = 0.0D+0
      VSIGMAAA(I) = -2.381731024250066D-3*T5*T6/T4
      VSIGMAAB(I) = 0.0D+0
      VSIGMABB(I) = 0.0D+0
C
C         STANDARD CASE, ALPHA AND BETA ARE BOTH NON-VANISHING
C
      ELSE ! (.NOT.(RHOA.LT.TOL).AND..NOT.(RHOB.LT.TOL))
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
      SIGMABB = MAX(0.D0,SIGMABB1(I))
C
      T1 = 1.2599210498948732D+0
      T2 = 6.299605249474366D-1
      T3 = 7.131826587600489D-3*T2*SIGMAAA*RHOA**((-8.0D+0)/
     #3.0D+0)+1.0D+0
      T4 = 1.804D+0-8.04D-1/T3
      T5 = RHOA**(4.0D+0/3.0D+0)
      T6 = 7.131826587600489D-3*T2*SIGMABB*RHOB**((-8.0D+0)/
     #3.0D+0)+1.0D+0
      T7 = 1.804D+0-8.04D-1/T6
      T8 = RHOB**(4.0D+0/3.0D+0)
      T9 = 1.0D+0/T1
      T10 = 1.0D+0/T3**2
      T11 = 1.0D+0/T6**2
      ZK(I) = 5.0D-1*(-1.4771175327640446D+0*T1*T7*T8-
     #1.4771175327640446D+0*T1*T4*T5)
      VRHOA(I) = 5.0D-1*(2.2586066823772455D-2*T10*T9*SIGMAAA*
     #RHOA**((-7.0D+0)/3.0D+0)-1.969490043685393D+0*T1*T4*RHOA**(1.0D+0/
     #3.0D+0))
      VRHOB(I) = 5.0D-1*(2.2586066823772455D-2*T11*T9*SIGMABB*
     #RHOB**((-7.0D+0)/3.0D+0)-1.969490043685393D+0*T1*T7*RHOB**(1.0D+0/
     #3.0D+0))
      VSIGMAAA(I) = -4.234887529457336D-3*T10*T9/T5
      VSIGMABB(I) = -4.234887529457336D-3*T11*T9/T8
      VSIGMAAB(I) = 0.0D+0
C
      ENDIF
C
C        CASE WHERE BOTH ALPHA AND BETA ARE SMALL
C
      ELSE ! RHO
         ZK(I) = 0.0D0
         VRHOA(I) = 0.0D0
         VRHOB(I) = 0.0D0
         VSIGMAAA(I) = 0.0D0
         VSIGMAAB(I) = 0.0D0
         VSIGMABB(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      RETURN
      END
C*MODULE DFTXCE  *DECK RKS_C_PBE2
      SUBROUTINE RKS_C_PBE2(NPT,RHOA1,SIGMAAA1,ZK,VRHOA,VSIGMAAA)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      INTEGER NPT
      DOUBLE PRECISION RHOA1(NPT),SIGMAAA1(NPT)
      DOUBLE PRECISION ZK(NPT),VRHOA(NPT),VSIGMAAA(NPT)
      PARAMETER(TOL=1.0D-20)
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHO = 2.D+00*RHOA
      IF(RHO.GT.TOL) THEN
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
C
      T1 = SQRT(RHOA)
      T2 = 1.0D+0*RHOA**((-1.0D+0)/3.0D+0)
      T3 = 5.982550435771079D+0*RHOA**((-1.0D+0)/6.0D+0)+
     #1.8970043257475583D-1*RHOA**((-2.0D+0)/3.0D+0)+
     #2.2255694211506874D+0*T2+8.004286349993636D-1/T1
      T4 = 1.6081979498692536D+1/T3+1.0D+0
      T5 = LOG(T4)
      T6 = 1.3256889990520176D-1*T2+1.0D+0
      T7 = -6.21814D-2*T5*T6
      T8 = 3.068528194400547D-1
      T9 = 1.0D+0/T8
      T10 = 1.0D+0*RHOA**((-7.0D+0)/3.0D+0)
      T11 = 2.718281828459045D+0**(6.137058191058978D-1*T9*T5*
     #T6)
      T12 = T11-1.0D+0
      T13 = 1.0D+0/T12
      T14 = 4.179666459885054D-2*T9*SIGMAAA*T10*T13
      T15 = T14+1.0D+0
      T16 = 1.0D+0/T8**2
      T17 = SIGMAAA**2
      T18 = 1.0D+0*RHOA**((-1.3999999999999999D+1)/3.0D+0)
      T19 = 1.0D+0/T12**2
      T20 = 1.746961171588806D-3*T16*T17*T18*T19+T14+1.0D+0
      T21 = 1.0D+0/T20
      T22 = 4.1796664598850536D-2*T9*SIGMAAA*T10*T15*T21+1.0D+0
      T23 = 1.0132118364233778D-1*T8*LOG(T22)
      T24 = 1.0D+0/T4
      T25 = 1.0D+0*RHOA**((-4.0D+0)/3.0D+0)
      T26 = -9.970917392951799D-1*RHOA**((-7.0D+0)/6.0D+0)-
     #1.264669550498372D-1*RHOA**((-5.0D+0)/3.0D+0)-
     #7.418564737168958D-1*T25-4.002143174996818D-1/T1**3
      T27 = 1.0D+0/T3**2
      T28 = 1.0D+0/T22
      T29 = 1.0D+0*RHOA**((-1.0D+1)/3.0D+0)
      T30 = -9.752555073065128D-2*T9*SIGMAAA*T29*T13
      T31 = -2.7119435101429873D-2*T9*T5*T25-
     #9.86960440108936D+0*T9*T24*T26*T6*T27
      T32 = -4.179666459885054D-2*T9*SIGMAAA*T31*T10*T19*T11
      T33 = 1.0D+0/T20**2
      ZK(I) = RHOA*(T23+T7)
      VRHOA(I) = (1.0132118364233778D-1*T28*T8*
     #(-4.1796664598850536D-2*T10*T15*T33*T9*SIGMAAA*
     #(-8.152485467414428D-3*T16*T17*T19*RHOA**
     #((-1.6999999999999998D+1)/3.0D+0)+T32-3.493922343177612D-3*T11*
     #T16*T17*T18*T31/T12**3+T30)+4.1796664598850536D-2*T9*SIGMAAA*T10*
     #T21*(T32+T30)-9.752555073065126D-2*T9*SIGMAAA*T29*T15*T21)+1.0D+0*
     #T24*T26*T6*T27+2.747773264188437D-3*T5*T25)*RHOA+T7+T23
      VSIGMAAA(I) = 4.052847345693511D-1*T8*RHOA*T28*
     #(1.746961171588806D-3*T16*SIGMAAA*T18*T21*T13+
     #4.1796664598850536D-2*T9*T10*T15*T21-4.1796664598850536D-2*T9*
     #SIGMAAA*T10*(4.179666459885054D-2*T9*T10*T13+3.493922343177612D-3*
     #T16*SIGMAAA*T18*T19)*T15*T33)
C
      ELSE ! RHO
      ZK(I) = 0.0D0
      VRHOA(I) = 0.0D0
      VSIGMAAA(I) = 0.0D0
      ENDIF
      ENDDO
C
      RETURN
      END
C*MODULE DFTXCE  *DECK UKS_C_PBE2
      SUBROUTINE UKS_C_PBE2(NPT,RHOA1,RHOB1,SIGMAAA1,SIGMABB1,SIGMAAB1,
     *                      ZK,VRHOA,VRHOB,VSIGMAAA,VSIGMAAB,VSIGMABB)
C
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      INTEGER NPT
      DOUBLE PRECISION RHOA1(NPT),RHOB1(NPT)
      DOUBLE PRECISION SIGMAAA1(NPT),SIGMABB1(NPT),SIGMAAB1(NPT)
      DOUBLE PRECISION ZK(NPT),VRHOA(NPT),VRHOB(NPT)
      DOUBLE PRECISION VSIGMAAA(NPT),VSIGMAAB(NPT),VSIGMABB(NPT)
      PARAMETER(TOL=1.0D-20)
C
      DO I=1,NPT
      RHOA = MAX(0.D0,RHOA1(I))
      RHOB = MAX(0.D0,RHOB1(I))
      RHO = RHOA+RHOB
      IF(RHO.GT.TOL) THEN
      IF(RHOA.LT.TOL) THEN
      SIGMABB = MAX(0.D0,SIGMABB1(I))
C
      T1 = SQRT(RHOB)
      T2 = 1.0D+0*RHOB**((-1.0D+0)/3.0D+0)
      T3 = 1.1120374863094687D+1*RHOB**((-1.0D+0)/6.0D+0)+
     #2.4058712912881913D-1*RHOB**((-2.0D+0)/3.0D+0)+
     #3.8447462374472113D+0*T2+1.6447337755676092D+0/T1
      T4 = 3.216395899738507D+1/T3+1.0D+0
      T5 = LOG(T4)
      T6 = 1.274696188700087D-1*T2+1.0D+0
      T7 = -3.10907D-2*T5*T6
      T8 = 3.068528194400547D-1
      T9 = 7.937005259840997D-1
      T10 = 1.0D+0/T8
      T11 = 1.0D+0*RHOB**((-7.0D+0)/3.0D+0)
      T12 = 2.718281828459045D+0**(6.137058191058978D-1*T10*T5*
     #T6)
      T13 = T12-1.0D+0
      T14 = 1.0D+0/T13
      T15 = 5.762935993326513D-2*T9*T10*SIGMABB*T11*T14
      T16 = T15+1.0D+0
      T17 = 6.299605249474366D-1
      T18 = 1.0D+0/T8**2
      T19 = SIGMABB**2
      T20 = 1.0D+0*RHOB**((-1.3999999999999999D+1)/3.0D+0)
      T21 = 1.0D+0/T13**2
      T22 = 3.321143126317825D-3*T17*T18*T19*T20*T21+T15+1.0D+0
      T23 = 1.0D+0/T22
      T24 = 5.762935993326513D-2*T9*T10*SIGMABB*T11*T16*T23+
     #1.0D+0
      T25 = 5.066059182116889D-2*T8*LOG(T24)
      T26 = 1.0D+0/T4
      T27 = 1.0D+0*RHOB**((-4.0D+0)/3.0D+0)
      T28 = -1.8533958105157808D+0*RHOB**((-7.0D+0)/6.0D+0)-
     #1.6039141941921276D-1*RHOB**((-5.0D+0)/3.0D+0)-
     #1.2815820791490704D+0*T27-8.223668877838046D-1/T1**3
      T29 = 1.0D+0/T3**2
      T30 = 1.0D+0/T24
      T31 = 1.0D+0*RHOB**((-1.0D+1)/3.0D+0)
      T32 = -1.34468506510952D-1*T9*T10*SIGMABB*T31*T14
      T33 = -2.6076282286578434D-2*T10*T5*T27-
     #1.973920880217872D+1*T10*T26*T28*T6*T29
      T34 = -5.762935993326513D-2*T9*T10*SIGMABB*T33*T11*T21*T12
      T35 = 1.0D+0/T22**2
      ZK(I) = RHOB*(T25+T7)
      VRHOA(I) = 0.0D+0
      VRHOB(I) = (5.066059182116889D-2*T30*T8*
     #(-5.762935993326513D-2*T10*T11*T16*T35*T9*SIGMABB*
     #(-1.5498667922816517D-2*T17*T18*T19*T21*RHOB**
     #((-1.6999999999999998D+1)/3.0D+0)+T34-6.64228625263565D-3*T12*T17*
     #T18*T19*T20*T33/T13**3+T32)+5.762935993326513D-2*T9*T10*SIGMABB*
     #T11*T23*(T34+T32)-1.34468506510952D-1*T9*T10*SIGMABB*T31*T16*T23)+
     #1.0D+0*T26*T28*T6*T29+1.3210398931339262D-3*T5*T27)*RHOB+T7+T25
      VSIGMAAA(I) = 0.0D+0
      VSIGMABB(I) = 0.0D+0
      VSIGMABB(I) = 5.066059182116889D-2*T8*RHOB*T30*
     #(3.321143126317825D-3*T17*T18*SIGMABB*T20*T23*T14+
     #5.762935993326513D-2*T9*T10*T11*T16*T23-5.762935993326513D-2*T9*
     #T10*SIGMABB*T11*(5.762935993326513D-2*T9*T10*T11*T14+
     #6.64228625263565D-3*T17*T18*SIGMABB*T20*T21)*T16*T35)
C
      ELSEIF(RHOB.LT.TOL) THEN
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
C
      T1 = SQRT(RHOA)
      T2 = 1.0D+0*RHOA**((-1.0D+0)/3.0D+0)
      T3 = 1.1120374863094687D+1*RHOA**((-1.0D+0)/6.0D+0)+
     #2.4058712912881913D-1*RHOA**((-2.0D+0)/3.0D+0)+
     #3.8447462374472113D+0*T2+1.6447337755676092D+0/T1
      T4 = 3.216395899738507D+1/T3+1.0D+0
      T5 = LOG(T4)
      T6 = 1.274696188700087D-1*T2+1.0D+0
      T7 = -3.10907D-2*T5*T6
      T8 = 3.068528194400547D-1
      T9 = 7.937005259840997D-1
      T10 = 1.0D+0/T8
      T11 = 1.0D+0*RHOA**((-7.0D+0)/3.0D+0)
      T12 = 2.718281828459045D+0**(6.137058191058978D-1*T10*T5*
     #T6)
      T13 = T12-1.0D+0
      T14 = 1.0D+0/T13
      T15 = 5.762935993326513D-2*T9*T10*SIGMAAA*T11*T14
      T16 = T15+1.0D+0
      T17 = 6.299605249474366D-1
      T18 = 1.0D+0/T8**2
      T19 = SIGMAAA**2
      T20 = 1.0D+0*RHOA**((-1.3999999999999999D+1)/3.0D+0)
      T21 = 1.0D+0/T13**2
      T22 = 3.321143126317825D-3*T17*T18*T19*T20*T21+T15+1.0D+0
      T23 = 1.0D+0/T22
      T24 = 5.762935993326513D-2*T9*T10*SIGMAAA*T11*T16*T23+
     #1.0D+0
      T25 = 5.066059182116889D-2*T8*LOG(T24)
      T26 = 1.0D+0/T4
      T27 = 1.0D+0*RHOA**((-4.0D+0)/3.0D+0)
      T28 = -1.8533958105157808D+0*RHOA**((-7.0D+0)/6.0D+0)-
     #1.6039141941921276D-1*RHOA**((-5.0D+0)/3.0D+0)-
     #1.2815820791490704D+0*T27-8.223668877838046D-1/T1**3
      T29 = 1.0D+0/T3**2
      T30 = 1.0D+0/T24
      T31 = 1.0D+0*RHOA**((-1.0D+1)/3.0D+0)
      T32 = -1.34468506510952D-1*T9*T10*SIGMAAA*T31*T14
      T33 = -2.6076282286578434D-2*T10*T5*T27-
     #1.973920880217872D+1*T10*T26*T28*T6*T29
      T34 = -5.762935993326513D-2*T9*T10*SIGMAAA*T33*T11*T21*T12
      T35 = 1.0D+0/T22**2
      ZK(I) = RHOA*(T25+T7)
      VRHOA(I) = (5.066059182116889D-2*T30*T8*
     #(-5.762935993326513D-2*T10*T11*T16*T35*T9*SIGMAAA*
     #(-1.5498667922816517D-2*T17*T18*T19*T21*RHOA**
     #((-1.6999999999999998D+1)/3.0D+0)+T34-6.64228625263565D-3*T12*T17*
     #T18*T19*T20*T33/T13**3+T32)+5.762935993326513D-2*T9*T10*SIGMAAA*
     #T11*T23*(T34+T32)-1.34468506510952D-1*T9*T10*SIGMAAA*T31*T16*T23)+
     #1.0D+0*T26*T28*T6*T29+1.3210398931339262D-3*T5*T27)*RHOA+T7+T25
      VRHOB(I) = 0.0D+0
      VSIGMAAA(I) = 5.066059182116889D-2*T8*RHOA*T30*
     #(3.321143126317825D-3*T17*T18*SIGMAAA*T20*T23*T14+
     #5.762935993326513D-2*T9*T10*T11*T16*T23-5.762935993326513D-2*T9*
     #T10*SIGMAAA*T11*(5.762935993326513D-2*T9*T10*T11*T14+
     #6.64228625263565D-3*T17*T18*SIGMAAA*T20*T21)*T16*T35)
      VSIGMABB(I) = 0.0D+0
      VSIGMAAB(I) = 0.0D+0
C
      ELSE ! (.NOT.(RHOA.LT.TOL).AND..NOT.(RHOB.LT.TOL))
      SIGMAAA = MAX(0.D0,SIGMAAA1(I))
      SIGMAAB = SIGMAAB1(I)
      SIGMABB = MAX(0.D0,SIGMABB1(I))
C
      T1 = RHOB+RHOA
      T2 = 1.0D+0*T1**((-1.0D+0)/3.0D+0)
      T3 = 1.3256889990520176D-1*T2+1.0D+0
      T4 = 1.0D+0*T1**((-2.0D+0)/3.0D+0)
      T5 = SQRT(T1)
      T6 = 1.0D+0/T5
      T7 = 1.0D+0*T1**((-1.0D+0)/6.0D+0)
      T8 = 5.982550435771079D+0*T7+2.2255694211506874D+0*T2+
     #8.004286349993636D-1*T6+1.8970043257475583D-1*T4
      T9 = 1.6081979498692536D+1/T8+1.0D+0
      T10 = LOG(T9)
      T11 = -6.21814D-2*T3*T10
      T12 = 1.2599210498948732D+0
      T13 = 1.0D+0/(2.0D+0*T12-2.0D+0)
      T14 = 9.0D+0*T12-9.0D+0
      T15 = RHOA-1.0D+0*RHOB
      T16 = T15**4
      T17 = 1.0D+0/T1**4
      T18 = 1.0D+0-1.0D+0*T16*T17
      T19 = 6.901399211255825D-2*T2+1.0D+0
      T20 = 1.0D+0/T1
      T21 = 1.0D+0-1.0D+0*T15*T20
      T22 = T15*T20+1.0D+0
      T23 = T22**(4.0D+0/3.0D+0)+T21**(4.0D+0/3.0D+0)-2.0D+0
      T24 = 8.157414703487641D+0*T7+2.247591863577616D+0*T2+
     #4.3009724712766434D-1*T6+1.9115125951273373D-1*T4
      T25 = 2.9608749977793436D+1/T24+1.0D+0
      T26 = LOG(T25)
      T27 = 8.443449999999999D-3*T13*T14*T18*T19*T23*T26
      T28 = 6.21814D-2*T3*T10
      T29 = 1.274696188700087D-1*T2+1.0D+0
      T30 = 1.1120374863094687D+1*T7+3.8447462374472113D+0*T2+
     #1.6447337755676092D+0*T6+2.4058712912881913D-1*T4
      T31 = 3.216395899738507D+1/T30+1.0D+0
      T32 = LOG(T31)
      T33 = T28-3.10907D-2*T29*T32
      T34 = T13*T16*T17*T23*T33
      T35 = 3.068528194400547D-1
      T36 = 5.0D-1*T22**(2.0D+0/3.0D+0)+5.0D-1*T21**(2.0D+0/
     #3.0D+0)
      T37 = T36**3
      T38 = 1.0D+0/T35
      T39 = SIGMABB+SIGMAAA+2.0D+0*SIGMAAB
      T40 = 1.0D+0*T1**((-7.0D+0)/3.0D+0)
      T41 = T36**2
      T42 = 1.0D+0/T41
      T43 = 1.0D+0/T37
      T44 = -1.0D+0*T13*T16*T17*T23*T33+T28-
     #8.443449999999999D-3*T13*T14*T18*T19*T23*T26
      T45 = 2.718281828459045D+0**(9.869604401089358D+0*T38*T43*
     #T44)
      T46 = T45-1.0D+0
      T47 = 1.0D+0/T46
      T48 = 4.179666459885054D-2*T38*T39*T40*T42*T47
      T49 = T48+1.0D+0
      T50 = 1.0D+0/T35**2
      T51 = T39**2
      T52 = 1.0D+0*T1**((-1.3999999999999999D+1)/3.0D+0)
      T53 = 1.0D+0/T36**4
      T54 = 1.0D+0/T46**2
      T55 = 1.746961171588806D-3*T50*T51*T52*T53*T54+T48+1.0D+0
      T56 = 1.0D+0/T55
      T57 = 4.1796664598850536D-2*T38*T39*T40*T42*T49*T56+1.0D+0
      T58 = LOG(T57)
      T59 = 1.0132118364233778D-1*T35*T37*T58
      T60 = 1.0D+0*T1**((-5.0D+0)/3.0D+0)
      T61 = 1.0D+0/T5**3
      T62 = 1.0D+0*T1**((-4.0D+0)/3.0D+0)
      T63 = 1.0D+0*T1**((-7.0D+0)/6.0D+0)
      T64 = -9.970917392951799D-1*T63-7.418564737168958D-1*T62-
     #4.002143174996818D-1*T61-1.264669550498372D-1*T60
      T65 = 1.0D+0/T8**2
      T66 = 1.0D+0/T9
      T67 = 1.0D+0*T64*T3*T65*T66
      T68 = -1.3595691172479402D+0*T63-7.491972878592053D-1*T62-
     #2.1504862356383217D-1*T61-1.2743417300848914D-1*T60
      T69 = 1.0D+0/T24**2
      T70 = 1.0D+0/T25
      T71 = -2.5D-1*T13*T14*T18*T68*T19*T69*T23*T70
      T72 = 2.747773264188437D-3*T62*T10
      T73 = 1.0D+0/T1**2
      T74 = T15*T73
      T75 = -1.0D+0*T20
      T76 = T75+T74
      T77 = T21**(1.0D+0/3.0D+0)
      T78 = -1.0D+0*T15*T73
      T79 = T20+T78
      T80 = T22**(1.0D+0/3.0D+0)
      T81 = 1.3333333333333333D+0*T79*T80+1.3333333333333333D+0*
     #T76*T77
      T82 = -1.942387305675933D-4*T13*T14*T62*T18*T23*T26
      T83 = 1.0D+0/T1**5
      T84 = 4.0D+0*T16*T83
      T85 = T15**3
      T86 = T84-4.0D+0*T17*T85
      T87 = -1.0D+0*T64*T3*T65*T66
      T88 = -2.747773264188437D-3*T62*T10
      T89 = T88+T87+1.0D+0*T29*(-1.8533958105157808D+0*T63-
     #1.2815820791490704D+0*T62-8.223668877838046D-1*T61-
     #1.6039141941921276D-1*T60)/(T30**2*T31)+1.3210398931339262D-3*T62*
     #T32
      T90 = T13*T16*T17*T23*T89
      T91 = -4.0D+0*T13*T16*T23*T33*T83
      T92 = 4.0D+0*T13*T17*T23*T33*T85
      T93 = 1.0D+0/T57
      T94 = 1.0D+0/T77
      T95 = 1.0D+0/T80
      T96 = 3.333333333333333D-1*T79*T95+3.333333333333333D-1*
     #T76*T94
      T97 = 1.0D+0*T1**((-1.0D+1)/3.0D+0)
      T98 = -9.752555073065126D-2*T38*T39*T97*T42*T49*T56
      T99 = -8.359332919770108D-2*T38*T39*T40*T96*T43*T47
      T100 = -9.752555073065128D-2*T38*T39*T97*T42*T47
      T101 = 2.5D-1*T13*T14*T18*T68*T19*T69*T23*T70
      T102 = 1.942387305675933D-4*T13*T14*T62*T18*T23*T26
      T103 = -1.0D+0*T13*T16*T17*T23*T89
      T104 = 4.0D+0*T13*T16*T23*T33*T83
      T105 = -4.0D+0*T13*T17*T23*T33*T85
      T106 = 9.869604401089358D+0*T38*T43*(T88+T87-1.0D+0*T13*
     #T16*T17*T33*T81-8.443449999999999D-3*T13*T14*T18*T19*T81*T26-
     #8.443449999999999D-3*T13*T14*T86*T19*T23*T26+T105+T104+T103+T102+
     #T101)-2.9608813203268075D+1*T38*T96*T53*T44
      T107 = -4.179666459885054D-2*T38*T39*T40*T42*T106*T54*T45
      T108 = 1.0D+0/T55**2
      T109 = 1.0D+0/T36**5
      T110 = -8.152485467414428D-3*T1**
     #((-1.6999999999999998D+1)/3.0D+0)*T50*T51*T53*T54
      T111 = 1.0D+0/T46**3
      T112 = T20+T74
      T113 = T75+T78
      T114 = 1.3333333333333333D+0*T113*T80+
     #1.3333333333333333D+0*T112*T77
      T115 = 4.0D+0*T17*T85+T84
      T116 = 3.333333333333333D-1*T113*T95+3.333333333333333D-1*
     #T112*T94
      T117 = -8.359332919770108D-2*T38*T39*T40*T116*T43*T47
      T118 = 9.869604401089358D+0*T38*T43*(T92+T88+T87-1.0D+0*
     #T114*T13*T16*T17*T33-8.443449999999999D-3*T13*T14*T115*T19*T23*
     #T26-8.443449999999999D-3*T13*T14*T18*T19*T114*T26+T104+T103+T102+
     #T101)-2.9608813203268075D+1*T38*T116*T53*T44
      T119 = -4.179666459885054D-2*T38*T39*T40*T42*T118*T54*T45
      T120 = 1.0132118364233778D-1*T35*T1*T37*T93*
     #(1.746961171588806D-3*T50*T39*T52*T53*T56*T47+
     #4.1796664598850536D-2*T38*T40*T42*T49*T56-4.1796664598850536D-2*
     #T38*T39*T40*T42*(4.179666459885054D-2*T38*T40*T42*T47+
     #3.493922343177612D-3*T50*T39*T52*T53*T54)*T49*T108)
      ZK(I) = T1*(T59+T34+T27+T11)
      VRHOA(I) = T1*(3.039635509270133D-1*T35*T96*T41*T58+
     #1.0132118364233778D-1*T35*T37*T93*(-4.1796664598850536D-2*T38*T39*
     #T40*T42*T49*T108*(T107-3.493922343177612D-3*T50*T51*T52*T53*T106*
     #T111*T45+T100+T99+T110-6.987844686355223D-3*T50*T51*T52*T96*T109*
     #T54)+4.1796664598850536D-2*T38*T39*T40*T42*T56*(T107+T100+T99)+
     #T98-8.359332919770107D-2*T38*T39*T40*T96*T43*T49*T56)+T92+T91+T13*
     #T16*T17*T81*T33+T90+8.443449999999999D-3*T13*T14*T86*T19*T23*T26+
     #T82+8.443449999999999D-3*T13*T14*T18*T19*T81*T26+T72+T71+T67)+T59+
     #T34+T27+T11
      VRHOB(I) = T1*(3.039635509270133D-1*T35*T116*T41*T58+
     #1.0132118364233778D-1*T35*T37*T93*(-4.1796664598850536D-2*T38*T39*
     #T40*T42*T49*T108*(T119-3.493922343177612D-3*T50*T51*T52*T53*T118*
     #T111*T45+T100+T117+T110-6.987844686355223D-3*T50*T51*T52*T116*
     #T109*T54)+4.1796664598850536D-2*T38*T39*T40*T42*T56*(T119+T100+
     #T117)+T98-8.359332919770107D-2*T38*T39*T40*T116*T43*T49*T56)+T105+
     #T91+T13*T16*T17*T114*T33+T90+8.443449999999999D-3*T13*T14*T115*
     #T19*T23*T26+T82+8.443449999999999D-3*T13*T14*T18*T19*T114*T26+T72+
     #T71+T67)+T59+T34+T27+T11
      VSIGMAAA(I) = T120
      VSIGMABB(I) = T120
      VSIGMAAB(I) = 1.0132118364233778D-1*T35*T1*T37*T93*
     #(3.493922343177612D-3*T50*T39*T52*T53*T56*T47+
     #8.359332919770107D-2*T38*T40*T42*T49*T56-4.1796664598850536D-2*
     #T38*T39*T40*T42*(8.359332919770108D-2*T38*T40*T42*T47+
     #6.987844686355223D-3*T50*T39*T52*T53*T54)*T49*T108)
C
      ENDIF ! RHOA,RHOB
      ELSE ! RHO
      ZK(I) = 0.0D0
      VRHOA(I) = 0.0D0
      VRHOB(I) = 0.0D0
      VSIGMAAA(I) = 0.0D0
      VSIGMAAB(I) = 0.0D0
      VSIGMABB(I) = 0.0D0
      ENDIF ! RHO
      ENDDO
C
      RETURN
      END
