C 27 Apr 12 - MWS - use VICLR to zero integer arrays
C 12 Dec 10 - MWS - save IROOT'th value for IP/EA numerical derivatives
C  1 Oct 10 - JRG - added IP-EOM3A routines, fixed various small bugs
C 23 Jun 10 - JRG - fixed bugs in HRLOOPAB2, EADENA, EADENR3A,
C                   correct restarts in EASTRINT and EA3ASOLSR
C 25 Mar 10 - JRG - enable active space triples for EA-EOM
C 14 Oct 09 - JRG - new module to provide IP-EOM and EA-EOM methods
C
C*MODULE EAIPCC  *DECK DREAEOM
      SUBROUTINE DREAEOM(BESTEOM,NOA,NUA,NOB,NUB)
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
C
      PARAMETER (MXATM=2000, MXAO=8192)
C
      CHARACTER*1 SMALLD,SMALLT
C
      COMMON /FMCOM / X(1)
      COMMON /IOFILE/ IR,IW,IP,IJK,IJKT,IDAF,NAV,IODA(950)
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /RUNOPT/ RUNTYP,EXETYP,NEVALS,NGLEVL,NHLEVL
      COMMON /WFNOPT/ SCFTYP,VBTYP,DFTYPE,TDDFTYP,CITYP,CCTYP,
     *                MPLEVL,MPCTYP
      COMMON /EOMPAR/ CVGCI,CVGEOM,GRPEOM,NSTEOM(8),NOACT,NUACT,
     *                MOACTCC(MXAO),MTHTRIP,MTHCI,MTHEOM,MTHINIT,
     *                MAXCI,MAXEOM,MICCI,MICEOM,IROOTCC(2),
     *                IPROPCC,IPROPCCE
      COMMON /INFOA / NAT,ICH,MUL,NUM,NQMT,NE,NA,NB,
     *                ZAN(MXATM),C(3,MXATM),IAN(MXATM)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
      DATA EAEOM2,EAEOM3A       /8HEA-EOM2 ,8HEA-EOM3A/
C---  DATA EAEOM2,EAEOM3,EAEOM3A/8HEA-EOM2 ,8HEA-EOM3 ,8HEA-EOM3A/
      DATA CHECK/8HCHECK   /
C
C     --- actual driver for EA-EOMCC methods ---
C     these are EA-EOMCCSD(2p-1h),
C               EA-EOMCCSD(3p-2h),
C               EA-EOMCCSDt
C         h=occupied, h means "holes" which are occupied
C                       states in the Fermi vacuum
C         p= virtual, p means "particles" which are unoccupied
C                       states in the Fermi vacuum
C
      WRITE(IW,9000)
      IF(CCTYP.EQ.EAEOM3A) THEN
      IF((NACTB.GT.NUB).OR.(NACTA.GT.NUA)) THEN
       WRITE(IW,9005)NUB
       CALL ABRT
       STOP
      END IF
      END IF
C
C         ---- Open Files Specific to EA-EOMCC Calculations ----
      CALL OPEAFILE(NUA)
C
C               ---- EA-EOMCC Initial Start ----
      IF(MTHINIT.EQ.2) THEN
       IDIM=NUA
       WRITE(IW,9100)
      ELSE
       IDIM=2*NOACT*NUACT*NUACT
       IDIM=IDIM+NUA
       SMALLD = CHAR(100)
       WRITE(IW,9105) SMALLD
      END IF
      CALL FLSHBF(IW)
      IDIM2=IDIM*IDIM
      L1=NUM
      CALL VALFM(LOADFM)
      I1   = LOADFM + 1
      I2   = I1     + NU2            !FPP
      I3   = I2     + NU2            !FPPB
      I4   = I3     + NO2            !FHH
      I5   = I4     + NOU            !FHP
      I6   = I5     + NO2U2          !VHPHP
      I7   = I6     + NOU3           !VHPPP
      I8   = I7     + NU3            !VPPP
      I9   = I8     + NUA            !INDEX1
      I10  = I9     + NOU2           !INDEXA
      I11  = I10    + NOU2           !INDEXB
      I12  = I11    + IDIM2          !HM
      I13  = I12    + IDIM           !WR
      I14  = I13    + IDIM           !WI
      I15  = I14    + 4*IDIM         !WORK
      I16  = I15    + IDIM2          !VR
      I17  = I16    + NUA+NOU2+NOU2  !TRANS
      I18  = I17    + L1             !LABMO
      LAST = I18    + IDIM           !ISPIN
      NEED=LAST-LOADFM-1
      WRITE(IW,9110) NEED
      CALL FLSHBF(IW)
C
      CALL GETFM(NEED)
C
      CALL EAINIT(NOA,NUA,NOB,NUB,X(I1),X(I2),X(I3),X(I4),
     *             X(I5),X(I6),X(I7),X(I8),X(I9),X(I10),
     *             X(I11),X(I12),X(I13),X(I14),X(I15),
     *             X(I16),X(I17),X(I18),L1,IDIM,NROOT)
C
      CALL RETFM(NEED)
C
      WRITE(IW,9120)
      CALL TIMIT(1)
C                ---- EA-EOMCCSD(2p-1h) Solver ----
      IF(CCTYP.EQ.EAEOM2) THEN
      WRITE(IW,9200)
      CALL FLSHBF(IW)
      CALL VALFM(LOADFM)
      NOUP=NUA+NOU2+NOU2
      ISPACE=MAXEOM
      ISPACE2=ISPACE*ISPACE
      I1   = LOADFM + 1
      I2   = I1     + NU2            !DPPA
      I3   = I2     + NU2            !DPPB
      I4   = I3     + NO2            !DHHA
      I5   = I4     + NO2            !DHHB
      I6   = I5     + NU2            !FPP
      I7   = I6     + NOU            !FHP
      I8   = I7     + NO2            !FHH
      I9   = I8     + NOU3           !VHPPP
      I10  = I9     + NU3            !VPPP
      I11  = I10    + NO2U2          !VHPHP
      I12  = I11    + NO2U2          !T2
      I13  = I12    + NOA            !OHA
      I14  = I13    + NOU3           !TI
      I15  = I14    + NOUP           !VEC1
      I16  = I15    + NOUP           !VEC2
      I17  = I16    + ISPACE2        !HM
      I18  = I17    + ISPACE2        !HMAUX
      I19  = I18    + ISPACE         !WR
      I20  = I19    + ISPACE         !WI
      I21  = I20    + ISPACE2        !VR
      I22  = I21    + 4*ISPACE       !WORK
      LENGMAT = I22    + NOUP           !AUX
      LSYM    = LENGMAT+ NROOT
      LISPIN  = LSYM   + NROOT
      LICON   = LISPIN + NROOT
      LAST    = LICON  + NROOT
      NEED=LAST-LOADFM-1
      WRITE(IW,9210) NEED
      CALL FLSHBF(IW)
C
      CALL GETFM(NEED)
      IF(EXETYP.EQ.CHECK) GO TO 66
C
      CALL EA2SOLSR(BESTEOM,NOA,NUA,NOB,NUB,X(I1),X(I2),X(I3),X(I4),
     *              X(I5),X(I6),X(I7),X(I8),X(I9),X(I10),
     *              X(I11),X(I12),X(I13),X(I14),X(I15),
     *              X(I16),X(I17),X(I18),X(I19),X(I20),
     *              X(I21),X(I22),X(LENGMAT),X(LSYM),X(LISPIN),X(LICON),
     *              NROOT)
C
 66   CONTINUE
      CALL RETFM(NEED)
C
      WRITE(IW,9220)
      CALL TIMIT(1)
      END IF
C
C                ---- EA-EOMCCSDt Solver ----
C
      IF(CCTYP.EQ.EAEOM3A) THEN
      SMALLT=CHAR(116)
      WRITE(IW,9300) SMALLT
      CALL FLSHBF(IW)
      CALL VALFM(LOADFM)
      NOUP=NUA+NOU2+NOU2
      ISPACE=MAXEOM
      ISPACE2=ISPACE*ISPACE
      I1   = LOADFM + 1
      I2   = I1     + NU2            !DPPA
      I3   = I2     + NU2            !DPPB
      I4   = I3     + NO2            !DHHA
      I5   = I4     + NO2            !DHHB
      I6   = I5     + NU2            !FPPA
      I7   = I6     + NU2            !FPPB
      I8   = I7     + NOU            !FHPA
      I9   = I8     + NOU            !FHPB
      I10  = I9     + NO2            !FHHA
      I11  = I10    + NO2            !FHHB
      I12  = I11    + NOU3           !VHPPP1
      I13  = I12    + NOU3           !VHPPP2
      I14  = I13    + NOU3           !VHPPP3
      I15  = I14    + NOU3           !TI
      I16  = I15    + NU3            !VPPP
      I17  = I16    + NO2U2          !VHPHP1
      I18  = I17    + NO2U2          !VHPHP2
      I19  = I18    + NO2U2          !VHPHP3
      I20  = I19    + NO2U2          !VHPHP4
      I21  = I20    + NO2U2          !VHPHP5
      I22  = I21    + NO2U2          !VHPHP6
      I23  = I22    + NO3U           !VHHHP1
      I24  = I23    + NO3U           !VHHHP2
      I25  = I24    + NO4            !VHHHH
      I26  = I25    + NO2U2          !T2
      I27  = I26    + NO2U2          !T2B
      I28  = I27    + NOA            !OHA
      I29  = I28    + NU3            !OPPPA
      I30  = I29    + NU3            !OPPPB
      I31  = I30    + NO2U           !OHHPA
      I32  = I31    + NO2U           !OHHPB
      I33  = I32    + NO2U           !OHHPB2
      I34  = I33    + NOU2           !OHPP
      I35  = I34    + NOU2           !OHPPB
      I36  = I35    + NOUP           !VEC1
      I37  = I36    + NOUP           !VEC2
      I38  = I37    + NO2U2          !R3
      I39  = I38    + NO2U2          !HR3
      I40  = I39    + ISPACE2        !HM
      I41  = I40    + ISPACE2        !HMAUX
      I42  = I41    + ISPACE         !WR
      I43  = I42    + ISPACE         !WI
      I44  = I43    + ISPACE2        !VR
      I45  = I44    + 4*ISPACE       !WORK
      I46  = I45    + NOUP           !AUX
      I47  = I46    + NROOT          !ENGMAT
      I48  = I47    + NROOT          !SYM
      I49  = I48    + NROOT          !ISPIN
      LAST = I49    + NROOT          !ICON
      NEED=LAST-LOADFM-1
      WRITE(IW,9310) NEED
      CALL FLSHBF(IW)
C
      CALL GETFM(NEED)
      IF(EXETYP.EQ.CHECK) GO TO 67
C
      CALL EA3ASOLSR(BESTEOM,NOA,NUA,NOB,NUB,X(I1),X(I2),X(I3),X(I4),
     *               X(I5),X(I6),X(I7),X(I8),X(I9),X(I10),
     *               X(I11),X(I12),X(I13),X(I14),X(I15),
     *               X(I16),X(I17),X(I18),X(I19),X(I20),
     *               X(I21),X(I22),X(I23),X(I24),X(I25),
     *               X(I26),X(I27),X(I28),X(I29),X(I30),
     *               X(I31),X(I32),X(I33),X(I34),X(I35),
     *               X(I36),X(I37),X(I38),X(I39),X(I40),
     *               X(I41),X(I42),X(I43),X(I44),X(I45),
     *               X(I46),X(I47),X(I48),X(I49),NROOT)
C
 67   CONTINUE
      CALL RETFM(NEED)
C
      WRITE(IW,9320) SMALLT
      CALL TIMIT(1)
      END IF
      RETURN
C
 9000 FORMAT(/3X,'----------------------------------------------------'
     *       ,'--------'
     *       /3X,'ELECTRON-ATTACHED EQUATION-OF-MOTION COUPLED-CLUSTER'
     *       ,1X,'PROGRAM'/
     *        15X,'PROGRAM BY J.R.GOUR, P.PIECUCH'/
     *        3X,'----------------------------------------------------'
     *       ,'--------')
 9005 FORMAT(1X,'NACT CANNOT EXCEED THE TOTAL NUMBER OF UNOCCUPIED',
     *       1X,'ORBITALS.'/
     *       1X,'PLEASE SET NACT LESS THAN OR EQUAL TO',1X,I3,
     *       1X,'AND RESUBMIT')
 9100 FORMAT(/8X,'------------------------------------'/
     *        8X,'EA-EOMCC ''CIS'' INITIAL START PROGRAM'/
     *        8X,'------------------------------------')
 9105 FORMAT(/8X,'----------------------------------------'/
     *        8X,'EA-EOMCC ''EOMCCS',A,''' INITIAL START PROGRAM'/
     *        8X,'----------------------------------------')
 9110 FORMAT(1X,'MEMORY NEEDED BY EAINIT: ',I12,' WORDS')
 9120 FORMAT(1X,'..... DONE WITH EA-EOMCC INITIAL START CALCULATION
     *.....')
 9200 FORMAT(/18X,'-------------------------'/
     *        18X,'EA-EOMCCSD(2P-1H) PROGRAM'/
     *        18X,'-------------------------')
 9210 FORMAT(1X,'MEMORY NEEDED BY EA2SOLSR: ',I12,' WORDS')
 9220 FORMAT(1X,'..... DONE WITH EA-EOMCCSD(2P-1H) AMPLITUDE ITERATIONS
     *.....')
 9300 FORMAT(/24X,'-------------------'/
     *        24X,'EA-EOMCCSD',A,' PROGRAM'/
     *        24X,'-------------------')
 9310 FORMAT(1X,'MEMORY NEEDED BY EA3ASOLSR: ',I12,' WORDS')
 9320 FORMAT(1X,'..... DONE WITH EA-EOMCCSD',A,' AMPLITUDE ITERATIONS
     *.....')
      END
C
C*MODULE EAIPCC  *DECK OPEAFILE
      SUBROUTINE OPEAFILE(NUA)
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
C
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB  !JRG 12 APR 2010
C
C       This file contains iterative subspace data for the 1P and 2P-1H
C       vectors in the EA-EOM calculations, and 1H and 2H-1P vectors
C       in the IP-EOM calculations.
C
      CALL CCOPEN(96,NOU2,'ITSPACE')
C
C       This file stores the initial start vectors
C
      LEN97=NUA+NOU2+NOU2
      CALL CCOPEN(97,LEN97,'INSTART')
C
C       This file contains iterative subspace data for the 3P-2H vectors
C       in EA-EOM3A (and eventually EA-EOM3 when it is finished) runs.
C       It will eventually hold the same sort of data for IP-EOM runs.
C
      CALL CCOPEN(98,NO2U2,'ITSPC3')
C
C*************** JRG 12 APR 2010 *************************************
C       This file stores the 3P-2H initial start vectors. Is only
C       necessary when JREST=1
C
      IF(JREST.EQ.1) THEN
       CALL CCOPEN(99,NO2U2,'INSTRT3')
      END IF
C*********************************************************************
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK EA2SOLSR
      SUBROUTINE EA2SOLSR(BESTEOM,NOA,NUA,NOB,NUB,DPPA,DPPB,DHHA,DHHB,
     *                    FPP,FHP,FHH,VHPPP,VPPP,VHPHP,
     *                    T2,OHA,TI,VEC1,VEC2,HM,HMAUX,WR,WI,VR,
     *                    WORK,AUX,ENGMAT,SYM,ISPIN,ICON,NROOT)
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
C
      LOGICAL CNVR
C
      CHARACTER*3 SYM,REP
C
      PARAMETER (MXAO=8192)
C
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /CCENGY/ ENRG,EREF,EMP2,ECCN,ETOT(6),ECORR(6),
     *                DIAGS(3),AMPMX(5,2),IAMPMX(5,4,2),XO1,XO2,
     *                DIFMAX,DIFFENG,ITER,CNVR
      COMMON /IOFILE/ IR,IW,IP,IJK,IJKT,IDAF,NAV,IODA(950)
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EOMPAR/ CVGCI,CVGEOM,GRPEOM,NSTEOM(8),NOACT,NUACT,
     *                MOACTCC(MXAO),MTHTRIP,MTHCI,MTHEOM,MTHINIT,
     *                MAXCI,MAXEOM,MICCI,MICEOM,IROOTCC(2),
     *                IPROPCC,IPROPCCE
      COMMON /EOMSYM/ IG,NRE(4),MC(8,8,4),ISORB(MXAO),REP(8)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
      DIMENSION FPP(1),FHP(1),FHH(1),VHPPP(1),VPPP(1),VHPHP(1),T2(1)
      DIMENSION OHA(1),TI(1)
      DIMENSION VEC1(1),VEC2(1),HM(1),HMAUX(1),AUX(1)
      DIMENSION WR(1),WI(1),VR(1),WORK(1)
      DIMENSION DPPA(NUA,NUA),DPPB(NUB,NUB)
      DIMENSION DHHA(NOA,NOA),DHHB(NOB,NOB)
      DIMENSION ENGMAT(NROOT),SYM(NROOT),ISPIN(NROOT),ICON(NROOT)
      DIMENSION JSTATE(9)
C
      DATA ONE/1.00D+00/
      TOL=CVGEOM
C
      ISPACE=MAXEOM
      ISPACE2=ISPACE*ISPACE
      NOUP=NUA+NOAUA2+NOBUAB
C
      CALL ZEROMA(ENGMAT,1,NROOT)
      CALL VICLR(ICON,1,NROOT)
C
      CALL RDTAB2(NUA,NUA,DPPA,1,NFT891)
      CALL RDTAB2(NUB,NUB,DPPB,2,NFT891)
      CALL RDTAB2(NOA,NOA,DHHA,3,NFT891)
      CALL RDTAB2(NOB,NOB,DHHB,4,NFT891)
C
      CALL VICLR(JSTATE,1,9)
      JSTATE(1)=MULEAIP
      WRITE(NFT825,REC=6)JSTATE
C
      DO 1,IROOT=1,NROOT
      WRITE(IW,301)IROOT
      CALL FLSHBF(IW)
      CALL ZEROMA(HM,1,ISPACE2)
      CALL ZEROMA(HMAUX,1,ISPACE2)
      CALL ZEROMA(VEC1,1,NOUP)
      CALL ZEROMA(VEC2,1,NOUP)
      CALL REAINIT(IROOT,NOUP,VEC1)
C
      CALL DCOPY(NOUP,VEC1,1,VEC2,1)
      XNORM=DDOT(NOUP,VEC1,1,VEC2,1)
      XNORM=ONE/DSQRT(XNORM)
      CALL DSCAL(NOUP,XNORM,VEC1(1),1)
      CALL WRTAB1(NUA,VEC1(1),1,96)
      CALL WRTAB3(NUA,NUA,NOA,VEC1(1+NUA),2,96)
      CALL WRTAB3(NUA,NUB,NOB,VEC1(1+NUA+NOAUA2),3,96)
C
      DO 2,ITER=1,MAXEOM
C
C     ---------- GENERATING HR (R TAKEN FROM ITSPACE) -------------
      IREC=6*(ITER-1)
      CALL RDTAB1(NUA,VEC1(1),(IREC+1),96)
      CALL RDTAB3(NUA,NUA,NOA,VEC1(1+NUA),(IREC+2),96)
      CALL RDTAB3(NUA,NUB,NOB,VEC1(1+NUA+NOAUA2),(IREC+3),96)
      CALL HR2P1H(NOA,NUA,NOB,NUB,VEC1(1),VEC2(1),VEC1(1+NUA),
     *            VEC1(1+NUA+NOAUA2),VEC2(1+NUA),VEC2(1+NUA+NOAUA2),
     *            FPP,FHP,FHH,VHPPP,VPPP,VHPHP,T2,OHA,TI)
C
      CALL ZEROMA(VEC1(1+NUA),1,NOU2)
      CALL ASYMEA2(VEC2(1+NUA),NOA,NUA,VEC1(1+NUA))
      CALL WRTAB1(NUA,VEC2(1),(IREC+4),96)
      CALL WRTAB3(NUA,NUA,NOA,VEC2(1+NUA),(IREC+5),96)
      CALL WRTAB3(NUA,NUB,NOB,VEC2(1+NUA+NOAUA2),(IREC+6),96)
C     ------------------ FORMING SMALL MATRIX -------------------
      CALL EASMLLMA(NOA,NUA,NOB,NUB,ISPACE,ITER,HM,HMAUX,
     *              VEC1,VEC2,NOUP,IREC)
C
C     ------------- PICKING UP THE BEST EIGENVECTOR ------------
      CALL EASELVEC(ISPACE,ITER,HM,WR,WI,VR,WORK,XENE)
C
C     ---- FORMING OPTIMUM COMBINATION OF VECTORS FROM ITSPACE ON VEC1 ----
      ISN=1   !READING FROM ITSPACE
      CALL EACOMB(NOA,NUA,NOB,NUB,ISPACE,ITER,WI,VEC1,VEC2,ISN,NOUP)
      JROOT=3*(IROOT-1)
      JROOT=JROOT+6
      CALL WRTAB1(NUA,VEC1(1),(JROOT+1),NFT825)
      CALL WRTAB3(NUA,NUA,NOA,VEC1(1+NUA),(JROOT+2),NFT825)
      CALL WRTAB3(NUA,NUB,NOB,VEC1(1+NUA+NOAUA2),(JROOT+3),NFT825)
      IF(ITER.EQ.1) THEN
       CALL FIXGRSYM(NOA,NOB,IGRSYM)
       CALL EASYM(NOA,NUA,NOB,NUB,VEC1(1),VEC1(1+NUA),
     *            VEC1(1+NUA+NOAUA2),SYM(IROOT),NSYM,IGRSYM)
       JSTATE(NSYM+1)=JSTATE(NSYM+1)+1
       WRITE(NFT825,REC=6)JSTATE
      END IF
C
C     ---- FORMING OPTIMAL COMBINATION OF VECTORS FROM HR ON VEC2 ------
      ISN=2   !READING FROM HR
      CALL EACOMB(NOA,NUA,NOB,NUB,ISPACE,ITER,WI,VEC2,AUX,ISN,NOUP)
C
C     ---------------- FORMING THE CORRECTION ON AUX ------------------
      CALL ZEROMA(AUX,1,NOUP)
      CALL DCOPY(NOUP,VEC2(1),1,AUX(1),1)
      CALL DAXPY(NOUP,-XENE,VEC1(1),1,AUX(1),1)
      CALL EADEN(NOA,NUA,NOB,NUB,XENE,DHHA,DHHB,DPPA,DPPB,
     *           AUX(1),AUX(1+NUA),AUX(1+NUA+NOAUA2))
C
C     ------------------ CONVERGENCE TEST ---------------------
      CALL NORMV(NOUP,RES,AUX(1))
      WRITE(IW,300) ITER,XENE,RES
      CALL FLSHBF(IW)
      IF(RES.LT.TOL) GO TO 1000
C
C     ----------- ORTHONORMALIZATION OF THE CORRECTION ------------
      CALL EAORTH(NOA,NUA,NOB,NUB,NOUP,ITER,AUX,VEC1)
C
C     -------- WRITING THE CORRECTION TO RECORD NO. ITER+1 ---------
      JREC=6*ITER
      CALL WRTAB1(NUA,AUX(1),(JREC+1),96)
      CALL WRTAB3(NUA,NUA,NOA,AUX(1+NUA),(JREC+2),96)
      CALL WRTAB3(NUA,NUB,NOB,AUX(1+NUA+NOAUA2),(JREC+3),96)
C
 2    CONTINUE
C
C     --------------- LACK OF CONVERGENCE ---------------
      WRITE(IW,302) IROOT
      CALL RDTAB1(NUA,VEC1(1),(JROOT+1),NFT825)
      CALL RDTAB3(NUA,NUA,NOA,VEC1(1+NUA),(JROOT+2),NFT825)
      CALL RDTAB3(NUA,NUB,NOB,VEC1(1+NUA+NOAUA2),(JROOT+3),NFT825)
      CALL EA2NORM(NOA,NUA,NOB,NUB,VEC1(1),VEC1(1+NUA),
     *             VEC1(1+NUA+NOAUA2))
      CALL FIXGRSYM(NOA,NOB,IGRSYM)
      CALL EASYM(NOA,NUA,NOB,NUB,VEC1(1),VEC1(1+NUA),
     *           VEC1(1+NUA+NOAUA2),SYM(IROOT),NSYM,IGRSYM)
      IF(NOA.EQ.NOB) THEN
       CALL EASPIN(NOA,NUA,NOB,NUB,VEC1(1),VEC1(1+NUA),
     *             VEC1(1+NUA+NOAUA2),ISPIN(IROOT))
      END IF
      ENGMAT(IROOT)=XENE
      CALL WRTAB1(NUA,VEC1(1),(JROOT+1),NFT825)
      CALL WRTAB3(NUA,NUA,NOA,VEC1(1+NUA),(JROOT+2),NFT825)
      CALL WRTAB3(NUA,NUB,NOB,VEC1(1+NUA+NOAUA2),(JROOT+3),NFT825)
      GO TO 1
C
C     ----------------- CONVERGENCE ---------------------
 1000 CONTINUE
      WRITE(IW,303)IROOT
      WRITE(IW,304)XENE
      ICON(IROOT)=1
      CALL RDTAB1(NUA,VEC1(1),(JROOT+1),NFT825)
      CALL RDTAB3(NUA,NUA,NOA,VEC1(1+NUA),(JROOT+2),NFT825)
      CALL RDTAB3(NUA,NUB,NOB,VEC1(1+NUA+NOAUA2),(JROOT+3),NFT825)
      CALL EA2NORM(NOA,NUA,NOB,NUB,VEC1(1),VEC1(1+NUA),
     *             VEC1(1+NUA+NOAUA2))
      CALL FIXGRSYM(NOA,NOB,IGRSYM)
      CALL EASYM(NOA,NUA,NOB,NUB,VEC1(1),VEC1(1+NUA),
     *           VEC1(1+NUA+NOAUA2),SYM(IROOT),NSYM,IGRSYM)
      CALL PRNTR1(NOA,NUA,VEC1(1))
      CALL PRNTR2A(NOA,NUA,VEC1(1+NUA))
      CALL PRNTR2B(NOA,NUA,NOB,NUB,VEC1(1+NUA+NOAUA2))
C
      IF(NOA.EQ.NOB) THEN
       CALL EASPIN(NOA,NUA,NOB,NUB,VEC1(1),VEC1(1+NUA),
     *             VEC1(1+NUA+NOAUA2),ISPIN(IROOT))
       WRITE(IW,315) IROOT,SYM(IROOT),ISPIN(IROOT),ENRG+EREF+XENE,XENE
       CALL FLSHBF(IW)
      ELSE
       WRITE(IW,305) IROOT,SYM(IROOT),ENRG+EREF+XENE,XENE
       CALL FLSHBF(IW)
      END IF
      ENGMAT(IROOT)=XENE
      CALL WRTAB1(NUA,VEC1(1),(JROOT+1),NFT825)
      CALL WRTAB3(NUA,NUA,NOA,VEC1(1+NUA),(JROOT+2),NFT825)
      CALL WRTAB3(NUA,NUB,NOB,VEC1(1+NUA+NOAUA2),(JROOT+3),NFT825)
C
C           print converged (or unconverged) results
C
 1    CONTINUE
      ICHECK=0
      NRTIRRP=0
C
      IF(NOA.EQ.NOB) THEN
         WRITE(IW,316)
         DO I=1,NROOT
           IF(SYM(I).EQ.REP(IROOTCC(1))) THEN
             NRTIRRP = NRTIRRP+1
             IF(NRTIRRP.EQ.IROOTCC(2)) BESTEOM = ENRG+EREF+ENGMAT(I)
           END IF
           IF(ICON(I).EQ.1) THEN
             WRITE(IW,317) SYM(I),ISPIN(I),ENGMAT(I),ENRG+EREF+ENGMAT(I)
           ELSE
             WRITE(IW,318) SYM(I),ISPIN(I),ENGMAT(I),ENRG+EREF+ENGMAT(I)
             ICHECK=ICHECK+1
           END IF
         ENDDO
      ELSE
         WRITE(IW,306)
         DO I=1,NROOT
           IF(SYM(I).EQ.REP(IROOTCC(1))) THEN
             NRTIRRP = NRTIRRP+1
             IF(NRTIRRP.EQ.IROOTCC(2)) BESTEOM = ENRG+EREF+ENGMAT(I)
           END IF
           IF(ICON(I).EQ.1) THEN
             WRITE(IW,307) SYM(I),ENGMAT(I),ENRG+EREF+ENGMAT(I)
           ELSE
             WRITE(IW,308) SYM(I),ENGMAT(I),ENRG+EREF+ENGMAT(I)
             ICHECK=ICHECK+1
           END IF
         ENDDO
      END IF
      WRITE(IW,309) IROOTCC,BESTEOM
C
      IF(ICHECK.GT.0) THEN
        WRITE(IW,310) ICHECK
        CALL ABRT
        STOP
      END IF
      RETURN
C
 300  FORMAT(1X,'ITERATION:',1X,I3,2X,'EA ENERGY=',1X,F14.10,2X,'CONV:',
     *       1X,F14.9)
 301  FORMAT(/6X,'BEGINNING EA-EOMCCSD(2P-1H) ITERATIONS FOR ROOT NO.',
     *       1X,I3)
 302  FORMAT(/2X,'THE EA-EOMCCSD(2P-1H) ITERATIONS FOR ROOT NO.',1X,I3,
     *       1X,'DID NOT CONVERGE',/)
 303  FORMAT(/2X,'THE EA-EOMCCSD(2P-1H) ITERATIONS FOR ROOT NO.',1X,I3,
     *       1X,'HAVE CONVERGED')
 304  FORMAT(2X,'EA-EOMCCSD(2P-1H) ELECTRON-ATTACHMENT ENERGY:',
     *       1X,F15.10,/)
 305  FORMAT(/8X,'SUMMARY OF EA-EOMCCSD(2P-1H) RESULTS FOR ROOT NO.',
     *       1X,I3,/18X,'THE SYMMETRY OF THE STATE IS',A4,/
     *       1X,'EA-EOMCCSD(2P-1H) E=',F20.10,
     *       2X,'ATTACH E=',F15.10,/)
 306  FORMAT(/7X,'---- SUMMARY OF EA-EOMCCSD(2P-1H) CALCULATIONS ----',/
     *        15X,'ELECTRON',/
     *        14X,'ATTACHMENT',13X,'TOTAL',/
     *        1X,'SYMMETRY',5X,'ENERGY (H)',11X,'ENERGY (H)',9X,
     *        'ITERATIONS')
 307  FORMAT(3X,A4,3X,F15.10,2X,F20.10,7X,'CONVERGED')
 308  FORMAT(3X,A4,3X,F15.10,2X,F20.10,7X,'UNCONVERGED')
 309  FORMAT(/1X,'SELECTING TARGET STATE IROOT=',2I3,
     *           ' AS BEST EA ENERGY',F20.10)
 310  FORMAT(2X,'EA-EOMCCSD(2P-1H) HALTED WITHOUT CONVERGING ALL',
     *        1X,'DESIRED STATES'/
     *        2X,I3,1X,'STATES UNCONVERGED',/)
 315  FORMAT(/8X,'SUMMARY OF EA-EOMCCSD(2P-1H) RESULTS FOR ROOT NO.',
     *       1X,I3,/18X,'THE SYMMETRY OF THE STATE IS',A4,/
     *       14X,'THE SPIN MULTIPLICITY OF THE STATE IS',I2,/
     *       1X,'EA-EOMCCSD(2P-1H) E=',F20.10,
     *       2X,'ATTACH E=',F15.10,/)
 316  FORMAT(/9X,'---- SUMMARY OF EA-EOMCCSD(2P-1H) CALCULATIONS ----',/
     *        20X,'ELECTRON',/
     *        9X,'SPIN',6X,'ATTACHMENT',13X,'TOTAL',/
     *        2X,'SYMM',3X,'MULT',6X,'ENERGY (H)',11X,'ENERGY (H)',7X,
     *        'ITERATIONS')
 317  FORMAT(2X,A4,3X,I2,4X,F15.10,2X,F20.10,5X,'CONVERGED')
 318  FORMAT(2X,A4,3X,I2,4X,F15.10,2X,F20.10,5X,'UNCONVERGED')
      END
C
C*MODULE EAIPCC  *DECK EASMLLMA
      SUBROUTINE EASMLLMA(NOA,NUA,NOB,NUB,ISPACE,ITER,HM,
     *                    HMAUX,VEC1,VEC2,NOUP,IREC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      DIMENSION HM(ISPACE,ISPACE),HMAUX(ISPACE,ISPACE)
      DIMENSION VEC1(1),VEC2(1)
C
      DO 1,I1=1,ISPACE
      DO 2,I2=1,ISPACE
       HM(I1,I2)=HMAUX(I1,I2)
 2    CONTINUE
 1    CONTINUE
      CALL ZEROMA(VEC1,1,NOUP)
      CALL ZEROMA(VEC2,1,NOUP)
C
C     --------- ITER-TH COLUMN OF HM (VEC2-HR(ITER)) -------------
      CALL RDTAB1(NUA,VEC2(1),(IREC+4),96)
      CALL RDTAB3(NUA,NUA,NOA,VEC2(1+NUA),(IREC+5),96)
      CALL RDTAB3(NUA,NUB,NOB,VEC2(1+NUA+NOAUA2),(IREC+6),96)
      DO 3,J=1,ITER-1
       JREC=6*(J-1)
       CALL RDTAB1(NUA,VEC1(1),(JREC+1),96)
       CALL RDTAB3(NUA,NUA,NOA,VEC1(1+NUA),(JREC+2),96)
       CALL RDTAB3(NUA,NUB,NOB,VEC1(1+NUA+NOAUA2),(JREC+3),96)
       YYY=DDOT(NOUP,VEC2(1),1,VEC1(1),1)
       HM(J,ITER)=YYY
 3    CONTINUE
C
C     --------- ITER-TH ROW OF HM (VEC1-R(ITER) -------------------
      CALL RDTAB1(NUA,VEC1(1),(IREC+1),96)
      CALL RDTAB3(NUA,NUA,NOA,VEC1(1+NUA),(IREC+2),96)
      CALL RDTAB3(NUA,NUB,NOB,VEC1(1+NUA+NOAUA2),(IREC+3),96)
      DO 4,J=1,ITER-1
       JREC=6*(J-1)
       CALL RDTAB1(NUA,VEC2(1),(JREC+4),96)
       CALL RDTAB3(NUA,NUA,NOA,VEC2(1+NUA),(JREC+5),96)
       CALL RDTAB3(NUA,NUB,NOB,VEC2(1+NUA+NOAUA2),(JREC+6),96)
       YYY=DDOT(NOUP,VEC2(1),1,VEC1(1),1)
       HM(ITER,J)=YYY
 4    CONTINUE
C
C     ---------- (ITER,ITER)-DIAGONAL PART OF HM --------------------
      CALL RDTAB1(NUA,VEC1(1),(IREC+1),96)
      CALL RDTAB3(NUA,NUA,NOA,VEC1(1+NUA),(IREC+2),96)
      CALL RDTAB3(NUA,NUB,NOB,VEC1(1+NUA+NOAUA2),(IREC+3),96)
      CALL RDTAB1(NUA,VEC2(1),(IREC+4),96)
      CALL RDTAB3(NUA,NUA,NOA,VEC2(1+NUA),(IREC+5),96)
      CALL RDTAB3(NUA,NUB,NOB,VEC2(1+NUA+NOAUA2),(IREC+6),96)
      YYY=DDOT(NOUP,VEC2(1),1,VEC1(1),1)
      HM(ITER,ITER)=YYY
C
      DO 11,I1=1,ISPACE
      DO 12,I2=1,ISPACE
       HMAUX(I1,I2)=HM(I1,I2)
 12   CONTINUE
 11   CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK EASELVEC
      SUBROUTINE EASELVEC(ISPACE,ITER,HM,WR,WI,VR,WORK,XENE)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /IOFILE/ IR,IW,IP,IJK,IJKT,IDAF,NAV,IODA(950)
      DIMENSION HM(ISPACE,ISPACE),VR(ISPACE,ISPACE)
      DIMENSION WR(ISPACE),WI(ISPACE),WORK(4*ISPACE)
      CHARACTER*1 JOBVL,JOBVR
      DATA BIGN/10000.0D+00/
C
      LWORK=4*ISPACE
      JOBVL='N'
      JOBVR='V'
      DO 10,I=ITER+1,ISPACE
       HM(I,I)=BIGN+DBLE(I)
 10   CONTINUE
C
      CALL DGEEV(JOBVL,JOBVR,ISPACE,HM,ISPACE,WR,WI,VL,ISPACE,
     *           VR,ISPACE,WORK,LWORK,INFO)
      IF(INFO.NE.0) THEN
       WRITE(IW,*) 'ERROR IN SOLVING SMALL EIGENVALUE PROBLEM:',INFO
       CALL FLSHBF(IW)
       CALL ABRT
       STOP
      END IF
C
      XTOL=1.0D-7
      JMAX=0
      XOVER=0.0D+00
      DO 1,I=1,ISPACE
       XXX=DABS(VR(1,I))
       YYY=DABS(WI(I))
       ZZZ=DABS(WR(I))
       IF((XXX.GT.XOVER).AND.(YYY.LT.XTOL).AND.(ZZZ.LT.BIGN)) THEN
        XOVER=XXX
        JMAX=I
       END IF
 1    CONTINUE
      XENE=WR(JMAX)
      DO 2,I=1,ISPACE
       WI(I)=VR(I,JMAX)
 2    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK EACOMB
      SUBROUTINE EACOMB(NOA,NUA,NOB,NUB,ISPACE,ITER,WI,VEC1,VEC2,
     *                  ISN,NOUP)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      DIMENSION WI(ISPACE),VEC1(1),VEC2(1)
      CALL ZEROMA(VEC1,1,NOUP)
      CALL ZEROMA(VEC2,1,NOUP)
      DO 1,I=1,ITER
       XCOMB=WI(I)
       IF(ISN.EQ.1) THEN
        JREC=6*(I-1)
        CALL RDTAB1(NUA,VEC2(1),(JREC+1),96)
        CALL RDTAB3(NUA,NUA,NOA,VEC2(1+NUA),(JREC+2),96)
        CALL RDTAB3(NUA,NUB,NOB,VEC2(1+NUA+NOAUA2),(JREC+3),96)
       ELSE
        JREC=6*(I-1)
        CALL RDTAB1(NUA,VEC2(1),(JREC+4),96)
        CALL RDTAB3(NUA,NUA,NOA,VEC2(1+NUA),(JREC+5),96)
        CALL RDTAB3(NUA,NUB,NOB,VEC2(1+NUA+NOAUA2),(JREC+6),96)
       END IF
       CALL DAXPY(NOUP,XCOMB,VEC2(1),1,VEC1(1),1)
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK EADEN
      SUBROUTINE EADEN(NOA,NUA,NOB,NUB,XENE,DHHA,DHHB,DPPA,DPPB,
     *                 R1,R2A,R2B)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION DHHA(NOA,NOA),DHHB(NOB,NOB)
      DIMENSION DPPA(NUA,NUA),DPPB(NUB,NUB)
      DIMENSION R1(NUA),R2A(NUA,NUA,NOA),R2B(NUA,NUB,NOB)
C
      DO 1,IA=1,NUA
       XDEN=XENE-DPPA(IA,IA)
       R1(IA)=R1(IA)/XDEN
 1    CONTINUE
C
      DO 3,J=1,NOA
      DO 4,IA=1,NUA
      DO 5,IB=1,NUA
       XDEN=XENE+DHHA(J,J)-DPPA(IA,IA)-DPPA(IB,IB)
       R2A(IA,IB,J)=R2A(IA,IB,J)/XDEN
 5    CONTINUE
 4    CONTINUE
 3    CONTINUE
C
      DO 13,J=1,NOB
      DO 14,IA=1,NUA
      DO 15,IB=1,NUB
       XDEN=XENE+DHHB(J,J)-DPPA(IA,IA)-DPPB(IB,IB)
       R2B(IA,IB,J)=R2B(IA,IB,J)/XDEN
 15   CONTINUE
 14   CONTINUE
 13   CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK NORMV
      SUBROUTINE NORMV(NOUP,RES,VEC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION VEC(NOUP)
      RES=0.0D+00
      DO 1,I=1,NOUP
       RES=RES+VEC(I)*VEC(I)
 1    CONTINUE
      RES=DSQRT(RES)
      RETURN
      END
C
C*MODULE EAIPCC  *DECK EAORTH
      SUBROUTINE EAORTH(NOA,NUA,NOB,NUB,NOUP,ITER,VEC,AUX)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      DIMENSION VEC(1),AUX(1)
C
      CALL DCOPY(NOUP,VEC,1,AUX,1)
      XNORM=DDOT(NOUP,VEC,1,AUX,1)
      XNORM=(1.0D+00)/(DSQRT(XNORM))
      CALL DSCAL(NOUP,XNORM,VEC,1)
      DO 1,I=1,ITER
       JREC=6*(I-1)
       CALL RDTAB1(NUA,AUX(1),(JREC+1),96)
       CALL RDTAB3(NUA,NUA,NOA,AUX(1+NUA),(JREC+2),96)
       CALL RDTAB3(NUA,NUB,NOB,AUX(1+NUA+NOAUA2),(JREC+3),96)
       YYY=-DDOT(NOUP,VEC,1,AUX,1)
       CALL DAXPY(NOUP,YYY,AUX,1,VEC,1)
 1    CONTINUE
C
      CALL ZEROMA(AUX,1,NOUP)
      CALL DCOPY(NOUP,VEC,1,AUX,1)
      XNORM=DDOT(NOUP,VEC,1,AUX,1)
      XNORM=(1.0D+00)/(DSQRT(XNORM))
      CALL DSCAL(NOUP,XNORM,VEC,1)
      RETURN
      END
C
C*MODULE EAIPCC  *DECK EA2NORM
      SUBROUTINE EA2NORM(NOA,NUA,NOB,NUB,R1,R2A,R2B)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      DIMENSION R1(NUA),R2A(NUA,NUA,NOA),R2B(NUA,NUB,NOB)
      DATA ONE/1.0D+00/
C
      XNORM=0.00D+00
      DO 1,IA=1,NUA
       YYY=R1(IA)
       XNORM=XNORM+YYY*YYY
 1    CONTINUE
C
      DO 2,J=1,NOA
      DO 3,IA=1,NUA
      DO 4,IB=IA+1,NUA
       YYY=R2A(IA,IB,J)
       XNORM=XNORM+YYY*YYY
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
C
      DO 5,J=1,NOB
      DO 6,IA=1,NUA
      DO 7,IB=1,NUB
       YYY=R2B(IA,IB,J)
       XNORM=XNORM+YYY*YYY
 7    CONTINUE
 6    CONTINUE
 5    CONTINUE
C
      XNORM=ONE/DSQRT(XNORM)
      CALL DSCAL(NUA,XNORM,R1,1)
      CALL DSCAL(NOAUA2,XNORM,R2A,1)
      CALL DSCAL(NOBUAB,XNORM,R2B,1)
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK EASYM
      SUBROUTINE EASYM(NOA,NUA,NOB,NUB,R1,R2A,R2B,SYM,NSYM,IGRSYM)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      CHARACTER*3 SYM,REP
      PARAMETER (MXAO=8192)
      COMMON /EOMSYM/ IG,NRE(4),MC(8,8,4),ISORB(MXAO),REP(8)
C
      DIMENSION IVEC1(8),IVEC2(8)
      DIMENSION R1(NUA),R2A(NUA,NUA,NOA),R2B(NUA,NUB,NOB)
C
      TOL=0.10D+00
      DO 100,I=1,8
       IVEC1(I)=0
       IVEC2(I)=0
 100  CONTINUE
      IFIND=0
      DO 1,IA=1,NUA
       YYY=DABS(R1(IA))
       IF(YYY.GT.TOL) THEN
       IFIND=0
        DO 2,K=1,NRE(IG)
         IVEC1(K)=MC(K,ISORB(NOA+IA),IG)*MC(K,IGRSYM,IG)
 2      CONTINUE
        DO 3,JSYM=1,NRE(IG)
        DO 4,III=1,NRE(IG)
         IVEC2(III)=MC(III,JSYM,IG)
 4      CONTINUE
        IDIFF=0
        DO 5,III=1,8
         IDIFF=IDIFF+ABS(IVEC1(III)-IVEC2(III))
 5      CONTINUE
        IF(IDIFF.EQ.0) THEN
         IFIND=1
         SYM=REP(JSYM)
         NSYM=JSYM
         RETURN
        END IF
 3      CONTINUE
       END IF
 1     CONTINUE
       IF(IFIND.NE.0) GO TO 111
       DO 10,I=1,NOA
       DO 11,IA=1,NUA
       DO 12,IB=1,NUA
        YYY=DABS(R2A(IA,IB,I))
        IF(YYY.GT.TOL) THEN
         DO 13,K=1,NRE(IG)
         IVEC1(K)=MC(K,ISORB(I),IG)*MC(K,ISORB(IA+NOA),IG)*
     &            MC(K,ISORB(IB+NOA),IG)*MC(K,IGRSYM,IG)
 13      CONTINUE
         DO 14,JSYM=1,NRE(IG)
         DO 15,III=1,NRE(IG)
          IVEC2(III)=MC(III,JSYM,IG)
 15      CONTINUE
         IDIFF=0
         DO 16,III=1,8
          IDIFF=IDIFF+ABS(IVEC1(III)-IVEC2(III))
 16      CONTINUE
         IF(IDIFF.EQ.0) THEN
          IFIND=1
          SYM=REP(JSYM)
          NSYM=JSYM
          RETURN
         END IF
 14      CONTINUE
        END IF
 12     CONTINUE
 11     CONTINUE
 10     CONTINUE
        IF(IFIND.NE.0) GO TO 111
       DO 20,I=1,NOB
       DO 21,IA=1,NUA
       DO 22,IB=1,NUB
        YYY=DABS(R2B(IA,IB,I))
        IF(YYY.GT.TOL) THEN
         DO 23,K=1,NRE(IG)
         IVEC1(K)=MC(K,ISORB(I),IG)*MC(K,ISORB(IA+NOA),IG)*
     &            MC(K,ISORB(IB+NOB),IG)*MC(K,IGRSYM,IG)
 23      CONTINUE
         DO 24,JSYM=1,NRE(IG)
         DO 25,III=1,NRE(IG)
          IVEC2(III)=MC(III,JSYM,IG)
 25      CONTINUE
         IDIFF=0
         DO 26,III=1,8
          IDIFF=IDIFF+ABS(IVEC1(III)-IVEC2(III))
 26      CONTINUE
         IF(IDIFF.EQ.0) THEN
          IFIND=1
          SYM=REP(JSYM)
          NSYM=JSYM
          RETURN
         END IF
 24      CONTINUE
        END IF
 22     CONTINUE
 21     CONTINUE
 20     CONTINUE
C
 111    CONTINUE
        RETURN
        END
C
C*MODULE EAIPCC  *DECK EASPIN
      SUBROUTINE EASPIN(NOA,NUA,NOB,NUB,R1,R2A,R2B,ISPIN)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      PARAMETER (MXAO=8192)
      COMMON /EOMPAR/ CVGCI,CVGEOM,GRPEOM,NSTEOM(8),NOACT,NUACT,
     *                MOACTCC(MXAO),MTHTRIP,MTHCI,MTHEOM,MTHINIT,
     *                MAXCI,MAXEOM,MICCI,MICEOM,IROOTCC(2),
     *                IPROPCC,IPROPCCE
      DIMENSION R1(NUA),R2A(NUA,NUA,NOA),R2B(NUA,NUB,NOB)
      DATA BIGN/10000.0D+00/
C
      TOL=10*CVGEOM
      ISPIN=0
C
      R1MAX=0.00D+00
      DO 1,IA=1,NUA
       YYY=DABS(R1(IA))
       IF(YYY.GT.R1MAX) THEN
        R1MAX=YYY
       END IF
 1    CONTINUE
      IF(R1MAX.GT.TOL) THEN
       ISPIN=2
       GO TO 100
      END IF
C
      RAPRV=BIGN
      RBPRV=BIGN
 101  CONTINUE
C
      R2MAX=0.00D+00
      JMAX=0
      IAMAX=0
      IBMAX=0
      DO 2,J=1,NOA
      DO 3,IA=1,NUA
      DO 4,IB=IA+1,NUA
       YYY=DABS(R2A(IA,IB,J))
       IF(YYY.GT.R2MAX.AND.YYY.LT.RAPRV) THEN
        R2MAX=YYY
        JMAX=J
        IAMAX=IA
        IBMAX=IB
       END IF
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
C
      R2B1=DABS(R2B(IAMAX,IBMAX,JMAX))
      R2B2=DABS(R2B(IBMAX,IAMAX,JMAX))
      DIFF1=DABS((2.00D+00*R2B1)-R2MAX)
      DIFF2=DABS((2.00D+00*R2B2)-R2MAX)
      IF(DIFF1.LT.TOL.AND.DIFF2.LT.TOL) THEN
       ISPIN=2
       GO TO 100
      END IF
      DIFF1=DABS(R2B1-R2MAX)
      DIFF2=DABS(R2B2-R2MAX)
      IF(DIFF1.LT.TOL.AND.DIFF2.LT.TOL) THEN
       ISPIN=4
       GO TO 100
      END IF
C
      RAPRV=R2MAX
C
      R2MAX=0.00D+00
      IAMAX=0
      IBMAX=0
      JMAX=0
      DO 5,J=1,NOB
      DO 6,IA=1,NUA
      DO 7,IB=1,NUB
       YYY=DABS(R2B(IA,IB,J))
       IF(YYY.GT.R2MAX.AND.YYY.LT.RBPRV) THEN
        R2MAX=YYY
        JMAX=J
        IAMAX=IA
        IBMAX=IB
       END IF
 7    CONTINUE
 6    CONTINUE
 5    CONTINUE
C
      IF(IAMAX.EQ.IBMAX) THEN
       ISPIN=2
       GO TO 100
      END IF
C
      R2B2=DABS(R2B(IBMAX,IAMAX,JMAX))
      DIFF=DABS(R2B2-R2MAX)
      IF(DIFF.LT.TOL) THEN
       ISPIN=2
       GO TO 100
      END IF
C
      RBPRV=R2MAX
      IF(RAPRV.GT.1.0D-4.AND.RBPRV.GT.1.0D-4) GO TO 101
C
 100  CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK EA3ASOLSR
      SUBROUTINE EA3ASOLSR(BESTEOM,NOA,NUA,NOB,NUB,DPPA,DPPB,DHHA,DHHB,
     *                     FPPA,FPPB,FHPA,FHPB,FHHA,FHHB,VHPPP1,
     *                     VHPPP2,VHPPP3,TI,VPPP,VHPHP1,VHPHP2,VHPHP3,
     *                     VHPHP4,VHPHP5,VHPHP6,VHHHP1,VHHHP2,VHHHH,
     *                     T2,T2B,OHA,OPPPA,OPPPB,OHHPA,OHHPB,OHHPB2,
     *                     OHPP,OHPPB,VEC1,VEC2,R3,HR3,HM,HMAUX,WR,WI,
     *                     VR,WORK,AUX,ENGMAT,SYM,ISPIN,ICON,NROOT)
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
C
      LOGICAL CNVR
C
      CHARACTER*3 SYM,REP
      CHARACTER*1 SMALLT
C
      PARAMETER (MXAO=8192)
C
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /CCENGY/ ENRG,EREF,EMP2,ECCN,ETOT(6),ECORR(6),
     *                DIAGS(3),AMPMX(5,2),IAMPMX(5,4,2),XO1,XO2,
     *                DIFMAX,DIFFENG,ITER,CNVR
      COMMON /IOFILE/ IR,IW,IP,IJK,IJKT,IDAF,NAV,IODA(950)
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EOMPAR/ CVGCI,CVGEOM,GRPEOM,NSTEOM(8),NOACT,NUACT,
     *                MOACTCC(MXAO),MTHTRIP,MTHCI,MTHEOM,MTHINIT,
     *                MAXCI,MAXEOM,MICCI,MICEOM,IROOTCC(2),
     *                IPROPCC,IPROPCCE
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /EOMSYM/ IG,NRE(4),MC(8,8,4),ISORB(MXAO),REP(8)
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      COMMON /EAREST/ MREST(500)
C
      DIMENSION FPPA(1),FPPB(1),FHPA(1),FHPB(1),FHHA(1),FHHB(1)
      DIMENSION VHPPP1(1),VHPPP2(1),VHPPP3(1),VPPP(1),T2(1)
      DIMENSION VHPHP1(1),VHPHP2(1),VHPHP3(1),VHPHP4(1),TI(1)
      DIMENSION VHHHP1(1),VHHHP2(1),VHHHH(1),VHPHP5(1)
      DIMENSION OPPPA(1),OPPPB(1),OHPP(1)
      DIMENSION OHHPA(1),OHHPB(1),OHHPB2(1),OHA(1)
      DIMENSION VEC1(1),VEC2(1),HM(1),HMAUX(1),AUX(1)
      DIMENSION R3(1),HR3(1),T2B(1)
      DIMENSION WR(1),WI(1),VR(1),WORK(1)
      DIMENSION DPPA(NUA,NUA),DPPB(NUB,NUB)
      DIMENSION DHHA(NOA,NOA),DHHB(NOB,NOB)
      DIMENSION ENGMAT(NROOT),SYM(NROOT),ISPIN(NROOT),ICON(NROOT)
      DIMENSION JSTATE(9)
C
      DATA ONE/1.00D+00/
C
      SMALLT=CHAR(116)
      TOL=CVGEOM
C
      ISPACE=MAXEOM
      ISPACE2=ISPACE*ISPACE
      NOUP=NUA+NOAUA2+NOBUAB
      LREC1=NACTA
      LREC2=LREC1+NACTA
      LREC3=LREC2+NACTB
      LREC4=LREC3+NACTA
      IHREC=LREC4+NACTB
      NOABUA2=NOABUA*NUA
      NOB2UAB=NOB2UA*NUB
C
      CALL ZEROMA(ENGMAT,1,NROOT)
      CALL VICLR(ICON,1,NROOT)
C
      CALL RDTAB2(NUA,NUA,DPPA,1,NFT891)
      CALL RDTAB2(NUB,NUB,DPPB,2,NFT891)
      CALL RDTAB2(NOA,NOA,DHHA,3,NFT891)
      CALL RDTAB2(NOB,NOB,DHHB,4,NFT891)
C
      CALL VICLR(JSTATE,1,9)
      JSTATE(1)=MULEAIP
      WRITE(NFT825,REC=6)JSTATE
C
      CALL V4PBAMK(NUA,NUB,VPPP,OPPPA)
C
      DO 1,IROOT=1,NROOT
      WRITE(IW,301) SMALLT,IROOT
      CALL FLSHBF(IW)
      CALL ZEROMA(HM,1,ISPACE2)
      CALL ZEROMA(HMAUX,1,ISPACE2)
      CALL ZEROMA(VEC1,1,NOUP)
      CALL ZEROMA(VEC2,1,NOUP)
      CALL REAINIT(IROOT,NOUP,VEC1)
C
      CALL DCOPY(NOUP,VEC1,1,VEC2,1)
      XNORM=DDOT(NOUP,VEC1,1,VEC2,1)
      JROOT=((6*NACTA)+(4*NACTB)+3)*(IROOT-1)
      JROOT=JROOT+6
      JROOT3=JROOT+3
      IF(MREST(IROOT).EQ.1) THEN
      DO 10,IA=1,NACTB
       IF(IA.LE.NACTA) THEN
C*********** JRG 12 APR 2010: THE ONLY CHANGE IS NFT825 --> 99 *******
       CALL RDTAB(NOA,NUA,NUA,NOA,R3,(JROOT3+IA),99)
       CALL DCOPY(NOA2UA2,R3,1,HR3,1)
       YYY=DDOT(NOA2UA2,R3,1,HR3,1)
       XNORM=XNORM+YYY
       CALL RDTAB(NOA,NUA,NUB,NOB,R3,(JROOT3+LREC1+IA),99)
       CALL DCOPY(NO2U2AB,R3,1,HR3,1)
       YYY=DDOT(NO2U2AB,R3,1,HR3,1)
       XNORM=XNORM+YYY
       CALL RDTAB(NOB,NUB,NUB,NOB,R3,(JROOT3+LREC3+IA),99)
       CALL DCOPY(NOB2UB2,R3,1,HR3,1)
       YYY=DDOT(NOB2UB2,R3,1,HR3,1)
       XNORM=XNORM+YYY
       END IF
       CALL RDTAB(NOA,NUA,NUA,NOB,R3,(JROOT3+LREC2+IA),99)
       CALL DCOPY(NOABUA2,R3,1,HR3,1)
       YYY=DDOT(NOABUA2,R3,1,HR3,1)
       XNORM=XNORM+YYY
       CALL RDTAB(NOB,NOB,NUB,NUA,R3,(JROOT3+LREC4+IA),99)
       CALL DCOPY(NOB2UAB,R3,1,HR3,1)
       YYY=DDOT(NOB2UAB,R3,1,HR3,1)
       XNORM=XNORM+YYY
 10   CONTINUE
      XNORM=ONE/DSQRT(XNORM)
      CALL DSCAL(NOUP,XNORM,VEC1(1),1)
      CALL WRTAB1(NUA,VEC1(1),1,96)
      CALL WRTAB3(NUA,NUA,NOA,VEC1(1+NUA),2,96)
      CALL WRTAB3(NUA,NUB,NOB,VEC1(1+NUA+NOAUA2),3,96)
      DO 11,IA=1,NACTB
       IF(IA.LE.NACTA) THEN
       CALL RDTAB(NOA,NUA,NUA,NOA,R3,(JROOT3+IA),99)
       CALL DSCAL(NOA2UA2,XNORM,R3,1)
       CALL WRTAB(NOA,NUA,NUA,NOA,R3,IA,98)
       CALL RDTAB(NOA,NUA,NUB,NOB,R3,(JROOT3+LREC1+IA),99)
       CALL DSCAL(NO2U2AB,XNORM,R3,1)
       CALL WRTAB(NOA,NUA,NUB,NOB,R3,(LREC1+IA),98)
       CALL RDTAB(NOB,NUB,NUB,NOB,R3,(JROOT3+LREC3+IA),99)
       CALL DSCAL(NOB2UB2,XNORM,R3,1)
       CALL WRTAB(NOB,NUB,NUB,NOB,R3,(LREC3+IA),98)
       END IF
       CALL RDTAB(NOA,NUA,NUA,NOB,R3,(JROOT3+LREC2+IA),99)
       CALL DSCAL(NOABUA2,XNORM,R3,1)
       CALL WRTAB(NOA,NUA,NUA,NOB,R3,(LREC2+IA),98)
       CALL RDTAB(NOB,NOB,NUB,NUA,R3,(JROOT3+LREC4+IA),99)
       CALL DSCAL(NOB2UAB,XNORM,R3,1)
       CALL WRTAB(NOB,NOB,NUB,NUA,R3,(LREC4+IA),98)
C**************** JRG 12 APR 2010: END OF NFT825 --> 99 CHANGE *****
 11   CONTINUE
      ELSE
      XNORM=ONE/DSQRT(XNORM)
      CALL DSCAL(NOUP,XNORM,VEC1(1),1)
      CALL WRTAB1(NUA,VEC1(1),1,96)
      CALL WRTAB3(NUA,NUA,NOA,VEC1(1+NUA),2,96)
      CALL WRTAB3(NUA,NUB,NOB,VEC1(1+NUA+NOAUA2),3,96)
      CALL ZEROMA(R3,1,NO2U2)
      DO 20,IA=1,NACTA
       IF(IA.LE.NACTA) THEN
       CALL WRTAB(NOA,NUA,NUA,NOA,R3,IA,98)
       CALL WRTAB(NOA,NUA,NUB,NOB,R3,(LREC1+IA),98)
       CALL WRTAB(NOB,NUB,NUB,NOB,R3,(LREC3+IA),98)
       END IF
       CALL WRTAB(NOA,NUA,NUA,NOB,R3,(LREC2+IA),98)
       CALL WRTAB(NOB,NOB,NUB,NUA,R3,(LREC4+IA),98)
 20   CONTINUE
      END IF
C
      DO 2,ITER=1,MAXEOM
C
C     ---------- GENERATING HR (R TAKEN FROM ITSPACE) -------------
      IREC=6*(ITER-1)
      I3REC=((6*NACTA)+(4*NACTB))*(ITER-1)
      CALL RDTAB1(NUA,VEC1(1),(IREC+1),96)
      CALL RDTAB3(NUA,NUA,NOA,VEC1(1+NUA),(IREC+2),96)
      CALL RDTAB3(NUA,NUB,NOB,VEC1(1+NUA+NOAUA2),(IREC+3),96)
      CALL HR2P1H(NOA,NUA,NOB,NUB,VEC1(1),VEC2(1),VEC1(1+NUA),
     *            VEC1(1+NUA+NOAUA2),VEC2(1+NUA),VEC2(1+NUA+NOAUA2),
     *            FPPA,FHPA,FHHA,VHPPP1,VPPP,VHPHP1,T2,OHA,TI)
      CALL RDTAB1(NUA,VEC1(1),(IREC+1),96)
      CALL RDTAB3(NUA,NUA,NOA,VEC1(1+NUA),(IREC+2),96)
      CALL RDTAB3(NUA,NUB,NOB,VEC1(1+NUA+NOAUA2),(IREC+3),96)
      CALL HR3P2HA(NOA,NUA,NOB,NUB,VEC1(1),VEC2(1),VEC1(1+NUA),
     *            VEC1(1+NUA+NOAUA2),VEC2(1+NUA),VEC2(1+NUA+NOAUA2),
     *            R3,HR3,FPPA,FPPB,FHPA,FHPB,FHHA,FHHB,VHPPP1,VHPPP2,
     *            VHPPP3,VPPP,VHPHP1,VHPHP2,VHPHP3,VHPHP4,VHPHP5,
     *            VHPHP6,VHHHP1,VHHHP2,VHHHH,T2,T2B,OPPPA,OPPPB,
     *            OHHPA,OHHPB,OHHPB2,OHPP,OHPPB,TI,I3REC)
C
      CALL ZEROMA(VEC1(1+NUA),1,NOU2)
      CALL ASYMEA2(VEC2(1+NUA),NOA,NUA,VEC1(1+NUA))
      CALL WRTAB1(NUA,VEC2(1),(IREC+4),96)
      CALL WRTAB3(NUA,NUA,NOA,VEC2(1+NUA),(IREC+5),96)
      CALL WRTAB3(NUA,NUB,NOB,VEC2(1+NUA+NOAUA2),(IREC+6),96)
C     ------------------ FORMING SMALL MATRIX -------------------
      CALL EASMLMAA(NOA,NUA,NOB,NUB,ISPACE,ITER,HM,HMAUX,
     *              VEC1,VEC2,R3,HR3,NOUP,IREC,I3REC)
C
C     ------------- PICKING UP THE BEST EIGENVECTOR ------------
      CALL EASELVEC(ISPACE,ITER,HM,WR,WI,VR,WORK,XENE)
C
C     ---- FORMING OPTIMUM COMBINATION OF VECTORS FROM ITSPACE ON VEC1 ----
      ISN=1   !READING FROM ITSPACE
      CALL EACOMB(NOA,NUA,NOB,NUB,ISPACE,ITER,WI,VEC1,VEC2,ISN,NOUP)
      JROOT=((6*NACTA)+(4*NACTB)+3)*(IROOT-1)
      JROOT=JROOT+6
      JROOT3=JROOT+3
      CALL WRTAB1(NUA,VEC1(1),(JROOT+1),NFT825)
      CALL WRTAB3(NUA,NUA,NOA,VEC1(1+NUA),(JROOT+2),NFT825)
      CALL WRTAB3(NUA,NUB,NOB,VEC1(1+NUA+NOAUA2),(JROOT+3),NFT825)
      IF(ITER.EQ.1) THEN
       CALL FIXGRSYM(NOA,NOB,IGRSYM)
       CALL EASYM(NOA,NUA,NOB,NUB,VEC1(1),VEC1(1+NUA),
     *            VEC1(1+NUA+NOAUA2),SYM(IROOT),NSYM,IGRSYM)
       JSTATE(NSYM+1)=JSTATE(NSYM+1)+1
       WRITE(NFT825,REC=6)JSTATE
      END IF
C
C     ---- FORMING OPTIMAL COMBINATION OF VECTORS FROM HR ON VEC2 ------
      ISN=2   !READING FROM HR
      CALL EACOMB(NOA,NUA,NOB,NUB,ISPACE,ITER,WI,VEC2,AUX,ISN,NOUP)
C
C     ---------------- FORMING THE CORRECTION ON AUX ------------------
      CALL ZEROMA(AUX,1,NOUP)
      CALL DCOPY(NOUP,VEC2(1),1,AUX(1),1)
      CALL DAXPY(NOUP,-XENE,VEC1(1),1,AUX(1),1)
      INTREC=((6*NACTA)+(4*NACTB))*ITER
      CALL EACOMBA(NOA,NOB,NUA,NUB,ISPACE,ITER,INTREC,JROOT3,
     *             XENE,WI,R3,HR3,T2)
      CALL EADENA(NOA,NUA,NOB,NUB,XENE,DHHA,DHHB,DPPA,DPPB,
     *           AUX(1),AUX(1+NUA),AUX(1+NUA+NOAUA2),R3,INTREC)
C
C     ------------------ CONVERGENCE TEST ---------------------
      CALL NORMVA(NOA,NOB,NUA,NUB,NOUP,RES,AUX(1),R3,HR3,INTREC)
      WRITE(IW,300) ITER,XENE,RES
      CALL FLSHBF(IW)
      IF(RES.LT.TOL) GO TO 1000
C
C     ----------- ORTHONORMALIZATION OF THE CORRECTION ------------
      CALL EAORTHA(NOA,NUA,NOB,NUB,NOUP,ITER,INTREC,
     *             AUX,VEC1,R3,HR3)
C
C
C     -------- WRITING THE CORRECTION TO RECORD NO. ITER+1 ---------
      JREC=6*ITER
      CALL WRTAB1(NUA,AUX(1),(JREC+1),96)
      CALL WRTAB3(NUA,NUA,NOA,AUX(1+NUA),(JREC+2),96)
      CALL WRTAB3(NUA,NUB,NOB,AUX(1+NUA+NOAUA2),(JREC+3),96)
C
 2    CONTINUE
C
C     --------------- LACK OF CONVERGENCE ---------------
      WRITE(IW,302) SMALLT,IROOT
      CALL RDTAB1(NUA,VEC1(1),(JROOT+1),NFT825)
      CALL RDTAB3(NUA,NUA,NOA,VEC1(1+NUA),(JROOT+2),NFT825)
      CALL RDTAB3(NUA,NUB,NOB,VEC1(1+NUA+NOAUA2),(JROOT+3),NFT825)
      CALL EA3NORMA(NOA,NUA,NOB,NUB,JROOT3,VEC1(1),VEC1(1+NUA),
     *              VEC1(1+NUA+NOAUA2),R3)
      CALL FIXGRSYM(NOA,NOB,IGRSYM)
      CALL EASYM(NOA,NUA,NOB,NUB,VEC1(1),VEC1(1+NUA),
     *           VEC1(1+NUA+NOAUA2),SYM(IROOT),NSYM,IGRSYM)
      IF(NOA.EQ.NOB) THEN
       CALL EASPIN(NOA,NUA,NOB,NUB,VEC1(1),VEC1(1+NUA),
     *             VEC1(1+NUA+NOAUA2),ISPIN(IROOT))
      END IF
      ENGMAT(IROOT)=XENE
      CALL WRTAB1(NUA,VEC1(1),(JROOT+1),NFT825)
      CALL WRTAB3(NUA,NUA,NOA,VEC1(1+NUA),(JROOT+2),NFT825)
      CALL WRTAB3(NUA,NUB,NOB,VEC1(1+NUA+NOAUA2),(JROOT+3),NFT825)
      GO TO 1
C
C     ----------------- CONVERGENCE ---------------------
 1000 CONTINUE
      WRITE(IW,303) SMALLT,IROOT
      WRITE(IW,304) SMALLT,XENE
      ICON(IROOT)=1
      CALL RDTAB1(NUA,VEC1(1),(JROOT+1),NFT825)
      CALL RDTAB3(NUA,NUA,NOA,VEC1(1+NUA),(JROOT+2),NFT825)
      CALL RDTAB3(NUA,NUB,NOB,VEC1(1+NUA+NOAUA2),(JROOT+3),NFT825)
      CALL EA3NORMA(NOA,NUA,NOB,NUB,JROOT3,VEC1(1),VEC1(1+NUA),
     *              VEC1(1+NUA+NOAUA2),R3)
      CALL FIXGRSYM(NOA,NOB,IGRSYM)
      CALL EASYM(NOA,NUA,NOB,NUB,VEC1(1),VEC1(1+NUA),
     *           VEC1(1+NUA+NOAUA2),SYM(IROOT),NSYM,IGRSYM)
      CALL PRNTR1(NOA,NUA,VEC1(1))
      CALL PRNTR2A(NOA,NUA,VEC1(1+NUA))
      CALL PRNTR2B(NOA,NUA,NOB,NUB,VEC1(1+NUA+NOAUA2))
      CALL PRNTR3AA(NOA,NUA,JROOT3,R3)
      CALL PRNTR3BB(NOA,NOB,NUA,NUB,JROOT3,R3,HR3)
      CALL PRNTR3AB(NOA,NOB,NUA,NUB,JROOT3,R3,HR3)
C
      IF(NOA.EQ.NOB) THEN
       CALL EASPIN(NOA,NUA,NOB,NUB,VEC1(1),VEC1(1+NUA),
     *             VEC1(1+NUA+NOAUA2),ISPIN(IROOT))
       WRITE(IW,315) SMALLT,IROOT,SYM(IROOT),ISPIN(IROOT),
     *               SMALLT,ENRG+EREF+XENE,XENE
       CALL FLSHBF(IW)
      ELSE
       WRITE(IW,305) SMALLT,IROOT,SYM(IROOT),
     *               SMALLT,ENRG+EREF+XENE,XENE
       CALL FLSHBF(IW)
      END IF
      ENGMAT(IROOT)=XENE
      CALL WRTAB1(NUA,VEC1(1),(JROOT+1),NFT825)
      CALL WRTAB3(NUA,NUA,NOA,VEC1(1+NUA),(JROOT+2),NFT825)
      CALL WRTAB3(NUA,NUB,NOB,VEC1(1+NUA+NOAUA2),(JROOT+3),NFT825)
C
C           print converged (or unconverged) results
C
 1    CONTINUE
      ICHECK=0
      NRTIRRP=0
C
      IF(NOA.EQ.NOB) THEN
         WRITE(IW,316) SMALLT
         DO I=1,NROOT
           IF(SYM(I).EQ.REP(IROOTCC(1))) THEN
             NRTIRRP = NRTIRRP+1
             IF(NRTIRRP.EQ.IROOTCC(2)) BESTEOM = ENRG+EREF+ENGMAT(I)
           END IF
           IF(ICON(I).EQ.1) THEN
             WRITE(IW,317) SYM(I),ISPIN(I),ENGMAT(I),ENRG+EREF+ENGMAT(I)
           ELSE
             WRITE(IW,318) SYM(I),ISPIN(I),ENGMAT(I),ENRG+EREF+ENGMAT(I)
             ICHECK=ICHECK+1
           END IF
         ENDDO
      ELSE
         WRITE(IW,306) SMALLT
         DO I=1,NROOT
           IF(SYM(I).EQ.REP(IROOTCC(1))) THEN
             NRTIRRP = NRTIRRP+1
             IF(NRTIRRP.EQ.IROOTCC(2)) BESTEOM = ENRG+EREF+ENGMAT(I)
           END IF
           IF(ICON(I).EQ.1) THEN
             WRITE(IW,307) SYM(I),ENGMAT(I),ENRG+EREF+ENGMAT(I)
           ELSE
             WRITE(IW,308) SYM(I),ENGMAT(I),ENRG+EREF+ENGMAT(I)
             ICHECK=ICHECK+1
           END IF
         ENDDO
      END IF
      WRITE(IW,309) IROOTCC,BESTEOM
C
      IF(ICHECK.GT.0) THEN
        WRITE(IW,310) SMALLT,ICHECK
        CALL ABRT
        STOP
      END IF
      RETURN
C
 300  FORMAT(1X,'ITERATION:',1X,I3,2X,'EA ENERGY=',1X,F14.10,2X,'CONV:',
     *       1X,F14.9)
 301  FORMAT(/6X,'BEGINNING EA-EOMCCSD',A,' ITERATIONS FOR ROOT NO.',
     *       1X,I3)
 302  FORMAT(/2X,'THE EA-EOMCCSD',A,' ITERATIONS FOR ROOT NO.',1X,I3,
     *       1X,'DID NOT CONVERGE',/)
 303  FORMAT(/2X,'THE EA-EOMCCSD',A,' ITERATIONS FOR ROOT NO.',1X,I3,
     *       1X,'HAVE CONVERGED')
 304  FORMAT(2X,'EA-EOMCCSD',A,' ELECTRON-ATTACHMENT ENERGY:',
     *       1X,F15.10,/)
 305  FORMAT(/8X,'SUMMARY OF EA-EOMCCSD',A,' RESULTS FOR ROOT NO.',
     *       1X,I3,/18X,'THE SYMMETRY OF THE STATE IS',A4,/
     *       1X,'EA-EOMCCSD',A,' E=',F20.10,
     *       2X,'ATTACH E=',F15.10,/)
 306  FORMAT(/7X,'---- SUMMARY OF EA-EOMCCSD',A,' CALCULATIONS ----',/
     *        15X,'ELECTRON',/
     *        14X,'ATTACHMENT',13X,'TOTAL',/
     *        1X,'SYMMETRY',5X,'ENERGY (H)',11X,'ENERGY (H)',9X,
     *        'ITERATIONS')
 307  FORMAT(3X,A4,3X,F15.10,2X,F20.10,7X,'CONVERGED')
 308  FORMAT(3X,A4,3X,F15.10,2X,F20.10,7X,'UNCONVERGED')
 309  FORMAT(/1X,'SELECTING TARGET STATE IROOT=',2I3,
     *           ' AS BEST EA ENERGY',F20.10)
 310  FORMAT(2X,'EA-EOMCCSD',A,' HALTED WITHOUT CONVERGING ALL',
     *        1X,'DESIRED STATES'/
     *        2X,I3,1X,'STATES UNCONVERGED',/)
 315  FORMAT(/8X,'SUMMARY OF EA-EOMCCSD',A,' RESULTS FOR ROOT NO.',
     *       1X,I3,/18X,'THE SYMMETRY OF THE STATE IS',A4,/
     *       14X,'THE SPIN MULTIPLICITY OF THE STATE IS',I2,/
     *       1X,'EA-EOMCCSD',A,' E=',F20.10,
     *       2X,'ATTACH E=',F15.10,/)
 316  FORMAT(/9X,'---- SUMMARY OF EA-EOMCCSD',A,' CALCULATIONS ----',/
     *        20X,'ELECTRON',/
     *        9X,'SPIN',6X,'ATTACHMENT',13X,'TOTAL',/
     *        2X,'SYMM',3X,'MULT',6X,'ENERGY (H)',11X,'ENERGY (H)',7X,
     *        'ITERATIONS')
 317  FORMAT(2X,A4,3X,I2,4X,F15.10,2X,F20.10,5X,'CONVERGED')
 318  FORMAT(2X,A4,3X,I2,4X,F15.10,2X,F20.10,5X,'UNCONVERGED')
      END
C
C*MODULE EAIPCC  *DECK HR3P2HA
      SUBROUTINE HR3P2HA(NOA,NUA,NOB,NUB,R1,HR1,R2A,R2B,HR2A,HR2B,
     *                  R3,HR3,FPPA,FPPB,FHPA,FHPB,FHHA,FHHB,VHPPP1,
     *                  VHPPP2,VHPPP3,VPPP,VHPHP1,VHPHP2,VHPHP3,
     *                  VHPHP4,VHPHP5,VHPHP6,VHHHP1,VHHHP2,VHHHH,T2,
     *                  T2B,OPPPA,OPPPB,OHHPA,OHHPB,OHHPB2,OHPP,
     *                  OHPPB,TI,I3REC)
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
C
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
      DATA TWO/2.0D+00/, HALF/0.5D+00/
      DATA QUART/0.25D+00/,EIGHTH/0.125D+00/
C
      DIMENSION R1(1),HR1(1),R2A(1),R2B(1),HR2A(1),HR2B(1)
      DIMENSION R3(1),HR3(1)
      DIMENSION FPPA(1),FPPB(1),FHPA(1),FHPB(1)
      DIMENSION VHPPP1(1),VHPPP2(1),VHPPP3(1)
      DIMENSION VPPP(1),VHPHP1(1),VHPHP2(1),VHPHP3(1),T2(1),TI(1)
      DIMENSION VHHHP1(1),VHHHP2(1),VHHHH(1)
      DIMENSION OPPPA(1),OPPPB(1),OHHPA(1),OHHPB(1),OHHPB2(1)
      DIMENSION VHPHP4(1),OHPP(1)
C
      INTREC=I3REC+((6*NACTA)+(4*NACTB))
      CALL ZEROMA(VHPHP1,1,NO2U2)
      CALL ZEROMA(OHHPA,1,NO2U)
      CALL ZEROMA(OPPPA,1,NU3)
      CALL ZEROMA(OHHPB,1,NO2U)
      CALL ZEROMA(OPPPB,1,NU3)
C
      CALL RDTAB(NUA,NOA,NUA,NOA,VHPHP1,1,NFT892)
      CALL RDTAB(NOA,NUA,NUA,NUA,VHPPP1,11,NFT892)
      CALL RDTAB(NOA,NOA,NOA,NUA,VHHHP1,14,NFT891)
      CALL RDTAB(NOA,NOB,NOA,NUB,VHHHP2,16,NFT891)
      CALL TRAN24(NOA,NUA,NUA,NUA,TI,VHPPP1)
      CALL CCMATMUL(VHPPP1,R2A,OHHPA,NOAUA,NOA,NUA2,1,1)
      CALL VECMUL(OHHPA,NOA2UA,HALF)
      CALL TRANSQ(VHPHP1,NOAUA)
      CALL CCMATMUL(R1,VHPHP1,OHHPA,1,NOA2UA,NUA,0,0)
      CALL TRT1(NOA,NOAUA,TI,OHHPA)
      CALL TRAN14(NOA,NOA,NOA,NUA,TI,VHHHP1)
      CALL CCMATMUL(R2A,VHHHP1,OHHPA,NUA,NOA2,NOAUA,0,0)
      CALL TRAN14(NOA,NOB,NOA,NUB,TI,VHHHP2)
      CALL CCMATMUL(R2B,VHHHP2,OHHPA,NUA,NOA2,NOBUB,0,0)
      CALL INSITU(NUA,NOA,NOA,1,TI,OHHPA,13)
C
      CALL ZEROMA(VHPHP1,1,NO2U2)
      CALL ZEROMA(VHPPP2,1,NOU3)
      CALL ZEROMA(VHHHP1,1,NO3U)
      CALL ZEROMA(VHHHP2,1,NO3U)
      CALL RDTAB(NUA,NOB,NUA,NOB,VHPHP1,4,NFT892)
      CALL RDTAB(NOA,NUB,NUA,NUB,VHPPP2,13,NFT892)
      CALL RDTAB(NOB,NOB,NOB,NUB,VHHHP1,15,NFT891)
      CALL RDTAB(NOA,NOB,NUA,NOB,VHHHP2,17,NFT891)
      CALL TRANSQ(VHPHP1,NOBUA)
      CALL CCMATMUL(R1,VHPHP1,OHHPB,1,NOB2UA,NUA,1,0)
      CALL TRAN24(NUA,NUB,NUA,NOB,TI,VHPPP2)
      CALL INSITU(NOB,NUA,NOB,1,TI,OHHPB,12)
      CALL CCMATMUL(VHPPP2,R2B,OHHPB,NOBUA,NOB,NUAB,0,0)
      CALL INSITU(NOA,NOB,NUA,NOB,TI,VHHHP2,23)
      CALL INSITU(NOA,NUA,NOB,NOB,TI,VHHHP2,12)
      CALL CCMATMUL(R2A,VHHHP2,OHHPB,NUA,NOB2,NOAUA,0,0)
      CALL TRANMD(OHHPB,NUA,NOB,NOB,1,23)
      CALL TRAN14(NOB,NOB,NOB,NUB,TI,VHHHP1)
      CALL CCMATMUL(R2B,VHHHP1,OHHPB,NUA,NOB2,NOBUB,0,0)
C
      CALL TRAN14(NUA,NOB,NUA,NUB,TI,VHPPP2)
      CALL CCMATMUL(R2B,VHPPP2,OPPPA,NUA,NUA2,NOBUB,1,0)
      CALL TRT1(NUA,NUA2,TI,OPPPA)
      CALL INSITU(NOA,NUA,NUA,NUA,TI,VHPPP1,13)
      CALL INSITU(NUA,NUA,NOA,1,TI,R2A,13)
      CALL CCMATMUL(VHPPP1,R2A,OPPPA,NUA2,NUA,NOAUA,0,1)
      CALL ASYMOP(NUA,OPPPA,TI)
C
      CALL ZEROMA(VHPPP1,1,NOU3)
      CALL RDTAB(NOA,NUB,NUA,NUB,VHPPP1,14,NFT892)
      CALL TRAN14(NOA,NUB,NUA,NUB,TI,VHPPP1)
      CALL INSITU(NOA,NUA,NUA,1,TI,R2A,12)
      CALL CCMATMUL(VHPPP1,R2A,OPPPB,NUB2,NUA,NOAUA,1,0)
      CALL INSITU(NUB,NUB,NUA,1,TI,OPPPB,13)
      CALL TRAN24(NUB,NUB,NUA,NOA,TI,VHPPP1)
      CALL CCMATMUL(VHPPP1,R2B,OHHPB2,NOAUB,NOB,NUAB,1,1)
      CALL ZEROMA(VHPPP1,1,NOU3)
      CALL RDTAB(NOB,NUB,NUB,NUB,VHPPP1,12,NFT892)
      CALL INSITU(NUA,NUB,NOB,1,TI,R2B,23)
      CALL CCMATMUL(R2B,VHPPP1,OPPPB,NUA,NUB2,NOBUB,0,1)
      CALL TRT1(NOBUAB,NUA,TI,VHPPP2)
      CALL INSITU(NUA,NOB,NUB,1,TI,R2B,12)
      CALL CCMATMUL(VHPPP2,R2B,OPPPB,NUAB,NUB,NOBUA,0,1)
C
      CALL ZEROMA(VHPHP1,1,NO2U2)
      CALL ZEROMA(VHHHP1,1,NO3U)
      CALL RDTAB(NUB,NOB,NUA,NOA,VHPHP1,6,NFT892)
      CALL RDTAB(NOA,NOB,NUA,NOB,VHHHP1,17,NFT891)
      CALL TRT1(NOABUA,NOB,TI,VHHHP1)
      CALL TRAN34N(NUB,NOB,NUA,NOA,TI,VHPHP1)
      CALL INSITU(NUB,NOA,NOB,1,TI,OHHPB2,23)
      CALL CCMATMUL(VHPHP1,R1,OHHPB2,NOABUB,1,NUA,0,0)
      CALL TRT1(NUB,NOAB,TI,OHHPB2)
      CALL CCMATMUL(VHHHP1,R2B,OHHPB2,NOAB,NUB,NOBUA,0,0)
      CALL INSITU(NOB,NOA,NUB,1,TI,OHHPB2,12)
C
      CALL RDTAB2(NOA,NUA,FHPA,5,NFT891)
      CALL RDTAB2(NOB,NUB,FHPB,6,NFT891)
      CALL RDTAB(NOA,NOA,NOA,NUA,VHHHP1,14,NFT891)
      CALL RDTAB(NOA,NOB,NOA,NUB,VHHHP2,16,NFT891)
      CALL RDTAB(NOA,NOB,NUA,NOB,VHPHP6,17,NFT891)
      CALL RDTAB(NOA,NUA,NUA,NUA,VHPPP1,11,NFT892)
      CALL RDTAB(NUA,NUB,NUA,NOB,VHPPP2,13,NFT892)
      CALL RDTAB(NOA,NUB,NUA,NUB,VHPPP3,14,NFT892)
      CALL ZEROMA(VHPHP1,1,NO2U2)
      CALL RDINT(1,NOAUA,NOAUA,VHPHP1,NFT829)
      CALL TRAN1TO4(NUA,NOA,NUA,NOA,TI,VHPHP1)
      CALL INSITU(NOA,NUA,NOA,NUA,TI,VHPHP1,23)
      CALL DCOPY(NOA2UA2,VHPHP1,1,VHPHP2,1)
      CALL INSITU(NOA,NOA,NUA,NUA,TI,VHPHP2,13)
      CALL RDINT(1,NOBUB,NOAUA,VHPHP4,NFT833)
      CALL INSITU(NUA,NOA,NUB,NOB,TI,VHPHP4,13)
      CALL TRAN1TO4(NUB,NOA,NUA,NOB,TI,VHPHP4)
      CALL INSITU(NOA,NUA,NUA,NUA,TI,VHPPP1,13)
      CALL TRAN24(NUA,NUB,NUA,NOB,TI,VHPPP2)
      CALL INSITU(NOA,NOB,NUA,NOB,TI,VHPHP6,12)
      CALL INSITU(NOA,NUB,NUA,NUB,TI,VHPPP3,23)
      CALL TRT1(NOAUAB,NUB,TI,VHPPP3)
      CALL ZEROMA(OHPP,1,NOU2)
      CALL ZEROMA(OHPPB,1,NOU2)
      CALL INTLOOP1(NOA,NUA,NOB,NUB,R3,HR3,HR1,T2,VHPHP3,OHHPA,OHHPB,
     *              OPPPA,OPPPB,VPPP,VHPHP1,VHPHP2,VHPHP4,TI,R1,
     *              OHHPB2,HR2A,HR2B,OHPP,OHPPB,FHPA,FHPB,VHHHP1,
     *              VHHHP2,VHPHP6,VHPPP1,VHPPP2,VHPPP3,I3REC,INTREC)
      CALL TRT1(NUA2,NOAUA,TI,VHPPP1)
      CALL INSITU(NOA,NUA,NUA,NUA,TI,VHPPP1,12)
      CALL R3HPPP2(NOA,NOB,NUA,NUB,R3,VHPPP1,HR2B,I3REC)
C
      CALL ZEROMA(VHPHP1,1,NO2U2)
      CALL ZEROMA(VHPHP2,1,NO2U2)
      CALL RDTAB(NOB,NOB,NOB,NUB,VHHHP1,15,NFT891)
      CALL RDTAB(NOB,NUB,NUB,NUB,VHPPP1,12,NFT892)
      CALL RDINT(1,NOBUB,NOAUA,VHPHP1,NFT833)
      CALL DCOPY(NO2U2AB,VHPHP1,1,VHPHP2,1)
      CALL INSITU(NUA,NOA,NUB,NOB,TI,VHPHP1,12)
      CALL TRAN1TO4(NUA,NOA,NUB,NOB,TI,VHPHP2)
      CALL RDINT(1,NOBUB,NOBUB,VHPHP4,NFT830)
      CALL TRANSQ(VHPHP4,NOBUB)
      CALL TRAN34N(NUB,NOB,NUB,NOB,TI,VHPHP4)
      CALL TRANMD(OHHPB,NUA,NOB,NOB,1,23)
      CALL INSITU(NUA,NOB,NOB,1,TI,OHHPB,13)
      CALL INSITU(NUA,NUB,NUB,1,TI,OPPPB,13)
      CALL TRT1(NOBUA,NUAB,TI,VHPPP2)
      CALL TRAN34N(NUA,NUB,NUA,NOB,TI,VHPPP2)
      CALL TRT1(NOAB,NOAUB,TI,VHHHP2)
      CALL TRAN34N(NOA,NUB,NOA,NOB,TI,VHHHP2)
      CALL INSITU(NUA,NOB,NUB,1,TI,OHPPB,12)
      CALL TRANMD(VHHHP1,NOB,NOB,NOB,NUB,13)
      CALL TRT1(NOBUB2,NUB,TI,VHPPP1)
      CALL INSITU(NUB,NOB,NUB,NUB,TI,VHPPP1,23)
      CALL INTLOOP2(NOA,NUA,NOB,NUB,R3,HR3,HR1,T2,VHPHP3,OHHPA,OHHPB,
     *              OPPPA,OPPPB,VPPP,VHPHP1,VHPHP2,VHPHP4,TI,R1,
     *              OHHPB2,HR2A,HR2B,OHPP,OHPPB,FHPA,FHPB,VHPPP2,
     *              VHPPP1,VHPPP3,VHPHP6,VHHHP2,VHHHP1,I3REC,INTREC)
      CALL INSITU(NOA,NUA,NUA,1,TI,OHPP,13)
      CALL DAXPY(NOAUA2,1.00D+00,OHPP,1,HR2A,1)
      CALL TRANMD(HR2A,NUA,NUA,NOA,1,12)
      CALL ZEROR2(NOA,NUA,OHPP)
      CALL DAXPY(NOAUA2,-1.00D+00,OHPP,1,HR2A,1)
      CALL TRANMD(HR2A,NUA,NUA,NOA,1,12)
C
      CALL ZEROMA(VHPHP1,1,NO2U2)
      CALL RDINT(1,NOBUB,NOBUB,VHPHP1,NFT830)
      CALL TRAN1TO4(NUB,NOB,NUB,NOB,TI,VHPHP1)
      CALL INSITU(NOB,NUB,NOB,NUB,TI,VHPHP1,23)
      CALL RDINT(1,NOAUA,NOAUA,VHPHP3,NFT829)
      CALL TRAN1TO4(NUA,NOA,NUA,NOA,TI,VHPHP3)
      CALL INSITU(NOA,NUA,NOA,NUA,TI,VHPHP3,23)
      CALL TRT1(NOB,NUB,TI,FHPB)
      CALL TRT1(NOBUA,NUB,TI,OHPPB)
      CALL INSITU(NUB,NUB,NOB,NUB,TI,VHPPP1,23)
      CALL TRANMD(VHPPP2,NUA,NUB,NOB,NUA,14)
      CALL INTLOOP3(NOA,NUA,NOB,NUB,R3,HR1,HR3,OHHPB,OPPPB,VPPP,
     *              VHPHP1,VHPHP2,VHPHP3,OHHPB2,TI,HR2B,FHPB,
     *              VHHHP1,VHPPP1,VHPPP2,OHPPB,I3REC,INTREC)
C      CALL TRT1(NOB,NUAB,TI,OHPPB)
      CALL TRT1(NOBUB,NUA,TI,OHPPB)
      CALL DAXPY(NOBUAB,1.00D+00,OHPPB,1,HR2B,1)
C
      CALL ZEROMA(FPPA,1,NU2)
      CALL ZEROMA(VHPHP1,1,NO2U2)
      CALL RDTAB2(NUA,NUA,FPPA,1,NFT891)
      CALL RDTAB2(NOA,NOA,FHHA,3,NFT891)
      CALL RDTAB(NUA,NOA,NUA,NOA,VHPHP1,1,NFT892)
      CALL RDTAB(NUB,NOB,NOA,NUA,VHPHP2,5,NFT892)
      CALL RDTAB(NOA,NOA,NOA,NUA,VHHHP1,10,NFT891)
      CALL RDTAB(NUA,NUA,NUA,NOA,VHPPP1,7,NFT892)
      CALL RDTAB(NOA,NOA,NOA,NOA,VHHHH,7,NFT891)
      CALL RDTAB(NOA,NUA,NUA,NOA,T2,3,NFT825)
      CALL VECMUL(FPPA,NUA2,HALF)
      CALL VECMUL(VHHHP1,NOA3UA,HALF)
      CALL VECMUL(VHHHH,NOA4,QUART)
      CALL TRANMD(VHHHP1,NOA,NOA,NOA,NUA,13)
      CALL TRT1(NUA2,NOAUA,TI,VHPPP1)
      CALL HRLOOPAA(NOA,NUA,NOB,NUB,R3,HR3,R2A,FPPA,FHHA,VHHHP1,
     *              VHPPP1,VPPP,VHHHH,VHPHP1,VHPHP2,T2,OHHPA,
     *              OPPPA,TI,I3REC,INTREC)
      CALL HRMAKEAA(NOA,NUA,R3,HR3,T2,I3REC,INTREC)
C
      CALL ZEROMA(FPPB,1,NU2)
      CALL ZEROMA(FHHB,1,NO2)
      CALL ZEROMA(VHPHP1,1,NO2U2)
      CALL ZEROMA(VHPHP2,1,NO2U2)
      CALL ZEROMA(VHPHP3,1,NO2U2)
      CALL ZEROMA(VHPPP1,1,NOU3)
      CALL ZEROMA(VHPPP2,1,NOU3)
      CALL ZEROMA(VHHHP1,1,NO3U)
      CALL ZEROMA(T2,1,NO2U2)
      CALL RDTAB2(NUB,NUB,FPPB,2,NFT891)
      CALL RDTAB2(NOB,NOB,FHHB,4,NFT891)
      CALL RDTAB(NUB,NOB,NUB,NOB,VHPHP1,2,NFT892)
      CALL RDTAB(NUB,NOB,NUA,NOA,VHPHP2,6,NFT892)
      CALL RDTAB(NUB,NOB,NUB,NOB,VHPHP3,4,NFT892)
      CALL RDTAB(NUB,NUB,NUB,NOB,VHPPP1,8,NFT892)
      CALL RDTAB(NUA,NUB,NUA,NOB,VHPPP2,9,NFT892)
      CALL RDTAB(NOB,NOB,NOB,NUB,VHHHP1,11,NFT891)
      CALL RDTAB(NOB,NOB,NOB,NOB,VHHHH,8,NFT891)
      CALL RDTAB(NOB,NUB,NUB,NOB,T2,4,NFT825)
      CALL RDTAB(NOA,NUA,NUB,NOB,VHPHP4,5,NFT825)
      CALL VECMUL(FPPB,NUB2,HALF)
      CALL VECMUL(FHHB,NOB2,HALF)
      CALL VECMUL(VHHHH,NOB4,EIGHTH)
      CALL VECMUL(T2,NOB2UB2,HALF)
      CALL TRANSQ(FHHB,NOB)
      CALL INSITU(NUB,NOB,NUB,NOB,TI,VHPHP1,12)
      CALL TRAN34N(NOB,NUB,NUB,NOB,TI,VHPHP1)
      CALL INSITU(NUB,NOB,NUA,NOA,TI,VHPHP2,12)
      CALL TRAN34N(NOB,NUB,NUA,NOA,TI,VHPHP2)
      CALL TRANMD(VHPPP1,NUB,NUB,NUB,NOB,13)
      CALL TRANMD(VHPPP2,NUA,NUB,NUA,NOB,13)
      CALL TRAN34N(NUA,NUB,NUA,NOB,TI,VHPPP2)
      CALL TRAN34N(NOB,NOB,NOB,NUB,TI,VHHHP1)
      CALL TRANMD(OPPPB,NUB,NUB,NUA,1,12)
      CALL INSITU(NOB,NUA,NUB,1,TI,R2B,23)
      CALL TRAN24(NOA,NUA,NUB,NOB,TI,VHPHP4)
      CALL INSITU(NOA,NOB,NUB,NUA,TI,VHPHP4,23)
      CALL TRT1(NOA,NOBUB,TI,OHHPB2)
      CALL HRLOOPBB(NOA,NUA,NOB,NUB,R3,HR3,FPPA,FPPB,FHHB,VHPHP1,
     *              VHPHP2,VHPHP3,VHHHH,VHPPP1,VHPPP2,VHHHP1,VPPP,
     *              VHPPP3,OHHPB,OPPPB,OHHPB2,R2B,T2,VHPHP4,TI,
     *              I3REC,INTREC)
      CALL HRMAKEBB(NUA,NOB,NUB,R3,HR3,VHPHP1,VHPHP2,
     *              T2,I3REC,INTREC)
C
      CALL RDTAB(NUA,NOA,NUA,NOA,VHPHP1,1,NFT892)
      CALL RDTAB(NUA,NOB,NUA,NOB,VHPHP2,4,NFT892)
      CALL RDTAB(NUB,NOB,NOA,NUA,VHPHP3,5,NFT892)
      CALL RDTAB(NUB,NOA,NUB,NOA,VHPHP4,3,NFT892)
      CALL RDTAB(NUB,NOB,NUA,NOA,VHPHP5,6,NFT892)
      CALL RDTAB(NUB,NOB,NUB,NOB,VHPHP6,2,NFT892)
      CALL RDTAB(NOA,NOB,NOA,NOB,VHHHH,9,NFT891)
      CALL RDTAB(NUA,NUB,NUA,NOB,VHPPP1,9,NFT892)
      CALL RDTAB(NUA,NUB,NOA,NUB,VHPPP2,10,NFT892)
      CALL RDTAB(NUA,NUA,NUA,NOA,VHPPP3,7,NFT892)
      CALL RDTAB(NOA,NOB,NOA,NUB,VHHHP1,12,NFT891)
      CALL RDTAB(NOA,NOB,NUA,NOB,VHHHP2,13,NFT891)
      CALL RDTAB(NOA,NUA,NUB,NOB,T2,5,NFT825)
      CALL RDTAB(NOA,NUA,NUA,NOA,T2B,3,NFT825)
      CALL VECMUL(FPPA,NUA2,TWO)
      CALL VECMUL(FPPB,NUB2,TWO)
      CALL TRANSQ(FPPB,NUB)
      CALL VECMUL(FHHA,NOA2,HALF)
      CALL VECMUL(VHHHH,NO2AB,HALF)
      CALL INSITU(NUA,NOA,NUA,NOA,TI,VHPHP1,12)
      CALL TRAN34N(NOA,NUA,NUA,NOA,TI,VHPHP1)
      CALL TRT1(NOBUB,NOAUA,TI,VHPHP3)
      CALL TRAN34N(NOA,NUA,NUB,NOB,TI,VHPHP3)
      CALL TRANMD(VHPPP1,NUA,NUB,NUA,NOB,13)
      CALL TRAN34N(NUA,NUB,NUA,NOB,TI,VHPPP1)
      CALL TRAN14(NUA,NUB,NOA,NUB,TI,VHPPP2)
      CALL TRAN14(NUA,NUA,NUA,NOA,TI,VHPPP3)
      CALL TRAN34N(NOA,NOB,NOA,NUB,TI,VHHHP1)
      CALL TRT1(NOAUA,NOBUB,TI,T2)
      CALL INSITU(NUA,NOA,NUA,1,TI,R2A,12)
      CALL TRANMD(OHHPB,NOB,NOB,NUA,1,12)
      CALL INSITU(NOB,NUB,NOA,1,TI,OHHPB2,13)
      CALL TRANSQ(T2B,NOAUA)
      CALL INSITU(NUA,NOA,NOA,NUA,TI,T2B,12)
      CALL HRLOOPAB(NOA,NUA,NOB,NUB,R3,HR3,FPPA,FPPB,FHHA,FHHB,
     *              VHPHP1,VHPHP2,VHPHP3,VHPHP4,VHPHP5,VHPHP6,
     *              VHHHH,VHPPP1,VHPPP2,VHPPP3,VHHHP1,VHHHP2,
     *              OPPPA,OPPPB,OHHPA,OHHPB,OHHPB2,T2,T2B,
     *              VPPP,R2A,R2B,TI,I3REC,INTREC)
      CALL HRMAKEAB(NOA,NUA,NOB,NUB,R3,HR3,VHPHP1,VHPHP2,
     *              T2,I3REC,INTREC)
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK INTLOOP1
      SUBROUTINE INTLOOP1(NOA,NUA,NOB,NUB,R3,R3B,HR1,GAMMA1,GAMMA2,
     *                    OHHPA,OHHPB,OPPPA,OPPPB,VPPP,VHPPH,VHPPH2,
     *                    VHPPH3,TI,R1,OHHPB2,HR2A,HR2B,OHPP,OHPPB,
     *                    FHPA,FHPB,VHHHP1,VHHHP2,VHHHP3,VHPPP1,
     *                    VHPPP2,VHPPP3,I3REC,INTREC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION R3(NUA,NOA,NOA,NUA),GAMMA1(NUA,NUA,NOA,NOA)
      DIMENSION HR1(NUA),OHHPA(NOA,NOA,NUA),OPPPA(NUA,NUA,NUA)
      DIMENSION VHPPH(NOA,NOA,NUA,NUA),VHPPH2(NUA,NOA,NOA,NUA)
      DIMENSION TI(1),VPPP(NUA,NUA,NUA),GAMMA2(NUA,NUA,NOB,NOA)
      DIMENSION R3B(NUA,NOB,NOA,NUA),VHPPH3(NOA,NUA,NOB,NUB)
      DIMENSION OHHPB(NUA,NOB,NOB),OPPPB(NUA,NUB,NUB),R1(1)
      DIMENSION OHHPB2(NOA,NOB,NUB),FHPA(NOA,NUA),FHPB(NOB,NUB)
      DIMENSION HR2A(NOA,NUA,NUA),VHHHP1(NOA,NOA,NOA,NUA)
      DIMENSION VHHHP2(NOA,NOB,NOA,NUB),VHPPP1(NUA,NOA,NUA,NUA)
      DIMENSION VHPPP2(NUA,NOB,NUA,NUB),OHPP(NOA,NUA,NUA)
      DIMENSION OHPPB(NUA,NOB,NUB),VHHHP3(1)
      DIMENSION VHPPP3(NUB,NOA,NUA,NUB)
C
      DATA TWO/2.0D+00/, HALF/0.5D+00/
      DATA FOUR/4.00D+00/
C
      NOABUA2=NOABUA*NUA
      DO 1,IA=1,NACTB
       IF(IA.LE.NACTA) THEN
        CALL RDTAB(NOA,NUA,NUA,NOA,R3,(I3REC+IA),98)
       ELSE
        CALL ZEROMA(R3,1,NO2U2)
       END IF
       CALL RDTAB(NOA,NUA,NUA,NOB,R3B,(I3REC+LREC2+IA),98)
C
       CALL VECMUL(R3,NOA2UA2,HALF)
       CALL CCMATMUL(VHPPH,R3,OHHPA(1,1,IA),NOA,NOA,NOAUA2,0,0)
       CALL INSITU(NUA,NUA,NOA,1,TI,HR2A,13)
       CALL CCMATMUL(R3,VHPPP1,HR2A(1,1,IA),NOA,NUA,NOAUA2,0,1)
       CALL INSITU(NOA,NUA,NUA,1,TI,HR2A,13)
       CALL TRT1(NOA,NUA,TI,FHPA)
       CALL CCMATMUL(R3,FHPA,OHPP(1,1,IA),NOAUA,1,NOAUA,0,0)
       CALL TRT1(NUA,NOA,TI,FHPA)
       CALL TRANSQ(R3,NOAUA)
       CALL VECMUL(R3,NOA2UA2,HALF)
       CALL TRT1(NOA2,NOAUA,TI,VHHHP1)
       CALL CCMATMUL(VHHHP1,R3,OHPP(1,1,IA),NOA,NUA,NOA2UA,0,0)
       CALL TRT1(NOAUA,NOA2,TI,VHHHP1)
C
       CALL VECMUL(R3B,NOABUA2,HALF)
       CALL CCMATMUL(VHPPH,R3B,OHHPB2(1,1,IA),NOA,NOB,NOAUA2,0,0)
       CALL TRT1(NOAUA2,NUA,TI,VHPPP1)
       CALL INSITU(NOA,NUA,NUA,NOB,TI,R3B,13)
       CALL CCMATMUL(VHPPP1,R3B,OHPPB(1,1,IA),NUA,NOB,NOAUA2,0,0)
       CALL TRT1(NUA,NOAUA2,TI,VHPPP1)
       CALL INSITU(NUA,NUA,NOA,NOB,TI,R3B,13)
C
       CALL VECMUL(R3B,NOABUA2,HALF)
       CALL TRT1(NOAUA,NOBUA,TI,R3B)
C
       CALL TRANMD(OPPPA,NUA,NUA,NUA,1,13)
       CALL VECMUL(R3,NOA2UA2,HALF)
       CALL ZEROMA(GAMMA1,1,NO2U2)
       CALL ZEROMA(GAMMA2,1,NO2U2)
       DO 10,IF=1,NUA
        READ(NFT899,REC=IF) VPPP
        CALL CCMATMUL(VPPP,R3(1,1,1,IF),GAMMA1,NUA2,NOA2,NUA,0,1)
        CALL CCMATMUL(VPPP,R3B(1,1,1,IF),GAMMA2,NUA2,NOAB,NUA,0,1)
        IF(IA.EQ.1) THEN
        CALL CCMATMUL(VPPP,R1,OPPPA(1,1,IF),NUA2,1,NUA,0,0)
        END IF
 10    CONTINUE
       IF(IA.LE.NACTA) THEN
       CALL WRTAB(NUA,NUA,NOA,NOA,GAMMA1,(INTREC+IA),98)
       END IF
       CALL WRTAB(NUA,NUA,NOB,NOA,GAMMA2,(INTREC+LREC2+IA),98)
       CALL TRANMD(OPPPA,NUA,NUA,NUA,1,13)
C
       CALL TRAN1TO4(NUA,NOA,NOA,NUA,TI,R3)
       CALL VECMUL(R3,NOA2UA2,TWO)
       CALL CCMATMUL(VHPPH,R3,HR1(IA),1,1,NOA2UA2,0,0)
       CALL VECMUL(R3,NOA2UA2,TWO)
       CALL CCMATMUL(VHPPH2,R3,OPPPA(1,1,IA),NUA,NUA,NOA2UA,0,1)
C
       CALL ZEROA(NOA,NUA,R3)
       CALL INSI23(NUA,NUA,NUA,TI,OPPPA)
       CALL CCMATMUL(VHPPH2,R3,OPPPA(1,1,IA),NUA,NUA,NOA2UA,0,0)
       CALL INSI23(NUA,NUA,NUA,TI,OPPPA)
C
       CALL ZEROB(NOA,NUA,IA,R3)
       CALL CCMATMUL(VHPPH(1,1,1,IA),R3,HR1,1,NUA,NOA2UA,0,1)
       CALL INSITU(NOA,NOA,NUA,NUA,TI,R3,23)
       CALL VECMUL(R3,NOA2UA2,TWO)
       CALL CCMATMUL(VHPPH(1,1,1,IA),R3,OHHPA,NOA,NOAUA,NOAUA,0,0)
       CALL INSITU(NOA,NUA,NOA,NUA,TI,R3,23)
       CALL TRAN14(NOA,NOA,NUA,NUA,TI,R3)
       CALL TRT1(NUA,NOAUA2,TI,VHPPP1)
       CALL INSITU(NUA,NUA,NOA,1,TI,HR2A,23)
       CALL CCMATMUL(R3,VHPPP1(1,1,1,IA),HR2A,NOAUA,NUA,NOAUA,0,1)
       CALL INSITU(NUA,NOA,NUA,1,TI,HR2A,23)
       CALL TRT1(NOAUA2,NUA,TI,VHPPP1)
       CALL TRAN14(NUA,NOA,NUA,NOA,TI,R3)
C
       CALL ZEROC(NOA,NUA,IA,R3)
       CALL VECMUL(R3,NOA2UA2,HALF)
       CALL CCMATMUL(VHPPH2(1,1,1,IA),R3,OPPPA,NUA,NUA2,NOA2,0,1)
       CALL TRAN24(NOA,NOA,NUA,NUA,TI,R3)
       CALL CCMATMUL(FHPA(1,IA),R3,HR2A,1,NOAUA2,NOA,0,1)
       CALL VECMUL(R3,NOA2UA2,HALF)
       CALL TRAN1TO4(NOA,NUA,NUA,NOA,TI,R3)
       CALL CCMATMUL(R3,VHHHP1(1,1,1,IA),HR2A,NUA2,NOA,NOA2,0,0)
C
       CALL ZEROE(NOA,NOB,NUA,R3B)
       CALL VECMUL(R3B,NOABUA2,FOUR)
C
       CALL TRANMD(R3B,NUA,NOB,NOA,NUA,14)
       CALL CCMATMUL(R3B,FHPA,OHPPB(1,1,IA),NOBUA,1,NOAUA,0,0)
       CALL CCMATMUL(R3B,VHHHP3,OHPPB(1,1,IA),NUA,NOB,NOABUA,0,1)
       CALL TRANMD(R3B,NUA,NOB,NOA,NUA,14)
C
       CALL CCMATMUL(VHPPH3(1,1,1,IA),R3B,OHHPA,NOA,NOAUA,NOBUA,0,0)
C
       CALL INSITU(NOA,NUA,NOB,NUB,TI,VHPPH3,12)
       CALL INSITU(NUA,NOB,NOA,NUA,TI,R3B,13)
       CALL CCMATMUL(VHPPH3(1,1,1,IA),R3B,OPPPA,NUA,NUA2,NOAB,0,1)
C
       CALL TRAN14(NOA,NOB,NUA,NUA,TI,R3B)
       CALL CCMATMUL(R3B,VHPPH3(1,1,1,IA),OHHPB,NOBUA,NOB,NOAUA,0,0)
C
       CALL INSITU(NUA,NOA,NOB,NUB,TI,VHPPH3,12)
       CALL TRAN24(NUA,NOB,NUA,NOA,TI,R3B)
       CALL CCMATMUL(R3B,VHPPH3,OPPPB(1,1,IA),NUA,NUB,NOABUA,0,1)
C
       CALL CCMATMUL(R3B,VHPPH3(1,1,1,IA),HR1,NUA,1,NOABUA,0,0)
       CALL VECMUL(R3B,NOABUA2,HALF)
       CALL INSITU(NUA,NOA,NUA,NOB,TI,R3B,23)
       CALL CCMATMUL(R3B,FHPB(1,IA),HR2A,NOAUA2,1,NOB,0,0)
       CALL CCMATMUL(R3B,VHHHP2(1,1,1,IA),HR2A,NUA2,NOA,NOAB,0,1)
       CALL TRAN14(NUA,NUA,NOA,NOB,TI,R3B)
       CALL VECMUL(R3B,NOABUA2,TWO)
       CALL TRT1(NUA,NOAUA,TI,HR2A)
       CALL CCMATMUL(VHPPP2(1,1,1,IA),R3B,HR2A,NUA,NOAUA,NOBUA,0,0)
       CALL TRT1(NOAUA,NUA,TI,HR2A)
C
       CALL TRT1(NUA,NOBUB,TI,HR2B)
       CALL INSITU(NOB,NUA,NOA,NUA,TI,R3B,13)
       CALL CCMATMUL(VHPPP3(1,1,1,IA),R3B,HR2B,NUB,NOBUA,NOAUA,0,0)
       CALL TRT1(NOBUB,NUA,TI,HR2B)
C
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK INTLOOP2
      SUBROUTINE INTLOOP2(NOA,NUA,NOB,NUB,R3,R3B,HR1,GAMMA1,GAMMA2,
     *                    OHHPA,OHHPB,OPPPA,OPPPB,VPPP,VHPPH,VHPPH2,
     *                    VHPPH3,TI,R1,OHHPB2,HR2A,HR2B,OHPP,OHPPB,
     *                    FHPA,FHPB,VHPPP1,VHPPP2,VHPPP3,
     *                    VHHHP1,VHHHP2,VHHHP3,I3REC,INTREC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION R3(NUA,NOB,NOA,NUB),GAMMA1(NUA,NUB,NOB,NOA)
      DIMENSION HR1(NUA),OHHPA(NOA,NOA,NUA),OPPPA(NUA,NUA,NUA)
      DIMENSION VHPPH(NOA,NUA,NOB,NUB),VHPPH2(NOA,NUB,NOB,NUA)
      DIMENSION TI(1),VPPP(NUA,NUB,NUA),GAMMA2(NUA,NUA,NOB,NOA)
      DIMENSION R3B(NUA,NOB,NOB,NUB),VHPPH3(NUB,NOB,NOB,NUB)
      DIMENSION OHHPB(NOB,NOB,NUA),OPPPB(NUA,NUB,NUB)
      DIMENSION OHHPB2(NOA,NOB,NUB),HR2A(NOA,NUA,NUA)
      DIMENSION VHPPP1(NOB,NUB,NUA,NUA),OHPP(NOA,NUA,NUA)
      DIMENSION VHHHP2(1),HR2B(NUB,NOB,NUA),FHPA(NOA,NUA)
      DIMENSION OHPPB(NOB,NUA,NUB),FHPB(NOB,NUB)
      DIMENSION VHHHP1(NOB,NOA,NOB,NUA),VHHHP3(NOB,NOB,NOB,NUB)
      DIMENSION VHPPP2(NUB,NUB,NOB,NUB),VHPPP3(NUB,NOA,NUB,NUA)
C
      DATA TWO/2.0D+00/, HALF/0.5D+00/
C
      NOB2UAB=NOB2UA*NUB
      DO 1,IA=1,NACTB
       IF(IA.LE.NACTA) THEN
        CALL RDTAB(NOA,NUA,NUB,NOB,R3,(I3REC+LREC1+IA),98)
       ELSE
        CALL ZEROMA(R3,1,NO2U2)
       END IF
       CALL RDTAB(NOB,NOB,NUB,NUA,R3B,(I3REC+LREC4+IA),98)
C
       CALL CCMATMUL(VHPPH,R3,HR1(IA),1,1,NO2U2AB,0,0)
       CALL INSITU(NUA,NUA,NOA,1,TI,HR2A,13)
       CALL CCMATMUL(R3,VHPPP1,HR2A(1,1,IA),NOA,NUA,NOBUAB,0,0)
       CALL INSITU(NOA,NUA,NUA,1,TI,HR2A,13)
       CALL TRT1(NUA,NOBUB,TI,HR2B)
       CALL CCMATMUL(FHPA,R3,HR2B(1,1,IA),1,NOBUB,NOAUA,0,0)
       CALL CCMATMUL(VHPPP3,R3,HR2B(1,1,IA),NUB,NOB,NOAUAB,0,0)
C
       CALL VECMUL(R3,NO2U2AB,HALF)
       CALL TRT1(NOB,NUB,TI,FHPB)
       CALL CCMATMUL(R3,FHPB,OHPP(1,1,IA),NOAUA,1,NOBUB,0,0)
       CALL TRT1(NUB,NOB,TI,FHPB)
       CALL TRT1(NOAUA,NOBUB,TI,R3)
       CALL CCMATMUL(VHHHP2,R3,OHPP(1,1,IA),NOA,NUA,NOABUB,0,1)
       CALL VECMUL(R3,NO2U2AB,TWO)
C
       CALL CCMATMUL(R3,VHHHP1,HR2B(1,1,IA),NUB,NOB,NOABUA,0,1)
       CALL TRT1(NOBUB,NUA,TI,HR2B)
C
       CALL TRAN24(NOB,NOB,NUB,NUA,TI,R3B)
       CALL CCMATMUL(R3B,VHPPP1,OHPPB(1,1,IA),NOB,NUA,NOBUAB,0,0)
       CALL TRAN24(NOB,NUA,NUB,NOB,TI,R3B)
C
       CALL TRAN14(NUB,NOB,NOA,NUA,TI,R3)
C
       CALL TRT1(NOB2,NUAB,TI,R3B)
C
       CALL INSITU(NUB,NUA,NOB,NOB,TI,R3B,12)
       CALL CCMATMUL(VHPPH,R3B,OHHPB2(1,1,IA),NOA,NOB,NOBUAB,0,0)
       CALL INSITU(NUA,NUB,NOB,NOB,TI,R3B,12)
C
       CALL TRAN1TO4(NUB,NUA,NOB,NOB,TI,R3B)
       CALL VECMUL(R3B,NOB2UAB,HALF)
C
       CALL TRT1(NUB2,NUA,TI,OPPPB)
       CALL ZEROMA(GAMMA1,1,NO2U2)
       CALL ZEROMA(GAMMA2,1,NO2U2)
       DO 10,IF=1,NUB
        READ(NFT899,REC=NUA+NUB+IF) VPPP
        CALL CCMATMUL(VPPP,R3(1,1,1,IF),GAMMA1,NUAB,NOAB,NUA,0,0)
        CALL CCMATMUL(VPPP,R3B(1,1,1,IF),GAMMA2,NUAB,NOB2,NUA,0,1)
        IF(IA.EQ.1) THEN
        CALL CCMATMUL(VPPP,R1,OPPPB(1,1,IF),NUAB,1,NUA,0,0)
        END IF
 10    CONTINUE
       IF(IA.LE.NACTA) THEN
       CALL WRTAB(NUA,NUB,NOB,NOA,GAMMA1,(INTREC+LREC1+IA),98)
       END IF
       CALL WRTAB(NUA,NUB,NOB,NOB,GAMMA2,(INTREC+LREC4+IA),98)
       CALL TRT1(NUA,NUB2,TI,OPPPB)
C
       CALL TRAN1TO4(NUA,NOB,NOA,NUB,TI,R3)
       CALL TRAN34N(NOB,NOA,NUB,NUA,TI,R3)
       CALL CCMATMUL(R3,VHPPH,OHHPB(1,1,IA),NOB,NOB,NOAUAB,0,0)
       CALL INSITU(NOB,NOA,NUA,NUB,TI,R3,13)
       CALL TRAN24(NUA,NOA,NOB,NUB,TI,R3)
       CALL CCMATMUL(VHPPH,R3,OHHPA(1,1,IA),NOA,NOA,NOBUAB,0,0)
       CALL INSITU(NOA,NUA,NUB,NOB,TI,VHPPH,12)
       CALL TRAN14(NUA,NUB,NOB,NOA,TI,R3)
       CALL CCMATMUL(VHPPH,R3,OPPPA(1,1,IA),NUA,NUA,NOABUB,0,1)
       CALL INSITU(NUA,NOA,NUB,NOB,TI,VHPPH,12)
       CALL TRAN34N(NOA,NUA,NUB,NOB,TI,VHPPH)
       CALL INSITU(NOA,NUB,NOB,NUA,TI,R3,12)
       CALL TRAN34N(NUB,NOA,NOB,NUA,TI,R3)
       CALL OPPBTERM(NUA,NUB,R3,VHPPH,OPPPB,IA)
       CALL TRAN34N(NOA,NUA,NOB,NUB,TI,VHPPH)
C
       CALL TRAN34N(NUB,NOA,NUA,NOB,TI,R3)
       CALL ZEROF(NOA,NUA,NOB,NUB,R3)
C
       CALL TRAN34N(NUB,NOA,NUA,NUB,TI,VHPPP3)
       CALL INSITU(NUB,NOA,NOB,NUA,TI,R3,12)
       CALL TRT1(NUA,NOBUB,TI,HR2B)
       CALL CCMATMUL(VHPPP3(1,1,1,IA),R3,HR2B,NUB,NOBUA,NOAUB,0,1)
       CALL TRT1(NOBUB,NUA,TI,HR2B)
       CALL INSITU(NOA,NUB,NOB,NUA,TI,R3,12)
       CALL TRAN34N(NUB,NOA,NUB,NUA,TI,VHPPP3)
C
       CALL INSITU(NUB,NOA,NOB,NUA,TI,R3,23)
       CALL CCMATMUL(VHPPH2(1,1,1,IA),R3,OHHPA,NOA,NOAUA,NOBUB,0,1)
       CALL TRAN14(NUB,NOB,NOA,NUA,TI,R3)
       CALL INSITU(NUA,NOB,NOA,NUB,TI,R3,12)
       CALL INSITU(NOB,NOB,NUA,1,TI,OHHPB,23)
       CALL CCMATMUL(R3,VHPPH2(1,1,1,IA),OHHPB,NOBUA,NOB,NOAUB,0,1)
       CALL TRAN1TO4(NOB,NUA,NOA,NUB,TI,R3)
       CALL TRANMD(OPPPA,NUA,NUA,NUA,1,23)
       CALL TRANMD(OPPPA,NUA,NUA,NUA,1,12)
       CALL CCMATMUL(R3,VHPPH2,OPPPA(1,1,IA),NUA,NUA,NOABUB,0,0)
       CALL TRANMD(OPPPA,NUA,NUA,NUA,1,12)
       CALL TRANMD(OPPPA,NUA,NUA,NUA,1,23)
       CALL TRAN14(NUA,NOA,NUB,NOB,TI,R3)
       CALL INSITU(NOB,NOA,NUB,NUA,TI,R3,12)
       CALL INSITU(NOA,NUB,NOB,NUA,TI,VHPPH2,12)
       CALL TRANMD(OPPPB,NUB,NUB,NUA,1,12)
       CALL CCMATMUL(VHPPH2(1,1,1,IA),R3,OPPPB,NUB,NUAB,NOAB,0,0)
       CALL INSITU(NUB,NOA,NOB,NUA,TI,VHPPH2,12)
       CALL TRAN14(NUA,NUB,NOB,NUA,TI,VHPPP1)
       CALL INSITU(NOA,NOB,NUB,NUA,TI,R3,13)
       CALL TRT1(NUA,NOAUA,TI,HR2A)
       CALL CCMATMUL(VHPPP1(1,1,1,IA),R3,HR2A,NUA,NOAUA,NOBUB,0,1)
       CALL TRT1(NOAUA,NUA,TI,HR2A)
       CALL TRAN14(NUA,NUB,NOB,NUA,TI,VHPPP1)
       CALL INSITU(NUB,NOB,NOA,NUA,TI,R3,13)
       CALL INSITU(NOA,NOB,NUB,NUA,TI,R3,23)
       CALL CCMATMUL(VHPPH2(1,1,1,IA),R3,HR1,1,NUA,NOABUB,0,1)
       CALL TRT1(NUA,NOBUB,TI,HR2B)
       CALL CCMATMUL(FHPA(1,IA),R3,HR2B,1,NOBUAB,NOA,0,1)
       CALL TRT1(NOBUB,NUA,TI,HR2B)
       CALL TRAN14(NOA,NUB,NOB,NUA,TI,R3)
       CALL TRAN34N(NOB,NOA,NUA,NOB,TI,VHHHP1)
       CALL CCMATMUL(R3,VHHHP1(1,1,1,IA),HR2B,NUAB,NOB,NOAB,0,0)
       CALL TRAN34N(NOB,NOA,NOB,NUA,TI,VHHHP1)
C
       CALL TRAN1TO4(NUA,NOB,NOB,NUB,TI,R3B)
       CALL ZEROG(NUA,NOB,NUB,R3B)
       CALL CCMATMUL(VHHHP3,R3B,OHPPB(1,1,IA),NOB,NUA,NOB2UB,0,0)
       CALL INSITU(NUB,NUB,NUA,1,TI,OPPPB,23)
       CALL CCMATMUL(VHPPH3,R3B,OPPPB(1,1,IA),NUB,NUA,NOB2UB,0,1)
       CALL INSITU(NUB,NUA,NUB,1,TI,OPPPB,23)
       CALL INSITU(NOB,NOB,NUB,NUA,TI,R3B,13)
       CALL TRT1(NOB,NUB,TI,FHPB)
       CALL VECMUL(R3B,NOB2UAB,TWO)
       CALL CCMATMUL(FHPB,R3B,OHPPB(1,1,IA),1,NOBUA,NOBUB,0,0)
       CALL VECMUL(R3B,NOB2UAB,HALF)
       CALL TRT1(NUB,NOB,TI,FHPB)
       CALL ZEROH2(NUA,NOB,NUB,IA,R3B)
       CALL CCMATMUL(VHPPH3(1,1,1,IA),R3B,HR1,1,NUA,NOB2UB,0,0)
       CALL VECMUL(R3B,NOB2UAB,TWO)
C
       CALL TRT1(NUA,NOBUB,TI,HR2B)
       CALL CCMATMUL(VHPPP2(1,1,1,IA),R3B,HR2B,NUB,NOBUA,NOBUB,0,1)
       CALL TRT1(NOBUB,NUA,TI,HR2B)
C
       CALL TRT1(NOBUB,NOBUA,TI,R3B)
       CALL CCMATMUL(R3B,VHPPH3(1,1,1,IA),OHHPB,NOBUA,NOB,NOBUB,0,0)
       CALL TRAN24(NOB,NUA,NUB,NOB,TI,R3B)
       CALL ZEROI(NUA,NOB,NUB,IA,R3B)
       CALL VECMUL(R3B,NOB2UAB,HALF)
       CALL CCMATMUL(VHPPH3(1,1,1,IA),R3B,OPPPB,NUB,NUAB,NOB2,0,0)
       CALL INSITU(NUA,NUB,NOB,1,TI,HR2B,13)
       CALL CCMATMUL(VHHHP3(1,1,1,IA),R3B,HR2B,NOB,NUAB,NOB2,0,1)
       CALL INSITU(NOB,NUB,NUA,1,TI,HR2B,13)
C
       CALL VECMUL(R3B,NOB2UAB,TWO)
       CALL TRAN34N(NOA,NUA,NUB,NOB,TI,VHPPH)
       CALL TRT1(NOB2UB,NUA,TI,R3B)
       CALL CCMATMUL(VHPPH(1,1,1,IA),R3B,OHHPB2,NOA,NOBUB,NOBUA,0,1)
       CALL TRAN34N(NOA,NUA,NOB,NUB,TI,VHPPH)
C
       CALL R3HPPP(NOB,NUA,NUB,IA,VHPPP1,R3B,HR2B,TI)
C
       CALL TRAN24(NUA,NOB,NOB,NUB,TI,R3B)
       CALL CCMATMUL(R3B,FHPB(1,IA),HR2B,NOBUAB,1,NOB,0,0)
C
       CALL INSITU(NOB,NUA,NOB,1,TI,OHHPB,23)
       CALL TRANMD(OPPPB,NUB,NUB,NUA,1,12)
C
 1     CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK R3HPPP
      SUBROUTINE R3HPPP(NOB,NUA,NUB,IA,VHPPP1,R3B,HR2B,TI)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      DIMENSION VHPPP1(NUA,NUA,NOB,NUB),R3B(1),HR2B(1),TI(1)
C
      CALL INSITU(NUA,NUB,NOB,1,TI,HR2B,23)
      CALL TRAN24(NUA,NUB,NOB,NUA,TI,VHPPP1)
      CALL TRANMD(VHPPP1,NUA,NUA,NOB,NUB,12)
      CALL CCMATMUL(VHPPP1(1,1,1,IA),R3B,HR2B,NUA,NOBUB,NOBUA,0,0)
      CALL TRANMD(VHPPP1,NUA,NUA,NOB,NUB,12)
      CALL TRAN24(NUA,NUA,NOB,NUB,TI,VHPPP1)
      CALL INSITU(NUA,NOB,NUB,1,TI,HR2B,23)
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK R3HPPP2
      SUBROUTINE R3HPPP2(NOA,NOB,NUA,NUB,R3,VHPPP,HR2B,I3REC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION VHPPP(NUA,NOA,NUA,NUA),R3(1),HR2B(1)
C
      DO 1,IE=1,NACTA
       CALL RDTAB(NOA,NUA,NUB,NOB,R3,(I3REC+LREC1+IE),98)
       CALL ZEROR(NOA,NUA,NOB,NUB,IE,R3)
       CALL CCMATMUL(VHPPP(1,1,1,IE),R3,HR2B,NUA,NOBUB,NOAUA,0,0)
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK OPPBTERM
      SUBROUTINE OPPBTERM(NUA,NUB,R3,VHPPH,OPPPB,IA)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      DIMENSION R3(1),VHPPH(1),OPPPB(NUB,NUB,NUA)
      CALL CCMATMUL(R3,VHPPH,OPPPB(1,1,IA),NUB,NUB,NOABUA,0,1)
      RETURN
      END
C
C*MODULE EAIPCC  *DECK INTLOOP3
      SUBROUTINE INTLOOP3(NOA,NUA,NOB,NUB,R3,HR1,GAMMA,OHHPB,OPPPB,
     *                    VPPP,VHPPH,VHPPH2,VHPPH3,OHHPB2,TI,HR2B,
     *                    FHPB,VHHHP1,VHPPP1,VHPPP2,OHPPB,
     *                    I3REC,INTREC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION R3(NUB,NOB,NOB,NUB),GAMMA(NUB,NUB,NOB,NOB)
      DIMENSION HR1(NUA),HR2B(NOB,NUB,NUA)
      DIMENSION VHPPH(NOB,NOB,NUB,NUB),VHPPH2(NOA,NUB,NOB,NUA)
      DIMENSION TI(1),VPPP(NUB,NUB,NUB)
      DIMENSION OHHPB(NOB,NOB,NUA),OPPPB(NUB,NUB,NUA),OHHPB2(1)
      DIMENSION VHPPH3(NOA,NOA,NUA,NUA),FHPB(1)
      DIMENSION VHHHP1(1),VHPPP1(1),OHPPB(NUB,NOB,NUA)
      DIMENSION VHPPP2(NUA,NUB,NOB,NUA)
C
      DATA TWO/2.0D+00/, HALF/0.5D+00/
      DATA QUART/0.25D+00/
C
      DO 1,IA=1,NACTA
       CALL RDTAB(NOB,NUB,NUB,NOB,R3,(I3REC+LREC3+IA),98)
C
       CALL INSITU(NUA,NUB,NOB,1,TI,HR2B,13)
       CALL CCMATMUL(R3,FHPB,HR2B(1,1,IA),NOBUB,1,NOBUB,0,0)
       CALL INSITU(NOB,NUB,NUA,1,TI,HR2B,13)
       CALL VECMUL(R3,NOB2UB2,HALF)
C
C       CALL TRT1(NUA,NOBUB,TI,OHPPB)
       CALL CCMATMUL(VHPPP1,R3,OHPPB(1,1,IA),NUB,NOB,NOBUB2,0,1)
C       CALL TRT1(NOBUB,NUA,TI,OHPPB)
C
       CALL TRANMD(OHHPB,NOB,NOB,NUA,1,12)
       CALL CCMATMUL(VHPPH,R3,OHHPB(1,1,IA),NOB,NOB,NOBUB2,0,0)
       CALL TRANMD(OHHPB,NOB,NOB,NUA,1,12)
       CALL TRANSQ(R3,NOBUB)
       CALL CCMATMUL(R3,VHPPH,OPPPB(1,1,IA),NUB,NUB,NOB2UB,0,1)
       CALL VECMUL(R3,NOB2UB2,QUART)
       CALL ZEROMA(GAMMA,1,NO2U2)
       DO 10,IF=1,NUB
        READ(NFT899,REC=NUA+IF) VPPP
        CALL CCMATMUL(VPPP,R3(1,1,1,IF),GAMMA,NUB2,NOB2,NUB,0,1)
 10    CONTINUE
       CALL WRTAB(NUB,NUB,NOB,NOB,GAMMA,(INTREC+LREC3+IA),98)
       CALL VECMUL(R3,NOB2UB2,TWO)
       CALL INSITU(NUB,NOB,NOB,NUB,TI,R3,13)
       CALL CCMATMUL(VHPPH,R3,HR1(IA),1,1,NOB2UB2,0,0)
C
       CALL VECMUL(R3,NOB2UB2,TWO)
       CALL INSITU(NUA,NUB,NOB,1,TI,HR2B,13)
       CALL CCMATMUL(VHHHP1,R3,HR2B(1,1,IA),NOB,NUB,NOB2UB,0,0)
       CALL INSITU(NOB,NUB,NUA,1,TI,HR2B,13)
       CALL VECMUL(R3,NOB2UB2,TWO)
C
       CALL TRT1(NOB2UB,NUB,TI,R3)
       CALL ZEROQ(NOB,NUB,R3)
       CALL CCMATMUL(VHPPH2(1,1,1,IA),R3,OHHPB2,NOA,NOBUB,NOBUB,0,1)
C
       CALL INSITU(NUA,NUB,NOB,1,TI,HR2B,23)
       CALL CCMATMUL(VHPPP2(1,1,1,IA),R3,HR2B,NUA,NOBUB,NOBUB,0,0)
       CALL INSITU(NUA,NOB,NUB,1,TI,HR2B,23)
C
       CALL RDTAB(NOA,NUA,NUB,NOB,R3,(I3REC+LREC1+IA),98)
       CALL ZEROR(NOA,NUA,NOB,NUB,IA,R3)
       CALL TRAN34N(NOA,NUA,NUB,NOB,TI,R3)
       CALL CCMATMUL(VHPPH3(1,1,1,IA),R3,OHHPB2,NOA,NOBUB,NOAUA,0,1)
C
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK HRLOOPAA
      SUBROUTINE HRLOOPAA(NOA,NUA,NOB,NUB,R3,HR3,R2A,FPPA,FHHA,VHHHP1,
     *                    VHPPP1,VPPP,VHHHH,VHPHP1,VHPHP2,T2,OHHPA,
     *                    OPPPA,TI,I3REC,INTREC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
C
      DIMENSION R3(1),HR3(NUA,NOA,NOA,NUA)
      DIMENSION R2A(NUA,NOA,NUA),FPPA(NUA,NUA),FHHA(1)
      DIMENSION VHHHP1(NOA,NOA,NOA,NUA)
      DIMENSION VHPPP1(NUA,NOA,NUA,NUA),VPPP(NUA,NUA,NUA)
      DIMENSION VHHHH(1),VHPHP1(NOA,NOA,NUA,NUA)
      DIMENSION VHPHP2(NOB,NOA,NUA,NUB)
      DIMENSION T2(NUA,NOA,NOA,NUA),OHHPA(NOA,NOA,NUA)
      DIMENSION OPPPA(NUA,NUA,NUA),TI(1)
C
      DATA TWO/2.0D+00/, HALF/0.5D+00/
      DATA QUART/0.25D+00/
C
      NOABUA2=NOABUA*NUA
      DO 1,IA=1,NACTA
       CALL ZEROMA(HR3,1,NO2U2)
       CALL RDTAB(NOA,NUA,NUB,NOB,R3,(I3REC+LREC1+IA),98)
       CALL VECMUL(R3,NO2U2AB,HALF)
       CALL CCMATMUL(R3,VHPHP2,HR3,NOAUA,NOAUA,NOBUB,1,1)
       CALL INSITU(NOA,NUA,NOA,NUA,TI,HR3,12)
       CALL RDTAB(NOA,NUA,NUA,NOA,R3,(I3REC+IA),98)
       CALL VECMUL(R3,NOA2UA2,HALF)
       CALL TRANSQ(R3,NOAUA)
       CALL CCMATMUL(R3,FPPA,HR3,NOA2UA,NUA,NUA,0,0)
       CALL TRANMD(HR3,NUA,NOA,NOA,NUA,14)
       CALL CCMATMUL(VHPHP1,R3,HR3,NOAUA,NOAUA,NOAUA,0,0)
       CALL TRANMD(HR3,NUA,NOA,NOA,NUA,14)
       CALL WRTAB(NUA,NOA,NOA,NUA,HR3,(INTREC+IHREC+IA),98)
       CALL VECMUL(HR3,NOA2UA2,TWO)
       CALL CCMATMUL(R2A(1,1,IA),VHHHP1,HR3,NUA,NOA2UA,NOA,0,0)
       CALL CCMATMUL(R2A,VHPPP1(1,1,1,IA),HR3,NOAUA,NOAUA,NUA,0,1)
       CALL VECMUL(R2A,NOAUA2,HALF)
       CALL INSITU(NUA,NOA,NUA,1,TI,R2A,23)
       CALL TRAN24(NUA,NOA,NOA,NUA,TI,HR3)
       CALL CCMATMUL(R2A,VHHHP1(1,1,1,IA),HR3,NUA2,NOA2,NOA,0,0)
       CALL INSITU(NUA,NUA,NOA,1,TI,R2A,13)
       CALL TRT1(NUA2,NOA2,TI,HR3)
       CALL CCMATMUL(R2A(1,1,IA),VHPPP1,HR3,NOA,NOAUA2,NUA,0,0)
       CALL VECMUL(R2A,NOAUA2,TWO)
       CALL TRT1(NOAUA,NUA,TI,R2A)
       CALL INSITU(NUA,NOA,NOA,NUA,TI,R3,13)
       CALL CCMATMUL(VHHHH,R3,HR3,NOA2,NUA2,NOA2,0,0)
       CALL TRAN24(NOA,NOA,NUA,NUA,TI,R3)
       CALL TRT1(NOA2,NUA2,TI,HR3)
       CALL TRANSQ(T2,NOAUA)
       CALL TRANMD(OPPPA,NUA,NUA,NUA,1,13)
       CALL VECMUL(OPPPA,NUA3,QUART)
       CALL CCMATMUL(OPPPA,T2(1,1,1,IA),HR3,NUA2,NOA2,NUA,0,1)
       CALL TRANMD(OPPPA,NUA,NUA,NUA,1,13)
       CALL VECMUL(OPPPA,NUA3,TWO)
       CALL TRAN24(NUA,NUA,NOA,NOA,TI,HR3)
       CALL CCMATMUL(T2(1,1,1,IA),OHHPA,HR3,NOAUA,NOAUA,NOA,0,0)
       CALL CCMATMUL(T2,OPPPA(1,1,IA),HR3,NOA2UA,NUA,NUA,0,0)
       CALL VECMUL(OPPPA,NUA3,TWO)
       CALL TRANSQ(HR3,NOAUA)
       CALL TRANSQ(T2,NOAUA)
       CALL VECMUL(OHHPA,NOA2UA,HALF)
       CALL CCMATMUL(FHHA,R3,HR3,NOA,NOAUA2,NOA,0,1)
       CALL CCMATMUL(T2,OHHPA(1,1,IA),HR3,NOAUA2,NOA,NOA,0,1)
       CALL VECMUL(OHHPA,NOA2UA,TWO)
C
       CALL TRAN14(NUA,NOA,NUA,NOA,TI,VHPHP1)
       CALL TRAN1TO4(NUB,NOB,NOA,NUA,TI,VHPHP2)
       DO 2,IE=1,NACTB
        CALL TRANSQ(HR3,NOAUA)
        CALL TRANMD(HR3,NUA,NOA,NOA,NUA,14)
        IF(IE.LE.NACTA) THEN
        CALL RDTAB(NOA,NUA,NUA,NOA,R3,(I3REC+IE),98)
        ELSE
        CALL ZEROMA(R3,1,NO2U2)
        END IF
        CALL TRANSQ(R3,NOAUA)
        CALL ZEROK(NOA,NUA,IE,R3)
        CALL VECMUL(R3,NOA2UA2,HALF)
        READ(NFT899,REC=IE) VPPP
        CALL TRT1(NUA2,NUA,TI,VPPP)
        CALL CCMATMUL(R3,VPPP(1,1,IA),HR3,NOA2UA,NUA,NUA,0,1)
        CALL TRANMD(HR3,NUA,NOA,NOA,NUA,14)
        CALL ZEROL(NOA,NUA,IE,R3)
        CALL CCMATMUL(FPPA(IE,IA),R3,HR3,1,NOA2UA2,1,0,0)
        CALL TRANSQ(HR3,NOAUA)
        CALL TRANSQ(R3,NOAUA)
        CALL CCMATMUL(R3,VHPHP1(1,1,IE,IA),HR3,NOAUA2,NOA,NOA,0,1)
        CALL RDTAB(NOA,NUA,NUA,NOB,R3,(I3REC+LREC2+IE),98)
        CALL VECMUL(R3,NOABUA2,HALF)
        CALL ZEROM(NOA,NOB,NUA,R3)
        CALL CCMATMUL(R3,VHPHP2(1,1,IA,IE),HR3,NOAUA2,NOA,NOB,0,1)
 2     CONTINUE
       CALL TRAN14(NOA,NOA,NUA,NUA,TI,VHPHP1)
       CALL TRT1(NOABUA,NUB,TI,VHPHP2)
C
       CALL WRTAB(NOA,NUA,NUA,NOA,HR3,(I3REC+IHREC+IA),98)
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK HRMAKEAA
      SUBROUTINE HRMAKEAA(NOA,NUA,R3,HR3,T2,I3REC,INTREC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION R3(NUA,NOA,NOA,NUA)
      DIMENSION HR3(NUA,NOA,NOA,NUA)
      DIMENSION T2(1)
C
      DATA ONE/1.00D+00/
      DATA TWON/-2.0D+00/, ONEN/-1.0D+00/
C
      DO 1,IA=1,NACTA
       CALL RDTAB(NOA,NUA,NUA,NOA,HR3,(I3REC+IHREC+IA),98)
       CALL RDTAB(NUA,NUA,NOA,NOA,R3,(INTREC+IA),98)
       CALL INSITU(NUA,NUA,NOA,NOA,T2,R3,13)
       CALL DAXPY(NOA2UA2,ONE,R3,1,HR3,1)
       CALL ZEROMA(R3,1,NO2U2)
C
        CALL TRANSQ(HR3,NOAUA)
        DO 2,IB=1,NACTA
          CALL RDTAB(NUA,NUA,NOA,NOA,R3,(INTREC+IB),98)
          CALL TRAN1TO4(NUA,NUA,NOA,NOA,T2,R3)
          CALL DAXPY(NOA2UA,TWON,R3(1,1,1,IA),1,HR3(1,1,1,IB),1)
          CALL RDTAB(NUA,NOA,NOA,NUA,R3,(INTREC+IHREC+IB),98)
          CALL DAXPY(NOA2UA,ONEN,R3(1,1,1,IA),1,HR3(1,1,1,IB),1)
          CALL ZEROJ(NOA,NUA,R3)
          CALL TRANMD(HR3,NUA,NOA,NOA,NUA,14)
          CALL DAXPY(NOA2UA,ONE,R3(1,1,1,IA),1,HR3(1,1,1,IB),1)
          CALL TRANMD(HR3,NUA,NOA,NOA,NUA,14)
 2      CONTINUE
        CALL TRANSQ(HR3,NOAUA)
C
       CALL ZEROMA(R3,1,NO2U2)
       CALL SYMETR2(HR3,NOA,NUA,R3)
       CALL WRTAB(NOA,NUA,NUA,NOA,HR3,(I3REC+IHREC+IA),98)
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK HRLOOPBB
      SUBROUTINE HRLOOPBB(NOA,NUA,NOB,NUB,R3,HR3,FPPA,FPPB,FHHB,VHPHP1,
     *                    VHPHP2,VHPHP3,VHHHH,VHPPP1,VHPPP2,VHHHP1,VPPP,
     *                    VPPP2,OHHPB,OPPPB,OHHPB2,R2B,T2,T2B,TI,
     *                    I3REC,INTREC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
C
      DATA TWO/2.0D+00/, HALF/0.5D+00/
C
      DIMENSION R3(1),HR3(1)
      DIMENSION FPPA(NUA,NUA),FPPB(1),FHHB(1),VHHHH(1)
      DIMENSION VHPHP1(1),VHPHP2(1),VHPHP3(NOB,NOB,NUA,NUA)
      DIMENSION VHPPP1(1),VHPPP2(NUA,NUB,NOB,NUA)
      DIMENSION VHHHP1(1),VPPP(NUB,NUB,NUA),VPPP2(NUA,NUB,NUA)
      DIMENSION OHHPB(NOB,NOB,NUA),OPPPB(NUB,NUB,NUA)
      DIMENSION R2B(NOB,NUB,NUA),OHHPB2(1)
      DIMENSION T2(1),T2B(NOA,NUB,NOB,NUA)
C
      NOB2UAB=NOB2UA*NUB
      DO 1,IA=1,NACTB
       CALL ZEROMA(HR3,1,NO2U2)
       IF(IA.LE.NACTA) THEN
       CALL RDTAB(NOA,NUA,NUB,NOB,R3,(I3REC+LREC1+IA),98)
       CALL CCMATMUL(VHPHP2,R3,HR3,NOBUB,NOBUB,NOAUA,1,1)
       CALL RDTAB(NOB,NUB,NUB,NOB,R3,(I3REC+LREC3+IA),98)
       CALL CCMATMUL(VHPHP1,R3,HR3,NOBUB,NOBUB,NOBUB,0,1)
       CALL TRANSQ(R3,NOBUB)
       CALL TRANSQ(HR3,NOBUB)
       CALL CCMATMUL(R3,FPPB,HR3,NOB2UB,NUB,NUB,0,0)
       CALL TRANSQ(HR3,NOBUB)
       CALL WRTAB(NOB,NUB,NUB,NOB,HR3,(INTREC+IHREC+IA),98)
       CALL INSITU(NUB,NOB,NOB,NUB,TI,R3,13)
       CALL TRAN24(NOB,NUB,NUB,NOB,TI,HR3)
       CALL CCMATMUL(VHHHH,R3,HR3,NOB2,NUB2,NOB2,0,0)
       CALL VECMUL(R2B,NOBUAB,HALF)
       CALL CCMATMUL(VHHHP1,R2B(1,1,IA),HR3,NOB2UB,NUB,NOB,0,1)
       CALL TRAN24(NOB,NOB,NUB,NUB,TI,HR3)
       CALL TRAN24(NOB,NOB,NUB,NUB,TI,R3)
       CALL CCMATMUL(R3,FHHB,HR3,NOBUB2,NOB,NOB,0,1)
       CALL CCMATMUL(R2B(1,1,IA),VHPPP1,HR3,NOB,NOBUB2,NUB,0,1)
       CALL VECMUL(R2B,NOBUAB,TWO)
       CALL CCMATMUL(R2B,VHPPP2(1,1,1,IA),HR3,NOBUB,NOBUB,NUA,0,0)
       CALL CCMATMUL(OHHPB(1,1,IA),T2,HR3,NOB,NOBUB2,NOB,0,1)
       CALL TRANSQ(T2,NOBUB)
       CALL TRANSQ(HR3,NOBUB)
       CALL CCMATMUL(T2,OPPPB(1,1,IA),HR3,NOB2UB,NUB,NUB,0,0)
       CALL TRANSQ(HR3,NOBUB)
       CALL TRANSQ(T2,NOBUB)
       CALL TRAN14(NUA,NOB,NUA,NOB,TI,VHPHP3)
       DO 2,IE=1,NACTB
        IF(IE.LE.NACTA) THEN
        CALL RDTAB(NOB,NUB,NUB,NOB,R3,(I3REC+LREC3+IE),98)
        CALL ZEROO(NOB,NUB,R3)
        CALL VECMUL(R3,NOB2UB2,HALF)
        CALL CCMATMUL(R3,FPPA(IE,IA),HR3,NOB2UB2,1,1,0,0)
        CALL CCMATMUL(R3,VHPHP3(1,1,IE,IA),HR3,NOBUB2,NOB,NOB,0,1)
        CALL TRANSQ(HR3,NOBUB)
        CALL TRANSQ(R3,NOBUB)
        READ(NFT899,REC=NUA+NUB+NUB+IE) VPPP
        CALL INSITU(NUA,NUB,NUB,1,TI,VPPP,13)
        CALL CCMATMUL(R3,VPPP(1,1,IA),HR3,NOB2UB,NUB,NUB,0,0)
        CALL INSITU(NUB,NOB,NOB,NUB,TI,HR3,13)
        ELSE
        CALL TRAN24(NOB,NUB,NUB,NOB,TI,HR3)
        END IF
        CALL RDTAB(NOB,NOB,NUB,NUA,R3,(I3REC+LREC4+IE),98)
        CALL VECMUL(R3,NOB2UAB,HALF)
        CALL ZEROP(NOB,NUB,NUA,R3)
        READ(NFT899,REC=NUA+NUB+IE) VPPP2
        CALL TRANMD(VPPP2,NUA,NUB,NUA,1,13)
        CALL CCMATMUL(R3,VPPP2(1,1,IA),HR3,NOB2UB,NUB,NUA,0,0)
        CALL TRAN24(NOB,NOB,NUB,NUB,TI,HR3)
 2     CONTINUE
       CALL TRAN14(NOB,NOB,NUA,NUA,TI,VHPHP3)
       CALL CCMATMUL(OHHPB2,T2B(1,1,1,IA),HR3,NOBUB,NOBUB,NOA,0,0)
       CALL WRTAB(NOB,NUB,NUB,NOB,HR3,(I3REC+IHREC+LREC3+IA),98)
       END IF
C
       CALL HRLOOPBB2(NOA,NUA,NOB,NUB,R3,HR3,FPPA,FPPB,FHHB,VHPHP1,
     *                VHPHP2,VHPHP3,VHHHH,VHPPP1,VHPPP2,VHHHP1,VPPP,
     *                VPPP2,OHHPB,OPPPB,OHHPB2,R2B,T2,T2B,TI,
     *                I3REC,INTREC,IA)
C
       CALL ZEROMA(HR3,1,NO2U2)
       CALL RDTAB(NOB,NOB,NUB,NUA,R3,(I3REC+LREC4+IA),98)
       CALL TRAN34N(NOB,NOB,NUB,NUA,TI,R3)
       CALL CCMATMUL(R3,FPPB,HR3,NOB2UA,NUB,NUB,1,0)
       CALL TRAN34N(NOB,NOB,NUA,NUB,TI,HR3)
       CALL INSITU(NOB,NOB,NUB,NUA,TI,HR3,23)
       CALL TRT1(NOB2UA,NUB,TI,R3)
       CALL INSITU(NUB,NOB,NOB,NUA,TI,R3,12)
       CALL CCMATMUL(VHPHP1,R3,HR3,NOBUB,NOBUA,NOBUB,0,1)
       CALL RDTAB(NOA,NUA,NUA,NOB,R3,(I3REC+LREC2+IA),98)
       CALL TRANMD(R3,NOA,NUA,NUA,NOB,23)
       CALL TRAN34N(NOA,NUA,NUA,NOB,TI,R3)
       CALL CCMATMUL(VHPHP2,R3,HR3,NOBUB,NOBUA,NOAUA,0,0)
       CALL INSITU(NOB,NUB,NOB,NUA,TI,HR3,23)
       CALL WRTAB(NOB,NOB,NUB,NUA,HR3,(INTREC+IHREC+LREC4+IA),98)
C
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK HRLOOPBB2
      SUBROUTINE HRLOOPBB2(NOA,NUA,NOB,NUB,R3,HR3,FPPA,FPPB,FHHB,VHPHP1,
     *                    VHPHP2,VHPHP3,VHHHH,VHPPP1,VHPPP2,VHHHP1,VPPP,
     *                    VPPP2,OHHPB,OPPPB,OHHPB2,R2B,T2,T2B,TI,
     *                    I3REC,INTREC,IA)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
C
      DATA TWO/2.0D+00/, HALF/0.5D+00/
C
      DIMENSION R3(1),HR3(1)
      DIMENSION FPPA(1),FPPB(NUB,NUB),FHHB(1),VHHHH(1)
      DIMENSION VHPHP1(NOB,NOB,NUB,NUB),VHPHP2(NOB,NOA,NUB,NUA)
      DIMENSION VHPHP3(1)
      DIMENSION VHPPP1(NUB,NUB,NOB,NUB),VHPPP2(NUA,NUA,NOB,NUB)
      DIMENSION VHHHP1(NOB,NOB,NOB,NUB),VPPP(NUA,NUA,NUB)
      DIMENSION OHHPB(1),OPPPB(NUB,NUA,NUB)
      DIMENSION R2B(NOB,NUA,NUB),OHHPB2(NOB,NOA,NUB)
      DIMENSION T2(NOB,NUB,NOB,NUB),T2B(NOB,NUA,NOA,NUB)
      DIMENSION VPPP2(NUB,NUA,NUB)
C
      NOB2UAB=NOB2UA*NUB
      CALL ZEROMA(R3,1,NO2U2)
      CALL ZEROMA(HR3,1,NO2U2)
      CALL RDTAB(NOB,NOB,NUB,NUA,R3,(I3REC+LREC4+IA),98)
      CALL CCMATMUL(R3,FPPA,HR3,NOB2UB,NUA,NUA,1,0)
      CALL TRT1(NOB2UB,NUA,TI,R3)
      CALL TRT1(NOB2UB,NUA,TI,HR3)
      CALL CCMATMUL(VHPHP3,R3,HR3,NOBUA,NOBUB,NOBUA,0,1)
      CALL TRAN1TO4(NUA,NOB,NOB,NUB,TI,HR3)
      CALL WRTAB(NOB,NOB,NUB,NUA,HR3,(INTREC+IHREC+LREC2+IA),98)
      CALL TRAN1TO4(NUA,NOB,NOB,NUB,TI,R3)
      CALL VECMUL(R3,NOB2UAB,TWO)
      CALL CCMATMUL(VHHHH,R3,HR3,NOB2,NUAB,NOB2,0,0)
      CALL TRT1(NOB2,NUAB,TI,R3)
      CALL TRT1(NOB2,NUAB,TI,HR3)
      CALL CCMATMUL(R3,FHHB,HR3,NOBUAB,NOB,NOB,0,1)
      CALL TRT1(NUAB,NOB2,TI,HR3)
      CALL TRAN34N(NOB,NOB,NUB,NOB,TI,VHHHP1)
      CALL VECMUL(R2B,NOBUAB,HALF)
      CALL CCMATMUL(VHHHP1(1,1,1,IA),R2B,HR3,NOB2,NUAB,NOB,0,0)
      CALL TRAN34N(NOB,NOB,NOB,NUB,TI,VHHHP1)
      CALL INSITU(NOB,NUB,NUA,1,TI,R2B,23)
      CALL CCMATMUL(VHHHP1,R2B(1,1,IA),HR3,NOB2UB,NUA,NOB,0,1)
      CALL VECMUL(R2B,NOBUAB,TWO)
      CALL INSITU(NOB,NOB,NUB,NUA,TI,HR3,23)
      CALL CCMATMUL(R2B(1,1,IA),VHPPP2,HR3,NOB,NOBUAB,NUA,0,0)
      CALL INSITU(NOB,NUB,NOB,NUA,TI,HR3,23)
      CALL TRAN34N(NUB,NUB,NUB,NOB,TI,VHPPP1)
      CALL TRAN24(NOB,NOB,NUB,NUA,TI,HR3)
      CALL CCMATMUL(R2B,VHPPP1(1,1,1,IA),HR3,NOBUA,NOBUB,NUB,0,0)
      CALL TRAN34N(NUB,NUB,NOB,NUB,TI,VHPPP1)
      CALL INSITU(NOB,NUA,NUB,1,TI,R2B,23)
      CALL TRAN24(NUA,NUB,NOB,NUA,TI,VHPPP2)
      CALL INSITU(NOB,NUA,NUB,NOB,TI,HR3,23)
      CALL CCMATMUL(R2B,VHPPP2(1,1,1,IA),HR3,NOBUB,NOBUA,NUA,0,1)
      CALL INSITU(NOB,NUB,NUA,NOB,TI,HR3,23)
      CALL TRAN24(NUA,NUA,NOB,NUB,TI,VHPPP2)
      CALL TRAN24(NOB,NUB,NUB,NOB,TI,T2)
      CALL INSITU(NOB,NOB,NUB,NUB,TI,T2,23)
      CALL INSITU(NOB,NOB,NUA,1,TI,OHHPB,23)
      CALL VECMUL(T2,NOB2UB2,TWO)
      CALL CCMATMUL(OHHPB,T2(1,1,1,IA),HR3,NOBUA,NOBUB,NOB,0,1)
      CALL VECMUL(T2,NOB2UB2,HALF)
      CALL INSITU(NOB,NUA,NOB,1,TI,OHHPB,23)
      CALL INSITU(NOB,NUB,NOB,NUB,TI,T2,23)
      CALL INSITU(NOB,NUB,NOA,1,TI,OHHPB2,13)
      CALL TRT1(NOAUB,NOBUA,TI,T2B)
      CALL CCMATMUL(T2B(1,1,1,IA),OHHPB2,HR3,NOBUA,NOBUB,NOA,0,0)
      CALL TRT1(NOBUA,NOAUB,TI,T2B)
      CALL INSITU(NOA,NUB,NOB,1,TI,OHHPB2,13)
      CALL TRAN24(NOB,NUA,NUB,NOB,TI,HR3)
      CALL INSITU(NUB,NUB,NUA,1,TI,OPPPB,23)
      CALL CCMATMUL(T2,OPPPB(1,1,IA),HR3,NOB2UB,NUA,NUB,0,0)
      CALL INSITU(NUB,NUA,NUB,1,TI,OPPPB,23)
      CALL CCMATMUL(T2(1,1,1,IA),OPPPB,HR3,NOB2,NUAB,NUB,0,0)
      CALL INSITU(NOB,NUB,NOA,1,TI,OHHPB2,23)
      CALL INSITU(NOA,NUB,NOB,NUA,TI,T2B,23)
      CALL CCMATMUL(OHHPB2(1,1,IA),T2B,HR3,NOB,NOBUAB,NOA,0,0)
      CALL INSITU(NOA,NOB,NUB,NUA,TI,T2B,23)
      CALL INSITU(NOB,NOA,NUB,1,TI,OHHPB2,23)
      CALL TRAN24(NOB,NOB,NUB,NUB,TI,T2)
C
      CALL INSITU(NOB,NUB,NOB,NUB,TI,VHPHP1,23)
      CALL INSITU(NOB,NUB,NOA,NUA,TI,VHPHP2,23)
      DO 3,IE=1,NACTB
       CALL RDTAB(NOB,NOB,NUB,NUA,R3,(I3REC+LREC4+IE),98)
       CALL ZEROP(NOB,NUB,NUA,R3)
       READ(NFT899,REC=NUA+NUB+IE) VPPP
       CALL VECMUL(VPPP,NUA2UB,HALF)
       CALL TRT1(NUAB,NUA,TI,VPPP)
       CALL CCMATMUL(R3,VPPP(1,1,IA),HR3,NOB2UB,NUA,NUA,0,0)
       CALL ZEROG(NUA,NOB,NUB,R3)
       CALL CCMATMUL(FPPB(IE,IA),R3,HR3,1,NOB2UAB,1,0,0)
       CALL CCMATMUL(VHPHP1(1,1,IA,IE),R3,HR3,NOB,NOBUAB,NOB,0,1)
       IF(IE.LE.NACTA) THEN
       CALL RDTAB(NOA,NUA,NUB,NOB,R3,(I3REC+LREC1+IE),98)
       CALL ZEROS(NOA,NUA,NOB,NUB,R3)
       CALL ZEROS2(NOA,NUA,NOB,NUB,R3)
       CALL TRAN24(NOA,NUA,NUB,NOB,TI,R3)
       CALL CCMATMUL(VHPHP2(1,1,IA,IE),R3,HR3,NOB,NOBUAB,NOA,0,0)
       CALL RDTAB(NOB,NUB,NUB,NOB,R3,(I3REC+LREC3+IE),98)
       CALL ZEROO(NOB,NUB,R3)
       CALL TRAN24(NOB,NUB,NUB,NOB,TI,R3)
       READ(NFT899,REC=NUA+NUB+NUB+IE)VPPP2
       CALL TRT1(NUAB,NUB,TI,VPPP2)
       CALL VECMUL(R3,NOB2UB2,HALF)
       CALL CCMATMUL(R3,VPPP2(1,1,IA),HR3,NOB2UB,NUA,NUB,0,0)
       END IF
       CALL RDTAB(NOB,NOB,NUB,NUA,R3,(I3REC+LREC4+IE),98)
       CALL ZEROG(NUA,NOB,NUB,R3)
       CALL ZEROH3(NUA,NOB,NUB,IE,R3)
       CALL TRAN34N(NOB,NOB,NUB,NUA,TI,R3)
       CALL TRAN34N(NOB,NOB,NUB,NUA,TI,HR3)
       CALL VECMUL(R3,NOB2UAB,HALF)
       I=IA
       CALL R3VPPP(NUA,NUB,R3,VPPP,HR3,TI,I,IE)
       CALL TRAN34N(NOB,NOB,NUA,NUB,TI,HR3)
 3    CONTINUE
      CALL INSITU(NOB,NOB,NUB,NUB,TI,VHPHP1,23)
      CALL INSITU(NOB,NOA,NUB,NUA,TI,VHPHP2,23)
      CALL WRTAB(NOB,NOB,NUB,NUA,HR3,(I3REC+IHREC+LREC4+IA),98)
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK R3VPPP
      SUBROUTINE R3VPPP(NUA,NUB,R3,VPPP,HR3,TI,IA,IE)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      DIMENSION VPPP(NUB,NUB,NUB),R3(1),HR3(1)
C
      READ(NFT899,REC=NUA+IE)VPPP
      CALL TRT1(NUB2,NUB,TI,VPPP)
      CALL CCMATMUL(R3,VPPP(1,1,IA),HR3,NOB2UA,NUB,NUB,0,0)
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK HRMAKEBB
      SUBROUTINE HRMAKEBB(NUA,NOB,NUB,R3,HR3,R3B,R3C,
     *                    T2,I3REC,INTREC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION R3(NUB,NOB,NOB,NUB)
      DIMENSION R3B(NUB,NOB,NOB,NUA)
      DIMENSION R3C(NUB,NOB,NOB,NUA)
      DIMENSION HR3(NUB,NOB,NOB,NUB)
      DIMENSION T2(1)
C
      DATA TWO/2.0D+00/, HALF/0.5D+00/, ONE/1.00D+00/
      DATA ONEN/-1.0D+00/, HALFN/-0.5D+00/
C
      NOB2UAB=NOB2UA*NUB
      DO 1,IA=1,NACTB
       IF(IA.LE.NACTA) THEN
       CALL RDTAB(NOB,NUB,NUB,NOB,HR3,(I3REC+IHREC+LREC3+IA),98)
       CALL RDTAB(NUB,NUB,NOB,NOB,R3,(INTREC+LREC3+IA),98)
       CALL INSITU(NUB,NUB,NOB,NOB,T2,R3,13)
       CALL DAXPY(NOB2UB2,ONE,R3,1,HR3,1)
       CALL ZEROMA(R3,1,NO2U2)
C
       CALL TRANSQ(HR3,NOBUB)
       DO 2,IB=1,NACTB
        CALL RDTAB(NOB,NOB,NUB,NUA,R3B,(INTREC+IHREC+LREC2+IB),98)
        CALL INSITU(NOB,NOB,NUB,NUA,T2,R3B,13)
        CALL DAXPY(NOB2UB,HALF,R3B(1,1,1,IA),1,HR3(1,1,1,IB),1)
        CALL TRANMD(HR3,NUB,NOB,NOB,NUB,14)
        CALL RDTAB(NUA,NUB,NOB,NOB,R3C,(INTREC+LREC4+IB),98)
        CALL TRAN1TO4(NUA,NUB,NOB,NOB,T2,R3C)
        CALL DAXPY(NOB2UB,ONEN,R3C(1,1,1,IA),1,HR3(1,1,1,IB),1)
        CALL ZERON(NOB,NUB,NUA,R3B)
        CALL DAXPY(NOB2UB,HALFN,R3B(1,1,1,IA),1,HR3(1,1,1,IB),1)
        CALL TRANMD(HR3,NUB,NOB,NOB,NUB,14)
 2     CONTINUE
       CALL TRANSQ(HR3,NOBUB)
C
       CALL ZEROMA(R3,1,NO2U2)
       CALL SYMETR2(HR3,NOB,NUB,R3)
       CALL WRTAB(NOB,NUB,NUB,NOB,HR3,(I3REC+IHREC+LREC3+IA),98)
       END IF
C
       CALL RDTAB(NOB,NOB,NUB,NUA,R3B,(I3REC+IHREC+LREC4+IA),98)
       CALL RDTAB(NOB,NOB,NUB,NUA,R3C,(INTREC+IHREC+LREC4+IA),98)
       CALL DAXPY(NOB2UAB,ONE,R3C,1,R3B,1)
       CALL RDTAB(NUA,NUB,NOB,NOB,R3C,(INTREC+LREC4+IA),98)
       CALL INSITU(NUA,NUB,NOB,NOB,T2,R3C,12)
       CALL TRT1(NUAB,NOB2,T2,R3C)
       CALL DAXPY(NOB2UAB,ONEN,R3C,1,R3B,1)
C
       DO 3,IB=1,NACTA
        CALL RDTAB(NUB,NUB,NOB,NOB,R3,(INTREC+LREC3+IB),98)
        CALL TRT1(NUB2,NOB2,T2,R3)
        CALL DAXPY(NOB2UB,TWO,R3(1,1,1,IA),1,R3B(1,1,1,IB),1)
        CALL RDTAB(NOB,NUB,NUB,NOB,R3,(INTREC+IHREC+IB),98)
        CALL TRANSQ(R3,NOBUB)
        CALL INSITU(NUB,NOB,NOB,NUB,T2,R3,13)
        CALL DAXPY(NOB2UB,ONE,R3(1,1,1,IA),1,R3B(1,1,1,IB),1)
 3     CONTINUE
C
       CALL TRAN34N(NOB,NOB,NUB,NUA,T2,R3B)
       CALL HRMAKBB2(NUA,NOB,NUB,R3,R3B,
     *               T2,IA,INTREC)
       CALL TRAN34N(NOB,NOB,NUA,NUB,T2,R3B)
C
       CALL ZEROMA(R3,1,NO2U2)
       CALL SYMETR3IJ(R3B,NOB,NUB,NUA,R3)
       CALL WRTAB(NOB,NOB,NUB,NUA,R3B,(I3REC+IHREC+LREC4+IA),98)
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK HRMAKBB2
      SUBROUTINE HRMAKBB2(NUA,NOB,NUB,R3,R3B,
     *                    T2,IA,INTREC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION R3(NOB,NOB,NUA,NUB)
      DIMENSION R3B(NOB,NOB,NUA,NUB)
      DIMENSION T2(1)
C
      DATA ONE/1.00D+00/
      DATA ONEN/-1.0D+00/
C
      DO 4,IC=1,NACTB
       CALL RDTAB(NUA,NUB,NOB,NOB,R3,(INTREC+LREC4+IC),98)
       CALL TRT1(NUAB,NOB2,T2,R3)
       CALL DAXPY(NOB2UA,ONE,R3(1,1,1,IA),1,R3B(1,1,1,IC),1)
       CALL RDTAB(NOB,NOB,NUB,NUA,R3,(INTREC+IHREC+LREC4+IC),98)
       CALL ZEROG(NUA,NOB,NUB,R3)
       CALL TRAN34N(NOB,NOB,NUB,NUA,T2,R3)
       CALL DAXPY(NOB2UA,ONEN,R3(1,1,1,IA),1,R3B(1,1,1,IC),1)
4     CONTINUE
C
      RETURN
      END
C*MODULE EAIPCC  *DECK HRLOOPAB
      SUBROUTINE HRLOOPAB(NOA,NUA,NOB,NUB,R3,HR3,FPPA,FPPB,FHHA,FHHB,
     *                    VHPHP1,VHPHP2,VHPHP3,VHPHP4,VHPHP5,VHPHP6,
     *                    VHHHH,VHPPP1,VHPPP2,VHPPP3,VHHHP1,VHHHP2,
     *                    OPPPA,OPPPB,OHHPA,OHHPB,OHHPB2,T2,T2B,
     *                    VPPP,R2A,R2B,TI,I3REC,INTREC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
C
      DATA TWO/2.0D+00/
C
      DIMENSION R3(1),HR3(1),VPPP(NUB,NUB,NUA)
      DIMENSION FPPA(NUA,NUA),FPPB(1)
      DIMENSION FHHA(1),FHHB(1),VHHHH(1)
      DIMENSION VHPHP1(NOA,NOA,NUA,NUA),VHPHP2(NOB,NOB,NUA,NUA)
      DIMENSION VHPHP3(NOA,NOB,NUA,NUB)
      DIMENSION VHPHP4(1),VHPHP5(1),VHPHP6(1)
      DIMENSION VHPPP1(NUA,NUB,NOB,NUA),VHPPP2(NUB,NUB,NOA,NUA)
      DIMENSION VHPPP3(NOA,NUA,NUA,NUA)
      DIMENSION VHHHP1(1),VHHHP2(NOA,NOB,NOB,NUA)
      DIMENSION R2A(NOA,NUA,NUA),R2B(NOB,NUB,NUA)
      DIMENSION OPPPA(NUA,NUA,NUA),OPPPB(NUB,NUB,NUA)
      DIMENSION OHHPA(NOA,NOA,NUA),OHHPB(NOB,NOB,NUA)
      DIMENSION OHHPB2(1)
      DIMENSION T2(NOA,NOB,NUB,NUA),T2B(NOA,NUA,NOA,NUA)
C
      DO 1,IA=1,NACTB
       CALL ZEROMA(HR3,1,NO2U2)
       IF(IA.LE.NACTA) THEN
       CALL RDTAB(NOB,NUB,NUB,NOB,R3,(I3REC+LREC3+IA),98)
       CALL CCMATMUL(VHPHP3,R3,HR3,NOAUA,NOBUB,NOBUB,1,1)
       CALL RDTAB(NOA,NUA,NUB,NOB,R3,(I3REC+LREC1+IA),98)
       CALL CCMATMUL(VHPHP1,R3,HR3,NOAUA,NOBUB,NOAUA,0,1)
       CALL TRT1(NOAUA,NOBUB,TI,R3)
       CALL TRT1(NOAUA,NOBUB,TI,HR3)
       CALL CCMATMUL(R3,FPPA,HR3,NOABUB,NUA,NUA,0,0)
       CALL TRAN14(NUB,NOB,NOA,NUA,TI,R3)
       CALL TRAN14(NUB,NOB,NOA,NUA,TI,HR3)
       CALL CCMATMUL(VHPHP2,R3,HR3,NOBUA,NOAUB,NOBUA,0,1)
       CALL TRAN14(NUA,NOB,NOA,NUB,TI,HR3)
       CALL TRT1(NOBUB,NOAUA,TI,HR3)
       CALL WRTAB(NOA,NUA,NUB,NOB,HR3,(INTREC+IHREC+IA),98)
       CALL TRAN14(NUA,NOB,NOA,NUB,TI,R3)
       CALL TRT1(NOBUB,NOAUA,TI,R3)
       CALL VECMUL(R3,NO2U2AB,TWO)
       CALL CCMATMUL(R3,FHHB,HR3,NOAUAB,NOB,NOB,0,1)
       CALL CCMATMUL(FHHA,R3,HR3,NOA,NOBUAB,NOA,0,1)
       CALL TRAN24(NOA,NUA,NUB,NOB,TI,HR3)
       CALL TRAN24(NOA,NUA,NUB,NOB,TI,R3)
       CALL INSITU(NUB,NOB,NOA,NUA,TI,T2,13)
       CALL CCMATMUL(T2(1,1,1,IA),OPPPB,HR3,NOAB,NUAB,NUB,0,1)
       CALL INSITU(NOA,NOB,NUB,NUA,TI,T2,13)
       CALL CCMATMUL(VHHHP1,R2A(1,1,IA),HR3,NOABUB,NUA,NOA,0,1)
       CALL CCMATMUL(VHHHH,R3,HR3,NOAB,NUAB,NOAB,0,0)
       CALL TRAN34N(NOA,NOB,NUA,NOB,TI,VHHHP2)
       CALL CCMATMUL(VHHHP2(1,1,1,IA),R2B,HR3,NOAB,NUAB,NOB,0,0)
       CALL TRAN34N(NOA,NOB,NOB,NUA,TI,VHHHP2)
       CALL TRAN34N(NOA,NOB,NUB,NUA,TI,HR3)
       CALL CCMATMUL(VHHHP2,R2B(1,1,IA),HR3,NOABUA,NUB,NOB,0,1)
       CALL TRAN34N(NOA,NOB,NUA,NUB,TI,HR3)
       CALL INSITU(NOA,NOB,NUB,NUA,TI,HR3,23)
       CALL CCMATMUL(R2A(1,1,IA),VHPPP1,HR3,NOA,NOBUAB,NUA,0,0)
       CALL INSITU(NOA,NUB,NOB,NUA,TI,HR3,23)
       CALL TRAN24(NOA,NOB,NUB,NUA,TI,HR3)
       CALL TRANMD(R2A,NOA,NUA,NUA,1,23)
       CALL CCMATMUL(R2A,VHPPP1(1,1,1,IA),HR3,NOAUA,NOBUB,NUA,0,1)
       CALL TRANMD(R2A,NOA,NUA,NUA,1,23)
       CALL TRAN14(NOA,NUA,NUB,NOB,TI,HR3)
       CALL INSITU(NOB,NUB,NUA,1,TI,R2B,23)
       CALL CCMATMUL(R2B,VHPPP2(1,1,1,IA),HR3,NOBUA,NOAUB,NUB,0,1)
       CALL INSITU(NOB,NUA,NUB,1,TI,R2B,23)
       CALL TRAN14(NOB,NUA,NUB,NOA,TI,HR3)
       CALL TRT1(NOAUA,NOBUB,TI,HR3)
       CALL CCMATMUL(T2(1,1,1,IA),OHHPA,HR3,NOBUB,NOAUA,NOA,0,0)
       CALL CCMATMUL(T2,OPPPA(1,1,IA),HR3,NOABUB,NUA,NUA,0,0)
       CALL TRANMD(OPPPB,NUB,NUB,NUA,1,12)
       CALL CCMATMUL(OPPPB(1,1,IA),T2,HR3,NUB,NOABUA,NUB,0,0)
       CALL TRANMD(OPPPB,NUB,NUB,NUA,1,12)
       CALL INSITU(NUB,NOB,NOA,NUA,TI,HR3,12)
       CALL CCMATMUL(R2B(1,1,IA),VHPPP2,HR3,NOB,NOAUAB,NUB,0,0)
       CALL INSITU(NOB,NUB,NOA,NUA,TI,HR3,12)
       CALL INSITU(NUB,NOB,NOA,NUA,TI,HR3,23)
       CALL INSITU(NUB,NOB,NOA,NUA,TI,T2,23)
       CALL CCMATMUL(T2(1,1,1,IA),OHHPB,HR3,NOAUB,NOBUA,NOB,0,0)
       CALL INSITU(NUB,NOA,NOB,NUA,TI,T2,23)
       CALL INSITU(NUB,NOA,NOB,NUA,TI,HR3,23)
       CALL TRT1(NOBUB,NOAUA,TI,HR3)
       CALL INSITU(NOB,NUB,NUA,1,TI,R2B,13)
       CALL CCMATMUL(VHPPP3(1,1,1,IA),R2B,HR3,NOAUA,NOBUB,NUA,0,0)
       CALL INSITU(NUA,NUB,NOB,1,TI,R2B,13)
       CALL TRT1(NOBUB,NOAUA,TI,T2)
       CALL TRANMD(OHHPA,NOA,NOA,NUA,1,12)
       CALL CCMATMUL(OHHPA(1,1,IA),T2,HR3,NOA,NOBUAB,NOA,0,1)
       CALL TRANMD(OHHPA,NOA,NOA,NUA,1,12)
       CALL CCMATMUL(T2,OHHPB(1,1,IA),HR3,NOAUAB,NOB,NOB,0,1)
       CALL TRT1(NOAUA,NOBUB,TI,T2)
       CALL CCMATMUL(T2B(1,1,1,IA),OHHPB2,HR3,NOAUA,NOBUB,NOA,0,0)
       CALL INSITU(NOA,NUA,NOA,NUA,TI,VHPHP1,23)
       CALL TRAN14(NUA,NOB,NUA,NOB,TI,VHPHP2)
       CALL INSITU(NOA,NUA,NOB,NUB,TI,VHPHP3,23)
       DO 2,IE=1,NACTB
        IF(IE.LE.NACTA) THEN
        CALL RDTAB(NOA,NUA,NUB,NOB,R3,(I3REC+LREC1+IE),98)
        CALL ZEROS(NOA,NUA,NOB,NUB,R3)
        READ(NFT899,REC=NUA+NUB+NUB+IE) VPPP
        CALL TRT1(NOAUA,NOBUB,TI,R3)
        CALL TRT1(NOAUA,NOBUB,TI,HR3)
        CALL TRT1(NUA,NUB2,TI,VPPP)
        CALL CCMATMUL(VPPP(1,1,IA),R3,HR3,NUB,NOABUA,NUB,0,0)
        CALL TRT1(NOBUB,NOAUA,TI,HR3)
        CALL TRT1(NOBUB,NOAUA,TI,R3)
        CALL ZEROS2(NOA,NUA,NOB,NUB,R3)
        CALL CCMATMUL(FPPA(IE,IA),R3,HR3,1,NO2U2AB,1,0,0)
        CALL CCMATMUL(VHPHP1(1,1,IA,IE),R3,HR3,NOA,NOBUAB,NOA,0,1)
        CALL CCMATMUL(R3,VHPHP2(1,1,IE,IA),HR3,NOAUAB,NOB,NOB,0,1)
        CALL RDTAB(NOA,NUA,NUB,NOB,R3,(I3REC+LREC1+IE),98)
        CALL ZEROR(NOA,NUA,NOB,NUB,IE,R3)
        CALL TRT1(NOAUA,NOBUB,TI,R3)
        CALL TRT1(NOAUA,NOBUB,TI,HR3)
        CALL R3VPPP2(NUA,R3,VPPP,HR3,TI,IA,IE)
        ELSE
        CALL TRT1(NOAUA,NOBUB,TI,HR3)
        END IF
        CALL RDTAB(NOA,NUA,NUB,NOB,R3,(I3REC+LREC2+IE),98)
        CALL TRT1(NOAUA,NOBUA,TI,R3)
        CALL ZEROE(NOA,NOB,NUA,R3)
        CALL R3VPPP3(NUA,NUB,R3,VPPP,HR3,TI,IA,IE)
        CALL TRT1(NOBUB,NOAUA,TI,HR3)
        CALL RDTAB(NOB,NOB,NUB,NUA,R3,(I3REC+LREC4+IE),98)
        CALL ZEROG(NUA,NOB,NUB,R3)
        CALL ZEROP(NOB,NUB,NUA,R3)
        CALL TRT1(NOB2,NUAB,TI,R3)
        CALL INSITU(NUB,NUA,NOB,NOB,TI,R3,13)
        CALL CCMATMUL(VHPHP3(1,1,IA,IE),R3,HR3,NOA,NOBUAB,NOB,0,0)
 2     CONTINUE
       CALL INSITU(NOA,NOA,NUA,NUA,TI,VHPHP1,23)
       CALL TRAN14(NOB,NOB,NUA,NUA,TI,VHPHP2)
       CALL INSITU(NOA,NOB,NUA,NUB,TI,VHPHP3,23)
C
       CALL WRTAB(NOA,NUA,NUB,NOB,HR3,(I3REC+IHREC+LREC1+IA),98)
C
       CALL ZEROMA(HR3,1,NO2U2)
       CALL RDTAB(NOA,NUA,NUB,NOB,R3,(I3REC+LREC1+IA),98)
       CALL TRT1(NOAUA,NOBUB,TI,R3)
       CALL CCMATMUL(FPPB,R3,HR3,NUB,NOABUA,NUB,1,0)
       CALL CCMATMUL(VHPHP6,R3,HR3,NOBUB,NOAUA,NOBUB,0,1)
       CALL INSITU(NUB,NOB,NOA,NUA,TI,R3,23)
       CALL INSITU(NUB,NOB,NOA,NUA,TI,HR3,23)
       CALL CCMATMUL(VHPHP4,R3,HR3,NOAUB,NOBUA,NOAUB,0,1)
       CALL INSITU(NUB,NOA,NOB,NUA,TI,HR3,23)
       CALL RDTAB(NOA,NUA,NUA,NOA,R3,(I3REC+IA),98)
       CALL TRANSQ(R3,NOAUA)
       CALL CCMATMUL(VHPHP5,R3,HR3,NOBUB,NOAUA,NOAUA,0,1)
       CALL TRT1(NOBUB,NOAUA,TI,HR3)
       CALL WRTAB(NOA,NUA,NUB,NOB,HR3,(INTREC+LREC1+IHREC+IA),98)
       END IF
C
       CALL HRLOOPAB2(NOA,NUA,NOB,NUB,R3,HR3,FPPA,FPPB,FHHA,FHHB,
     *                VHPHP1,VHPHP2,VHPHP3,VHPHP4,VHPHP5,VHPHP6,
     *                VHHHH,VHPPP1,VHPPP2,VHPPP3,VHHHP1,VHHHP2,
     *                OPPPA,OPPPB,OHHPA,OHHPB,OHHPB2,T2,T2B,
     *                VPPP,R2A,R2B,TI,I3REC,INTREC,IA)
C
 1     CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK HRLOOPAB2
      SUBROUTINE HRLOOPAB2(NOA,NUA,NOB,NUB,R3,HR3,FPPA,FPPB,FHHA,FHHB,
     *                    VHPHP1,VHPHP2,VHPHP3,VHPHP4,VHPHP5,VHPHP6,
     *                    VHHHH,VHPPP1,VHPPP2,VHPPP3,VHHHP1,VHHHP2,
     *                    OPPPA,OPPPB,OHHPA,OHHPB,OHHPB2,T2,T2B,
     *                    VPPP,R2A,R2B,TI,I3REC,INTREC,IA)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
C
      DATA TWO/2.0D+00/, HALF/0.5D+00/
C
      DIMENSION R3(1),HR3(1),VPPP(NUA,NUA,NUB)
      DIMENSION FPPA(1),FPPB(NUB,NUB)
      DIMENSION FHHA(1),FHHB(1),VHHHH(1)
      DIMENSION VHPHP1(1),VHPHP2(1),VHPHP3(1)
      DIMENSION VHPHP4(NOA,NOA,NUB,NUB),VHPHP5(NOA,NOB,NUA,NUB)
      DIMENSION VHPHP6(NOB,NOB,NUB,NUB)
      DIMENSION VHPPP1(NUA,NUA,NOB,NUB),VHPPP2(NUB,NUA,NOA,NUB)
      DIMENSION VHPPP3(1),VHHHP1(NOA,NOB,NOA,NUB),VHHHP2(1)
      DIMENSION R2A(1),R2B(NOB,NUA,NUB)
      DIMENSION OPPPA(1),OPPPB(NUA,NUB,NUB)
      DIMENSION OHHPA(1),OHHPB(1),OHHPB2(NOA,NOB,NUB)
      DIMENSION T2(NOA,NOB,NUA,NUB),T2B(1)
C
      NOABUA2=NOABUA*NUA
      CALL ZEROMA(HR3,1,NO2U2)
      CALL RDTAB(NOB,NOB,NUB,NUA,R3,(I3REC+LREC4+IA),98)
      CALL TRAN1TO4(NOB,NOB,NUB,NUA,TI,R3)
      CALL CCMATMUL(VHPHP3,R3,HR3,NOAUA,NOBUA,NOBUB,1,0)
      CALL RDTAB(NOA,NUA,NUA,NOB,R3,(I3REC+LREC2+IA),98)
      CALL CCMATMUL(VHPHP1,R3,HR3,NOAUA,NOBUB,NOAUA,0,1)
      CALL TRT1(NOAUA,NOBUA,TI,R3)
      CALL TRT1(NOAUA,NOBUA,TI,HR3)
      CALL CCMATMUL(R3,FPPA,HR3,NOABUA,NUA,NUA,0,0)
      CALL TRANMD(HR3,NUA,NOB,NOA,NUA,14)
      CALL CCMATMUL(VHPHP2,R3,HR3,NOBUA,NOAUA,NOBUA,0,0)
      CALL TRANMD(HR3,NUA,NOB,NOA,NUA,14)
      CALL TRT1(NOBUA,NOAUA,TI,HR3)
      CALL WRTAB(NOA,NUA,NUA,NOB,HR3,(INTREC+IHREC+LREC2+IA),98)
      CALL TRT1(NOBUA,NOAUA,TI,R3)
      CALL CCMATMUL(R3,FHHB,HR3,NOAUA2,NOB,NOB,0,1)
      CALL CCMATMUL(FHHA,R3,HR3,NOA,NOBUA2,NOA,0,1)
      CALL TRAN24(NOA,NUA,NUA,NOB,TI,HR3)
      CALL TRAN24(NOA,NUA,NUA,NOB,TI,R3)
      CALL CCMATMUL(VHHHH,R3,HR3,NOAB,NUA2,NOAB,0,0)
      CALL INSITU(NOB,NUB,NUA,1,TI,R2B,23)
      CALL CCMATMUL(VHHHP2,R2B(1,1,IA),HR3,NOABUA,NUA,NOB,0,1)
      CALL TRAN34N(NOA,NOB,NUB,NOA,TI,VHHHP1)
      CALL VECMUL(R2A,NOAUA2,HALF)
      CALL CCMATMUL(VHHHP1(1,1,1,IA),R2A,HR3,NOAB,NUA2,NOA,0,1)
      CALL VECMUL(R2A,NOAUA2,TWO)
      CALL TRAN34N(NOA,NOB,NOA,NUB,TI,VHHHP1)
      CALL INSITU(NUB,NOB,NOA,NUA,TI,T2,13)
      CALL TRAN34N(NOA,NOB,NUB,NUA,TI,T2)
      CALL VECMUL(OPPPA,NUA3,HALF)
      CALL CCMATMUL(T2(1,1,1,IA),OPPPA,HR3,NOAB,NUA2,NUA,0,0)
      CALL VECMUL(OPPPA,NUA3,TWO)
      CALL TRAN34N(NOA,NOB,NUA,NUB,TI,T2)
      CALL INSITU(NOA,NOB,NUB,NUA,TI,T2,13)
      CALL TRAN24(NOA,NOB,NUA,NUA,TI,HR3)
      CALL TRAN14(NOA,NUA,NUA,NOB,TI,HR3)
      CALL TRAN24(NUB,NUB,NOA,NUA,TI,VHPPP2)
      CALL CCMATMUL(R2B,VHPPP2(1,1,1,IA),HR3,NOBUA,NOAUA,NUB,0,0)
      CALL TRAN24(NUB,NUA,NOA,NUB,TI,VHPPP2)
      CALL TRAN14(NOB,NUA,NUA,NOA,TI,HR3)
      CALL TRANMD(VHPPP3,NOA,NUA,NUA,NUA,34)
      CALL INSITU(NOB,NUA,NUB,1,TI,R2B,12)
      CALL VECMUL(R2B,NOBUAB,HALF)
      CALL CCMATMUL(VHPPP3,R2B(1,1,IA),HR3,NOAUA2,NOB,NUA,0,1)
      CALL VECMUL(R2B,NOBUAB,TWO)
      CALL TRT1(NUA,NOBUB,TI,R2B)
      CALL TRANMD(VHPPP3,NOA,NUA,NUA,NUA,34)
      CALL TRANMD(R2A,NOA,NUA,NUA,1,23)
      CALL TRAN24(NUA,NUB,NOB,NUA,TI,VHPPP1)
      CALL CCMATMUL(R2A,VHPPP1(1,1,1,IA),HR3,NOAUA,NOBUA,NUA,0,0)
      CALL TRAN24(NUA,NUA,NOB,NUB,TI,VHPPP1)
      CALL TRANMD(R2A,NOA,NUA,NUA,1,23)
      CALL TRT1(NOAUA,NOBUA,TI,HR3)
      CALL INSITU(NUB,NUB,NUA,1,TI,OPPPB,13)
      CALL TRANMD(OPPPB,NUA,NUB,NUB,1,23)
      CALL CCMATMUL(OPPPB(1,1,IA),T2,HR3,NUA,NOABUA,NUB,0,1)
      CALL TRANMD(OPPPB,NUA,NUB,NUB,1,23)
      CALL INSITU(NUA,NUB,NUB,1,TI,OPPPB,13)
      CALL TRAN14(NUB,NOB,NOA,NUA,TI,T2)
      CALL CCMATMUL(T2(1,1,1,IA),OHHPA,HR3,NOBUA,NOAUA,NOA,0,1)
      CALL TRAN14(NUA,NOB,NOA,NUB,TI,T2)
      CALL TRT1(NUB,NOABUA,TI,T2)
      CALL INSITU(NOB,NOB,NUA,1,TI,OHHPB,13)
      CALL CCMATMUL(OHHPB,T2(1,1,1,IA),HR3,NOBUA,NOAUA,NOB,0,0)
      CALL INSITU(NUA,NOB,NOB,1,TI,OHHPB,13)
      CALL TRT1(NOABUA,NUB,TI,T2)
      CALL TRT1(NOBUA,NOAUA,TI,HR3)
      CALL TRAN34N(NOA,NUA,NOA,NUA,TI,T2B)
      CALL INSITU(NOA,NUB,NOB,1,TI,OHHPB2,23)
      CALL VECMUL(OHHPB2,NOABUB,HALF)
      CALL CCMATMUL(T2B,OHHPB2(1,1,IA),HR3,NOAUA2,NOB,NOA,0,1)
      CALL VECMUL(OHHPB2,NOABUB,TWO)
      CALL INSITU(NOA,NOB,NUB,1,TI,OHHPB2,23)
      CALL TRAN34N(NOA,NUA,NUA,NOA,TI,T2B)
      CALL TRAN14(NUB,NOA,NUB,NOA,TI,VHPHP4)
      CALL TRANMD(VHPHP4,NOA,NOA,NUB,NUB,12)
      CALL TRAN14(NUB,NOB,NUA,NOA,TI,VHPHP5)
      CALL TRAN14(NUB,NOB,NUB,NOB,TI,VHPHP6)
      DO 3,IE=1,NACTB
       CALL RDTAB(NOA,NUA,NUA,NOB,R3,(I3REC+LREC2+IE),98)
       CALL ZEROM(NOA,NOB,NUA,R3)
       CALL TRT1(NOAUA,NOBUA,TI,HR3)
       CALL TRT1(NOAUA,NOBUA,TI,R3)
       READ(NFT899,REC=NUA+NUB+IE) VPPP
       CALL INSITU(NUA,NUB,NUA,1,TI,VPPP,23)
       CALL CCMATMUL(VPPP(1,1,IA),R3,HR3,NUA,NOABUA,NUA,0,0)
       CALL TRT1(NOBUA,NOAUA,TI,HR3)
       CALL TRT1(NOBUA,NOAUA,TI,R3)
       CALL VECMUL(R3,NOABUA2,HALF)
       CALL CCMATMUL(FPPB(IA,IE),R3,HR3,1,NOABUA2,1,0,0)
       CALL CCMATMUL(VHPHP4(1,1,IE,IA),R3,HR3,NOA,NOBUA2,NOA,0,1)
       CALL CCMATMUL(R3,VHPHP6(1,1,IE,IA),HR3,NOAUA2,NOB,NOB,0,1)
       IF(IE.LE.NACTA) THEN
       CALL RDTAB(NOA,NUA,NUA,NOA,R3,(I3REC+IE),98)
       CALL ZEROM2(NOA,NUA,R3)
       CALL VECMUL(R3,NOA2UA2,HALF)
       CALL CCMATMUL(R3,VHPHP5(1,1,IE,IA),HR3,NOAUA2,NOB,NOA,0,1)
       CALL RDTAB(NOA,NUA,NUB,NOB,R3,(I3REC+LREC1+IE),98)
       CALL ZEROS(NOA,NUA,NOB,NUB,R3)
       CALL TRT1(NOAUA,NOBUA,TI,HR3)
       CALL TRT1(NOAUA,NOBUB,TI,R3)
       I=IA
       CALL R3VPPP4(NUA,NUB,R3,VPPP,HR3,I,IE)
       CALL TRT1(NOBUA,NOAUA,TI,HR3)
       END IF
 3    CONTINUE
      CALL TRANMD(VHPHP4,NOA,NOA,NUB,NUB,12)
      CALL TRAN14(NOA,NOA,NUB,NUB,TI,VHPHP4)
      CALL TRAN14(NOA,NOB,NUA,NUB,TI,VHPHP5)
      CALL TRAN14(NOB,NOB,NUB,NUB,TI,VHPHP6)
      CALL WRTAB(NOA,NUA,NUA,NOB,HR3,(I3REC+IHREC+LREC2+IA),98)
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK R3VPPP2
      SUBROUTINE R3VPPP2(NUA,R3,VPPP,HR3,TI,IA,IE)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      DIMENSION VPPP(NUA,NUA,NUA),R3(1),HR3(1)
C
      READ(NFT899,REC=IE) VPPP
      CALL TRT1(NUA2,NUA,TI,VPPP)
      CALL CCMATMUL(R3,VPPP(1,1,IA),HR3,NOABUB,NUA,NUA,0,0)
      RETURN
      END
C
C*MODULE EAIPCC  *DECK R3VPPP3
      SUBROUTINE R3VPPP3(NUA,NUB,R3,VPPP,HR3,TI,IA,IE)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      DIMENSION VPPP(NUB,NUA,NUA),R3(1),HR3(1)
C
        READ(NFT899,REC=NUA+NUB+IE) VPPP
        CALL TRT1(NUA,NUAB,TI,VPPP)
        CALL CCMATMUL(VPPP(1,1,IA),R3,HR3,NUB,NOABUA,NUA,0,1)
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK R3VPPP4
      SUBROUTINE R3VPPP4(NUA,NUB,R3,VPPP,HR3,IA,IE)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      DIMENSION VPPP(NUA,NUB,NUB),R3(1),HR3(1)
C
       READ(NFT899,REC=NUA+NUB+NUB+IE) VPPP
       CALL TRANMD(VPPP,NUA,NUB,NUB,1,23)
       CALL CCMATMUL(VPPP(1,1,IA),R3,HR3,NUA,NOABUA,NUB,0,1)
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK HRMAKEAB
      SUBROUTINE HRMAKEAB(NOA,NUA,NOB,NUB,R3,HR3,R3B,HR3B,
     *                    T2,I3REC,INTREC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION R3(NUB,NOB,NOA,NUA)
      DIMENSION R3B(NOA,NOB,NUA,NUB)
      DIMENSION HR3(NUB,NOB,NOA,NUA)
      DIMENSION HR3B(NOA,NOB,NUA,NUA)
      DIMENSION T2(1)
C
      DATA HALF/0.5D+00/, ONE/1.00D+00/
      DATA ONEN/-1.0D+00/, HALFN/-0.5D+00/
C
      NOABUA2=NOABUA*NUA
      DO 1,IA=1,NACTB
       CALL ZEROMA(HR3,1,NO2U2)
       IF(IA.LE.NACTA) THEN
       CALL RDTAB(NOA,NUA,NUB,NOB,HR3,(I3REC+IHREC+LREC1+IA),98)
       CALL RDTAB(NOA,NUA,NUB,NOB,R3,(INTREC+IHREC+LREC1+IA),98)
       CALL DAXPY(NO2U2AB,ONE,R3,1,HR3,1)
       CALL ZEROMA(R3,1,NO2U2)
       CALL RDTAB(NUA,NUB,NOB,NOA,R3,(INTREC+LREC1+IA),98)
       CALL TRT1(NOBUAB,NOA,T2,R3)
       CALL DAXPY(NO2U2AB,ONE,R3,1,HR3,1)
       CALL TRT1(NOAUA,NOBUB,T2,HR3)
        DO 2,IB=1,NACTB
        IF(IB.LE.NACTA) THEN
        CALL RDTAB(NUA,NUB,NOB,NOA,R3,(INTREC+LREC1+IB),98)
        CALL TRAN1TO4(NUA,NUB,NOB,NOA,T2,R3)
        CALL DAXPY(NOABUB,ONEN,R3(1,1,1,IA),1,HR3(1,1,1,IB),1)
        CALL RDTAB(NOA,NUA,NUB,NOB,R3,(INTREC+IHREC+IB),98)
        CALL TRT1(NOAUA,NOBUB,T2,R3)
        CALL DAXPY(NOABUB,ONEN,R3(1,1,1,IA),1,HR3(1,1,1,IB),1)
        END IF
        CALL HRMAKAB2(NOA,NUA,NOB,NUB,R3,HR3,T2,INTREC,IA,IB)
 2      CONTINUE
       CALL TRT1(NOBUB,NOAUA,T2,HR3)
       CALL WRTAB(NOA,NUA,NUB,NOB,HR3,(I3REC+IHREC+LREC1+IA),98)
       END IF
C
       CALL ZEROMA(HR3B,1,NO2U2)
       CALL RDTAB(NOA,NUA,NUA,NOB,HR3B,(I3REC+IHREC+LREC2+IA),98)
       CALL RDTAB(NUA,NUA,NOB,NOA,R3B,(INTREC+LREC2+IA),98)
       CALL TRT1(NOBUA2,NOA,T2,R3B)
       CALL DAXPY(NOABUA2,ONE,R3B,1,HR3B,1)
       CALL TRAN24(NOA,NUA,NUA,NOB,T2,HR3B)
        DO 3,IB=1,NACTA
        CALL RDTAB(NUA,NUB,NOB,NOA,R3B,(INTREC+LREC1+IB),98)
        CALL TRT1(NUAB,NOAB,T2,R3B)
        CALL INSITU(NOB,NOA,NUA,NUB,T2,R3B,12)
        CALL DAXPY(NOABUA,ONE,R3B(1,1,1,IA),1,HR3B(1,1,1,IB),1)
        CALL RDTAB(NOA,NUA,NUB,NOB,R3B,(INTREC+IHREC+LREC1+IB),98)
        CALL TRAN34N(NOA,NUA,NUB,NOB,T2,R3B)
        CALL INSITU(NOA,NUA,NOB,NUB,T2,R3B,23)
        CALL DAXPY(NOABUA,HALF,R3B(1,1,1,IA),1,HR3B(1,1,1,IB),1)
        CALL ZEROU(NOA,NOB,NUA,NUB,R3B)
        CALL TRANMD(HR3B,NOA,NOB,NUA,NUA,34)
        CALL DAXPY(NOABUA,HALFN,R3B(1,1,1,IA),1,HR3B(1,1,1,IB),1)
        CALL TRANMD(HR3B,NOA,NOB,NUA,NUA,34)
 3      CONTINUE
       CALL TRAN24(NOA,NOB,NUA,NUA,T2,HR3B)
       CALL SYMETR3AB(HR3B,NOA,NOB,NUA,R3B)
       CALL WRTAB(NOA,NUA,NUA,NOB,HR3B,(I3REC+IHREC+LREC2+IA),98)
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK HRMAKAB2
      SUBROUTINE HRMAKAB2(NOA,NUA,NOB,NUB,R3,HR3,T2,INTREC,IA,IB)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION R3(NUA,NOB,NOA,NUA)
      DIMENSION HR3(NUA,NOB,NOA,NUB)
      DIMENSION T2(1)
C
      DATA TWO/2.0D+00/, ONE/1.00D+00/
C
        CALL TRAN14(NUB,NOB,NOA,NUA,T2,HR3)
        CALL RDTAB(NUA,NUA,NOB,NOA,R3,(INTREC+LREC2+IB),98)
        CALL TRAN1TO4(NUA,NUA,NOB,NOA,T2,R3)
        CALL DAXPY(NOABUA,TWO,R3(1,1,1,IA),1,HR3(1,1,1,IB),1)
        CALL RDTAB(NOA,NUA,NUA,NOB,R3,(INTREC+IHREC+LREC2+IB),98)
        CALL ZEROT(NOA,NOB,NUA,R3)
        CALL TRT1(NOAUA,NOBUA,T2,R3)
        CALL DAXPY(NOABUA,ONE,R3(1,1,1,IA),1,HR3(1,1,1,IB),1)
        CALL TRAN14(NUA,NOB,NOA,NUB,T2,HR3)
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK SYMETR3IJ
      SUBROUTINE SYMETR3IJ(HR3,NOB,NUB,NUA,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION HR3(NOB,NOB,NUB,NUA),R3(NOB,NOB,NUB,NUA)
C
      NN=(NOB**2)*NUB*NUA
      CALL DCOPY(NN,HR3,1,R3,1)
      CALL TRANMD(R3,NOB,NOB,NUB,NUA,12)
      CALL DAXPY(NN,-1.00D+00,R3,1,HR3,1)
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK SYMETR3JK
      SUBROUTINE SYMETR3JK(HR3,NOB,NUB,NUA,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION HR3(NOB,NUB,NUA,NOB),R3(NOB,NUB,NUA,NOB)
C
      NN=(NOB**2)*NUB*NUA
      CALL DCOPY(NN,HR3,1,R3,1)
      CALL TRANMD(R3,NOB,NUB,NUA,NOB,14)
      CALL DAXPY(NN,-1.00D+00,R3,1,HR3,1)
C
      RETURN
      END
C*MODULE EAIPCC  *DECK SYMETR3AB
      SUBROUTINE SYMETR3AB(HR3,NOA,NOB,NUA,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION HR3(NOA,NUA,NUA,NOB),R3(NOA,NUA,NUA,NOB)
C
      NN=NOA*NOB*(NUA**2)
      CALL DCOPY(NN,HR3,1,R3,1)
      CALL TRANMD(R3,NOA,NUA,NUA,NOB,23)
      CALL DAXPY(NN,-1.00D+00,R3,1,HR3,1)
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK SYMETR3BC
      SUBROUTINE SYMETR3BC(HR3,NOA,NOB,NUA,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION HR3(NOB,NUA,NUA,NOA),R3(NOB,NUA,NUA,NOA)
C
      NN=NOA*NOB*(NUA**2)
      CALL DCOPY(NN,HR3,1,R3,1)
      CALL TRANMD(R3,NOB,NUA,NUA,NOA,23)
      CALL DAXPY(NN,-1.00D+00,R3,1,HR3,1)
C
      RETURN
      END
C
C*MODULE EAIPCC   DECK ASYMOP
      SUBROUTINE ASYMOP(NP,OPPP,TI)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION TI(1),OPPP(1)
C
      NN=(NP**3)
      CALL VECCOP(NN,TI,OPPP)
      CALL TRANMD(TI,NP,NP,NP,1,23)
      CALL DAXPY(NN,-1.00D+00,TI,1,OPPP,1)
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROA
      SUBROUTINE ZEROA(NOA,NUA,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NOA,NOA,NUA,NUA)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
      DO 1,IA=1,NACTA
      DO 2,N=1,NOA
      DO 3,M=1,NOA
      DO 4,IF=1,NUA
       R3(N,M,IF,IA)=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROB
      SUBROUTINE ZEROB(NOA,NUA,IE,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NOA,NOA,NUA,NUA)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
      DO 1,IF=1,NACTA
      IF(IF.LE.IE) THEN
      DO 2,N=1,NOA
      DO 3,M=1,NOA
      DO 4,IA=1,NUA
       R3(N,M,IF,IA)=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
      END IF
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROC
      SUBROUTINE ZEROC(NOA,NUA,IE,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NOA,NOA,NUA,NUA)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
      DO 1,IF=IE+1,NACTA
      DO 2,N=1,NOA
      DO 3,M=1,NOA
      DO 4,IA=1,NUA
       R3(N,M,IF,IA)=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROE
      SUBROUTINE ZEROE(NOA,NOB,NUA,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NUA,NOB,NOA,NUA)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      DO 1,IA=1,NACTA
      DO 2,IE=1,NUA
      DO 3,J=1,NOA
      DO 4,N=1,NOB
       R3(IE,N,J,IA)=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      DO 10,IE=1,NACTA
      DO 11,IA=NACTA+1,NUA
      DO 12,J=1,NOA
      DO 13,N=1,NOB
       R3(IE,N,J,IA)=0.00D+00
 13   CONTINUE
 12   CONTINUE
 11   CONTINUE
 10   CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROF
      SUBROUTINE ZEROF(NOA,NUA,NOB,NUB,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NUB,NOA,NOB,NUA)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
      DO 1,IA=1,NACTA
      DO 2,N=1,NOB
      DO 3,J=1,NOA
      DO 4,IF=1,NUB
       R3(IF,J,N,IA)=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROG
      SUBROUTINE ZEROG(NUA,NOB,NUB,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NOB,NOB,NUB,NUA)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
      DO 1,IA=1,NACTA
      DO 2,M=1,NOB
      DO 3,N=1,NOB
      DO 4,IE=1,NUB
       R3(M,N,IE,IA)=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROH2
      SUBROUTINE ZEROH2(NUA,NOB,NUB,IE,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NUB,NOB,NOB,NUA)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
      DO 1,IF=1,IE
      DO 2,M=1,NOB
      DO 3,N=1,NOB
      DO 4,IA=NACTA+1,NUA
       R3(IF,N,M,IA)=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROH3
      SUBROUTINE ZEROH3(NUA,NOB,NUB,IE,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NOB,NOB,NUB,NUA)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
      DO 1,IF=1,IE
      DO 2,M=1,NOB
      DO 3,N=1,NOB
      DO 4,IA=NACTA+1,NUA
       R3(M,N,IF,IA)=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROI
      SUBROUTINE ZEROI(NUA,NOB,NUB,IE,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NOB,NOB,NUB,NUA)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
      DO 1,IB=IE+1,NACTB
      DO 2,M=1,NOB
      DO 3,N=1,NOB
      DO 4,IA=NACTA+1,NUA
       R3(M,N,IB,IA)=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROJ
      SUBROUTINE ZEROJ(NOA,NUA,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NUA,NOA,NOA,NUA)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
      DO 1,IB=1,NACTA
      DO 2,J=1,NOA
      DO 3,K=1,NOA
      DO 4,IA=1,NUA
       R3(IB,K,J,IA)=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROK
      SUBROUTINE ZEROK(NOA,NUA,IE,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NUA,NOA,NOA,NUA)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
      DO 1,IB=1,NACTA
      DO 2,J=1,NOA
      DO 3,K=1,NOA
      DO 4,IF=1,NUA
       R3(IB,K,J,IF)=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      DO 10,IF=1,IE
      DO 11,J=1,NOA
      DO 12,K=1,NOA
      DO 13,IB=NACTA+1,NUA
       R3(IB,K,J,IF)=0.00D+00
 13   CONTINUE
 12   CONTINUE
 11   CONTINUE
 10   CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROL
      SUBROUTINE ZEROL(NOA,NUA,IE,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NUA,NOA,NOA,NUA)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
      DO 10,IF=IE+1,NACTA
      DO 11,J=1,NOA
      DO 12,K=1,NOA
      DO 13,IB=NACTA+1,NUA
       R3(IB,K,J,IF)=0.00D+00
 13   CONTINUE
 12   CONTINUE
 11   CONTINUE
 10   CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROM
      SUBROUTINE ZEROM(NOA,NOB,NUA,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NOA,NUA,NUA,NOB)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
      DO 10,IB=1,NACTA
      DO 11,J=1,NOA
      DO 12,K=1,NOB
      DO 13,IC=1,NUA
       R3(J,IB,IC,K)=0.00D+00
 13   CONTINUE
 12   CONTINUE
 11   CONTINUE
 10   CONTINUE
C
      DO 20,IC=1,NACTA
      DO 21,J=1,NOA
      DO 22,K=1,NOB
      DO 23,IB=NACTA+1,NUA
       R3(J,IB,IC,K)=0.00D+00
 23   CONTINUE
 22   CONTINUE
 21   CONTINUE
 20   CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROM2
      SUBROUTINE ZEROM2(NOA,NUA,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NOA,NUA,NUA,NOA)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
      DO 10,IB=1,NACTA
      DO 11,J=1,NOA
      DO 12,K=1,NOA
      DO 13,IC=1,NUA
       R3(J,IB,IC,K)=0.00D+00
 13   CONTINUE
 12   CONTINUE
 11   CONTINUE
 10   CONTINUE
C
      DO 20,IC=1,NACTA
      DO 21,J=1,NOA
      DO 22,K=1,NOA
      DO 23,IB=NACTA+1,NUA
       R3(J,IB,IC,K)=0.00D+00
 23   CONTINUE
 22   CONTINUE
 21   CONTINUE
 20   CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZERON
      SUBROUTINE ZERON(NOB,NUB,NUA,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NUB,NOB,NOB,NUA)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
      DO 10,IB=1,NACTB
      DO 11,J=1,NOB
      DO 12,K=1,NOB
      DO 13,IA=1,NACTA
       R3(IB,K,J,IA)=0.00D+00
 13   CONTINUE
 12   CONTINUE
 11   CONTINUE
 10   CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROO
      SUBROUTINE ZEROO(NOB,NUB,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NOB,NUB,NUB,NOB)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
      DO 1,IB=1,NACTB
      DO 2,J=1,NOB
      DO 3,K=1,NOB
      DO 4,IC=1,NUB
       R3(J,IB,IC,K)=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      DO 10,IC=1,NACTB
      DO 11,J=1,NOB
      DO 12,K=1,NOB
      DO 13,IB=NACTB+1,NUB
       R3(J,IB,IC,K)=0.00D+00
 13   CONTINUE
 12   CONTINUE
 11   CONTINUE
 10   CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROP
      SUBROUTINE ZEROP(NOB,NUB,NUA,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NOB,NOB,NUB,NUA)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
      DO 1,IC=1,NACTB
      DO 2,J=1,NOB
      DO 3,K=1,NOB
      DO 4,IE=1,NUA
       R3(J,K,IC,IE)=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROQ
      SUBROUTINE ZEROQ(NOB,NUB,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NUB,NOB,NOB,NUB)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
      DO 1,IB=1,NACTB
      DO 2,J=1,NOB
      DO 3,N=1,NOB
      DO 4,IF=1,NUB
       R3(IF,N,J,IB)=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROR
      SUBROUTINE ZEROR(NOA,NUA,NOB,NUB,IA,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NOA,NUA,NUB,NOB)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
      DO 1,IB=1,NACTB
      DO 2,J=1,NOB
      DO 3,N=1,NOA
      DO 4,IF=1,NUA
       R3(N,IF,IB,J)=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      DO 11,IF=1,IA
      DO 12,J=1,NOB
      DO 13,N=1,NOA
      DO 14,IB=NACTB+1,NUB
       R3(N,IF,IB,J)=0.00D+00
 14   CONTINUE
 13   CONTINUE
 12   CONTINUE
 11   CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROS
      SUBROUTINE ZEROS(NOA,NUA,NOB,NUB,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NOA,NUA,NUB,NOB)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
      DO 11,IF=1,NACTA
      DO 12,J=1,NOB
      DO 13,N=1,NOA
      DO 14,IB=1,NUB
       R3(N,IF,IB,J)=0.00D+00
 14   CONTINUE
 13   CONTINUE
 12   CONTINUE
 11   CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROS2
      SUBROUTINE ZEROS2(NOA,NUA,NOB,NUB,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NOA,NUA,NUB,NOB)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
      DO 1,IB=1,NACTB
      DO 2,J=1,NOB
      DO 3,N=1,NOA
      DO 4,IF=1,NUA
       R3(N,IF,IB,J)=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROT
      SUBROUTINE ZEROT(NOA,NOB,NUA,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NOA,NUA,NUA,NOB)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
      DO 1,IB=1,NACTA
      DO 2,J=1,NOA
      DO 3,K=1,NOB
      DO 4,IA=1,NUA
       R3(J,IA,IB,K)=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROU
      SUBROUTINE ZEROU(NOA,NOB,NUA,NUB,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NOA,NOB,NUA,NUB)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
      DO 1,IA=1,NACTA
      DO 2,J=1,NOA
      DO 3,K=1,NOB
      DO 4,IC=1,NUB
       R3(J,K,IA,IC)=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROR2
      SUBROUTINE ZEROR2(NOA,NUA,OHPP)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION OHPP(NUA,NUA,NOA)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
      DO 1,IA=1,NACTA
      DO 2,IB=1,NUA
      DO 3,I=1,NOA
       OHPP(IB,IA,I)=0.00D+00
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK V4PBAMK
      SUBROUTINE V4PBAMK(NUA,NUB,VPPP,VPPPI)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      DIMENSION VPPP(NUA,NUB,NUA),VPPPI(NUA,NUB,NUB)
C
C
      DO 1,IE=1,NACTA
       DO 2,IF=1,NUB
        READ(NFT899,REC=NUA+NUB+IF) VPPP
        CALL DCOPY(NUAB,VPPP(1,1,IE),1,VPPPI(1,1,IF),1)
C         DO 3,IA=1,NUA
C         DO 4,IB=1,NUB
C         VPPPI(IA,IB,IF)=VPPP(IA,IB,IE)
C 4       CONTINUE
C 3       CONTINUE
 2     CONTINUE
       WRITE(NFT899,REC=NUA+NUB+NUB+IE) VPPPI
 1    CONTINUE
C
        RETURN
        END
C
C*MODULE EAIPCC  *DECK EASMLMAA
      SUBROUTINE EASMLMAA(NOA,NUA,NOB,NUB,ISPACE,ITER,HM,
     *                    HMAUX,VEC1,VEC2,R3,HR3,NOUP,
     *                    IREC,I3REC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION HM(ISPACE,ISPACE),HMAUX(ISPACE,ISPACE)
      DIMENSION VEC1(1),VEC2(1),R3(1),HR3(1)
C
      NOABUA2=NOABUA*NUA
      NOB2UAB=NOB2UA*NUB
C
      DO 1,I1=1,ISPACE
      DO 2,I2=1,ISPACE
       HM(I1,I2)=HMAUX(I1,I2)
 2    CONTINUE
 1    CONTINUE
      CALL ZEROMA(VEC1,1,NOUP)
      CALL ZEROMA(VEC2,1,NOUP)
C
C     --------- ITER-TH COLUMN OF HM (VEC2-HR(ITER)) -------------
      CALL RDTAB1(NUA,VEC2(1),(IREC+4),96)
      CALL RDTAB3(NUA,NUA,NOA,VEC2(1+NUA),(IREC+5),96)
      CALL RDTAB3(NUA,NUB,NOB,VEC2(1+NUA+NOAUA2),(IREC+6),96)
      DO 3,J=1,ITER-1
       JREC=6*(J-1)
       CALL RDTAB1(NUA,VEC1(1),(JREC+1),96)
       CALL RDTAB3(NUA,NUA,NOA,VEC1(1+NUA),(JREC+2),96)
       CALL RDTAB3(NUA,NUB,NOB,VEC1(1+NUA+NOAUA2),(JREC+3),96)
       XXX=DDOT(NOUP,VEC2(1),1,VEC1(1),1)
       DO 43,IA=1,NACTB
        I3REC2=((6*NACTA)+(4*NACTB))*(J-1)
        IF(IA.LE.NACTA) THEN
        CALL RDTAB(NOA,NUA,NUA,NOA,HR3,(I3REC+IHREC+IA),98)
        CALL RDTAB(NOA,NUA,NUA,NOA,R3,(I3REC2+IA),98)
        YYY=DDOT(NOA2UA2,HR3,1,R3,1)
        XXX=XXX+YYY
        CALL RDTAB(NOA,NUA,NUB,NOB,HR3,(I3REC+IHREC+LREC1+IA),98)
        CALL RDTAB(NOA,NUA,NUB,NOB,R3,(I3REC2+LREC1+IA),98)
        YYY=DDOT(NO2U2AB,HR3,1,R3,1)
        XXX=XXX+YYY
        CALL RDTAB(NOB,NUB,NUB,NOB,HR3,(I3REC+IHREC+LREC3+IA),98)
        CALL RDTAB(NOB,NUB,NUB,NOB,R3,(I3REC2+LREC3+IA),98)
        YYY=DDOT(NOB2UB2,HR3,1,R3,1)
        XXX=XXX+YYY
        END IF
        CALL RDTAB(NOA,NUA,NUA,NOB,HR3,(I3REC+IHREC+LREC2+IA),98)
        CALL RDTAB(NOA,NUA,NUA,NOB,R3,(I3REC2+LREC2+IA),98)
        YYY=DDOT(NOABUA2,HR3,1,R3,1)
        XXX=XXX+YYY
        CALL RDTAB(NOB,NOB,NUB,NUA,HR3,(I3REC+IHREC+LREC4+IA),98)
        CALL RDTAB(NOB,NOB,NUB,NUA,R3,(I3REC2+LREC4+IA),98)
        YYY=DDOT(NOB2UAB,HR3,1,R3,1)
        XXX=XXX+YYY
 43    CONTINUE
       HM(J,ITER)=XXX
 3    CONTINUE
C
C     --------- ITER-TH ROW OF HM (VEC1-R(ITER) -------------------
      CALL RDTAB1(NUA,VEC1(1),(IREC+1),96)
      CALL RDTAB3(NUA,NUA,NOA,VEC1(1+NUA),(IREC+2),96)
      CALL RDTAB3(NUA,NUB,NOB,VEC1(1+NUA+NOAUA2),(IREC+3),96)
      DO 4,J=1,ITER-1
       JREC=6*(J-1)
       CALL RDTAB1(NUA,VEC2(1),(JREC+4),96)
       CALL RDTAB3(NUA,NUA,NOA,VEC2(1+NUA),(JREC+5),96)
       CALL RDTAB3(NUA,NUB,NOB,VEC2(1+NUA+NOAUA2),(JREC+6),96)
       XXX=DDOT(NOUP,VEC2(1),1,VEC1(1),1)
       DO 44,IA=1,NACTB
        I3REC2=((6*NACTA)+(4*NACTB))*(J-1)
        IF(IA.LE.NACTA) THEN
        CALL RDTAB(NOA,NUA,NUA,NOA,R3,(I3REC+IA),98)
        CALL RDTAB(NOA,NUA,NUA,NOA,HR3,(I3REC2+IHREC+IA),98)
        YYY=DDOT(NOA2UA2,HR3,1,R3,1)
        XXX=XXX+YYY
        CALL RDTAB(NOA,NUA,NUB,NOB,R3,(I3REC+LREC1+IA),98)
        CALL RDTAB(NOA,NUA,NUB,NOB,HR3,(I3REC2+IHREC+LREC1+IA),98)
        YYY=DDOT(NO2U2AB,HR3,1,R3,1)
        XXX=XXX+YYY
        CALL RDTAB(NOB,NUB,NUB,NOB,R3,(I3REC+LREC3+IA),98)
        CALL RDTAB(NOB,NUB,NUB,NOB,HR3,(I3REC2+IHREC+LREC3+IA),98)
        YYY=DDOT(NOB2UB2,HR3,1,R3,1)
        XXX=XXX+YYY
        END IF
        CALL RDTAB(NOA,NUA,NUA,NOB,R3,(I3REC+LREC2+IA),98)
        CALL RDTAB(NOA,NUA,NUA,NOB,HR3,(I3REC2+IHREC+LREC2+IA),98)
        YYY=DDOT(NOABUA2,HR3,1,R3,1)
        XXX=XXX+YYY
        CALL RDTAB(NOB,NOB,NUB,NUA,R3,(I3REC+LREC4+IA),98)
        CALL RDTAB(NOB,NOB,NUB,NUA,HR3,(I3REC2+IHREC+LREC4+IA),98)
        YYY=DDOT(NOB2UAB,HR3,1,R3,1)
        XXX=XXX+YYY
 44    CONTINUE
       HM(ITER,J)=XXX
 4    CONTINUE
C
C     ---------- (ITER,ITER)-DIAGONAL PART OF HM --------------------
      CALL RDTAB1(NUA,VEC1(1),(IREC+1),96)
      CALL RDTAB3(NUA,NUA,NOA,VEC1(1+NUA),(IREC+2),96)
      CALL RDTAB3(NUA,NUB,NOB,VEC1(1+NUA+NOAUA2),(IREC+3),96)
      CALL RDTAB1(NUA,VEC2(1),(IREC+4),96)
      CALL RDTAB3(NUA,NUA,NOA,VEC2(1+NUA),(IREC+5),96)
      CALL RDTAB3(NUA,NUB,NOB,VEC2(1+NUA+NOAUA2),(IREC+6),96)
      XXX=DDOT(NOUP,VEC2(1),1,VEC1(1),1)
      DO 45,IA=1,NACTB
       IF(IA.LE.NACTA) THEN
       CALL RDTAB(NOA,NUA,NUA,NOA,HR3,(I3REC+IHREC+IA),98)
       CALL RDTAB(NOA,NUA,NUA,NOA,R3,(I3REC+IA),98)
       YYY=DDOT(NOA2UA2,HR3,1,R3,1)
       XXX=XXX+YYY
       CALL RDTAB(NOA,NUA,NUB,NOB,HR3,(I3REC+IHREC+LREC1+IA),98)
       CALL RDTAB(NOA,NUA,NUB,NOB,R3,(I3REC+LREC1+IA),98)
       YYY=DDOT(NO2U2AB,HR3,1,R3,1)
       XXX=XXX+YYY
       CALL RDTAB(NOB,NUB,NUB,NOB,HR3,(I3REC+IHREC+LREC3+IA),98)
       CALL RDTAB(NOB,NUB,NUB,NOB,R3,(I3REC+LREC3+IA),98)
       YYY=DDOT(NOB2UB2,HR3,1,R3,1)
       XXX=XXX+YYY
       END IF
       CALL RDTAB(NOA,NUA,NUA,NOB,HR3,(I3REC+IHREC+LREC2+IA),98)
       CALL RDTAB(NOA,NUA,NUA,NOB,R3,(I3REC+LREC2+IA),98)
       YYY=DDOT(NOABUA2,HR3,1,R3,1)
       XXX=XXX+YYY
       CALL RDTAB(NOB,NOB,NUB,NUA,HR3,(I3REC+IHREC+LREC4+IA),98)
       CALL RDTAB(NOB,NOB,NUB,NUA,R3,(I3REC+LREC4+IA),98)
       YYY=DDOT(NOB2UAB,HR3,1,R3,1)
       XXX=XXX+YYY
 45    CONTINUE
       HM(ITER,ITER)=XXX
C
      DO 11,I1=1,ISPACE
      DO 12,I2=1,ISPACE
       HMAUX(I1,I2)=HM(I1,I2)
 12   CONTINUE
 11   CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK EACOMBA
      SUBROUTINE EACOMBA(NOA,NOB,NUA,NUB,ISPACE,ITER,INTREC,JROOT3,
     *                  XENE,WI,R3,HR3,T2)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION WI(ISPACE),R3(1),HR3(1),T2(1)
C
      NOABUA2=NOABUA*NUA
      NOB2UAB=NOB2UA*NUB
C
      DO 42,IA=1,NACTB
       CALL ZEROMA(R3,1,NO2U2)
       CALL ZEROMA(T2,1,NO2U2)
       IF(IA.LE.NACTA) THEN
       DO 1,J=1,ITER
        I3REC=((6*NACTA)+(4*NACTB))*(J-1)
        XCOMB=WI(J)
        CALL RDTAB(NOA,NUA,NUA,NOA,HR3,(I3REC+IA),98)
        CALL DAXPY(NOA2UA2,XCOMB,HR3,1,R3,1)
        CALL RDTAB(NOA,NUA,NUA,NOA,HR3,(I3REC+IHREC+IA),98)
        CALL DAXPY(NOA2UA2,XCOMB,HR3,1,T2,1)
 1     CONTINUE
       CALL WRTAB(NOA,NUA,NUA,NOA,R3,(JROOT3+IA),NFT825)
       CALL DAXPY(NOA2UA2,-XENE,R3,1,T2,1)
       CALL WRTAB(NOA,NUA,NUA,NOA,T2,(INTREC+IHREC+IA),98)
       CALL ZEROMA(R3,1,NO2U2)
       CALL ZEROMA(T2,1,NO2U2)
       DO 2,J=1,ITER
        I3REC=((6*NACTA)+(4*NACTB))*(J-1)
        XCOMB=WI(J)
        CALL RDTAB(NOA,NUA,NUB,NOB,HR3,(I3REC+LREC1+IA),98)
        CALL DAXPY(NO2U2AB,XCOMB,HR3,1,R3,1)
        CALL RDTAB(NOA,NUA,NUB,NOB,HR3,(I3REC+IHREC+LREC1+IA),98)
        CALL DAXPY(NO2U2AB,XCOMB,HR3,1,T2,1)
 2     CONTINUE
       CALL WRTAB(NOA,NUA,NUB,NOB,R3,(JROOT3+LREC1+IA),NFT825)
       CALL DAXPY(NO2U2AB,-XENE,R3,1,T2,1)
       CALL WRTAB(NOA,NUA,NUB,NOB,T2,(INTREC+IHREC+LREC1+IA),98)
       CALL ZEROMA(R3,1,NO2U2)
       CALL ZEROMA(T2,1,NO2U2)
       DO 3,J=1,ITER
        I3REC=((6*NACTA)+(4*NACTB))*(J-1)
        XCOMB=WI(J)
        CALL RDTAB(NOB,NUB,NUB,NOB,HR3,(I3REC+LREC3+IA),98)
        CALL DAXPY(NOB2UB2,XCOMB,HR3,1,R3,1)
        CALL RDTAB(NOB,NUB,NUB,NOB,HR3,(I3REC+IHREC+LREC3+IA),98)
        CALL DAXPY(NOB2UB2,XCOMB,HR3,1,T2,1)
 3     CONTINUE
       CALL WRTAB(NOB,NUB,NUB,NOB,R3,(JROOT3+LREC3+IA),NFT825)
       CALL DAXPY(NOB2UB2,-XENE,R3,1,T2,1)
       CALL WRTAB(NOB,NUB,NUB,NOB,T2,(INTREC+IHREC+LREC3+IA),98)
       END IF
       CALL ZEROMA(R3,1,NO2U2)
       CALL ZEROMA(T2,1,NO2U2)
       DO 4,J=1,ITER
        I3REC=((6*NACTA)+(4*NACTB))*(J-1)
        XCOMB=WI(J)
        CALL RDTAB(NOA,NUA,NUA,NOB,HR3,(I3REC+LREC2+IA),98)
        CALL DAXPY(NOABUA2,XCOMB,HR3,1,R3,1)
        CALL RDTAB(NOA,NUA,NUA,NOB,HR3,(I3REC+IHREC+LREC2+IA),98)
        CALL DAXPY(NOABUA2,XCOMB,HR3,1,T2,1)
 4     CONTINUE
       CALL WRTAB(NOA,NUA,NUA,NOB,R3,(JROOT3+LREC2+IA),NFT825)
       CALL DAXPY(NOABUA2,-XENE,R3,1,T2,1)
       CALL WRTAB(NOA,NUA,NUA,NOB,T2,(INTREC+IHREC+LREC2+IA),98)
       CALL ZEROMA(R3,1,NO2U2)
       CALL ZEROMA(T2,1,NO2U2)
       DO 5,J=1,ITER
        I3REC=((6*NACTA)+(4*NACTB))*(J-1)
        XCOMB=WI(J)
        CALL RDTAB(NOB,NOB,NUB,NUA,HR3,(I3REC+LREC4+IA),98)
        CALL DAXPY(NOB2UAB,XCOMB,HR3,1,R3,1)
        CALL RDTAB(NOB,NOB,NUB,NUA,HR3,(I3REC+IHREC+LREC4+IA),98)
        CALL DAXPY(NOB2UAB,XCOMB,HR3,1,T2,1)
 5     CONTINUE
       CALL WRTAB(NOB,NOB,NUB,NUA,R3,(JROOT3+LREC4+IA),NFT825)
       CALL DAXPY(NOB2UAB,-XENE,R3,1,T2,1)
       CALL WRTAB(NOB,NOB,NUB,NUA,T2,(INTREC+IHREC+LREC4+IA),98)
 42   CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK EADENA
      SUBROUTINE EADENA(NOA,NUA,NOB,NUB,XENE,DHHA,DHHB,DPPA,DPPB,
     *                 R1,R2A,R2B,R3,INTREC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION DHHA(NOA,NOA),DHHB(NOB,NOB)
      DIMENSION DPPA(NUA,NUA),DPPB(NUB,NUB)
      DIMENSION R1(NUA),R2A(NUA,NUA,NOA),R2B(NUA,NUB,NOB)
      DIMENSION R3(1)
C
      DO 1,IA=1,NUA
       XDEN=XENE-DPPA(IA,IA)
       R1(IA)=R1(IA)/XDEN
 1    CONTINUE
C
      DO 3,J=1,NOA
      DO 4,IA=1,NUA
      DO 5,IB=1,NUA
       XDEN=XENE+DHHA(J,J)-DPPA(IA,IA)-DPPA(IB,IB)
       R2A(IA,IB,J)=R2A(IA,IB,J)/XDEN
 5    CONTINUE
 4    CONTINUE
 3    CONTINUE
C
      DO 13,J=1,NOB
      DO 14,IA=1,NUA
      DO 15,IB=1,NUB
       XDEN=XENE+DHHB(J,J)-DPPA(IA,IA)-DPPB(IB,IB)
       R2B(IA,IB,J)=R2B(IA,IB,J)/XDEN
 15   CONTINUE
 14   CONTINUE
 13   CONTINUE
C
      DO 42,IA=1,NACTB
      IF(IA.LE.NACTA) THEN
C***************** JRG 15 APR 2010 ******************************
      CALL RDTAB(NOA,NUA,NUA,NOA,R3,(INTREC+IHREC+IA),98)
      CALL EADENR3A(NOA,NUA,NUA,NOA,R3,DHHA,DPPA,DPPA,DHHA,
     *DPPA,XENE,IA,NUA,1)
      CALL WRTAB(NOA,NUA,NUA,NOA,R3,(INTREC+IHREC+IA),98)
C
      CALL RDTAB(NOA,NUA,NUB,NOB,R3,(INTREC+IHREC+LREC1+IA),98)
      CALL EADENR3A(NOA,NUA,NUB,NOB,R3,DHHA,DPPA,DPPB,DHHB,
     *DPPA,XENE,IA,NUA,1)
      CALL WRTAB(NOA,NUA,NUB,NOB,R3,(INTREC+IHREC+LREC1+IA),98)
C
      CALL RDTAB(NOB,NUB,NUB,NOB,R3,(INTREC+IHREC+LREC3+IA),98)
      CALL EADENR3A(NOB,NUB,NUB,NOB,R3,DHHB,DPPB,DPPB,DHHB,
     *DPPA,XENE,IA,NUA,1)
      CALL WRTAB(NOB,NUB,NUB,NOB,R3,(INTREC+IHREC+LREC3+IA),98)
C
      END IF
C
      CALL RDTAB(NOA,NUA,NUA,NOB,R3,(INTREC+IHREC+LREC2+IA),98)
      CALL EADENR3A(NOA,NUA,NUA,NOB,R3,DHHA,DPPA,DPPA,DHHB,
     *DPPB,XENE,IA,NUB,1)
      CALL WRTAB(NOA,NUA,NUA,NOB,R3,(INTREC+IHREC+LREC2+IA),98)
C
      CALL RDTAB(NOB,NOB,NUB,NUA,R3,(INTREC+IHREC+LREC4+IA),98)
      CALL EADENR3A(NOB,NOB,NUB,NUA,R3,DHHB,DHHB,DPPB,DPPA,
     *DPPB,XENE,IA,NUB,2)
      CALL WRTAB(NOB,NOB,NUB,NUA,R3,(INTREC+IHREC+LREC4+IA),98)
C*********************************************************************
C
 42   CONTINUE
C
      RETURN
      END
C
C******************* JRG 15 APR 2010 ************************
C*MODULE EAIPCC  *DECK EADENR3A
      SUBROUTINE EADENR3A(N1,N2,N3,N4,R3,D1,D2,D3,D4,D5,
     *                    XENE,IA,N5,ICHK)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(N1,N2,N3,N4)
      DIMENSION D1(N1,N1),D2(N2,N2),D3(N3,N3),D4(N4,N4)
      DIMENSION D5(N5,N5)
C
      IF(ICHK.EQ.1) THEN
      DO 1,I1=1,N1
      DO 2,I2=1,N2
      DO 3,I3=1,N3
      DO 4,I4=1,N4
       XDEN=XENE+D1(I1,I1)-D2(I2,I2)-D3(I3,I3)+D4(I4,I4)
       XDEN=XDEN-D5(IA,IA)
       R3(I1,I2,I3,I4)=R3(I1,I2,I3,I4)/XDEN
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
      ELSE
      DO 11,I1=1,N1
      DO 12,I2=1,N2
      DO 13,I3=1,N3
      DO 14,I4=1,N4
       XDEN=XENE+D1(I1,I1)+D2(I2,I2)-D3(I3,I3)-D4(I4,I4)
       XDEN=XDEN-D5(IA,IA)
       R3(I1,I2,I3,I4)=R3(I1,I2,I3,I4)/XDEN
 14   CONTINUE
 13   CONTINUE
 12   CONTINUE
 11   CONTINUE
      END IF
C
      RETURN
      END
C*************************************************************************
C
C*MODULE EAIPCC  *DECK NORMVA
      SUBROUTINE NORMVA(NOA,NOB,NUA,NUB,NOUP,RES,VEC,R3,HR3,INTREC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION VEC(NOUP),R3(1),HR3(1)
      NOABUA2=NOABUA*NUA
      NOB2UAB=NOB2UA*NUB
      RES=0.0D+00
      DO 1,I=1,NOUP
       RES=RES+VEC(I)*VEC(I)
 1    CONTINUE
      DO 2,IA=1,NACTB
      IF(IA.LE.NACTA) THEN
      CALL RDTAB(NOA,NUA,NUA,NOA,R3,(INTREC+IHREC+IA),98)
      CALL DCOPY(NOA2UA2,R3,1,HR3,1)
      YYY=DDOT(NOA2UA2,R3,1,HR3,1)
      RES=RES+YYY
C
      CALL RDTAB(NOA,NUA,NUB,NOB,R3,(INTREC+IHREC+LREC1+IA),98)
      CALL DCOPY(NO2U2AB,R3,1,HR3,1)
      YYY=DDOT(NO2U2AB,R3,1,HR3,1)
      RES=RES+YYY
C
      CALL RDTAB(NOB,NUB,NUB,NOB,R3,(INTREC+IHREC+LREC3+IA),98)
      CALL DCOPY(NOB2UB2,R3,1,HR3,1)
      YYY=DDOT(NOB2UB2,R3,1,HR3,1)
      RES=RES+YYY
C
      END IF
C
      CALL RDTAB(NOA,NUA,NUA,NOB,R3,(INTREC+IHREC+LREC2+IA),98)
      CALL DCOPY(NOABUA2,R3,1,HR3,1)
      YYY=DDOT(NOABUA2,R3,1,HR3,1)
      RES=RES+YYY
C
      CALL RDTAB(NOB,NOB,NUB,NUA,R3,(INTREC+IHREC+LREC4+IA),98)
      CALL DCOPY(NOB2UAB,R3,1,HR3,1)
      YYY=DDOT(NOB2UAB,R3,1,HR3,1)
      RES=RES+YYY
C
 2    CONTINUE
      RES=DSQRT(RES)
      RETURN
      END
C
C*MODULE EAIPCC  *DECK EAORTHA
      SUBROUTINE EAORTHA(NOA,NUA,NOB,NUB,NOUP,ITER,INTREC,
     *                   VEC,AUX,R3,HR3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION VEC(1),AUX(1)
      DIMENSION R3(1),HR3(1)
C
      NOABUA2=NOABUA*NUA
      NOB2UAB=NOB2UA*NUB
C
      CALL DCOPY(NOUP,VEC,1,AUX,1)
      XNORM=DDOT(NOUP,VEC,1,AUX,1)
      DO 42,IA=1,NACTB
       IF(IA.LE.NACTA) THEN
       CALL RDTAB(NOA,NUA,NUA,NOA,R3,(INTREC+IHREC+IA),98)
       CALL DCOPY(NOA2UA2,R3,1,HR3,1)
       YYY=DDOT(NOA2UA2,R3,1,HR3,1)
       XNORM=XNORM+YYY
C
       CALL RDTAB(NOA,NUA,NUB,NOB,R3,(INTREC+IHREC+LREC1+IA),98)
       CALL DCOPY(NO2U2AB,R3,1,HR3,1)
       YYY=DDOT(NO2U2AB,R3,1,HR3,1)
       XNORM=XNORM+YYY
C
       CALL RDTAB(NOB,NUB,NUB,NOB,R3,(INTREC+IHREC+LREC3+IA),98)
       CALL DCOPY(NOB2UB2,R3,1,HR3,1)
       YYY=DDOT(NOB2UB2,R3,1,HR3,1)
       XNORM=XNORM+YYY
C
       END IF
C
       CALL RDTAB(NOA,NUA,NUA,NOB,R3,(INTREC+IHREC+LREC2+IA),98)
       CALL DCOPY(NOABUA2,R3,1,HR3,1)
       YYY=DDOT(NOABUA2,R3,1,HR3,1)
       XNORM=XNORM+YYY
C
       CALL RDTAB(NOB,NOB,NUB,NUA,R3,(INTREC+IHREC+LREC4+IA),98)
       CALL DCOPY(NOB2UAB,R3,1,HR3,1)
       YYY=DDOT(NOB2UAB,R3,1,HR3,1)
       XNORM=XNORM+YYY
C
 42   CONTINUE
      XNORM=(1.0D+00)/(DSQRT(XNORM))
      CALL DSCAL(NOUP,XNORM,VEC,1)
      DO 43,IA=1,NACTB
       IF(IA.LE.NACTA) THEN
       CALL RDTAB(NOA,NUA,NUA,NOA,R3,(INTREC+IHREC+IA),98)
       CALL DSCAL(NOA2UA2,XNORM,R3,1)
       CALL WRTAB(NOA,NUA,NUA,NOA,R3,(INTREC+IHREC+IA),98)
C
       CALL RDTAB(NOA,NUA,NUB,NOB,R3,(INTREC+IHREC+LREC1+IA),98)
       CALL DSCAL(NO2U2AB,XNORM,R3,1)
       CALL WRTAB(NOA,NUA,NUB,NOB,R3,(INTREC+IHREC+LREC1+IA),98)
C
       CALL RDTAB(NOB,NUB,NUB,NOB,R3,(INTREC+IHREC+LREC3+IA),98)
       CALL DSCAL(NOB2UB2,XNORM,R3,1)
       CALL WRTAB(NOB,NUB,NUB,NOB,R3,(INTREC+IHREC+LREC3+IA),98)
C
       END IF
C
       CALL RDTAB(NOA,NUA,NUA,NOB,R3,(INTREC+IHREC+LREC2+IA),98)
       CALL DSCAL(NOABUA2,XNORM,R3,1)
       CALL WRTAB(NOA,NUA,NUA,NOB,R3,(INTREC+IHREC+LREC2+IA),98)
C
       CALL RDTAB(NOB,NOB,NUB,NUA,R3,(INTREC+IHREC+LREC4+IA),98)
       CALL DSCAL(NOB2UAB,XNORM,R3,1)
       CALL WRTAB(NOB,NOB,NUB,NUA,R3,(INTREC+IHREC+LREC4+IA),98)
C
 43   CONTINUE
C
      DO 1,I=1,ITER
       JREC=6*(I-1)
       I3REC=((6*NACTA)+(4*NACTB))*(I-1)
       CALL RDTAB1(NUA,AUX(1),(JREC+1),96)
       CALL RDTAB3(NUA,NUA,NOA,AUX(1+NUA),(JREC+2),96)
       CALL RDTAB3(NUA,NUB,NOB,AUX(1+NUA+NOAUA2),(JREC+3),96)
       XXX=-DDOT(NOUP,VEC,1,AUX,1)
C
       DO 2,IA=1,NACTB
       IF(IA.LE.NACTA) THEN
       CALL RDTAB(NOA,NUA,NUA,NOA,HR3,(I3REC+IA),98)
       CALL RDTAB(NOA,NUA,NUA,NOA,R3,(INTREC+IHREC+IA),98)
       YYY=-DDOT(NOA2UA2,R3,1,HR3,1)
       XXX=XXX+YYY
C
       CALL RDTAB(NOA,NUA,NUB,NOB,HR3,(I3REC+LREC1+IA),98)
       CALL RDTAB(NOA,NUA,NUB,NOB,R3,(INTREC+IHREC+LREC1+IA),98)
       YYY=-DDOT(NO2U2AB,R3,1,HR3,1)
       XXX=XXX+YYY
C
       CALL RDTAB(NOB,NUB,NUB,NOB,HR3,(I3REC+LREC3+IA),98)
       CALL RDTAB(NOB,NUB,NUB,NOB,R3,(INTREC+IHREC+LREC3+IA),98)
       YYY=-DDOT(NOB2UB2,R3,1,HR3,1)
       XXX=XXX+YYY
C
       END IF
C
       CALL RDTAB(NOA,NUA,NUA,NOB,HR3,(I3REC+LREC2+IA),98)
       CALL RDTAB(NOA,NUA,NUA,NOB,R3,(INTREC+IHREC+LREC2+IA),98)
       YYY=-DDOT(NOABUA2,R3,1,HR3,1)
       XXX=XXX+YYY
C
       CALL RDTAB(NOB,NOB,NUB,NUA,HR3,(I3REC+LREC4+IA),98)
       CALL RDTAB(NOB,NOB,NUB,NUA,R3,(INTREC+IHREC+LREC4+IA),98)
       YYY=-DDOT(NOB2UAB,R3,1,HR3,1)
       XXX=XXX+YYY
 2     CONTINUE
C
       CALL DAXPY(NOUP,XXX,AUX,1,VEC,1)
C
       DO 3,IA=1,NACTB
       IF(IA.LE.NACTA) THEN
       CALL RDTAB(NOA,NUA,NUA,NOA,HR3,(I3REC+IA),98)
       CALL RDTAB(NOA,NUA,NUA,NOA,R3,(INTREC+IHREC+IA),98)
       CALL DAXPY(NOA2UA2,XXX,HR3,1,R3,1)
       CALL WRTAB(NOA,NUA,NUA,NOA,R3,(INTREC+IHREC+IA),98)
C
       CALL RDTAB(NOA,NUA,NUB,NOB,HR3,(I3REC+LREC1+IA),98)
       CALL RDTAB(NOA,NUA,NUB,NOB,R3,(INTREC+IHREC+LREC1+IA),98)
       CALL DAXPY(NO2U2AB,XXX,HR3,1,R3,1)
       CALL WRTAB(NOA,NUA,NUB,NOB,R3,(INTREC+IHREC+LREC1+IA),98)
C
       CALL RDTAB(NOB,NUB,NUB,NOB,HR3,(I3REC+LREC3+IA),98)
       CALL RDTAB(NOB,NUB,NUB,NOB,R3,(INTREC+IHREC+LREC3+IA),98)
       CALL DAXPY(NOB2UB2,XXX,HR3,1,R3,1)
       CALL WRTAB(NOB,NUB,NUB,NOB,R3,(INTREC+IHREC+LREC3+IA),98)
C
       END IF
C
       CALL RDTAB(NOA,NUA,NUA,NOB,HR3,(I3REC+LREC2+IA),98)
       CALL RDTAB(NOA,NUA,NUA,NOB,R3,(INTREC+IHREC+LREC2+IA),98)
       CALL DAXPY(NOABUA2,XXX,HR3,1,R3,1)
       CALL WRTAB(NOA,NUA,NUA,NOB,R3,(INTREC+IHREC+LREC2+IA),98)
C
       CALL RDTAB(NOB,NOB,NUB,NUA,HR3,(I3REC+LREC4+IA),98)
       CALL RDTAB(NOB,NOB,NUB,NUA,R3,(INTREC+IHREC+LREC4+IA),98)
       CALL DAXPY(NOB2UAB,XXX,HR3,1,R3,1)
       CALL WRTAB(NOB,NOB,NUB,NUA,R3,(INTREC+IHREC+LREC4+IA),98)
C
 3    CONTINUE
C
 1    CONTINUE
C
      CALL ZEROMA(AUX,1,NOUP)
      CALL DCOPY(NOUP,VEC,1,AUX,1)
      XNORM=DDOT(NOUP,VEC,1,AUX,1)
      DO 48,IA=1,NACTB
       IF(IA.LE.NACTA) THEN
       CALL RDTAB(NOA,NUA,NUA,NOA,R3,(INTREC+IHREC+IA),98)
       CALL DCOPY(NOA2UA2,R3,1,HR3,1)
       YYY=DDOT(NOA2UA2,R3,1,HR3,1)
       XNORM=XNORM+YYY
C
       CALL RDTAB(NOA,NUA,NUB,NOB,R3,(INTREC+IHREC+LREC1+IA),98)
       CALL DCOPY(NO2U2AB,R3,1,HR3,1)
       YYY=DDOT(NO2U2AB,R3,1,HR3,1)
       XNORM=XNORM+YYY
C
       CALL RDTAB(NOB,NUB,NUB,NOB,R3,(INTREC+IHREC+LREC3+IA),98)
       CALL DCOPY(NOB2UB2,R3,1,HR3,1)
       YYY=DDOT(NOB2UB2,R3,1,HR3,1)
       XNORM=XNORM+YYY
C
       END IF
C
       CALL RDTAB(NOA,NUA,NUA,NOB,R3,(INTREC+IHREC+LREC2+IA),98)
       CALL DCOPY(NOABUA2,R3,1,HR3,1)
       YYY=DDOT(NOABUA2,R3,1,HR3,1)
       XNORM=XNORM+YYY
C
       CALL RDTAB(NOB,NOB,NUB,NUA,R3,(INTREC+IHREC+LREC4+IA),98)
       CALL DCOPY(NOB2UAB,R3,1,HR3,1)
       YYY=DDOT(NOB2UAB,R3,1,HR3,1)
       XNORM=XNORM+YYY
C
 48   CONTINUE
      XNORM=(1.0D+00)/(DSQRT(XNORM))
      CALL DSCAL(NOUP,XNORM,VEC,1)
      DO 49,IA=1,NACTB
       IF(IA.LE.NACTA) THEN
       CALL RDTAB(NOA,NUA,NUA,NOA,R3,(INTREC+IHREC+IA),98)
       CALL DSCAL(NOA2UA2,XNORM,R3,1)
       CALL WRTAB(NOA,NUA,NUA,NOA,R3,(INTREC+IA),98)
C
       CALL RDTAB(NOA,NUA,NUB,NOB,R3,(INTREC+IHREC+LREC1+IA),98)
       CALL DSCAL(NO2U2AB,XNORM,R3,1)
       CALL WRTAB(NOA,NUA,NUB,NOB,R3,(INTREC+LREC1+IA),98)
C
       CALL RDTAB(NOB,NUB,NUB,NOB,R3,(INTREC+IHREC+LREC3+IA),98)
       CALL DSCAL(NOB2UB2,XNORM,R3,1)
       CALL WRTAB(NOB,NUB,NUB,NOB,R3,(INTREC+LREC3+IA),98)
C
       END IF
C
       CALL RDTAB(NOA,NUA,NUA,NOB,R3,(INTREC+IHREC+LREC2+IA),98)
       CALL DSCAL(NOABUA2,XNORM,R3,1)
       CALL WRTAB(NOA,NUA,NUA,NOB,R3,(INTREC+LREC2+IA),98)
C
       CALL RDTAB(NOB,NOB,NUB,NUA,R3,(INTREC+IHREC+LREC4+IA),98)
       CALL DSCAL(NOB2UAB,XNORM,R3,1)
       CALL WRTAB(NOB,NOB,NUB,NUA,R3,(INTREC+LREC4+IA),98)
C
 49   CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK EA3NORMA
      SUBROUTINE EA3NORMA(NOA,NUA,NOB,NUB,JROOT3,R1,R2A,R2B,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION R1(NUA),R2A(NUA,NUA,NOA),R2B(NUA,NUB,NOB),R3(1)
      DATA ONE/1.0D+00/
      NOABUA2=NOABUA*NUA
      NOB2UAB=NOB2UA*NUB
C
      XNORM=0.00D+00
      DO 1,IA=1,NUA
       YYY=R1(IA)
       XNORM=XNORM+YYY*YYY
 1    CONTINUE
C
      DO 2,J=1,NOA
      DO 3,IA=1,NUA
      DO 4,IB=IA+1,NUA
       YYY=R2A(IA,IB,J)
       XNORM=XNORM+YYY*YYY
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
C
      DO 5,J=1,NOB
      DO 6,IA=1,NUA
      DO 7,IB=1,NUB
       YYY=R2B(IA,IB,J)
       XNORM=XNORM+YYY*YYY
 7    CONTINUE
 6    CONTINUE
 5    CONTINUE
C
      DO 42,IA=1,NACTB
       IF(IA.LE.NACTA) THEN
       CALL RDTAB(NOA,NUA,NUA,NOA,R3,(JROOT3+IA),NFT825)
       CALL NORM3AA(NOA,NUA,IA,XNORM,R3)
       CALL RDTAB(NOA,NUA,NUB,NOB,R3,(JROOT3+LREC1+IA),NFT825)
       CALL NORM3AB(NOA,NUA,NOB,NUB,IA,XNORM,R3)
       CALL RDTAB(NOB,NUB,NUB,NOB,R3,(JROOT3+LREC3+IA),NFT825)
       CALL NORM3BB(NOB,NUB,XNORM,R3)
       END IF
       CALL RDTAB(NOA,NUA,NUA,NOB,R3,(JROOT3+LREC2+IA),NFT825)
       CALL NORM3BA(NOA,NUA,NOB,XNORM,R3)
       CALL RDTAB(NOB,NOB,NUB,NUA,R3,(JROOT3+LREC4+IA),NFT825)
       CALL NORM3BB2(NUA,NOB,NUB,IA,XNORM,R3)
  42  CONTINUE
C
      XNORM=ONE/DSQRT(XNORM)
C
      CALL DSCAL(NUA,XNORM,R1,1)
      CALL DSCAL(NOAUA2,XNORM,R2A,1)
      CALL DSCAL(NOBUAB,XNORM,R2B,1)
C
      DO 43,IA=1,NACTB
       IF(IA.LE.NACTA) THEN
       CALL RDTAB(NOA,NUA,NUA,NOA,R3,(JROOT3+IA),NFT825)
       CALL DSCAL(NOA2UA2,XNORM,R3,1)
       CALL WRTAB(NOA,NUA,NUA,NOA,R3,(JROOT3+IA),NFT825)
C
       CALL RDTAB(NOA,NUA,NUB,NOB,R3,(JROOT3+LREC1+IA),NFT825)
       CALL DSCAL(NO2U2AB,XNORM,R3,1)
       CALL WRTAB(NOA,NUA,NUB,NOB,R3,(JROOT3+LREC1+IA),NFT825)
C
       CALL RDTAB(NOB,NUB,NUB,NOB,R3,(JROOT3+LREC3+IA),NFT825)
       CALL DSCAL(NOB2UB2,XNORM,R3,1)
       CALL WRTAB(NOB,NUB,NUB,NOB,R3,(JROOT3+LREC3+IA),NFT825)
C
       END IF
C
       CALL RDTAB(NOA,NUA,NUA,NOB,R3,(JROOT3+LREC2+IA),NFT825)
       CALL DSCAL(NOABUA2,XNORM,R3,1)
       CALL WRTAB(NOA,NUA,NUA,NOB,R3,(JROOT3+LREC2+IA),NFT825)
C
       CALL RDTAB(NOB,NOB,NUB,NUA,R3,(JROOT3+LREC4+IA),NFT825)
       CALL DSCAL(NOB2UAB,XNORM,R3,1)
       CALL WRTAB(NOB,NOB,NUB,NUA,R3,(JROOT3+LREC4+IA),NFT825)
C
 43   CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK NORM3AA
      SUBROUTINE NORM3AA(NOA,NUA,IA,XNORM,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NOA,NUA,NUA,NOA)
C
      DO 1,IB=IA+1,NUA
      DO 2,IC=IB+1,NUA
      DO 3,J=1,NOA
      DO 4,K=J+1,NOA
       XXX=R3(J,IB,IC,K)
       XNORM=XNORM+(XXX*XXX)
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK NORM3AB
      SUBROUTINE NORM3AB(NOA,NUA,NOB,NUB,IA,XNORM,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NOA,NUA,NUB,NOB)
C
      DO 1,IB=IA+1,NUA
      DO 2,IC=1,NUB
      DO 3,J=1,NOA
      DO 4,K=1,NOB
       XXX=R3(J,IB,IC,K)
       XNORM=XNORM+(XXX*XXX)
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK NORM3BB
      SUBROUTINE NORM3BB(NOB,NUB,XNORM,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NOB,NUB,NUB,NOB)
C
      DO 1,IB=1,NUB
      DO 2,IC=IB+1,NUB
      DO 3,J=1,NOB
      DO 4,K=J+1,NOB
       XXX=R3(J,IB,IC,K)
       XNORM=XNORM+(XXX*XXX)
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK NORM3BA
      SUBROUTINE NORM3BA(NOA,NUA,NOB,XNORM,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      DIMENSION R3(NOA,NUA,NUA,NOB)
C
      DO 1,IB=NACTA+1,NUA
      DO 2,IC=IB+1,NUA
      DO 3,J=1,NOA
      DO 4,K=1,NOB
       XXX=R3(J,IB,IC,K)
       XNORM=XNORM+(XXX*XXX)
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK NORM3BB2
      SUBROUTINE NORM3BB2(NUA,NOB,NUB,IA,XNORM,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      DIMENSION R3(NOB,NOB,NUB,NUA)
C
      DO 1,IB=NACTA+1,NUA
      DO 2,IC=IA+1,NUB
      DO 3,J=1,NOB
      DO 4,K=J+1,NOB
       XXX=R3(J,K,IC,IB)
       XNORM=XNORM+(XXX*XXX)
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK EAINIT
      SUBROUTINE EAINIT(NOA,NUA,NOB,NUB,FPP,FPPB,FHH,FHP,VHPHP,
     *                  VHPPP,VPPP,INDEX1,INDEXA,INDEXB,HM,WR,
     *                  WI,WORK,VR,TRANS,LABMO,ISPIN,L1,IDIM,NROOT)
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
C
C        THIS GROUP IS ORBITAL SYMMETRY ASSIGNMENT
C
      CHARACTER*3 VECREP
      LOGICAL ABELPT
      DIMENSION LABMO(L1)
      CHARACTER*3 GR,REP
      CHARACTER*4 LBTEMP
      DIMENSION NREX(4),MCX(8,8,4)
      DIMENSION LABREP(8)
C
      CHARACTER*1 JOBVR,JOBVL,SMALLD
C
      DIMENSION FPP(1),FHH(1),FHP(1),VHPHP(1),VHPPP(1),VPPP(1)
      DIMENSION INDEX1(NUA),INDEXA(1),INDEXB(1),HM(IDIM,IDIM)
      DIMENSION WR(IDIM),WI(IDIM),WORK(4*IDIM)
      DIMENSION VR(IDIM,IDIM),TRANS(1)
      DIMENSION INDEXX(100),FPPB(1),ISPIN(IDIM),JSTATE(9)
C
      PARAMETER (MXAO=8192)
C
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /RUNOPT/ RUNTYP,EXETYP,NEVALS,NGLEVL,NHLEVL
      COMMON /IOFILE/ IR,IW,IP,IJK,IJKT,IDAF,NAV,IODA(950)
      COMMON /EOMPAR/ CVGCI,CVGEOM,GRPEOM,NSTEOM(8),NOACT,NUACT,
     *                MOACTCC(MXAO),MTHTRIP,MTHCI,MTHEOM,MTHINIT,
     *                MAXCI,MAXEOM,MICCI,MICEOM,IROOTCC(2),
     *                IPROPCC,IPROPCCE
      COMMON /EOMSYM/ IG,NRE(4),MC(8,8,4),ISORB(MXAO),REP(8)
      COMMON /EOMWFE/ EOMSDE(100),EOMR0(100),EOMR0L(100),
     *                CR1D1A(100),CR2D1A(100),CR1D1B(100),CR2D1B(100),
     *                CRCI3(100),XDELWB(100),XKKEOM(100),
     *                CR1A(100),CR1B(100),CR1C(100),CR1D(100),CR2A(100),
     *                CR2B(100),CR2C(100),CR2D(100),CREX3(100),
     *                KVGEOM(100),IUST(100),IREL(100),
     *                KKTRIM(100),KKTRIML(100),
     *                INUMEOM,NTOTEOM,NBADEOM,NTOTCISD,NCVGCISD,LAMCON,
     *                IVSYMAD(8),VECREP(100)
      COMMON /CCPAR / AMPTSH,METHCC,NCCTOT,NCCOCC,NCCFZC,NCCFZV,
     *                MXCCIT,MXRLEIT,NWRDCC,ICCCNV,ICCRST,IDSKCC
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /EAREST/ MREST(500)
      DATA CHECK/8HCHECK   /
C
C DATA BLOCK FOR MATRICES NRE AND MC
C
      DATA NREX/1,2,4,8/
      DATA MCX/
     &1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
     &0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
     &
     & 1,1,0,0,0,0,0,0, 1,-1,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,
     & 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,
     & 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,
     &
     & 1,1,1,1,0,0,0,0,      1,1,-1,-1,0,0,0,0, 1,-1,1,-1,0,0,0,0,
     & 1,-1,-1,1,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,
     & 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,
     &
     & 1,1,1,1,1,1,1,1,      1,1,1,1,-1,-1,-1,-1,  1,1,-1,-1,1,1,-1,-1,
     & 1,1,-1,-1,-1,-1,1,1,  1,-1,1,-1,1,-1,1,-1,  1,-1,1,-1,-1,1,-1,1,
     & 1,-1,-1,1,1,-1,-1,1,  1,-1,-1,1,-1,1,1,-1/
C
      DO K=1,4
         DO J=1,8
            DO I=1,8
               MC(I,J,K) = MCX(I,J,K)
            ENDDO
         ENDDO
         NRE(K) = NREX(K)
      ENDDO
C
      WRITE(UNIT=GR,FMT='(A3)') GRPEOM
      IF(.NOT.ABELPT()) GR='C1 '
C
      WRITE(IW,9010) GR
      CALL REPFIX(IW,GR,REP,IG)
C
      NIRREP = NRE(IG)
      DO I=1,NIRREP
         LBTEMP(1:3) = REP(I)
         LBTEMP(4:4) = ' '
         READ(UNIT=LBTEMP,FMT='(A4)') LABREP(I)
      ENDDO
C
C        4 BYTE MO SYMMETRY LABELS ARE AVAILABLE ON DISK FROM THE SCF
C        USE THESE TO FILL -ISORB- WITH CORRECT INTEGER VALUES
C
      IF(GR.EQ.'C1 ') THEN
         DO I=1,NOA+NUA
            ISORB(I) = 1
         ENDDO
      ELSE
         CALL DAREAD(IDAF,IODA,LABMO,L1,255,1)
         NERR=0
         DO I=1,NOA+NUA
            LTEMP = LABMO(I+NCCFZC)
            MATCH=0
            DO J=1,NIRREP
               IF(LTEMP.EQ.LABREP(J)) MATCH=J
            ENDDO
            ISORB(I) = MATCH
            IF(MATCH.EQ.0) THEN
               WRITE(IW,9020) I+NCCFZC,LTEMP
               NERR=NERR+1
            END IF
         ENDDO
         IF(NERR.GT.0) THEN
            WRITE(IW,9030) NERR
            CALL ABRT
            STOP
         END IF
      END IF
C
      IGO=1
      DO I=1,NRE(IG)
       DO J=1,NSTEOM(I)
        VECREP(IGO)=REP(I)
        IGO=IGO+1
       ENDDO
      ENDDO
      NROOT=0
      DO I=1,NRE(IG)
       NROOT=NROOT+NSTEOM(I)
      ENDDO
      CALL FIXGRSYM(NOA,NOB,IGRSYM)
      WRITE(IW,9040)REP(IGRSYM)
      CALL FLSHBF(IW)
      IPREV=0
      IPREVB=0
C
      IF(EXETYP.EQ.CHECK) RETURN
C
      CALL VICLR(MREST,1,500)
      CALL VICLR(JSTATE,1,9)
      IF(JREST.EQ.1) THEN
       READ(NFT825,REC=6,IOSTAT=IX)JSTATE
       IF(IX.NE.0) THEN
        WRITE(IW,9005)
        CALL ABRT
        STOP
       END IF
       IF(JSTATE(1).NE.MULEAIP) THEN
        WRITE(IW,9000)
        CALL ABRT
        STOP
       END IF
      END IF
C
      DO 1004,I=1,NRE(IG)
      IF(NSTEOM(I).EQ.0) GO TO 1004
      IROOT=NSTEOM(I)
      JROOT=JSTATE(I+1)
      CALL EAINDEX(NOA,NUA,NOB,NUB,INDEX1,INDEXA,INDEXB,IPOS,
     *             IGRSYM,I,ILC1,ILC2,MXUA,MXUB)
C
      JOBVR='V'
      JOBVL='N'
      LWORK=4*IDIM
      IALL=IPOS
      IF(MTHINIT.EQ.2) THEN
       WRITE(IW,9050) IALL
      ELSE
       SMALLD=CHAR(100)
       WRITE(IW,9055) SMALLD,IALL
      END IF
      CALL FLSHBF(IW)
      IF(IROOT.GT.IALL) THEN
       IF(MTHINIT.EQ.2) THEN
        WRITE(IW,9060)
       ELSE
        WRITE(IW,9065)
       END IF
       CALL FLSHBF(IW)
       CALL ABRT
       STOP
      END IF
C
C   FILL THE CIS OR EOMCCSd HAMILTONIAN MATRIX
C
      IF(MTHINIT.EQ.2) THEN
       CALL EASFILL(NUA,HM,FPP,INDEX1,IDIM)
      ELSE
       CALL EADFILL1(NOA,NUA,FPP,FHP,VHPPP,HM,INDEX1,INDEXA,IDIM)
       CALL EADFILL2(NOA,NUA,FPP,FHH,VHPPP,VHPHP,VPPP,HM,INDEX1,
     *               INDEXA,IDIM,MXUA)
       CALL EADFILL3(NOA,NUA,NOB,NUB,FHP,VHPPP,VHPHP,HM,INDEX1,
     *               INDEXA,INDEXB,IDIM)
       CALL EADFILL4(NOA,NUA,NOB,NUB,VHPHP,VHPPP,HM,INDEX1,
     *               INDEXA,INDEXB,IDIM)
       CALL EADFILL5(NUA,NOB,NUB,FPP,FPPB,FHH,VHPPP,VHPHP,VPPP,HM,
     *               INDEXB,IDIM,MXUB)
      END IF
C
C   DIAGONALIZE HAMILTONIAN MATRIX
C
      NORDER=ILC1+ILC2
      CALL DGEEV(JOBVL,JOBVR,NORDER,HM,IDIM,WR,WI,VL,IDIM,VR,
     *           IDIM,WORK,LWORK,INFO)
C
      IF(INFO.NE.0) THEN
       WRITE(IW,*) 'INITIAL DIAGONALIZATION ERROR INFO:',INFO
       CALL FLSHBF(IW)
       CALL ABRT
       STOP
      END IF
C
C IDENTIFY SPIN MULTIPLICITIES
      IF(NOA.EQ.NOB) THEN
      CALL EASPNINT(NOA,NUA,NOB,NUB,IDIM,NORDER,INDEX1,INDEXA,
     *              INDEXB,WR,VR,ISPIN)
      END IF
C
C ORDER THE STATES
C
      CALL EAORDER(NOA,NOB,NORDER,IROOT,WR,WI,ISPIN,INDEXX,INFO1,IREAL)
C
      IF(INFO1.EQ.0) THEN
       WRITE(IW,9070) IROOT,REP(I)
       WRITE(IW,9080)
       WRITE(IW,9090) REP(I)
        IF(NOA.EQ.NOB) THEN
        DO KROOT=1,IROOT
         WRITE(IW,9100) WR(INDEXX(KROOT)),ISPIN(INDEXX(KROOT))
        ENDDO
        ELSE
        DO KROOT=1,IROOT
         WRITE(IW,9105) WR(INDEXX(KROOT))
        ENDDO
        END IF
      ELSE IF(INFO1.NE.0.AND.MULEAIP.NE.1) THEN
       WRITE(IW,9110) IREAL,REP(I),MULEAIP
       CALL ABRT
       STOP
      ELSE
       WRITE(IW,9120) IREAL,REP(I)
       CALL ABRT
       STOP
      END IF
C
       CALL EASTRINT(NOA,NUA,NOB,NUB,IDIM,INDEX1,INDEXA,INDEXB,
     *               VR,TRANS,IROOT,JROOT,INDEXX,IPREV,IPREVB,
     *               VHPHP) !JRG 12 APR 2010
       IPREV=IPREV+IROOT
       IPREVB=IPREVB+JROOT
C
 1004 CONTINUE
C
      RETURN
 9000 FORMAT(1X,'ERROR IN RESTARTING THE CALCULATION!',/
     *       1X,'THE VALUE OF MULT MUST BE THE SAME AS IN THE',
     *       1X,'PREVIOUS CALCULATION!')
 9005 FORMAT(1X,'ERROR IN RESTARTING THE CALCULATION!',/
     *       1X,'NO RESTART INFORMATION EXISTS!',/
     *       1X,'PLACE THE AMPROCC FILE OF A PREVIOUS',
     *       1X,'CALCULATION INTO THE WORKING',/
     *       1X,'DIRECTORY AND RESUBMIT.')
 9010 FORMAT(/1X,'THE EA-EOMCC POINT GROUP IS ',A3)
 9020 FORMAT(1X,'ORBITAL',I5,' HAS UNKNOWN SYMMETRY LABEL ',A4)
 9030 FORMAT(1X,'UNABLE TO ASSIGN SYMMETRY TO',I5,' ORBITAL(S).'/
     *       1X,'PLEASE PROVIDE CRISPLY CONVERGED SCF ORBITALS!')
 9040 FORMAT(1X,'GROUND STATE SYMETRY IS ',A4)
 9050 FORMAT(1X,'SIZE OF CIS PROBLEM:',I8)
 9055 FORMAT(1X,'SIZE OF EOMCCS',A,' PROBLEM:',I8)
 9060 FORMAT(1X,'TOO MANY ROOTS REQUESTED FOR MINIT=2!'/
     *       1X,'PLEASE REDUCE THE NUMBER OF ROOTS OR USE MINIT=1.')
 9065 FORMAT(1X,'TOO MANY ROOTS REQUESTED!'/
     *       1X,'PLEASE REDUCE THE NUMBER OF ROOTS',
     *       1X,'OR INCREASE THE NUMBER OF ACTIVE ORBITALS')
 9070 FORMAT(1X,I4,' INITIAL VECTORS OF ',A3,
     *       ' SYMMETRY HAVE BEEN FOUND.')
 9080 FORMAT(4X,'ORDERING OF THE INITIAL EIGENVALUES WAS SUCCESSFUL')
 9090 FORMAT(4X,'INITIAL EIGENVALUES OF ',A3,' SYMMETRY:')
 9100 FORMAT(5X,'E=',1X,F20.10,3X,'SPIN MULTIPLICITY=',1X,I1)
 9105 FORMAT(5X,'E=',1X,F20.10)
 9110 FORMAT(1X,'ONLY',1X,I3,1X,'INITIAL VECTORS OF',1X,A3,1X,
     *       'SYMMETRY AND',/,2X,'SPIN MULTIPLICITY = ',I1,1X,
     *       'HAVE BEEN FOUND!')
 9120 FORMAT(1X,'ONLY',1X,I3,1X,'INITIAL VECTORS OF',1X,A3,1X,
     *       'SYMMETRY HAVE BEEN FOUND!')
      END
C
C*MODULE EAIPCC  *DECK EASFILL
      SUBROUTINE EASFILL(NU,HM,FPP,INDEX1,IDIM)
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      DIMENSION HM(IDIM,IDIM),FPP(NU,NU),INDEX1(NU)
C
      IDIM2=IDIM*IDIM
      CALL ZEROMA(HM,1,IDIM2)
      CALL RCCFL(NFT843,9,NUA2,FPP)
      DO 4,IA=1,NU
      IROW=INDEX1(IA)
      IF(IROW.EQ.0) GO TO 4
      DO 5,IB=1,NU
       ICOL=INDEX1(IB)
       IF(ICOL.EQ.0) GO TO 5
       HM(IROW,ICOL)=FPP(IB,IA)
 5    CONTINUE
 4    CONTINUE
C
C      DO 455,I1=IALL+1,IDIM
C       HM(I1,I1)=100000.0D+00+DBLE(I1)
C 455  CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK EADFILL1
      SUBROUTINE EADFILL1(NOA,NUA,FPP,FHP,VHPPP,HM,INDEX1,INDEXA,IDIM)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
C
      DIMENSION FPP(NUA,NUA),FHP(NOA,NUA),VHPPP(NOA,NUA,NUA,NUA)
      DIMENSION HM(IDIM,IDIM),INDEX1(NUA),INDEXA(NUA,NUA,NOA)
C
      CALL RDTAB2(NUA,NUA,FPP,1,NFT891)
      CALL RDTAB2(NOA,NUA,FHP,5,NFT891)
      CALL RDTAB(NOA,NUA,NUA,NUA,VHPPP,11,NFT892)
C
      IDIM2=IDIM*IDIM
      CALL ZEROMA(HM,1,IDIM2)
C
      DO 1,IA=1,NUA
       IROW=INDEX1(IA)
       IF(IROW.EQ.0) GO TO 1
C
       DO 2,IB=1,NUA
        ICOL=INDEX1(IB)
        IF(ICOL.EQ.0) GO TO 2
        HM(IROW,ICOL)=HM(IROW,ICOL)+FPP(IB,IA)
 2     CONTINUE
C
       DO 3,J=1,NOA
       DO 4,IB=1,NUA
        ICOL=INDEXA(IA,IB,J)
        IF(ICOL.EQ.0) GO TO 4
        HM(IROW,ICOL)=HM(IROW,ICOL)-(FHP(J,IB)*ISGN(IA,IB))
 4     CONTINUE
 3     CONTINUE
C
       DO 5,J=1,NOA
       DO 6,IB=1,NUA
       DO 7,IC=IB+1,NUA
        ICOL=INDEXA(IB,IC,J)
        IF(ICOL.EQ.0) GO TO 7
        HM(IROW,ICOL)=HM(IROW,ICOL)+VHPPP(J,IB,IC,IA)
 7     CONTINUE
 6     CONTINUE
 5     CONTINUE
C
 1    CONTINUE
C
      RETURN
      END
C
C
C*MODULE EAIPCC  *DECK EADFILL2
       SUBROUTINE EADFILL2(NOA,NUA,FPP,FHH,VHPPP,VHPHP,VPPP,HM,INDEX1,
     *                     INDEXA,IDIM,MXUA)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
C
      DIMENSION FPP(NUA,NUA),FHH(NOA,NOA),VPPP(NUA,NUA,NUA)
      DIMENSION VHPPP(NUA,NUA,NUA,NOA),VHPHP(NUA,NOA,NUA,NOA)
      DIMENSION HM(IDIM,IDIM),INDEX1(NUA),INDEXA(NUA,NUA,NOA)
C
      CALL RDTAB(NUA,NUA,NUA,NOA,VHPPP,7,NFT892)
      CALL RDTAB2(NOA,NOA,FHH,3,NFT891)
      CALL RDTAB(NUA,NOA,NUA,NOA,VHPHP,1,NFT892)
C
      DO 1,J=1,NOA
      DO 2,IA=1,NUA
      DO 3,IB=IA+1,NUA
       IROW=INDEXA(IA,IB,J)
       IF(IROW.EQ.0) GO TO 3
C
       DO 4,IC=1,NUA
        ICOL=INDEX1(IC)
        IF(ICOL.EQ.0) GO TO 20
        HM(IROW,ICOL)=HM(IROW,ICOL)+VHPPP(IA,IB,IC,J)
 20     ICOL=INDEXA(IB,IC,J)
        IF(ICOL.EQ.0) GO TO 21
        HM(IROW,ICOL)=HM(IROW,ICOL)+(FPP(IC,IA)*ISGN(IB,IC))
 21     ICOL=INDEXA(IA,IC,J)
        IF(ICOL.EQ.0) GO TO 4
        HM(IROW,ICOL)=HM(IROW,ICOL)-(FPP(IC,IB)*ISGN(IA,IC))
 4     CONTINUE
C
       DO 5,K=1,NOA
        ICOL=INDEXA(IA,IB,K)
        IF(ICOL.EQ.0) GO TO 5
        HM(IROW,ICOL)=HM(IROW,ICOL)-FHH(J,K)
 5     CONTINUE
C
       DO 6,K=1,NOA
       DO 7,IC=1,NUA
        ICOL=INDEXA(IB,IC,K)
        IF(ICOL.EQ.0) GO TO 22
        HM(IROW,ICOL)=HM(IROW,ICOL)-(VHPHP(IA,J,IC,K)*ISGN(IB,IC))
 22     ICOL=INDEXA(IA,IC,K)
        IF(ICOL.EQ.0) GO TO 7
        HM(IROW,ICOL)=HM(IROW,ICOL)+(VHPHP(IB,J,IC,K)*ISGN(IA,IC))
 7     CONTINUE
 6     CONTINUE
C
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      DO 10,ID=1,MXUA
      READ(NFT899,REC=ID) VPPP
      DO 11,IC=1,ID-1
       DO 12,J=1,NOA
       ICOL=INDEXA(IC,ID,J)
       IF(ICOL.EQ.0) GO TO 12
       DO 13,IA=1,NUA
       DO 14,IB=IA+1,NUA
        IROW=INDEXA(IA,IB,J)
        IF(IROW.EQ.0) GO TO 14
        HM(IROW,ICOL)=HM(IROW,ICOL)+VPPP(IA,IB,IC)
 14    CONTINUE
 13    CONTINUE
 12    CONTINUE
 11   CONTINUE
 10   CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK EADFILL3
      SUBROUTINE EADFILL3(NOA,NUA,NOB,NUB,FHP,VHPPP,VHPHP,HM,INDEX1,
     *                    INDEXA,INDEXB,IDIM)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
C
      DIMENSION FHP(NOB,NUB),VHPPP(NUA,NUB,NUA,NOB)
      DIMENSION VHPHP(NUB,NOB,NOA,NUA),HM(IDIM,IDIM)
      DIMENSION INDEX1(NUA),INDEXA(NUA,NUA,NOA),INDEXB(NUA,NUB,NOB)
C
      CALL RDTAB2(NOB,NUB,FHP,6,NFT891)
      CALL RDTAB(NUA,NUB,NUA,NOB,VHPPP,13,NFT892)
C
      DO 1,IA=1,NUA
       IROW=INDEX1(IA)
       IF(IROW.EQ.0) GO TO 1
C
       DO 2,J=1,NOB
       DO 3,IC=1,NUB
        ICOL=INDEXB(IA,IC,J)
        IF(ICOL.EQ.0) GO TO 3
        HM(IROW,ICOL)=HM(IROW,ICOL)+FHP(J,IC)
 3     CONTINUE
 2     CONTINUE
C
       DO 4,J=1,NOB
       DO 5,IB=1,NUA
       DO 6,IC=1,NUB
        ICOL=INDEXB(IB,IC,J)
        IF(ICOL.EQ.0) GO TO 6
        HM(IROW,ICOL)=HM(IROW,ICOL)+VHPPP(IA,IC,IB,J)
 6     CONTINUE
 5     CONTINUE
 4     CONTINUE
C
 1    CONTINUE
C
      CALL RDTAB(NUB,NOB,NOA,NUA,VHPHP,5,NFT892)
C
      DO 10,J=1,NOA
      DO 11,IA=1,NUA
      DO 12,IB=IA+1,NUA
       IROW=INDEXA(IA,IB,J)
       IF(IROW.EQ.0) GO TO 12
       DO 13,K=1,NOB
       DO 14,IC=1,NUB
        ICOL=INDEXB(IA,IC,K)
        IF(ICOL.EQ.0) GO TO 20
        HM(IROW,ICOL)=HM(IROW,ICOL)-VHPHP(IC,K,J,IB)
 20     ICOL=INDEXB(IB,IC,K)
        IF(ICOL.EQ.0) GO TO 14
        HM(IROW,ICOL)=HM(IROW,ICOL)+VHPHP(IC,K,J,IA)
 14    CONTINUE
 13    CONTINUE
 12   CONTINUE
 11   CONTINUE
 10   CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK EADFILL4
      SUBROUTINE EADFILL4(NOA,NUA,NOB,NUB,VHPHP,VHPPP,HM,INDEX1,
     *                    INDEXA,INDEXB,IDIM)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
C
      DIMENSION VHPHP(NUB,NOB,NUA,NOA),HM(IDIM,IDIM)
      DIMENSION INDEXA(NUA,NUA,NOA),INDEXB(NUA,NUB,NOB)
      DIMENSION VHPPP(NUA,NUB,NUA,NOB),INDEX1(NUA)
C
      CALL RDTAB(NUB,NOB,NUA,NOA,VHPHP,6,NFT892)
      CALL RDTAB(NUA,NUB,NUA,NOB,VHPPP,9,NFT892)
C
      DO 1,J=1,NOB
      DO 2,IA=1,NUA
      DO 3,IB=1,NUB
       IROW=INDEXB(IA,IB,J)
       IF(IROW.EQ.0) GO TO 3
       DO 4,K=1,NOA
       DO 5,IC=1,NUA
        ICOL=INDEXA(IA,IC,K)
        IF(ICOL.EQ.0) GO TO 5
        HM(IROW,ICOL)=HM(IROW,ICOL)+(VHPHP(IB,J,IC,K)*ISGN(IA,IC))
 5     CONTINUE
 4     CONTINUE
C
       DO 6,IC=1,NUA
        ICOL=INDEX1(IC)
        IF(ICOL.EQ.0) GO TO 6
        HM(IROW,ICOL)=HM(IROW,ICOL)+VHPPP(IA,IB,IC,J)
 6     CONTINUE
C
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK EADFILL5
       SUBROUTINE EADFILL5(NUA,NOB,NUB,FPP,FPPB,FHH,VHPHP,VHPHPB,
     *                     VPPP,HM,INDEXB,IDIM,MXUB)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      DIMENSION FPP(NUA,NUA),FPPB(NUB,NUB),FHH(NOB,NOB)
      DIMENSION VHPHP(NUA,NOB,NUA,NOB),VHPHPB(NUB,NOB,NUB,NOB)
      DIMENSION VPPP(NUA,NUB,NUA),HM(IDIM,IDIM),INDEXB(NUA,NUB,NOB)
C
      CALL RDTAB2(NUB,NUB,FPPB,2,NFT891)
      CALL RDTAB2(NOB,NOB,FHH,4,NFT891)
      CALL RDTAB(NUA,NOB,NUA,NOB,VHPHP,4,NFT892)
      CALL RDTAB(NUB,NOB,NUB,NOB,VHPHPB,2,NFT892)
C
      DO 1,J=1,NOB
      DO 2,IA=1,NUA
      DO 3,IB=1,NUB
       IROW=INDEXB(IA,IB,J)
       IF(IROW.EQ.0) GO TO 3
C
       DO 4,ID=1,NUB
        ICOL=INDEXB(IA,ID,J)
        IF(ICOL.EQ.0) GO TO 4
        HM(IROW,ICOL)=HM(IROW,ICOL)+FPPB(ID,IB)
 4     CONTINUE
C
       DO 5,IC=1,NUA
        ICOL=INDEXB(IC,IB,J)
        IF(ICOL.EQ.0) GO TO 5
        HM(IROW,ICOL)=HM(IROW,ICOL)+FPP(IC,IA)
 5     CONTINUE
C
       DO 6,K=1,NOB
        ICOL=INDEXB(IA,IB,K)
        IF(ICOL.EQ.0) GO TO 6
        HM(IROW,ICOL)=HM(IROW,ICOL)-FHH(J,K)
 6     CONTINUE
C
       DO 7,K=1,NOB
       DO 8,IC=1,NUA
        ICOL=INDEXB(IC,IB,K)
        IF(ICOL.EQ.0) GO TO 8
        HM(IROW,ICOL)=HM(IROW,ICOL)-VHPHP(IA,J,IC,K)
 8     CONTINUE
       DO 9,ID=1,NUB
        ICOL=INDEXB(IA,ID,K)
        IF(ICOL.EQ.0) GO TO 9
        HM(IROW,ICOL)=HM(IROW,ICOL)-VHPHPB(IB,J,ID,K)
 9     CONTINUE
 7     CONTINUE
C
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      DO 10,ID=1,MXUB
      READ(NFT899,REC=NUA+NUB+ID) VPPP
      DO 11,IC=1,NUA
       DO 12,J=1,NOB
       ICOL=INDEXB(IC,ID,J)
       IF(ICOL.EQ.0) GO TO 12
       DO 13,IA=1,NUA
       DO 14,IB=1,NUB
        IROW=INDEXB(IA,IB,J)
        IF(IROW.EQ.0) GO TO 14
        HM(IROW,ICOL)=HM(IROW,ICOL)+VPPP(IA,IB,IC)
 14    CONTINUE
 13    CONTINUE
 12    CONTINUE
 11   CONTINUE
 10   CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ISGN(IA,IB)
      INTEGER FUNCTION ISGN(IA,IB)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      ISGN=1
      IF(IA.LT.IB) ISGN=-ISGN
      RETURN
      END
C
C*MODULE EAIPCC  *DECK HR2P1H
      SUBROUTINE HR2P1H(NOA,NUA,NOB,NUB,R1,HR1,R2A,R2B,HR2A,HR2B,
     *                  FPP,FHP,FHH,VHPPP,VPPP,VHPHP,T2,OHA,TI)
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
C
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
C
      DIMENSION R1(1),HR1(1),R2A(1),R2B(1)
      DIMENSION HR2A(1),HR2B(1)
      DIMENSION FPP(1),FHP(1),FHH(1)
      DIMENSION VHPPP(1),VPPP(1)
      DIMENSION VHPHP(1),T2(1)
      DIMENSION OHA(1),TI(1)
C
      DATA HALF/0.5D+00/
      DATA QUART/0.25D+00/,FOUR/4.00D+00/
C
C     -------------------INITIAL ZEROING---------------------------------
      CALL ZEROMA(FHP,1,NOU)
      CALL ZEROMA(FPP,1,NU2)
      CALL ZEROMA(FHH,1,NO2)
      CALL ZEROMA(VHPPP,1,NOU3)
      CALL ZEROMA(VHPHP,1,NO2U2)
      CALL ZEROMA(T2,1,NO2U2)
      CALL ZEROMA(OHA,1,NOA)
      CALL ZEROMA(HR1,1,NUA)
      CALL ZEROMA(HR2A,1,NOU2)
      CALL ZEROMA(HR2B,1,NOU2)
C
      CALL RDTAB(NUB,NOB,NUA,NOA,VHPHP,6,NFT892)
      CALL TRT1(NOBUB,NOAUA,TI,VHPHP)
      CALL CCMATMUL(R2A,VHPHP,HR2B,NUA,NOBUB,NOAUA,1,1)   !HR2B(AA,BB,JB)
      CALL RDINT(1,NOAUA,NOAUA,VHPHP,NFT829)
      CALL INSI23(NUA,NUA,NOA,TI,R2A)
      CALL CCMATMUL(R2A,VHPHP,OHA,1,NOA,NOAUA2,1,1)
      CALL VECMUL(OHA,NOA,HALF)
      CALL ZEROMA(VHPHP,1,NO2U2)
      CALL RDINT(1,NOBUB,NOAUA,VHPHP,NFT833)
      CALL INSITU(NUA,NOA,NUB,NOB,TI,VHPHP,12)
      CALL CCMATMUL(VHPHP,R2B,OHA,NOA,1,NOBUAB,0,0)
      CALL ZEROMA(VHPHP,1,NO2U2)
      CALL RDTAB2(NUA,NUA,FPP,1,NFT891)
      CALL RDTAB2(NOA,NUA,FHP,5,NFT891)
      CALL RDTAB(NOA,NUA,NUA,NUA,VHPPP,11,NFT892)
      CALL RDTAB(NUA,NOA,NUA,NOA,VHPHP,1,NFT892)
      CALL CCMATMUL(VHPHP,R2A,HR2A,NOAUA,NUA,NOAUA,1,1)   !HR2A(AA,JA,BA)
      CALL ZEROMA(VHPHP,1,NO2U2)
      CALL RDTAB(NUB,NOB,NOA,NUA,VHPHP,5,NFT892)
      CALL CCMATMUL(R2B,VHPHP,HR2A,NUA,NOAUA,NOBUB,0,1)   !HR2A(AA,JA,BA)
      CALL INSI23(NUA,NOA,NUA,TI,HR2A)                    !HR2A(AA,BA,JA)
      CALL VECMUL(R2A,NOAUA2,QUART)
      CALL RPPPA(NOA,NUA,VPPP,R2A,HR2A)
      CALL VECMUL(R2A,NOAUA2,FOUR)
      CALL INSI12(NUA,NOA,NUA,TI,R2A)
      CALL CCMATMUL(R2A,VHPPP,HR1,1,NUA,NOAUA2,1,0)
      CALL VECMUL(HR1,NUA,HALF)
      CALL CCMATMUL(R1,FPP,HR1,1,NUA,NUA,0,0)
      CALL CCMATMUL(FHP,R2A,HR1,1,NUA,NOAUA,0,1)
      CALL ZEROMA(FHP,1,NOU)
      CALL ZEROMA(VHPPP,1,NOU3)
      CALL ZEROMA(VHPHP,1,NO2U2)
      CALL RDTAB2(NOB,NUB,FHP,6,NFT891)
      CALL RDTAB(NUA,NUB,NUA,NOB,VHPPP,13,NFT892)
      CALL RDTAB(NUB,NOB,NUB,NOB,VHPHP,2,NFT892)
      CALL TRANSNQN(NOB,NUB,FHP,TI)
      CALL CCMATMUL(R2B,FHP,HR1,NUA,1,NOBUB,0,0)
      CALL TRANSQ(FPP,NUA)
      CALL CCMATMUL(FPP,R2B,HR2B,NUA,NOBUB,NUA,0,0)        !HR2B(AA,BB,JB)
      CALL RDTAB2(NOB,NOB,FHH,4,NFT891)
      CALL TRANSQ(FHH,NOB)
      CALL CCMATMUL(R2B,FHH,HR2B,NUAB,NOB,NOB,0,1)         !HR2B(AA,BB,JB)
      CALL TRANSQ(VHPHP,NOBUB)
      CALL CCMATMUL(R2B,VHPHP,HR2B,NUA,NOBUB,NOBUB,0,1)    !HR2B(AA,BB,JB)
      CALL INSI12(NUA,NUB,NOB,TI,R2B)
      CALL CCMATMUL(VHPPP,R2B,HR1,NUA,1,NOBUAB,0,0)
C
      CALL RDTAB(NUA,NUB,NUA,NOB,VHPPP,9,NFT892)
      CALL TRANMD(VHPPP,NUA,NUB,NUA,NOB,13)
      CALL INSI12(NUA,NUB,NOB,TI,HR2B)                     !HR2B(BB,AA,JB)
      CALL CCMATMUL(R1,VHPPP,HR2B,1,NOBUAB,NUA,0,0)        !HR2B(BB,AA,JB)
      CALL ZEROMA(VHPPP,1,NOU3)
      CALL RDTAB(NUA,NUA,NUA,NOA,VHPPP,7,NFT892)
      CALL VECMUL(R1,NUA,HALF)
      CALL TRANMD(VHPPP,NUA,NUA,NUA,NOA,13)
      CALL CCMATMUL(R1,VHPPP,HR2A,1,NOAUA2,NUA,0,1)        !HR2A(AA,BA,JA)
      CALL INSI13(NOA,NUA,NUA,TI,R2A)
      CALL CCMATMUL(FPP,R2A,HR2A,NUA,NOAUA,NUA,0,1)        !HR2A(AA,BA,JA)
      CALL ZEROMA(FPP,1,NU2)
      CALL RDTAB2(NUB,NUB,FPP,2,NFT891)
      CALL TRANSQ(FPP,NUB)
      CALL CCMATMUL(FPP,R2B,HR2B,NUB,NOBUA,NUB,0,0)        !HR2B(BB,AA,JB)
      CALL ZEROMA(VHPHP,1,NO2U2)
      CALL ZEROMA(FHH,1,NO2)
      CALL RDTAB2(NOA,NOA,FHH,3,NFT891)
      CALL RDTAB(NUA,NOB,NUA,NOB,VHPHP,4,NFT892)
      CALL TRANSQ(FHH,NOA)
      CALL VECMUL(FHH,NOA2,HALF)
      CALL CCMATMUL(R2A,FHH,HR2A,NUA2,NOA,NOA,0,0)         !HR2A(AA,BA,JA)
      CALL TRANSQ(VHPHP,NOBUA)
      CALL CCMATMUL(R2B,VHPHP,HR2B,NUB,NOBUA,NOBUA,0,1)    !HR2B(BB,AA,JB)
      CALL INSI12(NUB,NUA,NOB,TI,HR2B)                     !HR2B(AA,BB,JB)
      CALL TRANSNQN(NUB,NOBUA,R2B,TI)
C      CALL INSI12(NUB,NUA,NOB,TI,R2B)
C      CALl INSI23(NUA,NUB,NOB,TI,R2B)
      CALL RPPPB(NUA,NOB,NUB,VPPP,R2B,HR2B)
C
      CALL RDTAB(NOA,NUA,NUB,NOB,T2,5,NFT825)
      CALL CCMATMUL(OHA,T2,HR2B,1,NOBUAB,NOA,0,1)          !HR2B(AA,BB,JB)
      CALL ZEROMA(T2,1,NO2U2)
      CALL RDTAB(NOA,NUA,NUA,NOA,T2,3,NFT825)
      CALL VECMUL(OHA,NOA,HALF)
      CALL CCMATMUL(OHA,T2,HR2A,1,NOAUA2,NOA,0,1)          !HR2A(AA,BA,JA)
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK RPPPA
      SUBROUTINE RPPPA(NOA,NUA,VPPP,R2A,HR2A)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
C
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
C
      DIMENSION VPPP(NUA,NUA,NUA),R2A(NUA,NOA,NUA),HR2A(NUA,NUA,NOA)
C
      DO 4,IF=1,NUA
       CALL ZEROMA(VPPP,1,NU3)
       READ(NFT899,REC=IF) VPPP
       CALL CCMATMUL(VPPP,R2A(1,1,IF),HR2A,NUA2,NOA,NUA,0,0)
 4    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK RPPPB
      SUBROUTINE RPPPB(NUA,NOB,NUB,VPPP,R2B,HR2B)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
C
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
C
      DIMENSION VPPP(NUA,NUB,NUA),R2B(NUA,NOB,NUB),HR2B(NUA,NUB,NOB)
C
      DO 4,IF=1,NUB
       CALL ZEROMA(VPPP,1,NU3)
       READ(NFT899,REC=NUA+NUB+IF) VPPP
       CALL CCMATMUL(VPPP,R2B(1,1,IF),HR2B,NUAB,NOB,NUA,0,0)
 4    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC   DECK ASYMEA2
      SUBROUTINE ASYMEA2(T2PPH,NH,NP,TI)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION TI(1),T2PPH(1)
C
      NN=NH*(NP**2)
      CALL VECCOP(NN,TI,T2PPH)
      CALL TRANMD(TI,NP,NP,NH,1,12)
      CALL DAXPY(NN,-1.00D+00,TI,1,T2PPH,1)
      RETURN
      END
C
C*MODULE EAIPCC  *DECK RDTAB1
      SUBROUTINE RDTAB1(N1,TAB,IREC,NFILE)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION TAB(N1)
C
      READ(NFILE,REC=IREC) TAB
      RETURN
      END
C
C*MODULE EAIPCC  *DECK RDTAB3
      SUBROUTINE RDTAB3(N1,N2,N3,TAB,IREC,NFILE)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION TAB(N1,N2,N3)
C
      READ(NFILE,REC=IREC) TAB
      RETURN
      END
C
C*MODULE EAIPCC  *DECK WRTAB1
      SUBROUTINE WRTAB1(N1,TAB,IREC,NFILE)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION TAB(N1)
C
      WRITE(NFILE,REC=IREC) TAB
      RETURN
      END
C
C*MODULE EAIPCC  *DECK WRTAB3
      SUBROUTINE WRTAB3(N1,N2,N3,TAB,IREC,NFILE)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION TAB(N1,N2,N3)
C
      WRITE(NFILE,REC=IREC) TAB
      RETURN
      END
C
C*MODULE EAIPCC  *DECK WEAINIT(IREC,N,A)
      SUBROUTINE WEAINIT(IREC,N,A)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION A(N)
      WRITE(97,REC=IREC) A
      RETURN
      END
C
C*MODULE EAIPCC  *DECK REAINIT(IREC,N,A)
      SUBROUTINE REAINIT(IREC,N,A)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION A(N)
      READ(97,REC=IREC) A
      RETURN
      END
C
C*MODULE EAIPCC  *DECK EAINDEX
      SUBROUTINE EAINDEX(NOA,NUA,NOB,NUB,INDEX1,INDEXA,INDEXB,IPOS,
     *                   IGRSYM,ISKK,ILC1,ILC2,MXUA,MXUB)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      CHARACTER*3 REP
      PARAMETER (MXAO=8192)
      COMMON /EOMSYM/ IG,NRE(4),MC(8,8,4),ISORB(MXAO),REP(8)
      COMMON /EOMPAR/ CVGCI,CVGEOM,GRPEOM,NSTEOM(8),NOACT,NUACT,
     *                MOACTCC(MXAO),MTHTRIP,MTHCI,MTHEOM,MTHINIT,
     *                MAXCI,MAXEOM,MICCI,MICEOM,IROOTCC(2),
     *                IPROPCC,IPROPCCE
      DIMENSION INDEX1(NUA),INDEXA(NUA,NUA,NOA),INDEXB(NUA,NUB,NOB)
C
      IPOS=0
      ILC1=0
      ILC2=0
      DO 41,I=1,NUA
       INDEX1(I)=0
 41   CONTINUE
      DO 1,I=1,NUA
       DO K=1,NRE(IG)
        IPROD=MC(K,ISORB(NOA+I),IG)*MC(K,IGRSYM,IG)
        ISFIX=MC(K,ISKK,IG)
        IDIFF=ABS(IPROD-ISFIX)
        IF(IDIFF.GT.0) GO TO 1
       ENDDO
        IPOS=IPOS+1
        INDEX1(I)=IPOS
        ILC1=ILC1+1
 1    CONTINUE
C
      IF(MTHINIT.EQ.1) THEN
      DO 10,I=1,NOA
      DO 11,IA=1,NUA
      DO 12,IB=1,NUA
       INDEXA(IA,IB,I)=0
 12   CONTINUE
 11   CONTINUE
 10   CONTINUE
C
      DO 14,I=1,NOB
      DO 15,IA=1,NUA
      DO 16,IB=1,NUB
       INDEXB(IA,IB,I)=0
 16   CONTINUE
 15   CONTINUE
 14   CONTINUE
C
      MXUA=0
      DO 20,I=1,NOA
      DO 21,IA=1,NUA
      DO 22,IB=IA+1,NUA
       IAX=MOACTCC(I)+MOACTCC(IA+NOA)+MOACTCC(IB+NOA)
       DO 111,K=1,NRE(IG)
        IPROD=MC(K,ISORB(I),IG)*MC(K,ISORB(IA+NOA),IG)*
     &        MC(K,ISORB(IB+NOA),IG)*MC(K,IGRSYM,IG)
        ISFIX=MC(K,ISKK,IG)
        IDIFF=ABS(IPROD-ISFIX)
        IF(IDIFF.GT.0) GO TO 22
 111   CONTINUE
       IF(IAX.EQ.3) THEN
        IPOS=IPOS+1
        INDEXA(IA,IB,I)=IPOS
        INDEXA(IB,IA,I)=IPOS
        ILC2=ILC2+1
        IF(IB.GT.MXUA) MXUA=IB
       END IF
 22    CONTINUE
 21    CONTINUE
 20    CONTINUE
C
      MXUB=0
      DO 30,I=1,NOB
      DO 31,IA=1,NUA
      DO 32,IB=1,NUB
       IAX=MOACTCC(I)+MOACTCC(IA+NOA)+MOACTCC(IB+NOB)
       DO 112,K=1,NRE(IG)
        IPROD=MC(K,ISORB(I),IG)*MC(K,ISORB(IA+NOA),IG)*
     &        MC(K,ISORB(IB+NOB),IG)*MC(K,IGRSYM,IG)
        ISFIX=MC(K,ISKK,IG)
        IDIFF=ABS(IPROD-ISFIX)
        IF(IDIFF.GT.0) GO TO 32
 112   CONTINUE
       IF(IAX.EQ.3) THEN
        IPOS=IPOS+1
        INDEXB(IA,IB,I)=IPOS
        ILC2=ILC2+1
        IF(IB.GT.MXUB) MXUB=IB
       END IF
 32   CONTINUE
 31   CONTINUE
 30   CONTINUE
      END IF
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK EAORDER
      SUBROUTINE EAORDER(NOA,NOB,NORDER,IROOT,WR,WI,ISPIN,INDEXX,
     *INFO1,IREAL)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      PARAMETER (MXAO=8192)
      COMMON /EOMPAR/ CVGCI,CVGEOM,GRPEOM,NSTEOM(8),NOACT,NUACT,
     *                MOACTCC(MXAO),MTHTRIP,MTHCI,MTHEOM,MTHINIT,
     *                MAXCI,MAXEOM,MICCI,MICEOM,IROOTCC(2),
     *                IPROPCC,IPROPCCE
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      DIMENSION WR(NORDER),WI(NORDER),ISPIN(NORDER),INDEXX(100)
C
      INFO1=0
      TOL=1.0D-10
      DO I=1,100
       INDEXX(I)=0
      ENDDO
      IMAG=0
      IF(IROOT.GT.NORDER) THEN
       WRITE(6,9010)
       INFO1=1
       RETURN
      END IF
      DO 2,I=1,NORDER
       YYY=ABS(WI(I))
       IF(YYY.GT.TOL) THEN
        WR(I)=0.00D+00
        IMAG=IMAG+1
       END IF
 2    CONTINUE
C CHECK SPIN MULTIPLICITY
      IF(NOA.NE.NOB.OR.MTHINIT.EQ.2) GO TO 100
      IF(MULEAIP.EQ.1) THEN
      DO 20,I=1,NORDER
       IF(ISPIN(I).EQ.0) THEN
        WR(I)=0.00D+00
        IMAG=IMAG+1
       END IF
 20   CONTINUE
      ELSE
      DO 21,I=1,NORDER
       IF(ISPIN(I).NE.MULEAIP) THEN
        WR(I)=0.00D+00
        IMAG=IMAG+1
       END IF
 21   CONTINUE
      END IF
 100  CONTINUE
C WR->WI
      DO 10,I=1,NORDER
       WI(I)=WR(I)
 10   CONTINUE
      IREAL=NORDER-IMAG
      IF(IROOT.GT.IREAL) THEN
       WRITE(6,9010)
       INFO1=1
       RETURN
      END IF
      DO 3,I=1,IROOT
       XMIN=1.0D+10
       IMIN=0
       DO 4,J=1,NORDER
        IF(WI(J).EQ.0.0D+00) GO TO 4
        IF(WI(J).LT.XMIN) THEN
         XMIN=WI(J)
         IMIN=J
        END IF
 4     CONTINUE
       INDEXX(I)=IMIN
       WI(IMIN)=0.00D+00
 3     CONTINUE
       RETURN
 9010 FORMAT(1X,'TOO MANY INITIAL VECTORS REQUESTED.')
       END
C
C*MODULE EAIPCC  *DECK EASPNINT
      SUBROUTINE EASPNINT(NOA,NUA,NOB,NUB,IDIM,NORDER,INDEX1,
     *                    INDEXA,INDEXB,WR,VR,ISPIN)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION WR(NORDER),VR(IDIM,IDIM),ISPIN(NORDER)
      DIMENSION INDEXA(NUA,NUA,NOA),INDEXB(NUA,NUB,NOB)
      DIMENSION INDEX1(NUA)
      DATA BIGN/10000.0D+00/
C
      TOL=1.0D-10
C
      DO 1,I=1,NORDER
       ISPIN(I)=0
 1    CONTINUE
C
      DO 2,ICOL=1,NORDER
      IF(WR(ICOL).EQ.0.00D+00) GO TO 2
C
      R1MAX=0.00D+00
      DO 10,IA=1,NUA
       IROW=INDEX1(IA)
       IF(IROW.EQ.0) GO TO 10
       YYY=DABS(VR(IROW,ICOL))
       IF(YYY.GT.R1MAX) THEN
        R1MAX=YYY
       END IF
 10   CONTINUE
      IF(R1MAX.GT.TOL) THEN
       ISPIN(ICOL)=2
       GO TO 2000
      END IF
C
      RAPRV=BIGN
      RBPRV=BIGN
 1000 CONTINUE
C
      R2MAX=0.00D+00
      JMAX=0
      IAMAX=0
      IBMAX=0
      DO 30,J=1,NOA
      DO 40,IA=1,NUA
      DO 50,IB=IA+1,NUA
       IROW=INDEXA(IA,IB,J)
       IF(IROW.EQ.0) GO TO 50
       YYY=DABS(VR(IROW,ICOL))
       IF(YYY.GT.R2MAX.AND.YYY.LT.RAPRV) THEN
        R2MAX=YYY
        JMAX=J
        IAMAX=IA
        IBMAX=IB
       END IF
 50   CONTINUE
 40   CONTINUE
 30   CONTINUE
C
      IROW=INDEXB(IAMAX,IBMAX,JMAX)
      IF(IROW.EQ.0) GO TO 1100
      R2B1=DABS(VR(IROW,ICOL))
      IROW=INDEXB(IBMAX,IAMAX,JMAX)
      IF(IROW.EQ.0) GO TO 1100
      R2B2=DABS(VR(IROW,ICOL))
      DIFF1=DABS((2.00D+00*R2B1)-R2MAX)
      DIFF2=DABS((2.00D+00*R2B2)-R2MAX)
      IF(DIFF1.LT.TOL.AND.DIFF2.LT.TOL) THEN
       ISPIN(ICOL)=2
       GO TO 2000
      END IF
      DIFF1=DABS(R2B1-R2MAX)
      DIFF2=DABS(R2B2-R2MAX)
      IF(DIFF1.LT.TOL.AND.DIFF2.LT.TOL) THEN
       ISPIN(ICOL)=4
       GO TO 2000
      END IF
C
 1100 CONTINUE
      RAPRV=R2MAX
C
      R2MAX=0.00D+00
      IAMAX=0
      IBMAX=0
      JMAX=0
      DO 60,J=1,NOB
      DO 70,IA=1,NUA
      DO 80,IB=1,NUB
       IROW=INDEXB(IA,IB,J)
       IF(IROW.EQ.0) GO TO 80
       YYY=DABS(VR(IROW,ICOL))
       IF(YYY.GT.R2MAX.AND.YYY.LT.RBPRV) THEN
        R2MAX=YYY
        JMAX=J
        IAMAX=IA
        IBMAX=IB
       END IF
 80   CONTINUE
 70   CONTINUE
 60   CONTINUE
C
      IF(IAMAX.EQ.IBMAX) THEN
       ISPIN(ICOL)=2
       GO TO 2000
      END IF
C
      IROW=INDEXB(IBMAX,IAMAX,JMAX)
      IF(IROW.EQ.0) GO TO 1200
      R2B2=DABS(VR(IROW,ICOL))
      DIFF=DABS(R2B2-R2MAX)
      IF(DIFF.LT.TOL) THEN
       ISPIN(ICOL)=2
       GO TO 2000
      END IF
C
 1200 CONTINUE
      RBPRV=R2MAX
      IF(RAPRV.GT.1.0D-4.AND.RBPRV.GT.1.0D-4) GO TO 1000
C
 2000 CONTINUE
C
 2    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK EASTRINT
      SUBROUTINE EASTRINT(NOA,NUA,NOB,NUB,IDIM,INDEX1,INDEXA,
     *                    INDEXB,VR,TRANS,IROOT,JROOT,INDEXX,
     *                    IPREV,IPREVB,R3) !JRG 12 APR 2010
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      PARAMETER (MXAO=8192)
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /EOMPAR/ CVGCI,CVGEOM,GRPEOM,NSTEOM(8),NOACT,NUACT,
     *                MOACTCC(MXAO),MTHTRIP,MTHCI,MTHEOM,MTHINIT,
     *                MAXCI,MAXEOM,MICCI,MICEOM,IROOTCC(2),
     *                IPROPCC,IPROPCCE
      COMMON /WFNOPT/ SCFTYP,VBTYP,DFTYPE,TDDFTYP,CITYP,CCTYP,
     *                MPLEVL,MPCTYP
      COMMON /EAREST/ MREST(500)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
CCC      DATA EAEOM2/8HEA-EOM2 /
      DATA EAEOM2,EAEOM3A       /8HEA-EOM2 ,8HEA-EOM3A/ !JRG 12 APR 2010
      DIMENSION INDEX1(NUA),VR(IDIM,IDIM)
      DIMENSION TRANS(NUA+NOAUA2+NOBUAB)
      DIMENSION INDEXX(*)
C
      DO 1,IR=1,IROOT
      IF(IR.GT.JROOT) THEN
       ICOL=INDEXX(IR)
       CALL ZEROMA(TRANS,1,NUA+NOAUA2+NOBUAB)
C
       IF(MTHINIT.EQ.2) THEN
        CALL EAWRTINTS(NUA,IDIM,INDEX1,VR,TRANS(1),ICOL)
       ELSE
        CALL EAWRTINT1(NUA,IDIM,INDEX1,VR,TRANS(1),ICOL)
        CALL EAWRTINTA(NOA,NUA,IDIM,INDEXA,VR,TRANS(1+NUA),ICOL)
        CALL EAWRTINTB(NUA,NOB,NUB,IDIM,INDEXB,VR,
     *                TRANS(1+NUA+NOAUA2),ICOL)
       END IF
       IRES=0
C
      ELSE
       IF(CCTYP.EQ.EAEOM2) THEN
        JREC=3*(IPREVB+IR-1)
       ELSE
        JREC=((6*NACTA)+(4*NACTB)+3)*(IPREVB+IR-1)
       END IF
       JREC=JREC+6
       CALL RDTAB1(NUA,TRANS(1),(JREC+1),NFT825)
       CALL RDTAB3(NUA,NUA,NOA,TRANS(1+NUA),(JREC+2),NFT825)
       CALL RDTAB3(NUA,NUB,NOB,TRANS(1+NUA+NOAUA2),(JREC+3),NFT825)
       IRES=1
C
C*************** JRG 12 APR 2010 *******************************
       IF(CCTYP.EQ.EAEOM3A) THEN
        LREC1=NACTA
        LREC2=LREC1+NACTA
        LREC3=LREC2+NACTB
        LREC4=LREC3+NACTA
        JREC3=JREC+3
        J2REC=((6*NACTA)+(4*NACTB)+3)*(IPREV+IR-1)
        J2REC=J2REC+6
        J2REC3=J2REC+3
        DO 10,IA=1,NACTB
         IF(IA.LE.NACTA) THEN
         CALL RDTAB(NOA,NUA,NUA,NOA,R3,(JREC3+IA),NFT825)
         CALL WRTAB(NOA,NUA,NUA,NOA,R3,(J2REC3+IA),99)
         CALL RDTAB(NOA,NUA,NUB,NOB,R3,(JREC3+LREC1+IA),NFT825)
         CALL WRTAB(NOA,NUA,NUB,NOB,R3,(J2REC3+LREC1+IA),99)
         CALL RDTAB(NOB,NUB,NUB,NOB,R3,(JREC3+LREC3+IA),NFT825)
         CALL WRTAB(NOB,NUB,NUB,NOB,R3,(J2REC3+LREC3+IA),99)
         END IF
         CALL RDTAB(NOA,NUA,NUA,NOB,R3,(JREC3+LREC2+IA),NFT825)
         CALL WRTAB(NOA,NUA,NUA,NOB,R3,(J2REC3+LREC2+IA),99)
         CALL RDTAB(NOB,NOB,NUB,NUA,R3,(JREC3+LREC4+IA),NFT825)
         CALL WRTAB(NOB,NOB,NUB,NUA,R3,(J2REC3+LREC4+IA),99)
 10    CONTINUE
      END IF
C***************************************************************
C
      END IF
C
      IRECX=IR+IPREV
      CALL WEAINIT(IRECX,NUA+NOAUA2+NOBUAB,TRANS)
      MREST(IRECX)=IRES
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK EAWRTINTS
      SUBROUTINE EAWRTINTS(NU,IDIM,INDEX1,VR,R1,ICOL)
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      DIMENSION VR(IDIM,IDIM),INDEX1(NU),R1(NU)
C
      DO 1,IA=1,NU
       IPOS=INDEX1(IA)
       IF(IPOS.EQ.0) GO TO 1
       IF(DABS(1.0D+00-VR(IPOS,ICOL)).LT.0.1D-10) THEN
       R1(IA)=0.95D+00
       ELSE IF(DABS(-1.00D+00-VR(IPOS,ICOL)).LT.0.1D-10) THEN
       R1(IA)=-0.95D+00
       ELSE
       R1(IA)=VR(IPOS,ICOL)
       END IF
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK EAWRTINT1
      SUBROUTINE EAWRTINT1(NU,IDIM,INDEX1,VR,R1,ICOL)
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      DIMENSION VR(IDIM,IDIM),INDEX1(NU),R1(NU)
C
      DO 1,IA=1,NU
       IPOS=INDEX1(IA)
       IF(IPOS.EQ.0) GO TO 1
       R1(IA)=VR(IPOS,ICOL)
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK EAWRTINTA
      SUBROUTINE EAWRTINTA(NO,NU,IDIM,INDEXA,VR,R2,ICOL)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION VR(IDIM,IDIM),INDEXA(NU,NU,NO)
      DIMENSION R2(NU,NU,NO)
C
      DO 1,J=1,NO
      DO 2,IA=1,NU
      DO 3,IB=1,NU
       IPOS=INDEXA(IA,IB,J)
       IF(IPOS.EQ.0) GO TO 3
       R2(IA,IB,J)=VR(IPOS,ICOL)*ISGN(IB,IA)
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK EAWRTINTB
      SUBROUTINE EAWRTINTB(NUA,NOB,NUB,IDIM,INDEXB,VR,
     *                     R2,ICOL)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION VR(IDIM,IDIM),INDEXB(NUA,NUB,NOB)
      DIMENSION R2(NUA,NUB,NOB)
C
      DO 1,J=1,NOB
      DO 2,IA=1,NUA
      DO 3,IB=1,NUB
       IPOS=INDEXB(IA,IB,J)
       IF(IPOS.EQ.0) GO TO 3
       R2(IA,IB,J)=VR(IPOS,ICOL)
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK FIXGRSYM
      SUBROUTINE FIXGRSYM(NOA,NOB,IGRSYM)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      CHARACTER*3 REP
      PARAMETER (MXAO=8192)
      COMMON /EOMSYM/ IG,NRE(4),MC(8,8,4),ISORB(MXAO),REP(8)
      DIMENSION ISTRING(8)
C
      DO I=1,8
       ISTRING(I)=1
      ENDDO
      DO 1,I=1,NOA
      DO 2,J=1,NRE(IG)
       ISTRING(J)=ISTRING(J)*MC(J,ISORB(I),IG)
 2    CONTINUE
 1    CONTINUE
      DO 11,I=1,NOB
      DO 12,J=1,NRE(IG)
       ISTRING(J)=ISTRING(J)*MC(J,ISORB(I),IG)
 12   CONTINUE
 11   CONTINUE
      DO 3,ISKK=1,NRE(IG)
       DO 4,K=1,NRE(IG)
        IPROD=ISTRING(K)
        ISFIX=MC(K,ISKK,IG)
        IDIFF=ABS(IPROD-ISFIX)
        IF(IDIFF.GT.0) GO TO 3
 4     CONTINUE
       IGRSYM=ISKK
       GO TO 10
 3    CONTINUE
 10   CONTINUE
      RETURN
      END
C*MODULE EAIPCC  *DECK PRNTR1
      SUBROUTINE PRNTR1(NO,NU,R1)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /IOFILE/ IR,IW,IP,IJK,IJKT,IDAF,NAV,IODA(950)
      COMMON /CCOPIN/ IOPCCREF,IOPCCMET,NOPCCFC,MULOPCC,
     *                KMICRO,KREST,LMICRO,LREST
      DIMENSION R1(NU)
C
      TOL=0.05D+00
C      TOL=0.0D+00
      DO 2,IA=1,NU
       XXX=R1(IA)
       IF(DABS(XXX).GT.TOL) THEN
        WRITE(IW,101)XXX,IA+NOPCCFC+NO
        CALL FLSHBF(IW)
       END IF
 2    CONTINUE
      RETURN
 101  FORMAT(4X,'R(1P)=',1X,F14.10,1X,'FOR AA=',I4)
      END
C
C*MODULE EAIPCC  *DECK PRNTR2A
      SUBROUTINE PRNTR2A(NO,NU,R2)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /IOFILE/ IR,IW,IP,IJK,IJKT,IDAF,NAV,IODA(950)
      COMMON /CCOPIN/ IOPCCREF,IOPCCMET,NOPCCFC,MULOPCC,
     *                KMICRO,KREST,LMICRO,LREST
      DIMENSION R2(NU,NU,NO)
C
      TOL=0.05D+00
C      TOL=0.0D+00
      DO 1,J=1,NO
      DO 2,IA=1,NU
      DO 3,IB=IA+1,NU
       XXX=R2(IA,IB,J)
       IF(DABS(XXX).GT.TOL) THEN
        WRITE(IW,101)XXX,J+NOPCCFC,
     *                IA+NOPCCFC+NO,IB+NOPCCFC+NO
        CALL FLSHBF(IW)
       END IF
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
      RETURN
 101  FORMAT(1X,'R(2P-1H)=',1X,F14.10,1X,'FOR JA -> AA, BA =',3I4)
      END
C
C
C*MODULE EAIPCC  *DECK PRNTR2B
      SUBROUTINE PRNTR2B(NOA,NUA,NOB,NUB,R2)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /IOFILE/ IR,IW,IP,IJK,IJKT,IDAF,NAV,IODA(950)
      COMMON /CCOPIN/ IOPCCREF,IOPCCMET,NOPCCFC,MULOPCC,
     *                KMICRO,KREST,LMICRO,LREST
      DIMENSION R2(NUA,NUB,NOB)
C
      TOL=0.05D+00
C      TOL=0.0D+00
      DO 1,J=1,NOB
      DO 2,IA=1,NUA
      DO 3,IB=1,NUB
       XXX=R2(IA,IB,J)
       IF(DABS(XXX).GT.TOL) THEN
        WRITE(IW,101)XXX,J+NOPCCFC,
     *               IA+NOPCCFC+NOA,IB+NOPCCFC+NOB
        CALL FLSHBF(IW)
       END IF
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
      RETURN
 101  FORMAT(1X,'R(2P-1H)=',1X,F14.10,1X,'FOR JB -> AA, BB =',3I4)
      END
C
C*MODULE EAIPCC  *DECK PRNTR3AA
      SUBROUTINE PRNTR3AA(NO,NU,JROOT3,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /IOFILE/ IR,IW,IP,IJK,IJKT,IDAF,NAV,IODA(950)
      COMMON /CCOPIN/ IOPCCREF,IOPCCMET,NOPCCFC,MULOPCC,
     *                KMICRO,KREST,LMICRO,LREST
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      DIMENSION R3(NO,NU,NU,NO)
C
      TOL=0.05D+00
C      TOL=0.0D+00
      DO 10,IA=1,NACTA
      CALL RDTAB(NO,NU,NU,NO,R3,(JROOT3+IA),NFT825)
      DO 1,J=1,NO
      DO 2,K=J+1,NO
      DO 3,IB=IA+1,NU
      DO 4,IC=IB+1,NU
       XXX=R3(J,IB,IC,K)
       IF(DABS(XXX).GT.TOL) THEN
        WRITE(IW,101)XXX,J+NOPCCFC,K+NOPCCFC,
     *                IA+NOPCCFC+NO,IB+NOPCCFC+NO,
     *                IC+NOPCCFC+NO
        CALL FLSHBF(IW)
       END IF
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
 10   CONTINUE
      RETURN
C 101  FORMAT(1X,'R(3P-2H)=',1X,D17.10,1X,'FOR JA, KA -> AA, BA, CA =',5I
C     *4)
 101  FORMAT(1X,'R(3P-2H)=',1X,F14.10,1X,'FOR JA, KA -> AA, BA, CA =',
     *5I4)
      END
C
C*MODULE EAIPCC  *DECK PRNTR3BB
      SUBROUTINE PRNTR3BB(NOA,NOB,NUA,NUB,JROOT3,R3,R3B)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /IOFILE/ IR,IW,IP,IJK,IJKT,IDAF,NAV,IODA(950)
      COMMON /CCOPIN/ IOPCCREF,IOPCCMET,NOPCCFC,MULOPCC,
     *                KMICRO,KREST,LMICRO,LREST
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION R3(NOB,NUB,NUB,NOB),R3B(NOB,NOB,NUB,NUA)
C
      TOL=0.05D+00
C      TOL=0.0D+00
      DO 10,IA=1,NACTA
      CALL RDTAB(NOB,NUB,NUB,NOB,R3,(JROOT3+LREC3+IA),NFT825)
      DO 1,J=1,NOB
      DO 2,K=J+1,NOB
      DO 3,IB=1,NUB
      DO 4,IC=IB+1,NUB
       XXX=R3(J,IB,IC,K)
       IF(DABS(XXX).GT.TOL) THEN
        WRITE(IW,101)XXX,J+NOPCCFC,K+NOPCCFC,
     *                IA+NOPCCFC+NOA,IB+NOPCCFC+NOB,
     *                IC+NOPCCFC+NOB
        CALL FLSHBF(IW)
       END IF
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
 10   CONTINUE
C
      DO 20,IB=1,NACTB
      CALL RDTAB(NOB,NOB,NUB,NUA,R3B,(JROOT3+LREC4+IB),NFT825)
      DO 21,J=1,NOB
      DO 22,K=J+1,NOB
      DO 23,IC=1,NUB
      DO 24,IA=1,NUA
       XXX=R3B(J,K,IC,IA)
       IF(DABS(XXX).GT.TOL) THEN
        WRITE(IW,101)XXX,J+NOPCCFC,K+NOPCCFC,
     *                IA+NOPCCFC+NOA,IB+NOPCCFC+NOB,
     *                IC+NOPCCFC+NOB
        CALL FLSHBF(IW)
       END IF
 24   CONTINUE
 23   CONTINUE
 22   CONTINUE
 21   CONTINUE
 20   CONTINUE
      RETURN
C 101  FORMAT(1X,'R(3P-2H)=',1X,D17.10,1X,'FOR JB, KB -> AA, BB, CB =',5I
C     *4)
 101  FORMAT(1X,'R(3P-2H)=',1X,F14.10,1X,'FOR JB, KB -> AA, BB, CB =',
     *5I4)
      END
C
C*MODULE EAIPCC  *DECK PRNTR3AB
      SUBROUTINE PRNTR3AB(NOA,NOB,NUA,NUB,JROOT3,R3,R3B)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /IOFILE/ IR,IW,IP,IJK,IJKT,IDAF,NAV,IODA(950)
      COMMON /CCOPIN/ IOPCCREF,IOPCCMET,NOPCCFC,MULOPCC,
     *                KMICRO,KREST,LMICRO,LREST
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION R3(NOA,NUA,NUB,NOB),R3B(NOA,NUA,NUA,NOB)
C
      TOL=0.05D+00
C      TOL=0.0D+00
      DO 10,IA=1,NACTA
      CALL RDTAB(NOA,NUA,NUB,NOB,R3,(JROOT3+LREC1+IA),NFT825)
      DO 1,J=1,NOA
      DO 2,K=1,NOB
      DO 3,IB=1,NUA
      DO 4,IC=1,NUB
       XXX=R3(J,IB,IC,K)
       IF(DABS(XXX).GT.TOL) THEN
        WRITE(IW,101)XXX,J+NOPCCFC,K+NOPCCFC,
     *                IA+NOPCCFC+NOA,IB+NOPCCFC+NOA,
     *                IC+NOPCCFC+NOB
        CALL FLSHBF(IW)
       END IF
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
 10   CONTINUE
C
      DO 20,IC=1,NACTB
      CALL RDTAB(NOA,NUA,NUA,NOB,R3B,(JROOT3+LREC2+IC),NFT825)
      DO 21,J=1,NOA
      DO 22,K=1,NOB
      DO 23,IA=1,NUA
      DO 24,IB=IA+1,NUA
       XXX=R3B(J,IA,IB,K)
       IF(DABS(XXX).GT.TOL) THEN
        WRITE(IW,101)XXX,J+NOPCCFC,K+NOPCCFC,
     *                IA+NOPCCFC+NOA,IB+NOPCCFC+NOA,
     *                IC+NOPCCFC+NOB
        CALL FLSHBF(IW)
       END IF
 24   CONTINUE
 23   CONTINUE
 22   CONTINUE
 21   CONTINUE
 20   CONTINUE
      RETURN
C 101  FORMAT(1X,'R(3P-2H)=',1X,D17.10,1X,'FOR JA, KB -> AA, BA, CB =',5I
C     *4)
 101  FORMAT(1X,'R(3P-2H)=',1X,F14.10,1X,'FOR JA, KB -> AA, BA, CB =',
     *5I4)
      END
C
C*MODULE EAIPCC  *DECK DRIPEOM
      SUBROUTINE DRIPEOM(BESTEOM,NOA,NUA,NOB,NUB)
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
C
      PARAMETER (MXATM=2000, MXAO=8192)
C
      CHARACTER*1 SMALLD,SMALLT
C
      COMMON /FMCOM / X(1)
      COMMON /IOFILE/ IR,IW,IP,IJK,IJKT,IDAF,NAV,IODA(950)
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /RUNOPT/ RUNTYP,EXETYP,NEVALS,NGLEVL,NHLEVL
      COMMON /WFNOPT/ SCFTYP,VBTYP,DFTYPE,TDDFTYP,CITYP,CCTYP,
     *                MPLEVL,MPCTYP
      COMMON /EOMPAR/ CVGCI,CVGEOM,GRPEOM,NSTEOM(8),NOACT,NUACT,
     *                MOACTCC(MXAO),MTHTRIP,MTHCI,MTHEOM,MTHINIT,
     *                MAXCI,MAXEOM,MICCI,MICEOM,IROOTCC(2),
     *                IPROPCC,IPROPCCE
      COMMON /INFOA / NAT,ICH,MUL,NUM,NQMT,NE,NA,NB,
     *                ZAN(MXATM),C(3,MXATM),IAN(MXATM)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
      DATA EOMIP2,EOMIP3A       /8HIP-EOM2 ,8HIP-EOM3A/
C---  data EOMIP2,EOMIP3,EOMIP3A/8HIP-EOM2 ,8HIP-EOM3 ,8HIP-EOM3A/
      DATA CHECK/8HCHECK   /
C
C     --- actual driver for IP-EOMCC methods ---
C     these are IP-EOMCCSD(2p-1h),
C               IP-EOMCCSD(3p-2h),
C               IP-EOMCCSDt
C         h=occupied, h means "holes" which are occupied
C                       states in the Fermi vacuum
C         p= virtual, p means "particles" which are unoccupied
C                       states in the Fermi vacuum
C
      WRITE(IW,9000)
      IF(CCTYP.EQ.EOMIP3A) THEN
      IF((NACTB.GT.NOB).OR.(NACTA.GT.NOA)) THEN
       WRITE(IW,9005)NOA
       CALL ABRT
       STOP
      END IF
      END IF
C
C         ---- Open Files Specific to IP-EOMCC Calculations ----
      CALL OPIPFILE(NOB)
C
C               ---- IP-EOMCC Initial Start ----
      IF(MTHINIT.EQ.2) THEN
       IDIM=NOB
       WRITE(IW,9100)
      ELSE
       IDIM=2*NOACT*NOACT*NUACT
       IDIM=IDIM+NOB
       SMALLD=CHAR(100)
       WRITE(IW,9105) SMALLD
      END IF
      CALL FLSHBF(IW)
      IDIM2=IDIM*IDIM
      L1=NUM
      CALL VALFM(LOADFM)
      I1   = LOADFM + 1
      I2   = I1     + NU2            !FPP
      I3   = I2     + NO2            !FHH
      I4   = I3     + NO2            !FHHB
      I5   = I4     + NOU            !FHP
      I6   = I5     + NO2U2          !VHPHP
      I7   = I6     + NO2U2          !VHPHPA
      I8   = I7     + NO3U           !VHHHP
      I9   = I8     + NO4            !VHHHH
      I10  = I9     + NOB            !INDEX1
      I11  = I10    + NO2U           !INDEXA
      I12  = I11    + NO2U           !INDEXB
      I13  = I12    + IDIM2          !HM
      I14  = I13    + IDIM           !WR
      I15  = I14    + IDIM           !WI
      I16  = I15    + 4*IDIM         !WORK
      I17  = I16    + IDIM2          !VR
      I18  = I17    + NOB+NO2U+NO2U  !TRANS
      I19  = I18    + L1             !LABMO
      LAST = I19    + IDIM           !ISPIN
      NEED=LAST-LOADFM-1
      WRITE(IW,9110) NEED
      CALL FLSHBF(IW)
C
      CALL GETFM(NEED)
C
      CALL IPINIT(NOA,NUA,NOB,NUB,X(I1),X(I2),X(I3),X(I4),
     *             X(I5),X(I6),X(I7),X(I8),X(I9),X(I10),
     *             X(I11),X(I12),X(I13),X(I14),X(I15),
     *             X(I16),X(I17),X(I18),X(I19),L1,IDIM,NROOT)
C
      CALL RETFM(NEED)
C
      WRITE(IW,9120)
      CALL TIMIT(1)
C                ---- IP-EOMCCSD(2h-1p) Solver ----
      IF(CCTYP.EQ.EOMIP2) THEN
      WRITE(IW,9200)
      CALL VALFM(LOADFM)
      NOUP=NOB+NO2U+NO2U
      ISPACE=MAXEOM
      ISPACE2=ISPACE*ISPACE
      I1      = LOADFM + 1
      I2      = I1     + NU2            !DPPA
      I3      = I2     + NU2            !DPPB
      I4      = I3     + NO2            !DHHA
      I5      = I4     + NO2            !DHHB
      I6      = I5     + NU2            !FPP
      I7      = I6     + NOU            !FHP
      I8      = I7     + NO2            !FHH
      I9      = I8     + NO3U           !VHHHP
      I10     = I9     + NO4            !VHHHH
      I11     = I10    + NO2U2          !VHPHP
      I12     = I11    + NO2U2          !T2
      I13     = I12    + NUB            !OPB
      I14     = I13    + NOU3           !TI
      I15     = I14    + NOUP           !VEC1
      I16     = I15    + NOUP           !VEC2
      I17     = I16    + ISPACE2        !HM
      I18     = I17    + ISPACE2        !HMAUX
      I19     = I18    + ISPACE         !WR
      I20     = I19    + ISPACE         !WI
      I21     = I20    + ISPACE2        !VR
      I22     = I21    + 4*ISPACE       !WORK
      LENGMAT = I22    + NOUP           !AUX
      LSYM    = LENGMAT+ NROOT
      LISPIN  = LSYM   + NROOT
      LICON   = LISPIN + NROOT
      LAST    = LICON  + NROOT
      NEED=LAST-LOADFM-1
      WRITE(IW,9210) NEED
      CALL FLSHBF(IW)
C
      CALL GETFM(NEED)
      IF(EXETYP.EQ.CHECK) GO TO 66
C
      CALL IP2SOLSR(BESTEOM,NOA,NUA,NOB,NUB,X(I1),X(I2),X(I3),X(I4),
     *              X(I5),X(I6),X(I7),X(I8),X(I9),X(I10),
     *              X(I11),X(I12),X(I13),X(I14),X(I15),
     *              X(I16),X(I17),X(I18),X(I19),X(I20),
     *              X(I21),X(I22),X(LENGMAT),X(LSYM),X(LISPIN),X(LICON),
     *              NROOT)
C
 66   CONTINUE
      CALL RETFM(NEED)
C
      WRITE(IW,9220)
      CALL TIMIT(1)
      END IF
C
C                ---- IP-EOMCCSDt Solver ----
C
      IF(CCTYP.EQ.EOMIP3A) THEN
      SMALLT=CHAR(116)
      WRITE(IW,9300) SMALLT
      CALL FLSHBF(IW)
      CALL VALFM(LOADFM)
      NOUP=NOB+NO2U+NO2U
      NO3=NO2*NOA
      ISPACE=MAXEOM
      ISPACE2=ISPACE*ISPACE
      I1   = LOADFM + 1
      I2   = I1     + NU2            !DPPA
      I3   = I2     + NU2            !DPPB
      I4   = I3     + NO2            !DHHA
      I5   = I4     + NO2            !DHHB
      I6   = I5     + NU2            !FPPA
      I7   = I6     + NU2            !FPPB
      I8   = I7     + NOU            !FHPA
      I9   = I8     + NOU            !FHPB
      I10  = I9     + NO2            !FHHA
      I11  = I10    + NO2            !FHHB
      I12  = I11    + NOU3           !VHPPP1
      I13  = I12    + NOU3           !VHPPP2
      I14  = I13    + NOU3           !TI
      I15  = I14    + NU3            !VPPP
      I16  = I15    + NO2U2          !VHPHP1
      I17  = I16    + NO2U2          !VHPHP2
      I18  = I17    + NO2U2          !VHPHP3
      I19  = I18    + NO2U2          !VHPHP4
      I20  = I19    + NO2U2          !VHPHP5
      I21  = I20    + NO2U2          !VHPHP6
      I22  = I21    + NO3U           !VHHHP1
      I23  = I22    + NO3U           !VHHHP2
      I24  = I23    + NO3U           !VHHHP3
      I25  = I24    + NO4            !VHHHH1
      I26  = I25    + NO4            !VHHHH2
      I27  = I26    + NO4            !VHHHH3
      I28  = I27    + NO2U2          !T2
      I29  = I28    + NO2U2          !T2B
      I30  = I29    + NOB            !OPB
      I31  = I30    + NO3            !OHHHB
      I32  = I31    + NO3            !OHHHA
      I33  = I32    + NOU2           !OHPPB
      I34  = I33    + NOU2           !OHPPA
      I35  = I34    + NOU2           !OHPA2
      I36  = I35    + NO3            !OHHA2
      I37  = I36    + NO2U           !OPHH
      I38  = I37    + NO2U           !OPHH2
      I39  = I38    + NOUP           !VEC1
      I40  = I39    + NOUP           !VEC2
      I41  = I40    + NO2U2          !R3
      I42  = I41    + NOU3           !R3B
      I43  = I42    + NO2U2          !HR3
      I44  = I43    + ISPACE2        !HM
      I45  = I44    + ISPACE2        !HMAUX
      I46  = I45    + ISPACE         !WR
      I47  = I46    + ISPACE         !WI
      I48  = I47    + ISPACE2        !VR
      I49  = I48    + 4*ISPACE       !WORK
      I50  = I49    + NOUP           !AUX
      I51  = I50    + NROOT          !ENGMAT
      I52  = I51    + NROOT          !SYM
      I53  = I52    + NROOT          !ISPIN
      I54  = I53    + NROOT          !ICON
      I55  = I54    + NACTB          !IRB
      LAST = I55    + NACTA          !IRA
      NEED=LAST-LOADFM-1
      WRITE(IW,9310) NEED
      CALL FLSHBF(IW)
C
      CALL GETFM(NEED)
      IF(EXETYP.EQ.CHECK) GO TO 67
C
      CALL IP3ASOLSR(BESTEOM,NOA,NUA,NOB,NUB,X(I1),X(I2),X(I3),X(I4),
     *               X(I5),X(I6),X(I7),X(I8),X(I9),X(I10),
     *               X(I11),X(I12),X(I13),X(I14),X(I15),
     *               X(I16),X(I17),X(I18),X(I19),X(I20),
     *               X(I21),X(I22),X(I23),X(I24),X(I25),
     *               X(I26),X(I27),X(I28),X(I29),X(I30),
     *               X(I31),X(I32),X(I33),X(I34),X(I35),
     *               X(I36),X(I37),X(I38),X(I39),X(I40),
     *               X(I41),X(I42),X(I43),X(I44),X(I45),
     *               X(I46),X(I47),X(I48),X(I49),X(I50),
     *               X(I51),X(I52),X(I53),X(I54),X(I55),NROOT)
C
 67   CONTINUE
      CALL RETFM(NEED)
C
      WRITE(IW,9320) SMALLT
      CALL TIMIT(1)
      END IF
      RETURN
C
 9000 FORMAT(/3X,'--------------------------------------------------'/
     *        3X,'IONIZED EQUATION-OF-MOTION COUPLED-CLUSTER PROGRAM'/
     *        7X,'PROGRAM BY J.R.GOUR, J.J.LUTZ, P.PIECUCH'/
     *        3X,'--------------------------------------------------')
 9005 FORMAT(1X,'NACT CANNOT EXCEED THE TOTAL NUMBER OF OCCUPIED',
     *       1X,'ORBITALS.'/
     *       1X,'PLEASE SET NACT LESS THAN OR EQUAL TO',1X,I3,
     *       1X,'AND RESUBMIT')
 9100 FORMAT(/8X,'------------------------------------'/
     *        8X,'IP-EOMCC ''CIS'' INITIAL START PROGRAM'/
     *        8X,'------------------------------------')
 9105 FORMAT(/8X,'----------------------------------------'/
     *        8X,'IP-EOMCC ''EOMCCS',A,''' INITIAL START PROGRAM'/
     *        8X,'----------------------------------------')
 9110 FORMAT(1X,'MEMORY NEEDED BY IPINIT: ',I12,' WORDS')
 9120 FORMAT(1X,'..... DONE WITH IP-EOMCC INITIAL START CALCULATION
     *.....')
 9200 FORMAT(/18X,'-------------------------'/
     *        18X,'IP-EOMCCSD(2H-1P) PROGRAM'/
     *        18X,'-------------------------')
 9210 FORMAT(1X,'MEMORY NEEDED BY IP2SOLSR: ',I12,' WORDS')
 9220 FORMAT(1X,'..... DONE WITH IP-EOMCCSD(2H-1P) AMPLITUDE ITERATIONS
     *.....')
 9300 FORMAT(/24X,'-------------------'/
     *        24X,'IP-EOMCCSD',A,' PROGRAM'/
     *        24X,'-------------------')
 9310 FORMAT(1X,'MEMORY NEEDED BY IP3ASOLSR: ',I12,' WORDS')
 9320 FORMAT(1X,'..... DONE WITH IP-EOMCCSD',A,' AMPLITUDE ITERATIONS
     *.....')
      END
C
C*MODULE EAIPCC  *DECK OPIPFILE
      SUBROUTINE OPIPFILE(NOB)
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
C
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
C       This file stores the results of each iteration of the solver, and
C       is used to construct the iterative space used in each iteration
      CALL CCOPEN(96,NO2U,'ITSPACE')
C
C       This file stores the initial start vectors
      LEN97=NOB+NO2U+NO2U
      CALL CCOPEN(97,LEN97,'INSTART')
C
C
C       This file contains iterative subspace data for the 3H-2P vectors
C       in IP-EOM3A (and eventually IP-EOM3 when it is finished) runs.
C
      CALL CCOPEN(98,NO2U2,'ITSPC3')
C
C       This file stores the 3H-2P initial start vectors. Is only
C       necessary when JREST=1
C
      IF(JREST.EQ.1) THEN
       CALL CCOPEN(99,NO2U2,'INSTRT3')
      END IF
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IP2SOLSR
      SUBROUTINE IP2SOLSR(BESTEOM,NOA,NUA,NOB,NUB,DPPA,DPPB,DHHA,DHHB,
     *                    FPP,FHP,FHH,VHHHP,VHHHH,VHPHP,
     *                    T2,OPB,TI,VEC1,VEC2,HM,HMAUX,WR,WI,VR,
     *                    WORK,AUX,ENGMAT,SYM,ISPIN,ICON,NROOT)
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
C
      CHARACTER*3 SYM,REP
C
      LOGICAL CNVR
C
      PARAMETER (MXAO=8192)
C
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /CCENGY/ ENRG,EREF,EMP2,ECCN,ETOT(6),ECORR(6),
     *                DIAGS(3),AMPMX(5,2),IAMPMX(5,4,2),XO1,XO2,
     *                DIFMAX,DIFFENG,ITER,CNVR
      COMMON /IOFILE/ IR,IW,IP,IJK,IJKT,IDAF,NAV,IODA(950)
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EOMPAR/ CVGCI,CVGEOM,GRPEOM,NSTEOM(8),NOACT,NUACT,
     *                MOACTCC(MXAO),MTHTRIP,MTHCI,MTHEOM,MTHINIT,
     *                MAXCI,MAXEOM,MICCI,MICEOM,IROOTCC(2),
     *                IPROPCC,IPROPCCE
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /EOMSYM/ IG,NRE(4),MC(8,8,4),ISORB(MXAO),REP(8)
C
      DIMENSION FPP(1),FHP(1),FHH(1),VHHHP(1),VHHHH(1),VHPHP(1),T2(1)
      DIMENSION OPB(1),TI(1)
      DIMENSION VEC1(1),VEC2(1),HM(1),HMAUX(1),AUX(1)
      DIMENSION WR(1),WI(1),VR(1),WORK(1)
      DIMENSION DPPA(NUA,NUA),DPPB(NUB,NUB)
      DIMENSION DHHA(NOA,NOA),DHHB(NOB,NOB)
      DIMENSION ENGMAT(NROOT),SYM(NROOT),ISPIN(NROOT),ICON(NROOT)
      DIMENSION JSTATE(9)
C
      DATA ONE/1.00D+00/
      TOL=CVGEOM
C
      ISPACE=MAXEOM
      ISPACE2=ISPACE*ISPACE
      NOUP=NOB+NOB2UB+NOABUA
C
      CALL ZEROMA(ENGMAT,1,NROOT)
      CALL VICLR(ICON,1,NROOT)
C
      CALL RDTAB2(NUA,NUA,DPPA,1,NFT891)
      CALL RDTAB2(NUB,NUB,DPPB,2,NFT891)
      CALL RDTAB2(NOA,NOA,DHHA,3,NFT891)
      CALL RDTAB2(NOB,NOB,DHHB,4,NFT891)
C
      CALL VICLR(JSTATE,1,9)
      JSTATE(1)=MULEAIP
      WRITE(NFT825,REC=6)JSTATE
C
      DO 1,IROOT=1,NROOT
      WRITE(IW,301)IROOT
      CALL FLSHBF(IW)
      CALL ZEROMA(HM,1,ISPACE2)
      CALL ZEROMA(HMAUX,1,ISPACE2)
      CALL ZEROMA(VEC1,1,NOUP)
      CALL ZEROMA(VEC2,1,NOUP)
      CALL REAINIT(IROOT,NOUP,VEC1)
C
      CALL DCOPY(NOUP,VEC1,1,VEC2,1)
      XNORM=DDOT(NOUP,VEC1,1,VEC2,1)
      XNORM=ONE/DSQRT(XNORM)
      CALL DSCAL(NOUP,XNORM,VEC1(1),1)
      CALL WRTAB1(NOB,VEC1(1),1,96)
      CALL WRTAB3(NOB,NUB,NOB,VEC1(1+NOB),2,96)
      CALL WRTAB3(NOB,NUA,NOA,VEC1(1+NOB+NOB2UB),3,96)
C
      DO 2,ITER=1,MAXEOM
C
C     ---------- GENERATING HR (R TAKEN FROM ITSPACE) -------------
      IREC=6*(ITER-1)
      CALL RDTAB1(NOB,VEC1(1),(IREC+1),96)
      CALL RDTAB3(NOB,NUB,NOB,VEC1(1+NOB),(IREC+2),96)
      CALL RDTAB3(NOB,NUA,NOA,VEC1(1+NOB+NOB2UB),(IREC+3),96)
      CALL HR2H1P(NOA,NUA,NOB,NUB,VEC1(1),VEC2(1),VEC1(1+NOB),
     *            VEC1(1+NOB+NOB2UB),VEC2(1+NOB),VEC2(1+NOB+NOB2UB),
     *            FPP,FHP,FHH,VHHHP,VHHHH,VHPHP,T2,OPB,TI)
C
      CALL ZEROMA(VEC1(1+NOB),1,NO2U)
      CALL ASYMIP2(VEC2(1+NOB),NOB,NUB,VEC1(1+NOB))
      CALL WRTAB1(NOB,VEC2(1),(IREC+4),96)
      CALL WRTAB3(NOB,NUB,NOB,VEC2(1+NOB),(IREC+5),96)
      CALL WRTAB3(NOB,NUA,NOA,VEC2(1+NOB+NOB2UB),(IREC+6),96)
C     ------------------ FORMING SMALL MATRIX -------------------
      CALL IPSMLLMA(NOA,NUA,NOB,NUB,ISPACE,ITER,HM,HMAUX,
     *              VEC1,VEC2,NOUP,IREC)
C
C     ------------- PICKING UP THE BEST EIGENVECTOR ------------
      CALL IPSELVEC(ISPACE,ITER,HM,WR,WI,VR,WORK,XENE)
C
C     ---- FORMING OPTIMUM COMBINATION OF VECTORS FROM ITSPACE ON VEC1 ----
      ISN=1   !READING FROM ITSPACE
      CALL IPCOMB(NOA,NUA,NOB,NUB,ISPACE,ITER,WI,VEC1,VEC2,ISN,NOUP)
      JROOT=3*(IROOT-1)
      JROOT=JROOT+6
      CALL WRTAB1(NOB,VEC1(1),(JROOT+1),NFT825)
      CALL WRTAB3(NOB,NUB,NOB,VEC1(1+NOB),(JROOT+2),NFT825)
      CALL WRTAB3(NOB,NUA,NOA,VEC1(1+NOB+NOB2UB),(JROOT+3),NFT825)
      IF(ITER.EQ.1) THEN
       CALL FIXGRSYM(NOA,NOB,IGRSYM)
       CALL IPSYM(NOA,NUA,NOB,NUB,VEC1(1),VEC1(1+NOB),
     *            VEC1(1+NOB+NOB2UB),SYM(IROOT),NSYM,IGRSYM)
       JSTATE(NSYM+1)=JSTATE(NSYM+1)+1
       WRITE(NFT825,REC=6)JSTATE
      END IF
C
C     ---- FORMING OPTIMAL COMBINATION OF VECTORS FROM HR ON VEC2 ------
      ISN=2   !READING FROM HR
      CALL IPCOMB(NOA,NUA,NOB,NUB,ISPACE,ITER,WI,VEC2,AUX,ISN,NOUP)
C
C     ---------------- FORMING THE CORRECTION ON AUX ------------------
      CALL ZEROMA(AUX,1,NOUP)
      CALL DCOPY(NOUP,VEC2(1),1,AUX(1),1)
      CALL DAXPY(NOUP,-XENE,VEC1(1),1,AUX(1),1)
      CALL IPDEN(NOA,NUA,NOB,NUB,XENE,DHHA,DHHB,DPPA,DPPB,
     *           AUX(1),AUX(1+NOB),AUX(1+NOB+NOB2UB))
C
C     ------------------ CONVERGENCE TEST ---------------------
      CALL NORMV(NOUP,RES,AUX(1))
      WRITE(IW,300) ITER,XENE,RES
      CALL FLSHBF(IW)
      IF(RES.LT.TOL) GO TO 1000
C
C     ----------- ORTHONORMALIZATION OF THE CORRECTION ------------
      CALL IPORTH(NOA,NUA,NOB,NUB,NOUP,ITER,AUX,VEC1)
C
C     -------- WRITING THE CORRECTION TO RECORD NO. ITER+1 ---------
      JREC=6*ITER
      CALL WRTAB1(NOB,AUX(1),(JREC+1),96)
      CALL WRTAB3(NOB,NUB,NOB,AUX(1+NOB),(JREC+2),96)
      CALL WRTAB3(NOB,NUA,NOA,AUX(1+NOB+NOB2UB),(JREC+3),96)
C
 2    CONTINUE
C
C     --------------- LACK OF CONVERGENCE ---------------
      WRITE(IW,302) IROOT
      CALL RDTAB1(NOB,VEC1(1),(JROOT+1),NFT825)
      CALL RDTAB3(NOB,NUB,NOB,VEC1(1+NOB),(JROOT+2),NFT825)
      CALL RDTAB3(NOB,NUA,NOA,VEC1(1+NOB+NOB2UB),(JROOT+3),NFT825)
      CALL IP2NORM(NOA,NUA,NOB,NUB,VEC1(1),VEC1(1+NOB),
     *             VEC1(1+NOB+NOB2UB))
      CALL FIXGRSYM(NOA,NOB,IGRSYM)
      CALL IPSYM(NOA,NUA,NOB,NUB,VEC1(1),VEC1(1+NOB),
     *           VEC1(1+NOB+NOB2UB),SYM(IROOT),NSYM,IGRSYM)
      IF(NOA.EQ.NOB) THEN
       CALL IPSPIN(NOA,NUA,NOB,NUB,VEC1(1),VEC1(1+NOB),
     *             VEC1(1+NOB+NOB2UB),ISPIN(IROOT))
      END IF
      ENGMAT(IROOT)=XENE
      CALL WRTAB1(NOB,VEC1(1),(JROOT+1),NFT825)
      CALL WRTAB3(NOB,NUB,NOB,VEC1(1+NOB),(JROOT+2),NFT825)
      CALL WRTAB3(NOB,NUA,NOA,VEC1(1+NOB+NOB2UB),(JROOT+3),NFT825)
      GO TO 1
C
C     ----------------- CONVERGENCE ---------------------
 1000 CONTINUE
      WRITE(IW,303)IROOT
      WRITE(IW,304)XENE
      ICON(IROOT)=1
      CALL RDTAB1(NOB,VEC1(1),(JROOT+1),NFT825)
      CALL RDTAB3(NOB,NUB,NOB,VEC1(1+NOB),(JROOT+2),NFT825)
      CALL RDTAB3(NOB,NUA,NOA,VEC1(1+NOB+NOB2UB),(JROOT+3),NFT825)
      CALL IP2NORM(NOA,NUA,NOB,NUB,VEC1(1),VEC1(1+NOB),
     *             VEC1(1+NOB+NOB2UB))
      CALL FIXGRSYM(NOA,NOB,IGRSYM)
      CALL IPSYM(NOA,NUA,NOB,NUB,VEC1(1),VEC1(1+NOB),
     *           VEC1(1+NOB+NOB2UB),SYM(IROOT),NSYM,IGRSYM)
      CALL PRNTIR1(NOB,VEC1(1))
      CALL PRNTIR2B(NOB,NUB,VEC1(1+NOB))
      CALL PRNTIR2A(NOA,NUA,NOB,VEC1(1+NOB+NOB2UB))
C
      IF(NOA.EQ.NOB) THEN
       CALL IPSPIN(NOA,NUA,NOB,NUB,VEC1(1),VEC1(1+NOB),
     *             VEC1(1+NOB+NOB2UB),ISPIN(IROOT))
       WRITE(IW,315) IROOT,SYM(IROOT),ISPIN(IROOT),ENRG+EREF+XENE,XENE
       CALL FLSHBF(IW)
      ELSE
       WRITE(IW,305) IROOT,SYM(IROOT),ENRG+EREF+XENE,XENE
       CALL FLSHBF(IW)
      END IF
      ENGMAT(IROOT)=XENE
      CALL WRTAB1(NOB,VEC1(1),(JROOT+1),NFT825)
      CALL WRTAB3(NOB,NUB,NOB,VEC1(1+NOB),(JROOT+2),NFT825)
      CALL WRTAB3(NOB,NUA,NOA,VEC1(1+NOB+NOB2UB),(JROOT+3),NFT825)
C
C           print converged (or unconverged) results
C
 1    CONTINUE
      ICHECK=0
      NRTIRRP=0
C
      IF(NOA.EQ.NOB) THEN
         WRITE(IW,316)
         DO I=1,NROOT
           IF(SYM(I).EQ.REP(IROOTCC(1))) THEN
             NRTIRRP = NRTIRRP+1
             IF(NRTIRRP.EQ.IROOTCC(2)) BESTEOM = ENRG+EREF+ENGMAT(I)
           END IF
           IF(ICON(I).EQ.1) THEN
             WRITE(IW,317) SYM(I),ISPIN(I),ENGMAT(I),ENRG+EREF+ENGMAT(I)
           ELSE
             WRITE(IW,318) SYM(I),ISPIN(I),ENGMAT(I),ENRG+EREF+ENGMAT(I)
             ICHECK=ICHECK+1
           END IF
         ENDDO
      ELSE
         WRITE(IW,306)
         DO I=1,NROOT
           IF(SYM(I).EQ.REP(IROOTCC(1))) THEN
             NRTIRRP = NRTIRRP+1
             IF(NRTIRRP.EQ.IROOTCC(2)) BESTEOM = ENRG+EREF+ENGMAT(I)
           END IF
           IF(ICON(I).EQ.1) THEN
             WRITE(IW,307) SYM(I),ENGMAT(I),ENRG+EREF+ENGMAT(I)
           ELSE
             WRITE(IW,308) SYM(I),ENGMAT(I),ENRG+EREF+ENGMAT(I)
             ICHECK=ICHECK+1
           END IF
         ENDDO
      END IF
      WRITE(IW,309) IROOTCC,BESTEOM
C
      IF(ICHECK.GT.0) THEN
        WRITE(IW,310) ICHECK
        CALL ABRT
        STOP
      END IF
      RETURN
C
 300  FORMAT(1X,'ITERATION:',1X,I3,2X,'IP ENERGY=',1X,F14.10,2X,'CONV:',
     *       1X,F14.9)
 301  FORMAT(/6X,'BEGINNING IP-EOMCCSD(2H-1P) ITERATIONS FOR ROOT NO.',
     *       1X,I3)
 302  FORMAT(/2X,'THE IP-EOMCCSD(2H-1P) ITERATIONS FOR ROOT NO.',1X,I3,
     *       1X,'DID NOT CONVERGE',/)
 303  FORMAT(/2X,'THE IP-EOMCCSD(2H-1P) ITERATIONS FOR ROOT NO.',1X,I3,
     *       1X,'HAVE CONVERGED')
 304  FORMAT(2X,'IP-EOMCCSD(2H-1P) IONIZATION ENERGY:',
     *       1X,F15.10,/)
 305  FORMAT(/8X,'SUMMARY OF IP-EOMCCSD(2H-1P) RESULTS FOR ROOT NO.',
     *       1X,I3,/18X,'THE SYMMETRY OF THE STATE IS',A4,/
     *       1X,'IP-EOMCCSD(2H-1P) E=',F20.10,
     *       2X,'IONIZE E=',F15.10,/)
 306  FORMAT(/7X,'---- SUMMARY OF IP-EOMCCSD(2H-1P) CALCULATIONS ----',/
     *        14X,'IONIZATION',13X,'TOTAL',/
     *        1X,'SYMMETRY',5X,'ENERGY (H)',11X,'ENERGY (H)',9X,
     *        'ITERATIONS')
 307  FORMAT(3X,A4,3X,F15.10,2X,F20.10,7X,'CONVERGED')
 308  FORMAT(3X,A4,3X,F15.10,2X,F20.10,7X,'UNCONVERGED')
 309  FORMAT(/1X,'SELECTING TARGET STATE IROOT=',2I3,
     *           ' AS BEST IP ENERGY',F20.10)
 310  FORMAT(2X,'IP-EOMCCSD(2H-1P) HALTED WITHOUT CONVERGING ALL',
     *        1X,'DESIRED STATES'/
     *        2X,I3,1X,'STATES UNCONVERGED',/)
 315  FORMAT(/8X,'SUMMARY OF IP-EOMCCSD(2H-1P) RESULTS FOR ROOT NO.',
     *       1X,I3,/18X,'THE SYMMETRY OF THE STATE IS',A4,/
     *       14X,'THE SPIN MULTIPLICITY OF THE STATE IS',I2,/
     *       1X,'IP-EOMCCSD(2H-1P) E=',F20.10,
     *       2X,'IONIZE E=',F15.10,/)
 316  FORMAT(/9X,'---- SUMMARY OF IP-EOMCCSD(2H-1P) CALCULATIONS ----',/
     *        9X,'SPIN',6X,'IONIZATION',13X,'TOTAL',/
     *        2X,'SYMM',3X,'MULT',6X,'ENERGY (H)',11X,'ENERGY (H)',7X,
     *        'ITERATIONS')
 317  FORMAT(2X,A4,3X,I2,4X,F15.10,2X,F20.10,5X,'CONVERGED')
 318  FORMAT(2X,A4,3X,I2,4X,F15.10,2X,F20.10,5X,'UNCONVERGED')
      END
C
C*MODULE EAIPCC  *DECK IPSMLLMA
      SUBROUTINE IPSMLLMA(NOA,NUA,NOB,NUB,ISPACE,ITER,HM,
     *                    HMAUX,VEC1,VEC2,NOUP,IREC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      DIMENSION HM(ISPACE,ISPACE),HMAUX(ISPACE,ISPACE)
      DIMENSION VEC1(1),VEC2(1)
C
      DO 1,I1=1,ISPACE
      DO 2,I2=1,ISPACE
       HM(I1,I2)=HMAUX(I1,I2)
 2    CONTINUE
 1    CONTINUE
      CALL ZEROMA(VEC1,1,NOUP)
      CALL ZEROMA(VEC2,1,NOUP)
C
C     --------- ITER-TH COLUMN OF HM (VEC2-HR(ITER)) -------------
      CALL RDTAB1(NOB,VEC2(1),(IREC+4),96)
      CALL RDTAB3(NOB,NUB,NOB,VEC2(1+NOB),(IREC+5),96)
      CALL RDTAB3(NOB,NUA,NOA,VEC2(1+NOB+NOB2UB),(IREC+6),96)
      DO 3,J=1,ITER-1
       JREC=6*(J-1)
       CALL RDTAB1(NOB,VEC1(1),(JREC+1),96)
       CALL RDTAB3(NOB,NUB,NOB,VEC1(1+NOB),(JREC+2),96)
       CALL RDTAB3(NOB,NUA,NOA,VEC1(1+NOB+NOB2UB),(JREC+3),96)
       YYY=DDOT(NOUP,VEC2(1),1,VEC1(1),1)
       HM(J,ITER)=YYY
 3    CONTINUE
C
C     --------- ITER-TH ROW OF HM (VEC1-R(ITER) -------------------
      CALL RDTAB1(NOB,VEC1(1),(IREC+1),96)
      CALL RDTAB3(NOB,NUB,NOB,VEC1(1+NOB),(IREC+2),96)
      CALL RDTAB3(NOB,NUA,NOA,VEC1(1+NOB+NOB2UB),(IREC+3),96)
      DO 4,J=1,ITER-1
       JREC=6*(J-1)
       CALL RDTAB1(NOB,VEC2(1),(JREC+4),96)
       CALL RDTAB3(NOB,NUB,NOB,VEC2(1+NOB),(JREC+5),96)
       CALL RDTAB3(NOB,NUA,NOA,VEC2(1+NOB+NOB2UB),(JREC+6),96)
       YYY=DDOT(NOUP,VEC2(1),1,VEC1(1),1)
       HM(ITER,J)=YYY
 4    CONTINUE
C
C     ---------- (ITER,ITER)-DIAGONAL PART OF HM --------------------
      CALL RDTAB1(NOB,VEC1(1),(IREC+1),96)
      CALL RDTAB3(NOB,NUB,NOB,VEC1(1+NOB),(IREC+2),96)
      CALL RDTAB3(NOB,NUA,NOA,VEC1(1+NOB+NOB2UB),(IREC+3),96)
      CALL RDTAB1(NOB,VEC2(1),(IREC+4),96)
      CALL RDTAB3(NOB,NUB,NOB,VEC2(1+NOB),(IREC+5),96)
      CALL RDTAB3(NOB,NUA,NOA,VEC2(1+NOB+NOB2UB),(IREC+6),96)
      YYY=DDOT(NOUP,VEC2(1),1,VEC1(1),1)
      HM(ITER,ITER)=YYY
C
      DO 11,I1=1,ISPACE
      DO 12,I2=1,ISPACE
       HMAUX(I1,I2)=HM(I1,I2)
 12   CONTINUE
 11   CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPSELVEC
      SUBROUTINE IPSELVEC(ISPACE,ITER,HM,WR,WI,VR,WORK,XENE)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /IOFILE/ IR,IW,IP,IJK,IJKT,IDAF,NAV,IODA(950)
      DIMENSION HM(ISPACE,ISPACE),VR(ISPACE,ISPACE)
      DIMENSION WR(ISPACE),WI(ISPACE),WORK(4*ISPACE)
      CHARACTER*1 JOBVL,JOBVR
      DATA BIGN/10000.0D+00/
C
      LWORK=4*ISPACE
      JOBVL='N'
      JOBVR='V'
      DO 10,I=ITER+1,ISPACE
       HM(I,I)=BIGN+DBLE(I)
 10   CONTINUE
C
      CALL DGEEV(JOBVL,JOBVR,ISPACE,HM,ISPACE,WR,WI,VL,ISPACE,
     *           VR,ISPACE,WORK,LWORK,INFO)
      IF(INFO.NE.0) THEN
       WRITE(IW,*) 'ERROR IN SOLVING SMALL EIGENVALUE PROBLEM:',INFO
       CALL FLSHBF(IW)
       CALL ABRT
       STOP
      END IF
C
      XTOL=1.0D-7
      JMAX=0
      XOVER=0.0D+00
      DO 1,I=1,ISPACE
       XXX=DABS(VR(1,I))
       YYY=DABS(WI(I))
       ZZZ=DABS(WR(I))
       IF((XXX.GT.XOVER).AND.(YYY.LT.XTOL).AND.(ZZZ.LT.BIGN)) THEN
        XOVER=XXX
        JMAX=I
       END IF
 1    CONTINUE
      XENE=WR(JMAX)
      DO 2,I=1,ISPACE
       WI(I)=VR(I,JMAX)
 2    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPCOMB
      SUBROUTINE IPCOMB(NOA,NUA,NOB,NUB,ISPACE,ITER,WI,VEC1,VEC2,
     *                  ISN,NOUP)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      DIMENSION WI(ISPACE),VEC1(1),VEC2(1)
      CALL ZEROMA(VEC1,1,NOUP)
      CALL ZEROMA(VEC2,1,NOUP)
      DO 1,I=1,ITER
       XCOMB=WI(I)
       IF(ISN.EQ.1) THEN
        JREC=6*(I-1)
        CALL RDTAB1(NOB,VEC2(1),(JREC+1),96)
        CALL RDTAB3(NOB,NUB,NOB,VEC2(1+NOB),(JREC+2),96)
        CALL RDTAB3(NOB,NUA,NOA,VEC2(1+NOB+NOB2UB),(JREC+3),96)
       ELSE
        JREC=6*(I-1)
        CALL RDTAB1(NOB,VEC2(1),(JREC+4),96)
        CALL RDTAB3(NOB,NUB,NOB,VEC2(1+NOB),(JREC+5),96)
        CALL RDTAB3(NOB,NUA,NOA,VEC2(1+NOB+NOB2UB),(JREC+6),96)
       END IF
       CALL DAXPY(NOUP,XCOMB,VEC2(1),1,VEC1(1),1)
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPDEN
      SUBROUTINE IPDEN(NOA,NUA,NOB,NUB,XENE,DHHA,DHHB,DPPA,DPPB,
     *                 R1,R2B,R2A)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION DHHA(NOA,NOA),DHHB(NOB,NOB)
      DIMENSION DPPA(NUA,NUA),DPPB(NUB,NUB)
      DIMENSION R1(NOB),R2B(NOB,NUB,NOB),R2A(NOB,NUA,NOA)
C
      DO 1,I=1,NOB
       XDEN=XENE+DHHB(I,I)  !JRG CHANGED SIGN
       R1(I)=R1(I)/XDEN
 1    CONTINUE
C
      DO 3,I=1,NOB
      DO 4,IB=1,NUB
      DO 5,J=1,NOB
       XDEN=XENE+DHHB(I,I)+DHHB(J,J)-DPPB(IB,IB) !JRG
       R2B(I,IB,J)=R2B(I,IB,J)/XDEN
 5    CONTINUE
 4    CONTINUE
 3    CONTINUE
C
      DO 13,I=1,NOB
      DO 14,IB=1,NUA
      DO 15,J=1,NOA
       XDEN=XENE+DHHB(I,I)+DHHA(J,J)-DPPA(IB,IB)
       R2A(I,IB,J)=R2A(I,IB,J)/XDEN
 15   CONTINUE
 14   CONTINUE
 13   CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPORTH
      SUBROUTINE IPORTH(NOA,NUA,NOB,NUB,NOUP,ITER,VEC,AUX)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      DIMENSION VEC(1),AUX(1)
C
      CALL DCOPY(NOUP,VEC,1,AUX,1)
      XNORM=DDOT(NOUP,VEC,1,AUX,1)
      XNORM=(1.0D+00)/(DSQRT(XNORM))
      CALL DSCAL(NOUP,XNORM,VEC,1)
      DO 1,I=1,ITER
       JREC=6*(I-1)
       CALL RDTAB1(NOB,AUX(1),(JREC+1),96)
       CALL RDTAB3(NOB,NUB,NOB,AUX(1+NOB),(JREC+2),96)
       CALL RDTAB3(NOB,NUA,NOA,AUX(1+NOB+NOB2UB),(JREC+3),96)
       YYY=-DDOT(NOUP,VEC,1,AUX,1)
       CALL DAXPY(NOUP,YYY,AUX,1,VEC,1)
 1    CONTINUE
C
      CALL ZEROMA(AUX,1,NOUP)
      CALL DCOPY(NOUP,VEC,1,AUX,1)
      XNORM=DDOT(NOUP,VEC,1,AUX,1)
      XNORM=(1.0D+00)/(DSQRT(XNORM))
      CALL DSCAL(NOUP,XNORM,VEC,1)
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IP2NORM
      SUBROUTINE IP2NORM(NOA,NUA,NOB,NUB,R1,R2B,R2A)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      DIMENSION R1(NOB),R2B(NOB,NUB,NOB),R2A(NOB,NUA,NOA)
      DATA ONE/1.0D+00/
C
      XNORM=0.00D+00
      DO 1,I=1,NOB
       YYY=R1(I)
       XNORM=XNORM+YYY*YYY
 1    CONTINUE
C
      DO 2,I=1,NOB
      DO 3,J=I+1,NOB
      DO 4,IB=1,NUB
       YYY=R2B(I,IB,J)
       XNORM=XNORM+YYY*YYY
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
C
      DO 5,I=1,NOB
      DO 6,J=1,NOA
      DO 7,IB=1,NUA
       YYY=R2A(I,IB,J)
       XNORM=XNORM+YYY*YYY
 7    CONTINUE
 6    CONTINUE
 5    CONTINUE
C
      XNORM=ONE/DSQRT(XNORM)
      CALL DSCAL(NOB,XNORM,R1,1)
      CALL DSCAL(NOB2UB,XNORM,R2B,1)
      CALL DSCAL(NOABUA,XNORM,R2A,1)
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPSYM
      SUBROUTINE IPSYM(NOA,NUA,NOB,NUB,R1,R2B,R2A,SYM,NSYM,IGRSYM)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      CHARACTER*3 SYM,REP
      PARAMETER (MXAO=8192)
      COMMON /EOMSYM/ IG,NRE(4),MC(8,8,4),ISORB(MXAO),REP(8)
C
      DIMENSION IVEC1(8),IVEC2(8)
      DIMENSION R1(NOB),R2A(NOB,NUA,NOA),R2B(NOB,NUB,NOB)
C
      TOL=0.10D+00
      DO 100,I=1,8
       IVEC1(I)=0
       IVEC2(I)=0
 100  CONTINUE
      IFIND=0
      DO 1,I=1,NOB
       YYY=DABS(R1(I))
       IF(YYY.GT.TOL) THEN
       IFIND=0
        DO 2,K=1,NRE(IG)
         IVEC1(K)=MC(K,ISORB(I),IG)*MC(K,IGRSYM,IG)
 2      CONTINUE
        DO 3,JSYM=1,NRE(IG)
        DO 4,III=1,NRE(IG)
         IVEC2(III)=MC(III,JSYM,IG)
 4      CONTINUE
        IDIFF=0
        DO 5,III=1,8
         IDIFF=IDIFF+ABS(IVEC1(III)-IVEC2(III))
 5      CONTINUE
        IF(IDIFF.EQ.0) THEN
         IFIND=1
         SYM=REP(JSYM)
         NSYM=JSYM
         RETURN
        END IF
 3      CONTINUE
       END IF
 1     CONTINUE
       IF(IFIND.NE.0) GO TO 111
       DO 10,I=1,NOB
       DO 11,J=1,NOB
       DO 12,IB=1,NUB
        YYY=DABS(R2B(I,IB,J))
        IF(YYY.GT.TOL) THEN
         DO 13,K=1,NRE(IG)
         IVEC1(K)=MC(K,ISORB(I),IG)*MC(K,ISORB(J),IG)*
     &            MC(K,ISORB(IB+NOB),IG)*MC(K,IGRSYM,IG)
 13      CONTINUE
         DO 14,JSYM=1,NRE(IG)
         DO 15,III=1,NRE(IG)
          IVEC2(III)=MC(III,JSYM,IG)
 15      CONTINUE
         IDIFF=0
         DO 16,III=1,8
          IDIFF=IDIFF+ABS(IVEC1(III)-IVEC2(III))
 16      CONTINUE
         IF(IDIFF.EQ.0) THEN
          IFIND=1
          SYM=REP(JSYM)
          NSYM=JSYM
          RETURN
         END IF
 14      CONTINUE
        END IF
 12     CONTINUE
 11     CONTINUE
 10     CONTINUE
        IF(IFIND.NE.0) GO TO 111
       DO 20,I=1,NOB
       DO 21,J=1,NOA
       DO 22,IB=1,NUA
        YYY=DABS(R2A(I,IB,J))
        IF(YYY.GT.TOL) THEN
         DO 23,K=1,NRE(IG)
         IVEC1(K)=MC(K,ISORB(I),IG)*MC(K,ISORB(J),IG)*
     &            MC(K,ISORB(IB+NOA),IG)*MC(K,IGRSYM,IG)
 23      CONTINUE
         DO 24,JSYM=1,NRE(IG)
         DO 25,III=1,NRE(IG)
          IVEC2(III)=MC(III,JSYM,IG)
 25      CONTINUE
         IDIFF=0
         DO 26,III=1,8
          IDIFF=IDIFF+ABS(IVEC1(III)-IVEC2(III))
 26      CONTINUE
         IF(IDIFF.EQ.0) THEN
          IFIND=1
          SYM=REP(JSYM)
          NSYM=JSYM
          RETURN
         END IF
 24      CONTINUE
        END IF
 22     CONTINUE
 21     CONTINUE
 20     CONTINUE
C
 111    CONTINUE
        RETURN
        END
C
C*MODULE EAIPCC  *DECK IPSPIN
      SUBROUTINE IPSPIN(NOA,NUA,NOB,NUB,R1,R2B,R2A,ISPIN)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      PARAMETER (MXAO=8192)
      COMMON /EOMPAR/ CVGCI,CVGEOM,GRPEOM,NSTEOM(8),NOACT,NUACT,
     *                MOACTCC(MXAO),MTHTRIP,MTHCI,MTHEOM,MTHINIT,
     *                MAXCI,MAXEOM,MICCI,MICEOM,IROOTCC(2),
     *                IPROPCC,IPROPCCE
      DIMENSION R1(NOB),R2A(NOB,NUB,NOB),R2B(NOB,NUA,NOA)
      DATA BIGN/10000.0D+00/
C
      TOL=10*CVGEOM
C
      ISPIN=0
C
      R1MAX=0.00D+00
      DO 1,I=1,NOB
       YYY=DABS(R1(I))
       IF(YYY.GT.R1MAX) THEN
        R1MAX=YYY
       END IF
 1    CONTINUE
      IF(R1MAX.GT.TOL) THEN
       ISPIN=2
       GO TO 100
      END IF
C
      RBPRV=BIGN
      RAPRV=BIGN
 101  CONTINUE
C
      R2MAX=0.00D+00
      IMAX=0
      JMAX=0
      IBMAX=0
      DO 2,I=1,NOB
      DO 3,J=I+1,NOB
      DO 4,IB=1,NUB
       YYY=DABS(R2B(I,IB,J))
       IF(YYY.GT.R2MAX.AND.YYY.LT.RBPRV) THEN
        R2MAX=YYY
        IMAX=I
        JMAX=J
        IBMAX=IB
       END IF
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
C
      R2A1=DABS(R2A(IMAX,IBMAX,JMAX))
      R2A2=DABS(R2A(JMAX,IBMAX,IMAX))
      DIFF1=DABS((2.00D+00*R2A1)-R2MAX)
      DIFF2=DABS((2.00D+00*R2A2)-R2MAX)
      IF(DIFF1.LT.TOL.AND.DIFF2.LT.TOL) THEN
       ISPIN=2
       GO TO 100
      END IF
      DIFF1=DABS(R2A1-R2MAX)
      DIFF2=DABS(R2A2-R2MAX)
      IF(DIFF1.LT.TOL.AND.DIFF2.LT.TOL) THEN
       ISPIN=4
       GO TO 100
      END IF
C
      RBPRV=R2MAX
C
      R2MAX=0.00D+00
      IMAX=0
      IBMAX=0
      JMAX=0
      DO 5,I=1,NOB
      DO 6,J=1,NOA
      DO 7,IB=1,NUA
       YYY=DABS(R2A(I,IB,J))
       IF(YYY.GT.R2MAX.AND.YYY.LT.RAPRV) THEN
        R2MAX=YYY
        JMAX=J
        IMAX=I
        IBMAX=IB
       END IF
 7    CONTINUE
 6    CONTINUE
 5    CONTINUE
C
      IF(IMAX.EQ.JMAX) THEN
       ISPIN=2
       GO TO 100
      END IF
C
      R2A2=DABS(R2A(JMAX,IBMAX,IMAX))
      DIFF=DABS(R2A2-R2MAX)
      IF(DIFF.LT.TOL) THEN
       ISPIN=2
       GO TO 100
      END IF
C
      RAPRV=R2MAX
      IF(RAPRV.GT.1.0D-4.AND.RBPRV.GT.1.0D-4) GO TO 101
C
 100  CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK HR2H1P
      SUBROUTINE HR2H1P(NOA,NUA,NOB,NUB,R1,HR1,R2B,R2A,HR2B,HR2A,
     *                  FPP,FHP,FHH,VHHHP,VHHHH,VHPHP,T2,OPB,TI)
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
C
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
C
      DIMENSION R1(1),HR1(1),R2B(1),R2A(1)
      DIMENSION HR2B(1),HR2A(1)
      DIMENSION FPP(1),FHP(1),FHH(1)
      DIMENSION VHHHP(1),VHHHH(1)
      DIMENSION VHPHP(1),T2(1)
      DIMENSION OPB(1),TI(1)
C
      DATA HALF/0.5D+00/
      DATA QUART/0.25D+00/
C
C     -------------------INITIAL ZEROING---------------------------------
      CALL ZEROMA(FHP,1,NOU)
      CALL ZEROMA(FPP,1,NU2)
      CALL ZEROMA(FHH,1,NO2)
      CALL ZEROMA(VHHHP,1,NO3U)
      CALL ZEROMA(VHHHH,1,NO4)
      CALL ZEROMA(VHPHP,1,NO2U2)
      CALL ZEROMA(T2,1,NO2U2)
      CALL ZEROMA(OPB,1,NUB)
      CALL ZEROMA(HR1,1,NOB)
      CALL ZEROMA(HR2B,1,NO2U)
      CALL ZEROMA(HR2A,1,NO2U)
C     --------------------PUT CODE HERE--------------------------
C
      CALL RDINT(1,NOBUB,NOBUB,VHPHP,NFT830)           !VHPHP:(FB,NB,EB,MB)
      CALL VECMUL(VHPHP,NOB2UB2,HALF)                  !VHPHP:1/2*(FB,NB,EB,MB)
      CALL TRANSQ(VHPHP,NOBUB)                         !VHPHP:1/2*(EB,MB,FB,NB)
      CALL CCMATMUL(VHPHP,R2B,OPB,NUB,1,NOB2UB,1,1)    !1/2*(EB,MB,FB,NB)(MB,FB,NB)=(EB)
      CALL ZEROMA(VHPHP,1,NO2U2)
      CALL RDINT(1,NOBUB,NOAUA,VHPHP,NFT833)           !VHPHP:(FA,NA,EB,MB)
      CALL INSITU(NUA,NOA,NUB,NOB,TI,VHPHP,13)         !VHPHP:(EB,NA,FA,MB)
      CALL TRAN24(NUB,NOA,NUA,NOB,TI,VHPHP)            !VHPHP:(EB,MB,FA,NA)
      CALL CCMATMUL(VHPHP,R2A,OPB,NUB,1,NOABUA,0,1)    !(EB,MB,FA,NA)(MB,FA,NA)=(EB)
      CALL RDTAB(NOB,NUB,NUB,NOB,T2,4,NFT825)          !T2:(IB,EB,BB,JB)
      CALL INSITU(NOB,NUB,NUB,NOB,TI,T2,12)            !T2:(IB,EB,BB,JB)-->(EB,IB,BB,JB)
      CALL VECMUL(T2,NOB2UB2,HALF)                     !1/2*(EB,IB,BB,JB)
      CALL CCMATMUL(OPB,T2,HR2B,1,NOB2UB,NUB,1,0)      !1/2*(EB)(EB,IB,BB,JB)=(IB,BB,JB)
      CALL ZEROMA(T2,1,NO2U2)
      CALL RDTAB(NOA,NUA,NUB,NOB,T2,5,NFT825)          !T2:(JA,BA,EB,IB)
      CALL INSITU(NOA,NUA,NUB,NOB,TI,T2,12)            !T2:(BA,JA,EB,IB)
      CALL TRAN1TO4(NUA,NOA,NUB,NOB,TI,T2)             !T2:(JA,EB,IB,BA)
      CALL TRAN1TO4(NOA,NUB,NOB,NUA,TI,T2)             !T2:(EB,IB,BA,JA)
      CALL CCMATMUL(OPB,T2,HR2A,1,NOABUA,NUB,1,0)      !(EB)(EB,IB,BA,JA)=(IB,BA,JA)
      CALL RDTAB2(NOB,NOB,FHH,4,NFT891)
      CALL CCMATMUL(FHH,R1,HR1,NOB,1,NOB,1,1)            !(IB,MB)(MB)=(IB)
      CALL RDTAB2(NOA,NUA,FHP,5,NFT891)                  !(MA,EA)
      CALL TRT1(NOA,NUA,TI,FHP)                          !(MA,EA)-->(EA,MA)
      CALL CCMATMUL(R2A,FHP,HR1,NOB,1,NOAUA,0,0)         !(IB,EA,MA)(EA,MA)=(IB)
      CALL ZEROMA(FHP,1,NOU)
      CALL RDTAB2(NOB,NUB,FHP,6,NFT891)
      CALL TRT1(NOB,NUB,TI,FHP)
      CALL CCMATMUL(R2B,FHP,HR1,NOB,1,NOBUB,0,0)         !(IB,EB,MB)(EB,MB)=(IB)
      CALL RDTAB(NOA,NOB,NUA,NOB,VHHHP,17,NFT891)       !VHHHP:(NA,MB,FA,IB)
      CALL INSITU(NOA,NOB,NUA,NOB,TI,VHHHP,23)           !VHHHP:(NA,FA,MB,IB)
      CALL INSITU(NOA,NUA,NOB,NOB,TI,VHHHP,13)           !VHHHP:(MB,FA,NA,IB)
      CALL CCMATMUL(R2A,VHHHP,HR1,1,NOB,NOABUA,0,1)      !(MB,FA,NA)(MB,FA,NA,IB)=(IB)
      CALL ZEROMA(VHHHP,1,NO3U)
      CALL RDTAB(NOB,NOB,NOB,NUB,VHHHP,15,NFT891)       !VHHHP:(MB,NB,IB,FB)
      CALL TRAN24(NOB,NOB,NOB,NUB,TI,VHHHP)              !VHHHP:(MB,FB,IB,NB)
      CALL TRANMD(VHHHP,NOB,NUB,NOB,NOB,34)              !VHHHP:(MB,FB,NB,IB)
      CALL VECMUL(VHHHP,NOB3UB,HALF)                   !VHHHP:1/2*(MB,FB,NB,IB)
      CALL CCMATMUL(R2B,VHHHP,HR1,1,NOB,NOB2UB,0,1)     !1/2*(MB,FB,NB)(MB,FB,NB,IB)=(IB)
      CALL TRANSQ(FHH,NOB)                              !FHH:(IB,MB)-->(NB,JB)
      CALL CCMATMUL(R2B,FHH,HR2B,NOBUB,NOB,NOB,0,1)     !(IB,BB,NB)(NB,JB)=(IB,BB,JB)
      CALL TRANSQ(FHH,NOB)                              !FHH:(NB,JB)-->(IB,MB)
      CALL ZEROMA(VHHHP,1,NO3U)
      CALL RDTAB(NOB,NOB,NOB,NUB,VHHHP,11,NFT891)       !VHHHP:(IB,JB,MB,BB)
      CALL VECMUL(VHHHP,NOB3UB,HALF)                    !VHHHP:1/2*(IB,JB,MB,BB)
      CALL TRANMD(VHHHP,NOB,NOB,NOB,NUB,23)             !VHHHP:1/2*(IB,MB,JB,BB)
      CALL TRAN24(NOB,NOB,NOB,NUB,TI,VHHHP)             !VHHHP:1/2*(IB,BB,JB,MB)
      CALL CCMATMUL(VHHHP,R1,HR2B,NOB2UB,1,NOB,0,1)     !1/2*(IB,BB,JB,MB)(MB)=(IB,BB,JB)
      CALL CCMATMUL(FHH,R2A,HR2A,NOB,NOAUA,NOB,0,1)     !(IB,MB)(MB,BA,JA)-->(IB,BA,JA)
      CALL ZEROMA(VHHHP,1,NO3U)
      CALL RDTAB(NOA,NOB,NUA,NOB,VHHHP,13,NFT891)       !VHHHP:(JA,IB,BA,MB)
      CALL TRAN14(NOA,NOB,NUA,NOB,TI,VHHHP)            !VHHHP:(MB,IB,BA,JA)
      CALL CCMATMUL(R1,VHHHP,HR2A,1,NOABUA,NOB,0,1)     !(MB)(MB,IB,BA,JA)=(IB,BA,JA)
      CALL ZEROMA(FHH,1,NO2)
      CALL RDTAB2(NOA,NOA,FHH,3,NFT891)
      CALL TRANSQ(FHH,NOA)                              !(JA,NA)-->(NA,JA)
      CALL CCMATMUL(R2A,FHH,HR2A,NOBUA,NOA,NOA,0,1)     !(IB,BA,NA)(NA,JA)=(IB,BA,JA)
      CALL ZEROMA(VHPHP,1,NO2U2)
      CALL RDTAB(NUB,NOB,NUA,NOA,VHPHP,6,NFT892)       !(BB,JB,EA,MA)
      CALL TRAN24(NUB,NOB,NUA,NOA,TI,VHPHP)            !(BB,MA,EA,JB)
      CALL INSITU(NUB,NOA,NUA,NOB,TI,VHPHP,13)         !(EA,MA,BB,JB)
      CALL CCMATMUL(R2A,VHPHP,HR2B,NOB,NOBUB,NOAUA,0,1)!(IB,EA,MA)(EA,MA,BB,JB)=(IB,BB,JB)
      CALL ZEROMA(VHPHP,1,NO2U2)
      CALL RDTAB(NUB,NOB,NUB,NOB,VHPHP,2,NFT892)       !(BB,JB,EB,MB)
      CALL TRANSQ(VHPHP,NOBUB)                         !(EB,MB,BB,JB)
      CALL CCMATMUL(R2B,VHPHP,HR2B,NOB,NOBUB,NOBUB,0,1)!(IB,EB,MB)(EB,MB,BB,JB)=(IB,MB,JB)
      CALL ZEROMA(VHPHP,1,NO2U2)
      CALL RDTAB(NUB,NOB,NOA,NUA,VHPHP,5,NFT892)       !(EB,MB,JA,BA)
      CALL TRAN34N(NUB,NOB,NOA,NUA,TI,VHPHP)           !(EB,MB,BA,JA)
      CALL CCMATMUL(R2B,VHPHP,HR2A,NOB,NOAUA,NOBUB,0,1)!(IB,EB,MB)(EB,MB,BA,JA)=(IB,BA,JA)
      CALL ZEROMA(VHPHP,1,NO2U2)
      CALL RDTAB(NUA,NOA,NUA,NOA,VHPHP,1,NFT892)      !(BA,JA,EA,MA)
      CALL TRANSQ(VHPHP,NOAUA)                         !(EA,MA,BA,JA)
      CALL CCMATMUL(R2A,VHPHP,HR2A,NOB,NOAUA,NOAUA,0,1)!(IB,EA,MA)(EA,MA,BA,JA)=(IB,BA,JA)
      CALL ZEROMA(VHPHP,1,NO2U2)
      CALL RDTAB(NUA,NOB,NUA,NOB,VHPHP,4,NFT892)       !(BA,IB,EA,MB)
      CALL TRAN34N(NUA,NOB,NUA,NOB,TI,VHPHP)           !(BA,IB,MB,EA)
      CALL INSITU(NUA,NOB,NOB,NUA,TI,VHPHP,12)         !(IB,BA,MB,EA)
      CALL CCMATMUL(VHPHP,R2A,HR2A,NOBUA,NOA,NOBUA,0,1)!(IB,BA,MB,EA)(MB,EA,JA)=(IB,EA,JA)
      CALL RDTAB2(NUB,NUB,FPP,2,NFT891)                 !(FB,BB)
      CALL VECMUL(FPP,NUB2,HALF)                        !FPP:1/2*(FB,BB)
      CALL TRANSQ(FPP,NUB)                              !FPP:1/2*(FB,BB)-->1/2*(BB,FB)
      CALL INSITU(NOB,NUB,NOB,1,TI,R2B,12)              !R2B:(IB,BB,NB)-->(FB,IB,JB)
      CALL INSITU(NOB,NUB,NOB,1,TI,HR2B,12)             !HR2B:(IB,BB,JB)-->(BB,IB,JB)
      CALL CCMATMUL(FPP,R2B,HR2B,NUB,NOB2,NUB,0,0)      !1/2*(BB,FB)(FB,IB,JB)=(BB,IB,JB)
      CALL RDTAB(NOB,NOB,NOB,NOB,VHHHH,8,NFT891)        !(JB,IB,NB,MB)
      CALL TRANSQ(VHHHH,NOB2)                           !(MB,NB,IB,JB)
      CALL VECMUL(VHHHH,NOB4,QUART)                      !1/4*(MB,NB,IB,JB)
      CALL CCMATMUL(R2B,VHHHH,HR2B,NUB,NOB2,NOB2,0,0)   !1/4*(BB,MB,NB)(MB,NB,IB,JB)-->(BB,IB,JB)
      CALL INSITU(NUB,NOB,NOB,1,TI,HR2B,12)             !HR2B:(BB,IB,JB)-->(IB,BB,JB)
      CALL ZEROMA(FPP,1,NU2)
      CALL RDTAB2(NUA,NUA,FPP,1,NFT891)                 !(FA,BA)
      CALL INSITU(NOB,NUA,NOA,1,TI,R2A,12)              !R2A:(IB,BA,NA)-->(FA,IB,JA)
      CALL TRANSQ(FPP,NUA)                              !(FA,BA)-->(BA,FA)
      CALL INSITU(NOB,NUA,NOA,1,TI,HR2A,12)             !HR2A:(IB,BA,JA)-->(BA,IB,JA)
      CALL CCMATMUL(FPP,R2A,HR2A,NUA,NOAB,NUA,0,0)      !(BA,FA)(FA,IB,JA)-->(BA,IB,JA)
      CALL ZEROMA(VHHHH,1,NO4)
      CALL RDTAB(NOA,NOB,NOA,NOB,VHHHH,9,NFT891)        !(JA,IB,NA,MB)
      CALL INSITU(NOA,NOB,NOA,NOB,TI,VHHHH,12)          !(IB,JA,NA,MB)
      CALL TRANSQ(VHHHH,NOAB)                           !(NA,MB,IB,JA)
      CALL INSITU(NOA,NOB,NOB,NOA,TI,VHHHH,12)          !(MB,NA,IB,JA)             )
      CALL CCMATMUL(R2A,VHHHH,HR2A,NUA,NOAB,NOAB,0,0)   !(BA,MB,NA)(MB,NA,IB,JA)-->(BA,IB,JA)
      CALL INSITU(NUA,NOB,NOA,1,TI,HR2A,12)             !HR2A:(BA,IB,JA)-->(IB,BA,JA)
C
      RETURN
      END
C
C*MODULE EAIPCC   DECK ASYMIP2
      SUBROUTINE ASYMIP2(T2HHP,NH,NP,TI)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION TI(1),T2HHP(1)
C
      NN=(NH**2)*NP
      CALL VECCOP(NN,TI,T2HHP)
      CALL TRANMD(TI,NH,NP,NH,1,13)
      CALL DAXPY(NN,-1.00D+00,TI,1,T2HHP,1)
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPINIT
      SUBROUTINE IPINIT(NOA,NUA,NOB,NUB,FPP,FHH,FHHA,FHP,VHPHP,
     *                  VHPHPA,VHHHP,VHHHH,INDEX1,INDEXA,INDEXB,HM,
     *                  WR,WI,WORK,VR,TRANS,LABMO,ISPIN,L1,IDIM,NROOT)
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
C
C        THIS GROUP IS ORBITAL SYMMETRY ASSIGNMENT
C
      CHARACTER*3 VECREP
      LOGICAL ABELPT
      DIMENSION LABMO(L1)
      CHARACTER*3 GR,REP
      CHARACTER*4 LBTEMP
      DIMENSION NREX(4),MCX(8,8,4)
      DIMENSION LABREP(8)
C
      CHARACTER*1 JOBVR,JOBVL,SMALLD
C
      DIMENSION FPP(1),FHH(1),FHP(1),VHPHP(1),VHHHP(1),VHHHH(1)
      DIMENSION INDEX1(NOB),INDEXA(1),INDEXB(1),HM(IDIM,IDIM)
      DIMENSION WR(IDIM),WI(IDIM),WORK(4*IDIM)
      DIMENSION VR(IDIM,IDIM),TRANS(1)
      DIMENSION INDEXX(100),FHHA(1),ISPIN(IDIM),JSTATE(9),VHPHPA(1)
C
      PARAMETER (MXAO=8192)
C
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /IOFILE/ IR,IW,IP,IJK,IJKT,IDAF,NAV,IODA(950)
      COMMON /RUNOPT/ RUNTYP,EXETYP,NEVALS,NGLEVL,NHLEVL
      COMMON /EOMPAR/ CVGCI,CVGEOM,GRPEOM,NSTEOM(8),NOACT,NUACT,
     *                MOACTCC(MXAO),MTHTRIP,MTHCI,MTHEOM,MTHINIT,
     *                MAXCI,MAXEOM,MICCI,MICEOM,IROOTCC(2),
     *                IPROPCC,IPROPCCE
      COMMON /EOMSYM/ IG,NRE(4),MC(8,8,4),ISORB(MXAO),REP(8)
      COMMON /EOMWFE/ EOMSDE(100),EOMR0(100),EOMR0L(100),
     *                CR1D1A(100),CR2D1A(100),CR1D1B(100),CR2D1B(100),
     *                CRCI3(100),XDELWB(100),XKKEOM(100),
     *                CR1A(100),CR1B(100),CR1C(100),CR1D(100),CR2A(100),
     *                CR2B(100),CR2C(100),CR2D(100),CREX3(100),
     *                KVGEOM(100),IUST(100),IREL(100),
     *                KKTRIM(100),KKTRIML(100),
     *                INUMEOM,NTOTEOM,NBADEOM,NTOTCISD,NCVGCISD,LAMCON,
     *                IVSYMAD(8),VECREP(100)
      COMMON /CCPAR / AMPTSH,METHCC,NCCTOT,NCCOCC,NCCFZC,NCCFZV,
     *                MXCCIT,MXRLEIT,NWRDCC,ICCCNV,ICCRST,IDSKCC
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /EAREST/ MREST(500)
      DATA CHECK/8HCHECK   /
C
C DATA BLOCK FOR MATRICES NRE AND MC
C
      DATA NREX/1,2,4,8/
      DATA MCX/
     &1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
     &0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
     &
     & 1,1,0,0,0,0,0,0, 1,-1,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,
     & 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,
     & 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,
     &
     & 1,1,1,1,0,0,0,0,      1,1,-1,-1,0,0,0,0, 1,-1,1,-1,0,0,0,0,
     & 1,-1,-1,1,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,
     & 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,
     &
     & 1,1,1,1,1,1,1,1,      1,1,1,1,-1,-1,-1,-1,  1,1,-1,-1,1,1,-1,-1,
     & 1,1,-1,-1,-1,-1,1,1,  1,-1,1,-1,1,-1,1,-1,  1,-1,1,-1,-1,1,-1,1,
     & 1,-1,-1,1,1,-1,-1,1,  1,-1,-1,1,-1,1,1,-1/
C
      DO K=1,4
         DO J=1,8
            DO I=1,8
               MC(I,J,K) = MCX(I,J,K)
            ENDDO
         ENDDO
         NRE(K) = NREX(K)
      ENDDO
C
      WRITE(UNIT=GR,FMT='(A3)') GRPEOM
      IF(.NOT.ABELPT()) GR='C1 '
C
      WRITE(IW,9010) GR
      CALL REPFIX(IW,GR,REP,IG)
C
      NIRREP = NRE(IG)
      DO I=1,NIRREP
         LBTEMP(1:3) = REP(I)
         LBTEMP(4:4) = ' '
         READ(UNIT=LBTEMP,FMT='(A4)') LABREP(I)
      ENDDO
C
C        4 BYTE MO SYMMETRY LABELS ARE AVAILABLE ON DISK FROM THE SCF
C        USE THESE TO FILL -ISORB- WITH CORRECT INTEGER VALUES
C
      IF(GR.EQ.'C1 ') THEN
         DO I=1,NOA+NUA
            ISORB(I) = 1
         ENDDO
      ELSE
         CALL DAREAD(IDAF,IODA,LABMO,L1,255,1)
         NERR=0
         DO I=1,NOA+NUA
            LTEMP = LABMO(I+NCCFZC)
            MATCH=0
            DO J=1,NIRREP
               IF(LTEMP.EQ.LABREP(J)) MATCH=J
            ENDDO
            ISORB(I) = MATCH
            IF(MATCH.EQ.0) THEN
               WRITE(IW,9020) I+NCCFZC,LTEMP
               NERR=NERR+1
            END IF
         ENDDO
         IF(NERR.GT.0) THEN
            WRITE(IW,9030) NERR
            CALL ABRT
            STOP
         END IF
      END IF
C
      IGO=1
      DO I=1,NRE(IG)
       DO J=1,NSTEOM(I)
        VECREP(IGO)=REP(I)
        IGO=IGO+1
       ENDDO
      ENDDO
      NROOT=0
      DO I=1,NRE(IG)
       NROOT=NROOT+NSTEOM(I)
      ENDDO
      CALL FIXGRSYM(NOA,NOB,IGRSYM)
      WRITE(IW,9040)REP(IGRSYM)
      CALL FLSHBF(IW)
      IPREV=0
      IPREVB=0
C
      IF(EXETYP.EQ.CHECK) RETURN
C
      CALL VICLR(MREST,1,500)
      CALL VICLR(JSTATE,1,9)
      IF(JREST.EQ.1) THEN
       READ(NFT825,REC=6,IOSTAT=IX) JSTATE
       IF(IX.NE.0) THEN
        WRITE(IW,9005)
        CALL ABRT
        STOP
       END IF
       IF(JSTATE(1).NE.MULEAIP) THEN
        WRITE(IW,9000)
        CALL ABRT
        STOP
       END IF
      END IF
C
      DO 1004,I=1,NRE(IG)
      IF(NSTEOM(I).EQ.0) GO TO 1004
      IROOT=NSTEOM(I)
      JROOT=JSTATE(I+1)
      CALL IPINDEX(NOA,NUA,NOB,NUB,INDEX1,INDEXA,INDEXB,IPOS,
     *             IGRSYM,I,ILC1,ILC2,MXUA,MXUB)
C
      JOBVR='V'
      JOBVL='N'
      LWORK=4*IDIM
      IALL=IPOS
      IF(MTHINIT.EQ.2) THEN
       WRITE(IW,9050) IALL
      ELSE
       SMALLD=CHAR(100)
       WRITE(IW,9055) SMALLD,IALL
      END IF
      CALL FLSHBF(IW)
      IF(IROOT.GT.IALL) THEN
       IF(MTHINIT.EQ.2) THEN
        WRITE(IW,9060)
       ELSE
        WRITE(IW,9065)
       END IF
       CALL FLSHBF(IW)
       CALL ABRT
       STOP
      END IF
C
C   FILL THE CIS OR EOMCCSd HAMILTONIAN MATRIX
C
      IF(MTHINIT.EQ.2) THEN
       CALL IPSFILL(NOB,HM,FHH,INDEX1,IDIM)
      ELSE
       CALL IPDFILL1(NOB,NUB,FHH,FHP,VHHHP,HM,INDEX1,INDEXB,IDIM)
       CALL IPDFILL2(NOB,NUB,FPP,FHH,VHHHP,VHPHP,VHHHH,HM,INDEX1,
     *               INDEXB,IDIM)
       CALL IPDFILL3(NOA,NUA,NOB,NUB,FHP,VHHHP,VHPHP,HM,INDEX1,
     *               INDEXA,INDEXB,IDIM)
       CALL IPDFILL4(NOA,NUA,NOB,NUB,VHPHP,VHHHP,HM,INDEX1,
     *               INDEXA,INDEXB,IDIM)
       CALL IPDFILL5(NOA,NUA,NOB,FPP,FHH,FHHA,VHPHP,VHPHPA,VHHHH,HM,
     *               INDEXA,IDIM)
      END IF
C
C   DIAGONALIZE HAMILTONIAN MATRIX
C
      NORDER=ILC1+ILC2
      CALL DGEEV(JOBVL,JOBVR,NORDER,HM,IDIM,WR,WI,VL,IDIM,VR,
     *           IDIM,WORK,LWORK,INFO)
C
      IF(INFO.NE.0) THEN
       WRITE(IW,*) 'INITIAL DIAGONALIZATION ERROR INFO:',INFO
       CALL FLSHBF(IW)
       CALL ABRT
       STOP
      END IF
C
C IDENTIFY SPIN MULTIPLICITIES
      IF(NOA.EQ.NOB) THEN
      CALL IPSPNINT(NOA,NUA,NOB,NUB,IDIM,NORDER,INDEX1,INDEXA,
     *              INDEXB,WR,VR,ISPIN)
      END IF
C
C ORDER THE STATES
C
      CALL IPORDER(NOA,NOB,NORDER,IROOT,WR,WI,ISPIN,INDEXX,INFO1,IREAL)
C
      IF(INFO1.EQ.0) THEN
       WRITE(IW,9070) IROOT,REP(I)
       WRITE(IW,9080)
       WRITE(IW,9090) REP(I)
        IF(NOA.EQ.NOB) THEN
        DO KROOT=1,IROOT
         WRITE(IW,9100) WR(INDEXX(KROOT)),ISPIN(INDEXX(KROOT))
        ENDDO
        ELSE
        DO KROOT=1,IROOT
         WRITE(IW,9105) WR(INDEXX(KROOT))
        ENDDO
        END IF
      ELSE IF(INFO1.NE.0.AND.MULEAIP.NE.1) THEN
       WRITE(IW,9110) IREAL,REP(I),MULEAIP
       CALL ABRT
       STOP
      ELSE
       WRITE(IW,9120) IREAL,REP(I)
       CALL ABRT
       STOP
      END IF
C
       CALL IPSTRINT(NOA,NUA,NOB,NUB,IDIM,INDEX1,INDEXA,INDEXB,
     *               VR,TRANS,IROOT,JROOT,INDEXX,IPREV,IPREVB,
     *               VHPHP)
       IPREV=IPREV+IROOT
       IPREVB=IPREVB+JROOT
C
 1004 CONTINUE
C
      RETURN
 9000 FORMAT(1X,'ERROR IN RESTARTING THE CALCULATION!',/
     *       1X,'THE VALUE OF MULEAIP MUST BE THE SAME AS IN THE',
     *       1X,'PREVIOUS CALCULATION!')
 9005 FORMAT(1X,'ERROR IN RESTARTING THE CALCULATION!',/
     *       1X,'NO RESTART INFORMATION EXISTS!',/
     *       1X,'PLACE THE AMPROCC FILE OF A PREVIOUS',
     *       1X,'CALCULATION INTO THE WORKING',/
     *       1X,'DIRECTORY AND RESUBMIT.')
 9010 FORMAT(/1X,'THE IP-EOMCC POINT GROUP IS ',A3)
 9020 FORMAT(1X,'ORBITAL',I5,' HAS UNKNOWN SYMMETRY LABEL ',A4)
 9030 FORMAT(1X,'UNABLE TO ASSIGN SYMMETRY TO',I5,' ORBITAL(S).'/
     *       1X,'PLEASE PROVIDE CRISPLY CONVERGED SCF ORBITALS!')
 9040 FORMAT(1X,'GROUND STATE SYMETRY IS ',A4)
 9050 FORMAT(1X,'SIZE OF CIS PROBLEM:',I8)
 9055 FORMAT(1X,'SIZE OF EOMCCS',A,' PROBLEM:',I8)
 9060 FORMAT(1X,'TOO MANY ROOTS REQUESTED FOR MINIT=2!'/
     *       1X,'PLEASE REDUCE THE NUMBER OF ROOTS OR USE MINIT=1.')
 9065 FORMAT(1X,'TOO MANY ROOTS REQUESTED!'/
     *       1X,'PLEASE REDUCE THE NUMBER OF ROOTS',
     *       1X,'OR INCREASE THE NUMBER OF ACTIVE ORBITALS')
 9070 FORMAT(1X,I4,' INITIAL VECTORS OF ',A3,
     *       ' SYMMETRY HAVE BEEN FOUND.')
 9080 FORMAT(4X,'ORDERING OF THE INITIAL EIGENVALUES WAS SUCCESSFUL')
 9090 FORMAT(4X,'INITIAL EIGENVALUES OF ',A3,' SYMMETRY:')
 9100 FORMAT(5X,'E=',1X,F20.10,3X,'SPIN MULTIPLICITY=',1X,I1)
 9105 FORMAT(5X,'E=',1X,F20.10)
 9110 FORMAT(1X,'ONLY',1X,I3,1X,'INITIAL VECTORS OF',1X,A3,1X,
     *       'SYMMETRY AND',/,2X,'SPIN MULTIPLICITY = ',I1,1X,
     *       'HAVE BEEN FOUND!')
 9120 FORMAT(1X,'ONLY',1X,I3,1X,'INITIAL VECTORS OF',1X,A3,1X,
     *       'SYMMETRY HAVE BEEN FOUND!')
      END
C
C*MODULE EAIPCC  *DECK IPSFILL
      SUBROUTINE IPSFILL(NO,HM,FHH,INDEX1,IDIM)
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      DIMENSION HM(IDIM,IDIM),FHH(NO,NO),INDEX1(NO)
C
      IDIM2=IDIM*IDIM
      CALL ZEROMA(HM,1,IDIM2)
      CALL RCCFL(NFT843,8,NOB2,FHH)
      DO 4,I=1,NO
      IROW=INDEX1(I)
      IF(IROW.EQ.0) GO TO 4
      DO 5,J=1,NO
       ICOL=INDEX1(J)
       IF(ICOL.EQ.0) GO TO 5
       HM(IROW,ICOL)=-FHH(I,J)
 5    CONTINUE
 4    CONTINUE
C---------------------------------------------
C      DO 455,I1=IALL+1,IDIM
C       HM(I1,I1)=100000.0D+00+DBLE(I1)
C 455  CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPDFILL1
      SUBROUTINE IPDFILL1(NOB,NUB,FHH,FHP,VHHHP,HM,INDEX1,INDEXB,IDIM)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
C
      DIMENSION FHH(NOB,NOB),FHP(NOB,NOB),VHHHP(NOB,NOB,NOB,NUB)
      DIMENSION HM(IDIM,IDIM),INDEX1(NOB),INDEXB(NOB,NUB,NOB)
C
      CALL RDTAB2(NOB,NOB,FHH,4,NFT891)
      CALL RDTAB2(NOB,NUB,FHP,6,NFT891)
      CALL RDTAB(NOB,NOB,NOB,NUB,VHHHP,15,NFT891)
C
      IDIM2=IDIM*IDIM
      CALL ZEROMA(HM,1,IDIM2)
C
      DO 1,I=1,NOB
       IROW=INDEX1(I)
       IF(IROW.EQ.0) GO TO 1
C
       DO 2,J=1,NOB
        ICOL=INDEX1(J)
        IF(ICOL.EQ.0) GO TO 2
        HM(IROW,ICOL)=HM(IROW,ICOL)-FHH(I,J)
 2     CONTINUE
C
       DO 3,J=1,NOB
       DO 4,IB=1,NUB
        ICOL=INDEXB(I,IB,J)
        IF(ICOL.EQ.0) GO TO 4
        HM(IROW,ICOL)=HM(IROW,ICOL)-(FHP(J,IB)*ISGN(I,J))
 4     CONTINUE
 3     CONTINUE
C
       DO 5,J=1,NOB
       DO 6,K=J+1,NOB
       DO 7,IB=1,NUB
        ICOL=INDEXB(J,IB,K)
        IF(ICOL.EQ.0) GO TO 7
        HM(IROW,ICOL)=HM(IROW,ICOL)-VHHHP(J,K,I,IB)
 7     CONTINUE
 6     CONTINUE
 5     CONTINUE
C
 1    CONTINUE
C
      RETURN
      END
C
C
C*MODULE EAIPCC  *DECK IPDFILL2
      SUBROUTINE IPDFILL2(NOB,NUB,FPP,FHH,VHHHP,VHPHP,VHHHH,HM,INDEX1,
     *                     INDEXB,IDIM)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
C
      DIMENSION FPP(NUB,NUB),FHH(NOB,NOB),VHHHH(NOB,NOB,NOB,NOB)
      DIMENSION VHHHP(NOB,NOB,NOB,NUB),VHPHP(NUB,NOB,NUB,NOB)
      DIMENSION HM(IDIM,IDIM),INDEX1(NOB),INDEXB(NOB,NUB,NOB)
C
      CALL RDTAB(NOB,NOB,NOB,NUB,VHHHP,11,NFT891)
      CALL RDTAB(NOB,NOB,NOB,NOB,VHHHH,8,NFT891)
      CALL RDTAB2(NUB,NUB,FPP,2,NFT891)
      CALL RDTAB(NUB,NOB,NUB,NOB,VHPHP,2,NFT892)
C
      DO 1,I=1,NOB
      DO 2,J=I+1,NOB
      DO 3,IB=1,NUB
       IROW=INDEXB(I,IB,J)
       IF(IROW.EQ.0) GO TO 3
C
       DO 4,K=1,NOB
        ICOL=INDEX1(K)
        IF(ICOL.EQ.0) GO TO 20
        HM(IROW,ICOL)=HM(IROW,ICOL)-VHHHP(I,J,K,IB)
 20     ICOL=INDEXB(I,IB,K)
        IF(ICOL.EQ.0) GO TO 21
        HM(IROW,ICOL)=HM(IROW,ICOL)+(FHH(J,K)*ISGN(I,K))
 21     ICOL=INDEXB(J,IB,K)
        IF(ICOL.EQ.0) GO TO 4
        HM(IROW,ICOL)=HM(IROW,ICOL)-(FHH(I,K)*ISGN(J,K))
 4     CONTINUE
C
       DO 14,K=1,NOB
       DO 15,L=K+1,NOB
        ICOL=INDEXB(K,IB,L)
        IF(ICOL.EQ.0) GO TO 15
        HM(IROW,ICOL)=HM(IROW,ICOL)+VHHHH(I,J,K,L)
 15    CONTINUE
 14    CONTINUE
C
       DO 5,IC=1,NUB
        ICOL=INDEXB(I,IC,J)
        IF(ICOL.EQ.0) GO TO 5
        HM(IROW,ICOL)=HM(IROW,ICOL)+FPP(IC,IB)
 5     CONTINUE
C
       DO 6,K=1,NOB
       DO 7,IC=1,NUB
        ICOL=INDEXB(I,IC,K)
        IF(ICOL.EQ.0) GO TO 22
        HM(IROW,ICOL)=HM(IROW,ICOL)+(VHPHP(IB,J,IC,K)*ISGN(I,K))
 22     ICOL=INDEXB(J,IC,K)
        IF(ICOL.EQ.0) GO TO 7
        HM(IROW,ICOL)=HM(IROW,ICOL)-(VHPHP(IB,I,IC,K)*ISGN(J,K))
 7     CONTINUE
 6     CONTINUE
C
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPDFILL3
      SUBROUTINE IPDFILL3(NOA,NUA,NOB,NUB,FHP,VHHHP,VHPHP,HM,INDEX1,
     *                    INDEXA,INDEXB,IDIM)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
C
      DIMENSION FHP(NOA,NUA),VHHHP(NOA,NOB,NUA,NOB)
      DIMENSION VHPHP(NUB,NOB,NUA,NOA),HM(IDIM,IDIM)
      DIMENSION INDEX1(NOB),INDEXA(NOB,NUA,NOA),INDEXB(NOB,NUB,NOB)
C
      CALL RDTAB2(NOA,NUA,FHP,5,NFT891)
      CALL RDTAB(NOA,NOB,NUA,NOB,VHHHP,17,NFT891)
C
      DO 1,I=1,NOB
       IROW=INDEX1(I)
       IF(IROW.EQ.0) GO TO 1
C
       DO 2,K=1,NOA
       DO 3,IB=1,NUA
        ICOL=INDEXA(I,IB,K)
        IF(ICOL.EQ.0) GO TO 3
        HM(IROW,ICOL)=HM(IROW,ICOL)+FHP(K,IB)
 3     CONTINUE
 2     CONTINUE
C
       DO 4,J=1,NOB
       DO 5,IB=1,NUA
       DO 6,K=1,NOA
        ICOL=INDEXA(J,IB,K)
        IF(ICOL.EQ.0) GO TO 6
        HM(IROW,ICOL)=HM(IROW,ICOL)-VHHHP(K,J,IB,I)
 6     CONTINUE
 5     CONTINUE
 4     CONTINUE
C
 1    CONTINUE
      CALL RDTAB(NUB,NOB,NUA,NOA,VHPHP,6,NFT892)
C
      DO 10,I=1,NOB
      DO 11,J=I+1,NOB
      DO 12,IB=1,NUB
       IROW=INDEXB(I,IB,J)
       IF(IROW.EQ.0) GO TO 12
       DO 13,K=1,NOA
       DO 14,IC=1,NUA
        ICOL=INDEXA(I,IC,K)
        IF(ICOL.EQ.0) GO TO 20
        HM(IROW,ICOL)=HM(IROW,ICOL)-VHPHP(IB,J,IC,K)
 20     ICOL=INDEXA(J,IC,K)
        IF(ICOL.EQ.0) GO TO 14
        HM(IROW,ICOL)=HM(IROW,ICOL)+VHPHP(IB,I,IC,K)
 14    CONTINUE
 13    CONTINUE
 12   CONTINUE
 11   CONTINUE
 10   CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPDFILL4
      SUBROUTINE IPDFILL4(NOA,NUA,NOB,NUB,VHPHP,VHHHP,HM,INDEX1,
     *                    INDEXA,INDEXB,IDIM)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
C
      DIMENSION VHPHP(NUB,NOB,NOA,NUA),HM(IDIM,IDIM)
      DIMENSION INDEXA(NOB,NUA,NOA),INDEXB(NOB,NUB,NOB)
      DIMENSION VHHHP(NOA,NOB,NUA,NOB),INDEX1(NOB)
C
      CALL RDTAB(NUB,NOB,NOA,NUA,VHPHP,5,NFT892)
      CALL RDTAB(NOA,NOB,NUA,NOB,VHHHP,13,NFT891)
C
      DO 1,I=1,NOB
      DO 2,J=1,NOA
      DO 3,IB=1,NUA
       IROW=INDEXA(I,IB,J)
       IF(IROW.EQ.0) GO TO 3
       DO 4,K=1,NOB
       DO 5,IC=1,NUB
        ICOL=INDEXB(I,IC,K)
        IF(ICOL.EQ.0) GO TO 5
        HM(IROW,ICOL)=HM(IROW,ICOL)+(VHPHP(IC,K,J,IB)*ISGN(I,K))
 5     CONTINUE
 4     CONTINUE
C
       DO 6,K=1,NOB
        ICOL=INDEX1(K)
        IF(ICOL.EQ.0) GO TO 6
        HM(IROW,ICOL)=HM(IROW,ICOL)-VHHHP(J,I,IB,K)
 6     CONTINUE
C
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPDFILL5
      SUBROUTINE IPDFILL5(NOA,NUA,NOB,FPP,FHH,FHHA,VHPHP,VHPHPA,
     *                     VHHHH,HM,INDEXA,IDIM)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      DIMENSION FPP(NUA,NUA),FHH(NOB,NOB),FHHA(NOA,NOA)
      DIMENSION VHPHP(NUA,NOB,NUA,NOB),VHPHPA(NUA,NOA,NUA,NOA)
      DIMENSION VHHHH(NOA,NOB,NOA,NOB),HM(IDIM,IDIM),INDEXA(NOB,NUA,NOA)
C
      CALL RDTAB2(NUA,NUA,FPP,1,NFT891)
      CALL RDTAB2(NOA,NOA,FHHA,3,NFT891)
      CALL RDTAB(NUA,NOB,NUA,NOB,VHPHP,4,NFT892)
      CALL RDTAB(NUA,NOA,NUA,NOA,VHPHPA,1,NFT892)
      CALL RDTAB(NOA,NOB,NOA,NOB,VHHHH,9,NFT891)
C
      DO 1,I=1,NOB
      DO 2,J=1,NOA
      DO 3,IB=1,NUA
       IROW=INDEXA(I,IB,J)
       IF(IROW.EQ.0) GO TO 3
C
       DO 4,K=1,NOA
        ICOL=INDEXA(I,IB,K)
        IF(ICOL.EQ.0) GO TO 4
        HM(IROW,ICOL)=HM(IROW,ICOL)-FHHA(J,K)
 4     CONTINUE
C
       DO 5,K=1,NOB
        ICOL=INDEXA(K,IB,J)
        IF(ICOL.EQ.0) GO TO 5
        HM(IROW,ICOL)=HM(IROW,ICOL)-FHH(I,K)
 5     CONTINUE
C
       DO 6,IC=1,NUA
        ICOL=INDEXA(I,IC,J)
        IF(ICOL.EQ.0) GO TO 6
        HM(IROW,ICOL)=HM(IROW,ICOL)+FPP(IC,IB)
 6     CONTINUE
C
       DO 70,K=1,NOB
       DO 80,L=1,NOA
        ICOL=INDEXA(K,IB,L)
        IF(ICOL.EQ.0) GO TO 80
        HM(IROW,ICOL)=HM(IROW,ICOL)+VHHHH(J,I,L,K)
 80    CONTINUE
 70    CONTINUE
C
       DO 7,IC=1,NUA
       DO 8,K=1,NOB
        ICOL=INDEXA(K,IC,J)
        IF(ICOL.EQ.0) GO TO 8
        HM(IROW,ICOL)=HM(IROW,ICOL)-VHPHP(IB,I,IC,K)
 8     CONTINUE
       DO 9,L=1,NOA
        ICOL=INDEXA(I,IC,L)
        IF(ICOL.EQ.0) GO TO 9
        HM(IROW,ICOL)=HM(IROW,ICOL)-VHPHPA(IB,J,IC,L)
 9     CONTINUE
 7     CONTINUE
C
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPINDEX
      SUBROUTINE IPINDEX(NOA,NUA,NOB,NUB,INDEX1,INDEXA,INDEXB,IPOS,
     *                   IGRSYM,ISKK,ILC1,ILC2,MXUA,MXUB)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      CHARACTER*3 REP
      PARAMETER (MXAO=8192)
      COMMON /EOMSYM/ IG,NRE(4),MC(8,8,4),ISORB(MXAO),REP(8)
      COMMON /EOMPAR/ CVGCI,CVGEOM,GRPEOM,NSTEOM(8),NOACT,NUACT,
     *                MOACTCC(MXAO),MTHTRIP,MTHCI,MTHEOM,MTHINIT,
     *                MAXCI,MAXEOM,MICCI,MICEOM,IROOTCC(2),
     *                IPROPCC,IPROPCCE
      DIMENSION INDEX1(NOB),INDEXA(NOB,NUA,NOA),INDEXB(NOB,NUB,NOB)
C
      IPOS=0
      ILC1=0
      ILC2=0
      DO 41,I=1,NOB
       INDEX1(I)=0
 41   CONTINUE
      DO 1,I=1,NOB
       DO K=1,NRE(IG)
        IPROD=MC(K,ISORB(I),IG)*MC(K,IGRSYM,IG)
        ISFIX=MC(K,ISKK,IG)
        IDIFF=ABS(IPROD-ISFIX)
        IF(IDIFF.GT.0) GO TO 1
       ENDDO
        IPOS=IPOS+1
        INDEX1(I)=IPOS
        ILC1=ILC1+1
 1    CONTINUE
C
      IF(MTHINIT.EQ.1) THEN
      DO 10,I=1,NOB
      DO 11,J=1,NOA
      DO 12,IB=1,NUA
       INDEXA(I,IB,J)=0
 12   CONTINUE
 11   CONTINUE
 10   CONTINUE
C
      DO 14,I=1,NOB
      DO 15,J=1,NOB
      DO 16,IB=1,NUB
       INDEXB(I,IB,J)=0
 16   CONTINUE
 15   CONTINUE
 14   CONTINUE
C
      MXUA=0
      DO 20,I=1,NOB
      DO 21,J=I+1,NOB
      DO 22,IB=1,NUB
       IAX=MOACTCC(I)+MOACTCC(J)+MOACTCC(IB+NOB)
       DO 111,K=1,NRE(IG)
        IPROD=MC(K,ISORB(I),IG)*MC(K,ISORB(J),IG)*
     &        MC(K,ISORB(IB+NOB),IG)*MC(K,IGRSYM,IG)
        ISFIX=MC(K,ISKK,IG)
        IDIFF=ABS(IPROD-ISFIX)
        IF(IDIFF.GT.0) GO TO 22
 111   CONTINUE
       IF(IAX.EQ.3) THEN
        IPOS=IPOS+1
        INDEXB(I,IB,J)=IPOS
        INDEXB(J,IB,I)=IPOS
        ILC2=ILC2+1
        IF(IB.GT.MXUA) MXUA=IB
       END IF
 22    CONTINUE
 21    CONTINUE
 20    CONTINUE
C
      MXUB=0
      DO 30,I=1,NOB
      DO 31,J=1,NOA
      DO 32,IB=1,NUA
       IAX=MOACTCC(I)+MOACTCC(J)+MOACTCC(IB+NOA)
       DO 112,K=1,NRE(IG)
        IPROD=MC(K,ISORB(I),IG)*MC(K,ISORB(J),IG)*
     &        MC(K,ISORB(IB+NOA),IG)*MC(K,IGRSYM,IG)
        ISFIX=MC(K,ISKK,IG)
        IDIFF=ABS(IPROD-ISFIX)
        IF(IDIFF.GT.0) GO TO 32
 112   CONTINUE
       IF(IAX.EQ.3) THEN
        IPOS=IPOS+1
        INDEXA(I,IB,J)=IPOS
        ILC2=ILC2+1
        IF(IB.GT.MXUB) MXUB=IB
       END IF
 32   CONTINUE
 31   CONTINUE
 30   CONTINUE
      END IF
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPORDER
      SUBROUTINE IPORDER(NOA,NOB,NORDER,IROOT,WR,WI,ISPIN,INDEXX,
     *INFO1,IREAL)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      PARAMETER (MXAO=8192)
      COMMON /EOMPAR/ CVGCI,CVGEOM,GRPEOM,NSTEOM(8),NOACT,NUACT,
     *                MOACTCC(MXAO),MTHTRIP,MTHCI,MTHEOM,MTHINIT,
     *                MAXCI,MAXEOM,MICCI,MICEOM,IROOTCC(2),
     *                IPROPCC,IPROPCCE
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      DIMENSION WR(NORDER),WI(NORDER),ISPIN(NORDER),INDEXX(100)
C
      INFO1=0
      TOL=1.0D-10
      DO I=1,100
       INDEXX(I)=0
      ENDDO
      IMAG=0
      IF(IROOT.GT.NORDER) THEN
       WRITE(6,9010)
       INFO1=1
       RETURN
      END IF
      DO 2,I=1,NORDER
       YYY=ABS(WI(I))
       IF(YYY.GT.TOL) THEN
        WR(I)=0.00D+00
        IMAG=IMAG+1
       END IF
 2    CONTINUE
C CHECK SPIN MULTIPLICITY
      IF(NOA.NE.NOB.OR.MTHINIT.EQ.2) GO TO 100
      IF(MULEAIP.EQ.1) THEN
      DO 20,I=1,NORDER
       IF(ISPIN(I).EQ.0) THEN
        WR(I)=0.00D+00
        IMAG=IMAG+1
       END IF
 20   CONTINUE
      ELSE
      DO 21,I=1,NORDER
       IF(ISPIN(I).NE.MULEAIP) THEN
        WR(I)=0.00D+00
        IMAG=IMAG+1
       END IF
 21   CONTINUE
      END IF
 100  CONTINUE
C WR->WI
      DO 10,I=1,NORDER
       WI(I)=WR(I)
 10   CONTINUE
      IREAL=NORDER-IMAG
      IF(IROOT.GT.IREAL) THEN
       WRITE(6,9010)
       INFO1=1
       RETURN
      END IF
      DO 3,I=1,IROOT
       XMIN=1.0D+10
       IMIN=0
       DO 4,J=1,NORDER
        IF(WI(J).EQ.0.0D+00) GO TO 4
        IF(WI(J).LT.XMIN) THEN
         XMIN=WI(J)
         IMIN=J
        END IF
 4     CONTINUE
       INDEXX(I)=IMIN
       WI(IMIN)=0.00D+00
 3     CONTINUE
       RETURN
 9010 FORMAT(1X,'TOO MANY INITIAL VECTORS REQUESTED.')
       END
C
C*MODULE EAIPCC  *DECK IPSPNINT
      SUBROUTINE IPSPNINT(NOA,NUA,NOB,NUB,IDIM,NORDER,INDEX1,
     *                    INDEXA,INDEXB,WR,VR,ISPIN)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION WR(NORDER),VR(IDIM,IDIM),ISPIN(NORDER)
      DIMENSION INDEXA(NOB,NUA,NOA),INDEXB(NOB,NUB,NOB)
      DIMENSION INDEX1(NOB)
      DATA BIGN/10000.0D+00/
C
      TOL=1.0D-10
C
      DO 1,I=1,NORDER
       ISPIN(I)=0
 1    CONTINUE
C
      DO 2,ICOL=1,NORDER
      IF(WR(ICOL).EQ.0.00D+00) GO TO 2
C
      R1MAX=0.00D+00
      DO 10,I=1,NOB
       IROW=INDEX1(I)
       IF(IROW.EQ.0) GO TO 10
       YYY=DABS(VR(IROW,ICOL))
       IF(YYY.GT.R1MAX) THEN
        R1MAX=YYY
       END IF
 10   CONTINUE
      IF(R1MAX.GT.TOL) THEN
       ISPIN(ICOL)=2
       GO TO 2000
      END IF
C
      RAPRV=BIGN
      RBPRV=BIGN
 1000 CONTINUE
C
      R2MAX=0.00D+00
      IMAX=0
      JMAX=0
      IBMAX=0
      DO 30,I=1,NOB
      DO 40,J=I+1,NOB
      DO 50,IB=1,NUB
       IROW=INDEXB(I,IB,J)
       IF(IROW.EQ.0) GO TO 50
       YYY=DABS(VR(IROW,ICOL))
       IF(YYY.GT.R2MAX.AND.YYY.LT.RBPRV) THEN
        R2MAX=YYY
        IMAX=I
        JMAX=J
        IBMAX=IB
       END IF
 50   CONTINUE
 40   CONTINUE
 30   CONTINUE
C
      IROW=INDEXA(IMAX,IBMAX,JMAX)
      IF(IROW.EQ.0) GO TO 1100
      R2B1=DABS(VR(IROW,ICOL))
      IROW=INDEXA(JMAX,IBMAX,IMAX)
      IF(IROW.EQ.0) GO TO 1100
      R2B2=DABS(VR(IROW,ICOL))
      DIFF1=DABS((2.00D+00*R2B1)-R2MAX)
      DIFF2=DABS((2.00D+00*R2B2)-R2MAX)
      IF(DIFF1.LT.TOL.AND.DIFF2.LT.TOL) THEN
       ISPIN(ICOL)=2
       GO TO 2000
      END IF
      DIFF1=DABS(R2B1-R2MAX)
      DIFF2=DABS(R2B2-R2MAX)
      IF(DIFF1.LT.TOL.AND.DIFF2.LT.TOL) THEN
       ISPIN(ICOL)=4
       GO TO 2000
      END IF
C
 1100 CONTINUE
      RBPRV=R2MAX
C
      R2MAX=0.00D+00
      IMAX=0
      IBMAX=0
      JMAX=0
      DO 60,I=1,NOB
      DO 70,J=1,NOA
      DO 80,IB=1,NUA
       IROW=INDEXA(I,IB,J)
       IF(IROW.EQ.0) GO TO 80
       YYY=DABS(VR(IROW,ICOL))
       IF(YYY.GT.R2MAX.AND.YYY.LT.RAPRV) THEN
        R2MAX=YYY
        IMAX=I
        JMAX=J
        IBMAX=IB
       END IF
 80   CONTINUE
 70   CONTINUE
 60   CONTINUE
C
      IF(IMAX.EQ.JMAX) THEN
       ISPIN(ICOL)=2
       GO TO 2000
      END IF
C
      IROW=INDEXA(JMAX,IBMAX,IMAX)
      IF(IROW.EQ.0) GO TO 1200
      R2B2=DABS(VR(IROW,ICOL))
      DIFF=DABS(R2B2-R2MAX)
      IF(DIFF.LT.TOL) THEN
       ISPIN(ICOL)=2
       GO TO 2000
      END IF
C
 1200 CONTINUE
      RAPRV=R2MAX
      IF(RAPRV.GT.1.0D-4.AND.RBPRV.GT.1.0D-4) GO TO 1000
C
 2000 CONTINUE
C
 2    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPSTRINT
      SUBROUTINE IPSTRINT(NOA,NUA,NOB,NUB,IDIM,INDEX1,INDEXA,
     *                    INDEXB,VR,TRANS,IROOT,JROOT,INDEXX,
     *                    IPREV,IPREVB,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      PARAMETER (MXAO=8192)
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /EOMPAR/ CVGCI,CVGEOM,GRPEOM,NSTEOM(8),NOACT,NUACT,
     *                MOACTCC(MXAO),MTHTRIP,MTHCI,MTHEOM,MTHINIT,
     *                MAXCI,MAXEOM,MICCI,MICEOM,IROOTCC(2),
     *                IPROPCC,IPROPCCE
      COMMON /WFNOPT/ SCFTYP,VBTYP,DFTYPE,TDDFTYP,CITYP,CCTYP,
     *                MPLEVL,MPCTYP
      COMMON /EAREST/ MREST(500)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      DATA EOMIP2,EOMIP3A       /8HIP-EOM2 ,8HIP-EOM3A/
C
      DIMENSION INDEX1(NOB),VR(IDIM,IDIM)
      DIMENSION TRANS(NOB+NOB2UB+NOABUA)
      DIMENSION INDEXX(*)
C
      DO 1,IR=1,IROOT
      IF(IR.GT.JROOT) THEN
       ICOL=INDEXX(IR)
       CALL ZEROMA(TRANS,1,NOB+NOB2UB+NOABUA)
C
       IF(MTHINIT.EQ.2) THEN
        CALL IPWRTINTS(NOB,IDIM,INDEX1,VR,TRANS(1),ICOL)
       ELSE
        CALL IPWRTINT1(NOB,IDIM,INDEX1,VR,TRANS(1),ICOL)
        CALL IPWRTINTB(NOB,NUB,IDIM,INDEXB,VR,TRANS(1+NOB),ICOL)
        CALL IPWRTINTA(NOB,NOA,NUA,IDIM,INDEXA,VR,
     *                TRANS(1+NOB+NOB2UB),ICOL)
       END IF
       IRES=0
C
      ELSE
       IF(CCTYP.EQ.EOMIP2) THEN
        JREC=3*(IPREVB+IR-1)
       ELSE
        JREC=((6*NACTB)+(4*NACTA)+3)*(IPREVB+IR-1)
       END IF
       JREC=JREC+6
       CALL RDTAB1(NOB,TRANS(1),(JREC+1),NFT825)
       CALL RDTAB3(NOB,NUB,NOB,TRANS(1+NOB),(JREC+2),NFT825)
       CALL RDTAB3(NOB,NUA,NOA,TRANS(1+NOB+NOB2UB),(JREC+3),NFT825)
       IRES=1
       IF(CCTYP.EQ.EOMIP3A) THEN
        LREC1=NACTB
        LREC2=LREC1+NACTB
        LREC3=LREC2+NACTA
        LREC4=LREC3+NACTB
        JREC3=JREC+3
        J2REC=((6*NACTB)+(4*NACTA)+3)*(IPREV+IR-1)
        J2REC=J2REC+6
        J2REC3=J2REC+3
        DO 10,I=1,NACTA
         IF(I.LE.NACTB) THEN
         CALL RDTAB(NOB,NUB,NUB,NOB,R3,(JREC3+I),NFT825)
         CALL WRTAB(NOB,NUB,NUB,NOB,R3,(J2REC3+I),99)
         CALL RDTAB(NOB,NUB,NUA,NOA,R3,(JREC3+LREC1+I),NFT825)
         CALL WRTAB(NOB,NUB,NUA,NOA,R3,(J2REC3+LREC1+I),99)
         CALL RDTAB(NOA,NUA,NUA,NOA,R3,(JREC3+LREC3+I),NFT825)
         CALL WRTAB(NOA,NUA,NUA,NOA,R3,(J2REC3+LREC3+I),99)
         END IF
         CALL RDTAB(NOB,NUB,NUA,NOB,R3,(JREC3+LREC2+I),NFT825)
         CALL WRTAB(NOB,NUB,NUA,NOB,R3,(J2REC3+LREC2+I),99)
         CALL RDTAB(NOB,NUA,NUA,NOA,R3,(JREC3+LREC4+I),NFT825)
         CALL WRTAB(NOB,NUA,NUA,NOA,R3,(J2REC3+LREC4+I),99)
 10    CONTINUE
      END IF
C
      END IF
C
      IRECX=IR+IPREV
      CALL WEAINIT(IRECX,NOB+NOB2UB+NOABUA,TRANS)
      MREST(IRECX)=IRES
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPWRTINTS
      SUBROUTINE IPWRTINTS(NO,IDIM,INDEX1,VR,R1,ICOL)
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      DIMENSION VR(IDIM,IDIM),INDEX1(NO),R1(NO)
C
      DO 1,I=1,NO
       IPOS=INDEX1(I)
       IF(IPOS.EQ.0) GO TO 1
       IF(DABS(1.0D+00-VR(IPOS,ICOL)).LT.0.1D-10) THEN
       R1(I)=0.95D+00
       ELSE IF(DABS(-1.00D+00-VR(IPOS,ICOL)).LT.0.1D-10) THEN
       R1(I)=-0.95D+00
       ELSE
       R1(I)=VR(IPOS,ICOL)
       END IF
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPWRTINT1
      SUBROUTINE IPWRTINT1(NO,IDIM,INDEX1,VR,R1,ICOL)
      IMPLICIT DOUBLE PRECISION(A-H,O-Z)
      DIMENSION VR(IDIM,IDIM),INDEX1(NO),R1(NO)
C
      DO 1,I=1,NO
       IPOS=INDEX1(I)
       IF(IPOS.EQ.0) GO TO 1
       R1(I)=VR(IPOS,ICOL)
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPWRTINTB
      SUBROUTINE IPWRTINTB(NO,NU,IDIM,INDEXB,VR,R2,ICOL)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION VR(IDIM,IDIM),INDEXB(NO,NU,NO)
      DIMENSION R2(NO,NU,NO)
C
      DO 1,I=1,NO
      DO 2,J=1,NO
      DO 3,IB=1,NU
       IPOS=INDEXB(I,IB,J)
       IF(IPOS.EQ.0) GO TO 3
       R2(I,IB,J)=VR(IPOS,ICOL)*ISGN(J,I)
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPWRTINTA
      SUBROUTINE IPWRTINTA(NOB,NOA,NUA,IDIM,INDEXA,VR,
     *                     R2,ICOL)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION VR(IDIM,IDIM),INDEXA(NOB,NUA,NOA)
      DIMENSION R2(NOB,NUA,NOA)
C
      DO 1,I=1,NOB
      DO 2,J=1,NOA
      DO 3,IB=1,NUA
       IPOS=INDEXA(I,IB,J)
       IF(IPOS.EQ.0) GO TO 3
       R2(I,IB,J)=VR(IPOS,ICOL)
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK PRNTIR1
      SUBROUTINE PRNTIR1(NO,R1)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /IOFILE/ IR,IW,IP,IJK,IJKT,IDAF,NAV,IODA(950)
      COMMON /CCOPIN/ IOPCCREF,IOPCCMET,NOPCCFC,MULOPCC,
     *                KMICRO,KREST,LMICRO,LREST
      DIMENSION R1(NO)
C
      TOL=0.05D+00
C      TOL=0.0D+00
      DO 2,I=1,NO
       XXX=R1(I)
       IF(DABS(XXX).GT.TOL) THEN
        WRITE(IW,101)XXX,I+NOPCCFC
        CALL FLSHBF(IW)
       END IF
 2    CONTINUE
      RETURN
 101  FORMAT(4X,'R(1H)=',1X,F14.10,1X,'FOR IB=',I4)
      END
C
C*MODULE EAIPCC  *DECK PRNTIR2B
      SUBROUTINE PRNTIR2B(NO,NU,R2)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /IOFILE/ IR,IW,IP,IJK,IJKT,IDAF,NAV,IODA(950)
      COMMON /CCOPIN/ IOPCCREF,IOPCCMET,NOPCCFC,MULOPCC,
     *                KMICRO,KREST,LMICRO,LREST
      DIMENSION R2(NO,NU,NO)
C
      TOL=0.05D+00
C      TOL=0.0D+00
      DO 1,I=1,NO
      DO 2,J=I+1,NO
      DO 3,IB=1,NU
       XXX=R2(I,IB,J)
       IF(DABS(XXX).GT.TOL) THEN
        WRITE(IW,101)XXX,I+NOPCCFC,J+NOPCCFC,
     *                IB+NOPCCFC+NO
        CALL FLSHBF(IW)
       END IF
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
      RETURN
 101  FORMAT(1X,'R(2H-1P)=',1X,F14.10,1X,'FOR IB, JB -> BB =',3I4)
      END
C
C
C*MODULE EAIPCC  *DECK PRNTIR2A
      SUBROUTINE PRNTIR2A(NOA,NUA,NOB,R2)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /IOFILE/ IR,IW,IP,IJK,IJKT,IDAF,NAV,IODA(950)
      COMMON /CCOPIN/ IOPCCREF,IOPCCMET,NOPCCFC,MULOPCC,
     *                KMICRO,KREST,LMICRO,LREST
      DIMENSION R2(NOB,NUA,NOA)
C
      TOL=0.05D+00
C      TOL=0.0D+00
      DO 1,I=1,NOB
      DO 2,J=1,NOA
      DO 3,IB=1,NUA
       XXX=R2(I,IB,J)
       IF(DABS(XXX).GT.TOL) THEN
        WRITE(IW,101)XXX,I+NOPCCFC,J+NOPCCFC,
     *               IB+NOPCCFC+NOA
        CALL FLSHBF(IW)
       END IF
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
      RETURN
 101  FORMAT(1X,'R(2H-1P)=',1X,F14.10,1X,'FOR IB, JA -> BA =',3I4)
      END
C
C-----------------JRG: NEW ADDITIONS FOR IP-EOMCCSDt---------------
C*MODULE EAIPCC  *DECK IP3ASOLSR
      SUBROUTINE IP3ASOLSR(BESTEOM,NOA,NUA,NOB,NUB,DPPA,DPPB,DHHA,DHHB,
     *                     FPPA,FPPB,FHPA,FHPB,FHHA,FHHB,VHPPP1,
     *                     VHPPP2,TI,VPPP,VHPHP1,VHPHP2,VHPHP3,
     *                     VHPHP4,VHPHP5,VHPHP6,VHHHP1,VHHHP2,
     *                     VHHHP3,VHHHH1,VHHHH2,VHHHH3,
     *                     T2,T2B,OPB,OHHHB,OHHHA,OHPPB,OHPPA,
     *                     OHPA2,OHHA2,OPHH,OPHH2,VEC1,VEC2,R3,R3B,HR3,
     *                     HM,HMAUX,WR,WI,VR,WORK,AUX,ENGMAT,SYM,
     *                     ISPIN,ICON,IRB,IRA,NROOT)
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
C
      LOGICAL CNVR
C
      CHARACTER*3 SYM,REP
      CHARACTER*1 SMALLT
C
      PARAMETER (MXAO=8192)
C
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /CCENGY/ ENRG,EREF,EMP2,ECCN,ETOT(6),ECORR(6),
     *                DIAGS(3),AMPMX(5,2),IAMPMX(5,4,2),XO1,XO2,
     *                DIFMAX,DIFFENG,ITER,CNVR
      COMMON /IOFILE/ IR,IW,IP,IJK,IJKT,IDAF,NAV,IODA(950)
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EOMPAR/ CVGCI,CVGEOM,GRPEOM,NSTEOM(8),NOACT,NUACT,
     *                MOACTCC(MXAO),MTHTRIP,MTHCI,MTHEOM,MTHINIT,
     *                MAXCI,MAXEOM,MICCI,MICEOM,IROOTCC(2),
     *                IPROPCC,IPROPCCE
      COMMON /EOMSYM/ IG,NRE(4),MC(8,8,4),ISORB(MXAO),REP(8)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      COMMON /EAREST/ MREST(500)
C
      DIMENSION FPPA(1),FPPB(1),FHPA(1),FHPB(1),FHHA(1),FHHB(1)
      DIMENSION VHPPP1(1),VHPPP2(1),VPPP(1),T2(1)
      DIMENSION VHPHP1(1),VHPHP2(1),VHPHP3(1),VHPHP4(1),TI(1)
      DIMENSION VHHHP1(1),VHHHP2(1),VHHHP3(1)
      DIMENSION VHHHH1(1),VHHHH2(1),VHHHH3(1)
      DIMENSION VHPHP5(1),VHPHP6(1)
      DIMENSION OHHHB(1),OHHHA(1),OPB(1),OPHH(1)
      DIMENSION OHPPB(1),OHPPA(1),OHHA2(1),OPHH2(1)
      DIMENSION VEC1(1),VEC2(1),HM(1),HMAUX(1),AUX(1)
      DIMENSION R3(1),HR3(1),T2B(1)
      DIMENSION WR(1),WI(1),VR(1),WORK(1)
      DIMENSION DPPA(NUA,NUA),DPPB(NUB,NUB)
      DIMENSION DHHA(NOA,NOA),DHHB(NOB,NOB)
      DIMENSION ENGMAT(NROOT),SYM(NROOT),ISPIN(NROOT),ICON(NROOT)
      DIMENSION JSTATE(9),IRB(NACTB),IRA(NACTA)
C
      DATA ONE/1.00D+00/
C
      SMALLT=CHAR(116)
      TOL=CVGEOM
C
      ISPACE=MAXEOM
      ISPACE2=ISPACE*ISPACE
      NOUP=NOB+NOB2UB+NOABUA
      LREC1=NACTB
      LREC2=LREC1+NACTB
      LREC3=LREC2+NACTA
      LREC4=LREC3+NACTB
      IHREC=LREC4+NACTA
      NOABUA2=NOABUA*NUA
      NOB2UAB=NOB2UA*NUB
C
      CALL ZEROMA(ENGMAT,1,NROOT)
      CALL VICLR(ICON,1,NROOT)
C
      CALL RDTAB2(NUA,NUA,DPPA,1,NFT891)
      CALL RDTAB2(NUB,NUB,DPPB,2,NFT891)
      CALL RDTAB2(NOA,NOA,DHHA,3,NFT891)
      CALL RDTAB2(NOB,NOB,DHHB,4,NFT891)
C
      CALL VICLR(JSTATE,1,9)
      JSTATE(1)=MULEAIP
      WRITE(NFT825,REC=6)JSTATE
C
      DO 51,I=1,NACTA
      IF(I.LE.NACTB) THEN
       IRB(I)=NOB-NACTB+I
      END IF
      IRA(I)=NOA-NACTA+I
 51   CONTINUE
C
      DO 1,IROOT=1,NROOT
      WRITE(IW,301) SMALLT,IROOT
      CALL FLSHBF(IW)
      CALL ZEROMA(HM,1,ISPACE2)
      CALL ZEROMA(HMAUX,1,ISPACE2)
      CALL ZEROMA(VEC1,1,NOUP)
      CALL ZEROMA(VEC2,1,NOUP)
      CALL REAINIT(IROOT,NOUP,VEC1)
C
      CALL DCOPY(NOUP,VEC1,1,VEC2,1)
      XNORM=DDOT(NOUP,VEC1,1,VEC2,1)
      JROOT=((6*NACTB)+(4*NACTA)+3)*(IROOT-1)
      JROOT=JROOT+6
      JROOT3=JROOT+3
      IF(MREST(IROOT).EQ.1) THEN
      DO 10,I=1,NACTA
       IF(I.LE.NACTB) THEN
       CALL RDTAB(NOB,NUB,NUB,NOB,R3,(JROOT3+I),99)
       CALL DCOPY(NOB2UB2,R3,1,HR3,1)
       YYY=DDOT(NOB2UB2,R3,1,HR3,1)
       XNORM=XNORM+YYY
       CALL RDTAB(NOB,NUB,NUA,NOA,R3,(JROOT3+LREC1+I),99)
       CALL DCOPY(NO2U2AB,R3,1,HR3,1)
       YYY=DDOT(NO2U2AB,R3,1,HR3,1)
       XNORM=XNORM+YYY
       CALL RDTAB(NOA,NUA,NUA,NOA,R3,(JROOT3+LREC3+I),99)
       CALL DCOPY(NOA2UA2,R3,1,HR3,1)
       YYY=DDOT(NOA2UA2,R3,1,HR3,1)
       XNORM=XNORM+YYY
       END IF
       CALL RDTAB(NOB,NUB,NUA,NOB,R3,(JROOT3+LREC2+I),99)
       CALL DCOPY(NOB2UAB,R3,1,HR3,1)
       YYY=DDOT(NOB2UAB,R3,1,HR3,1)
       XNORM=XNORM+YYY
       CALL RDTAB(NOB,NUA,NUA,NOA,R3,(JROOT3+LREC4+I),99)
       CALL DCOPY(NOABUA2,R3,1,HR3,1)
       YYY=DDOT(NOABUA2,R3,1,HR3,1)
       XNORM=XNORM+YYY
 10   CONTINUE
      XNORM=ONE/DSQRT(XNORM)
      CALL DSCAL(NOUP,XNORM,VEC1(1),1)
      CALL WRTAB1(NOB,VEC1(1),1,96)
      CALL WRTAB3(NOB,NUB,NOB,VEC1(1+NOB),2,96)
      CALL WRTAB3(NOB,NUA,NOA,VEC1(1+NOB+NOB2UB),3,96)
      DO 11,I=1,NACTA
       IF(I.LE.NACTB) THEN
       CALL RDTAB(NOB,NUB,NUB,NOB,R3,(JROOT3+I),99)
       CALL DSCAL(NOB2UB2,XNORM,R3,1)
       CALL WRTAB(NOB,NUB,NUB,NOB,R3,I,98)
       CALL RDTAB(NOB,NUB,NUA,NOA,R3,(JROOT3+LREC1+I),99)
       CALL DSCAL(NO2U2AB,XNORM,R3,1)
       CALL WRTAB(NOB,NUB,NUA,NOA,R3,(LREC1+I),98)
       CALL RDTAB(NOA,NUA,NUA,NOA,R3,(JROOT3+LREC3+I),99)
       CALL DSCAL(NOA2UA2,XNORM,R3,1)
       CALL WRTAB(NOA,NUA,NUA,NOA,R3,(LREC3+I),98)
       END IF
       CALL RDTAB(NOB,NUB,NUA,NOB,R3,(JROOT3+LREC2+I),99)
       CALL DSCAL(NOB2UAB,XNORM,R3,1)
       CALL WRTAB(NOB,NUB,NUA,NOB,R3,(LREC2+I),98)
       CALL RDTAB(NOB,NUA,NUA,NOA,R3,(JROOT3+LREC4+I),99)
       CALL DSCAL(NOABUA2,XNORM,R3,1)
       CALL WRTAB(NOB,NUA,NUA,NOA,R3,(LREC4+I),98)
 11   CONTINUE
      ELSE
      XNORM=ONE/DSQRT(XNORM)
      CALL DSCAL(NOUP,XNORM,VEC1(1),1)
      CALL WRTAB1(NOB,VEC1(1),1,96)
      CALL WRTAB3(NOB,NUB,NOB,VEC1(1+NOB),2,96)
      CALL WRTAB3(NOB,NUA,NOA,VEC1(1+NOB+NOB2UB),3,96)
      CALL ZEROMA(R3,1,NO2U2)
      DO 20,I=1,NACTA
       IF(I.LE.NACTB) THEN
       CALL WRTAB(NOB,NUB,NUB,NOB,R3,I,98)
       CALL WRTAB(NOB,NUB,NUA,NOA,R3,(LREC1+I),98)
       CALL WRTAB(NOA,NUA,NUA,NOA,R3,(LREC3+I),98)
       END IF
       CALL WRTAB(NOB,NUB,NUA,NOB,R3,(LREC2+I),98)
       CALL WRTAB(NOB,NUA,NUA,NOA,R3,(LREC4+I),98)
 20   CONTINUE
      END IF
C
      DO 2,ITER=1,MAXEOM
C
C     ---------- GENERATING HR (R TAKEN FROM ITSPACE) -------------
      IREC=6*(ITER-1)
      I3REC=((6*NACTB)+(4*NACTA))*(ITER-1)
      CALL RDTAB1(NOB,VEC1(1),(IREC+1),96)
      CALL RDTAB3(NOB,NUB,NOB,VEC1(1+NOB),(IREC+2),96)
      CALL RDTAB3(NOB,NUA,NOA,VEC1(1+NOB+NOB2UB),(IREC+3),96)
      CALL HR2H1P(NOA,NUA,NOB,NUB,VEC1(1),VEC2(1),VEC1(1+NOB),
     *            VEC1(1+NOB+NOB2UB),VEC2(1+NOB),VEC2(1+NOB+NOB2UB),
     *            FPPA,FHPA,FHHA,VHHHP1,VHHHH1,VHPHP1,T2,OPB,TI)
      CALL RDTAB1(NOB,VEC1(1),(IREC+1),96)
      CALL RDTAB3(NOB,NUB,NOB,VEC1(1+NOB),(IREC+2),96)
      CALL RDTAB3(NOB,NUA,NOA,VEC1(1+NOB+NOB2UB),(IREC+3),96)
      CALL HR3H2PA(NOA,NUA,NOB,NUB,VEC1(1),VEC2(1),VEC1(1+NOB),
     *            VEC1(1+NOB+NOB2UB),VEC2(1+NOB),VEC2(1+NOB+NOB2UB),
     *            R3,R3B,HR3,FPPA,FPPB,FHPA,FHPB,FHHA,FHHB,VHPPP1,
     *            VHPPP2,VPPP,VHPHP1,VHPHP2,VHPHP3,VHPHP4,VHPHP5,
     *            VHPHP6,VHHHP1,VHHHP2,VHHHP3,
     *            VHHHH1,VHHHH2,VHHHH3,T2,T2B,OHHHB,OHHHA,
     *            OHPPB,OHPPA,OHPA2,OHHA2,OPHH,OPHH2,TI,IRB,IRA,I3REC)
C
      CALL ZEROMA(VEC1(1+NOB),1,NO2U)
      CALL ASYMIP2(VEC2(1+NOB),NOB,NUB,VEC1(1+NOB))
      CALL WRTAB1(NOB,VEC2(1),(IREC+4),96)
      CALL WRTAB3(NOB,NUB,NOB,VEC2(1+NOB),(IREC+5),96)
      CALL WRTAB3(NOB,NUA,NOA,VEC2(1+NOB+NOB2UB),(IREC+6),96)
C     ------------------ FORMING SMALL MATRIX -------------------
      CALL IPSMLMAA(NOA,NUA,NOB,NUB,ISPACE,ITER,HM,HMAUX,
     *              VEC1,VEC2,R3,HR3,NOUP,IREC,I3REC)
C
C     ------------- PICKING UP THE BEST EIGENVECTOR ------------
      CALL IPSELVEC(ISPACE,ITER,HM,WR,WI,VR,WORK,XENE)
C
C     ---- FORMING OPTIMUM COMBINATION OF VECTORS FROM ITSPACE ON VEC1 ----
      ISN=1   !READING FROM ITSPACE
      CALL IPCOMB(NOA,NUA,NOB,NUB,ISPACE,ITER,WI,VEC1,VEC2,ISN,NOUP)
      JROOT=((6*NACTB)+(4*NACTA)+3)*(IROOT-1)
      JROOT=JROOT+6
      JROOT3=JROOT+3
      CALL WRTAB1(NOB,VEC1(1),(JROOT+1),NFT825)
      CALL WRTAB3(NOB,NUB,NOB,VEC1(1+NOB),(JROOT+2),NFT825)
      CALL WRTAB3(NOB,NUA,NOA,VEC1(1+NOB+NOB2UB),(JROOT+3),NFT825)
      IF(ITER.EQ.1) THEN
       CALL FIXGRSYM(NOA,NOB,IGRSYM)
       CALL IPSYM(NOA,NUA,NOB,NUB,VEC1(1),VEC1(1+NOB),
     *            VEC1(1+NOB+NOB2UB),SYM(IROOT),NSYM,IGRSYM)
       JSTATE(NSYM+1)=JSTATE(NSYM+1)+1
       WRITE(NFT825,REC=6)JSTATE
      END IF
C
C     ---- FORMING OPTIMAL COMBINATION OF VECTORS FROM HR ON VEC2 ------
      ISN=2   !READING FROM HR
      CALL IPCOMB(NOA,NUA,NOB,NUB,ISPACE,ITER,WI,VEC2,AUX,ISN,NOUP)
C
C     ---------------- FORMING THE CORRECTION ON AUX ------------------
      CALL ZEROMA(AUX,1,NOUP)
      CALL DCOPY(NOUP,VEC2(1),1,AUX(1),1)
      CALL DAXPY(NOUP,-XENE,VEC1(1),1,AUX(1),1)
      INTREC=((6*NACTB)+(4*NACTA))*ITER
      CALL IPCOMBA(NOA,NOB,NUA,NUB,ISPACE,ITER,INTREC,JROOT3,
     *             XENE,WI,R3,HR3,T2)
      CALL IPDENA(NOA,NUA,NOB,NUB,IRB,IRA,XENE,DHHA,DHHB,DPPA,DPPB,
     *           AUX(1),AUX(1+NOB),AUX(1+NOB+NOB2UB),R3,INTREC)
C
C     ------------------ CONVERGENCE TEST ---------------------
      CALL NORMVAI(NOA,NOB,NUA,NUB,NOUP,RES,AUX(1),R3,HR3,INTREC)
      WRITE(IW,300) ITER,XENE,RES
      CALL FLSHBF(IW)
      IF(RES.LT.TOL) GO TO 1000
C
C     ----------- ORTHONORMALIZATION OF THE CORRECTION ------------
C      CALL IPORTH(NOA,NUA,NOB,NUB,NOUP,ITER,AUX,VEC1)
      CALL IPORTHA(NOA,NUA,NOB,NUB,NOUP,ITER,INTREC,
     *             AUX,VEC1,R3,HR3)
C
C     -------- WRITING THE CORRECTION TO RECORD NO. ITER+1 ---------
      JREC=6*ITER
      CALL WRTAB1(NOB,AUX(1),(JREC+1),96)
      CALL WRTAB3(NOB,NUB,NOB,AUX(1+NOB),(JREC+2),96)
      CALL WRTAB3(NOB,NUA,NOA,AUX(1+NOB+NOB2UB),(JREC+3),96)
C
 2    CONTINUE
C
C     --------------- LACK OF CONVERGENCE ---------------
      WRITE(IW,302) SMALLT,IROOT
      CALL RDTAB1(NOB,VEC1(1),(JROOT+1),NFT825)
      CALL RDTAB3(NOB,NUB,NOB,VEC1(1+NOB),(JROOT+2),NFT825)
      CALL RDTAB3(NOB,NUA,NOA,VEC1(1+NOB+NOB2UB),(JROOT+3),NFT825)
      CALL IP3NORMA(NOA,NUA,NOB,NUB,JROOT3,VEC1(1),VEC1(1+NOB),
     *              VEC1(1+NOB+NOB2UB),R3,IRB,IRA)
      CALL FIXGRSYM(NOA,NOB,IGRSYM)
      CALL IPSYM(NOA,NUA,NOB,NUB,VEC1(1),VEC1(1+NOB),
     *           VEC1(1+NOB+NOB2UB),SYM(IROOT),NSYM,IGRSYM)
      IF(NOA.EQ.NOB) THEN
       CALL IPSPIN(NOA,NUA,NOB,NUB,VEC1(1),VEC1(1+NOB),
     *             VEC1(1+NOB+NOB2UB),ISPIN(IROOT))
      END IF
      ENGMAT(IROOT)=XENE
      CALL WRTAB1(NOB,VEC1(1),(JROOT+1),NFT825)
      CALL WRTAB3(NOB,NUB,NOB,VEC1(1+NOB),(JROOT+2),NFT825)
      CALL WRTAB3(NOB,NUA,NOA,VEC1(1+NOB+NOB2UB),(JROOT+3),NFT825)
      GO TO 1
C
C     ----------------- CONVERGENCE ---------------------
 1000 CONTINUE
      WRITE(IW,303) SMALLT,IROOT
      WRITE(IW,304) SMALLT,XENE
      ICON(IROOT)=1
      CALL RDTAB1(NOB,VEC1(1),(JROOT+1),NFT825)
      CALL RDTAB3(NOB,NUB,NOB,VEC1(1+NOB),(JROOT+2),NFT825)
      CALL RDTAB3(NOB,NUA,NOA,VEC1(1+NOB+NOB2UB),(JROOT+3),NFT825)
      CALL IP3NORMA(NOA,NUA,NOB,NUB,JROOT3,VEC1(1),VEC1(1+NOB),
     *              VEC1(1+NOB+NOB2UB),R3,IRB,IRA)
      CALL FIXGRSYM(NOA,NOB,IGRSYM)
      CALL IPSYM(NOA,NUA,NOB,NUB,VEC1(1),VEC1(1+NOB),
     *           VEC1(1+NOB+NOB2UB),SYM(IROOT),NSYM,IGRSYM)
      CALL PRNTIR1(NOB,VEC1(1))
      CALL PRNTIR2B(NOB,NUB,VEC1(1+NOB))
      CALL PRNTIR2A(NOA,NUA,NOB,VEC1(1+NOB+NOB2UB))
      CALL PRTIR3BB(NOB,NUB,JROOT3,R3,IRB)
      CALL PRTIR3AA(NOA,NOB,NUA,JROOT3,R3,HR3,IRB,IRA)
      CALL PRTIR3AB(NOA,NOB,NUA,NUB,JROOT3,R3,HR3,IRB)
C
      IF(NOA.EQ.NOB) THEN
       CALL IPSPIN(NOA,NUA,NOB,NUB,VEC1(1),VEC1(1+NOB),
     *             VEC1(1+NOB+NOB2UB),ISPIN(IROOT))
       WRITE(IW,315) SMALLT,IROOT,SYM(IROOT),ISPIN(IROOT),
     *               SMALLT,ENRG+EREF+XENE,XENE
       CALL FLSHBF(IW)
      ELSE
       WRITE(IW,305) SMALLT,IROOT,SYM(IROOT),
     *               SMALLT,ENRG+EREF+XENE,XENE
       CALL FLSHBF(IW)
      END IF
      ENGMAT(IROOT)=XENE
      CALL WRTAB1(NOB,VEC1(1),(JROOT+1),NFT825)
      CALL WRTAB3(NOB,NUB,NOB,VEC1(1+NOB),(JROOT+2),NFT825)
      CALL WRTAB3(NOB,NUA,NOA,VEC1(1+NOB+NOB2UB),(JROOT+3),NFT825)
C
C           print converged (or unconverged) results
C
 1    CONTINUE
      ICHECK=0
      NRTIRRP=0
C
      IF(NOA.EQ.NOB) THEN
         WRITE(IW,316) SMALLT
         DO I=1,NROOT
           IF(SYM(I).EQ.REP(IROOTCC(1))) THEN
             NRTIRRP = NRTIRRP+1
             IF(NRTIRRP.EQ.IROOTCC(2)) BESTEOM = ENRG+EREF+ENGMAT(I)
           END IF
           IF(ICON(I).EQ.1) THEN
             WRITE(IW,317) SYM(I),ISPIN(I),ENGMAT(I),ENRG+EREF+ENGMAT(I)
           ELSE
             WRITE(IW,318) SYM(I),ISPIN(I),ENGMAT(I),ENRG+EREF+ENGMAT(I)
             ICHECK=ICHECK+1
           END IF
         ENDDO
      ELSE
         WRITE(IW,306) SMALLT
         DO I=1,NROOT
           IF(SYM(I).EQ.REP(IROOTCC(1))) THEN
             NRTIRRP = NRTIRRP+1
             IF(NRTIRRP.EQ.IROOTCC(2)) BESTEOM = ENRG+EREF+ENGMAT(I)
           END IF
           IF(ICON(I).EQ.1) THEN
             WRITE(IW,307) SYM(I),ENGMAT(I),ENRG+EREF+ENGMAT(I)
           ELSE
             WRITE(IW,308) SYM(I),ENGMAT(I),ENRG+EREF+ENGMAT(I)
             ICHECK=ICHECK+1
           END IF
         ENDDO
      END IF
      WRITE(IW,309) IROOTCC,BESTEOM
C
      IF(ICHECK.GT.0) THEN
        WRITE(IW,310) SMALLT,ICHECK
        CALL ABRT
        STOP
      END IF
      RETURN
C
 300  FORMAT(1X,'ITERATION:',1X,I3,2X,'IP ENERGY=',1X,F14.10,2X,'CONV:',
     *       1X,F14.9)
 301  FORMAT(/6X,'BEGINNING IP-EOMCCSD',A,' ITERATIONS FOR ROOT NO.',
     *       1X,I3)
 302  FORMAT(/2X,'THE IP-EOMCCSD',A,' ITERATIONS FOR ROOT NO.',1X,I3,
     *       1X,'DID NOT CONVERGE',/)
 303  FORMAT(/2X,'THE IP-EOMCCSD',A,' ITERATIONS FOR ROOT NO.',1X,I3,
     *       1X,'HAVE CONVERGED')
 304  FORMAT(2X,'IP-EOMCCSD',A,' IONIZATION ENERGY:',
     *       1X,F15.10,/)
 305  FORMAT(/8X,'SUMMARY OF IP-EOMCCSD',A,' RESULTS FOR ROOT NO.',
     *       1X,I3,/18X,'THE SYMMETRY OF THE STATE IS',A4,/
     *       1X,'IP-EOMCCSD',A,' E=',F20.10,
     *       2X,'IONIZE E=',F15.10,/)
 306  FORMAT(/7X,'---- SUMMARY OF IP-EOMCCSD',A,' CALCULATIONS ----',/
     *        14X,'IONIZATION',13X,'TOTAL',/
     *        1X,'SYMMETRY',5X,'ENERGY (H)',11X,'ENERGY (H)',9X,
     *        'ITERATIONS')
 307  FORMAT(3X,A4,3X,F15.10,2X,F20.10,7X,'CONVERGED')
 308  FORMAT(3X,A4,3X,F15.10,2X,F20.10,7X,'UNCONVERGED')
 309  FORMAT(/1X,'SELECTING TARGET STATE IROOT=',2I3,
     *           ' AS BEST IP ENERGY',F20.10)
 310  FORMAT(2X,'IP-EOMCCSD',A,' HALTED WITHOUT CONVERGING ALL',
     *        1X,'DESIRED STATES'/
     *        2X,I3,1X,'STATES UNCONVERGED',/)
 315  FORMAT(/8X,'SUMMARY OF IP-EOMCCSD',A,' RESULTS FOR ROOT NO.',
     *       1X,I3,/18X,'THE SYMMETRY OF THE STATE IS',A4,/
     *       14X,'THE SPIN MULTIPLICITY OF THE STATE IS',I2,/
     *       1X,'IP-EOMCCSD',A,' E=',F20.10,
     *       2X,'IONIZE E=',F15.10,/)
 316  FORMAT(/9X,'---- SUMMARY OF IP-EOMCCSD',A,' CALCULATIONS ----',/
     *        9X,'SPIN',6X,'IONIZATION',13X,'TOTAL',/
     *        2X,'SYMM',3X,'MULT',6X,'ENERGY (H)',11X,'ENERGY (H)',7X,
     *        'ITERATIONS')
 317  FORMAT(2X,A4,3X,I2,4X,F15.10,2X,F20.10,5X,'CONVERGED')
 318  FORMAT(2X,A4,3X,I2,4X,F15.10,2X,F20.10,5X,'UNCONVERGED')
      END
C
C*MODULE EAIPCC  *DECK IPSMLMAA
      SUBROUTINE IPSMLMAA(NOA,NUA,NOB,NUB,ISPACE,ITER,HM,
     *                    HMAUX,VEC1,VEC2,R3,HR3,NOUP,
     *                    IREC,I3REC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION HM(ISPACE,ISPACE),HMAUX(ISPACE,ISPACE)
      DIMENSION VEC1(1),VEC2(1),R3(1),HR3(1)
C
      NOABUA2=NOABUA*NUA
      NOB2UAB=NOB2UA*NUB
C
      DO 1,I1=1,ISPACE
      DO 2,I2=1,ISPACE
       HM(I1,I2)=HMAUX(I1,I2)
 2    CONTINUE
 1    CONTINUE
      CALL ZEROMA(VEC1,1,NOUP)
      CALL ZEROMA(VEC2,1,NOUP)
C
C     --------- ITER-TH COLUMN OF HM (VEC2-HR(ITER)) -------------
      CALL RDTAB1(NOB,VEC2(1),(IREC+4),96)
      CALL RDTAB3(NOB,NUB,NOB,VEC2(1+NOB),(IREC+5),96)
      CALL RDTAB3(NOB,NUA,NOA,VEC2(1+NOB+NOB2UB),(IREC+6),96)
      DO 3,J=1,ITER-1
       JREC=6*(J-1)
       CALL RDTAB1(NOB,VEC1(1),(JREC+1),96)
       CALL RDTAB3(NOB,NUB,NOB,VEC1(1+NOB),(JREC+2),96)
       CALL RDTAB3(NOB,NUA,NOA,VEC1(1+NOB+NOB2UB),(JREC+3),96)
       XXX=DDOT(NOUP,VEC2(1),1,VEC1(1),1)
       DO 43,I=1,NACTA
        IF(I.LE.NACTB) THEN
        I3REC2=((6*NACTB)+(4*NACTA))*(J-1)
        CALL RDTAB(NOB,NUB,NUB,NOB,HR3,(I3REC+IHREC+I),98)
        CALL RDTAB(NOB,NUB,NUB,NOB,R3,(I3REC2+I),98)
        YYY=DDOT(NOB2UB2,HR3,1,R3,1)
        XXX=XXX+YYY
        CALL RDTAB(NOB,NUB,NUA,NOA,HR3,(I3REC+IHREC+LREC1+I),98)
        CALL RDTAB(NOB,NUB,NUA,NOA,R3,(I3REC2+LREC1+I),98)
        YYY=DDOT(NO2U2AB,HR3,1,R3,1)
        XXX=XXX+YYY
        CALL RDTAB(NOA,NUA,NUA,NOA,HR3,(I3REC+IHREC+LREC3+I),98)
        CALL RDTAB(NOA,NUA,NUA,NOA,R3,(I3REC2+LREC3+I),98)
        YYY=DDOT(NOA2UA2,HR3,1,R3,1)
        XXX=XXX+YYY
        END IF
        CALL RDTAB(NOB,NUB,NUA,NOB,HR3,(I3REC+IHREC+LREC2+I),98)
        CALL RDTAB(NOB,NUB,NUA,NOB,R3,(I3REC2+LREC2+I),98)
        YYY=DDOT(NOB2UAB,HR3,1,R3,1)
        XXX=XXX+YYY
        CALL RDTAB(NOB,NUA,NUA,NOA,HR3,(I3REC+IHREC+LREC4+I),98)
        CALL RDTAB(NOB,NUA,NUA,NOA,R3,(I3REC2+LREC4+I),98)
        YYY=DDOT(NOABUA2,HR3,1,R3,1)
        XXX=XXX+YYY
 43    CONTINUE
       HM(J,ITER)=XXX
 3    CONTINUE
C
C     --------- ITER-TH ROW OF HM (VEC1-R(ITER) -------------------
      CALL RDTAB1(NOB,VEC1(1),(IREC+1),96)
      CALL RDTAB3(NOB,NUB,NOB,VEC1(1+NOB),(IREC+2),96)
      CALL RDTAB3(NOB,NUA,NOA,VEC1(1+NOB+NOB2UB),(IREC+3),96)
      DO 4,J=1,ITER-1
       JREC=6*(J-1)
       CALL RDTAB1(NOB,VEC2(1),(JREC+4),96)
       CALL RDTAB3(NOB,NUB,NOB,VEC2(1+NOB),(JREC+5),96)
       CALL RDTAB3(NOB,NUA,NOA,VEC2(1+NOB+NOB2UB),(JREC+6),96)
       XXX=DDOT(NOUP,VEC2(1),1,VEC1(1),1)
       DO 44,I=1,NACTA
        IF(I.LE.NACTB) THEN
        I3REC2=((6*NACTB)+(4*NACTA))*(J-1)
        CALL RDTAB(NOB,NUB,NUB,NOB,R3,(I3REC+I),98)
        CALL RDTAB(NOB,NUB,NUB,NOB,HR3,(I3REC2+IHREC+I),98)
        YYY=DDOT(NOB2UB2,HR3,1,R3,1)
        XXX=XXX+YYY
        CALL RDTAB(NOB,NUB,NUA,NOA,R3,(I3REC+LREC1+I),98)
        CALL RDTAB(NOB,NUB,NUA,NOA,HR3,(I3REC2+IHREC+LREC1+I),98)
        YYY=DDOT(NO2U2AB,HR3,1,R3,1)
        XXX=XXX+YYY
        CALL RDTAB(NOA,NUA,NUA,NOA,R3,(I3REC+LREC3+I),98)
        CALL RDTAB(NOA,NUA,NUA,NOA,HR3,(I3REC2+IHREC+LREC3+I),98)
        YYY=DDOT(NOA2UA2,HR3,1,R3,1)
        XXX=XXX+YYY
        END IF
        CALL RDTAB(NOB,NUB,NUA,NOB,R3,(I3REC+LREC2+I),98)
        CALL RDTAB(NOB,NUB,NUA,NOB,HR3,(I3REC2+IHREC+LREC2+I),98)
        YYY=DDOT(NOB2UAB,HR3,1,R3,1)
        XXX=XXX+YYY
        CALL RDTAB(NOB,NUA,NUA,NOA,R3,(I3REC+LREC4+I),98)
        CALL RDTAB(NOB,NUA,NUA,NOA,HR3,(I3REC2+IHREC+LREC4+I),98)
        YYY=DDOT(NOABUA2,HR3,1,R3,1)
        XXX=XXX+YYY
 44    CONTINUE
       HM(ITER,J)=XXX
 4    CONTINUE
C
C     ---------- (ITER,ITER)-DIAGONAL PART OF HM --------------------
      CALL RDTAB1(NOB,VEC1(1),(IREC+1),96)
      CALL RDTAB3(NOB,NUB,NOB,VEC1(1+NOB),(IREC+2),96)
      CALL RDTAB3(NOB,NUA,NOA,VEC1(1+NOB+NOB2UB),(IREC+3),96)
      CALL RDTAB1(NOB,VEC2(1),(IREC+4),96)
      CALL RDTAB3(NOB,NUB,NOB,VEC2(1+NOB),(IREC+5),96)
      CALL RDTAB3(NOB,NUA,NOA,VEC2(1+NOB+NOB2UB),(IREC+6),96)
      XXX=DDOT(NOUP,VEC2(1),1,VEC1(1),1)
      DO 45,I=1,NACTA
       IF(I.LE.NACTB) THEN
       CALL RDTAB(NOB,NUB,NUB,NOB,HR3,(I3REC+IHREC+I),98)
       CALL RDTAB(NOB,NUB,NUB,NOB,R3,(I3REC+I),98)
       YYY=DDOT(NOB2UB2,HR3,1,R3,1)
       XXX=XXX+YYY
       CALL RDTAB(NOB,NUB,NUA,NOA,HR3,(I3REC+IHREC+LREC1+I),98)
       CALL RDTAB(NOB,NUB,NUA,NOA,R3,(I3REC+LREC1+I),98)
       YYY=DDOT(NO2U2AB,HR3,1,R3,1)
       XXX=XXX+YYY
       CALL RDTAB(NOA,NUA,NUA,NOA,HR3,(I3REC+IHREC+LREC3+I),98)
       CALL RDTAB(NOA,NUA,NUA,NOA,R3,(I3REC+LREC3+I),98)
       YYY=DDOT(NOA2UA2,HR3,1,R3,1)
       XXX=XXX+YYY
       END IF
       CALL RDTAB(NOB,NUB,NUA,NOB,HR3,(I3REC+IHREC+LREC2+I),98)
       CALL RDTAB(NOB,NUB,NUA,NOB,R3,(I3REC+LREC2+I),98)
       YYY=DDOT(NOB2UAB,HR3,1,R3,1)
       XXX=XXX+YYY
       CALL RDTAB(NOB,NUA,NUA,NOA,HR3,(I3REC+IHREC+LREC4+I),98)
       CALL RDTAB(NOB,NUA,NUA,NOA,R3,(I3REC+LREC4+I),98)
       YYY=DDOT(NOABUA2,HR3,1,R3,1)
       XXX=XXX+YYY
 45    CONTINUE
       HM(ITER,ITER)=XXX
C
      DO 11,I1=1,ISPACE
      DO 12,I2=1,ISPACE
       HMAUX(I1,I2)=HM(I1,I2)
 12   CONTINUE
 11   CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPCOMBA
      SUBROUTINE IPCOMBA(NOA,NOB,NUA,NUB,ISPACE,ITER,INTREC,JROOT3,
     *                  XENE,WI,R3,HR3,T2)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION WI(ISPACE),R3(1),HR3(1),T2(1)
C
      NOABUA2=NOABUA*NUA
      NOB2UAB=NOB2UA*NUB
C
      DO 42,I=1,NACTA
       CALL ZEROMA(R3,1,NO2U2)
       CALL ZEROMA(T2,1,NO2U2)
       IF(I.LE.NACTB) THEN
       DO 1,J=1,ITER
        I3REC=((6*NACTB)+(4*NACTA))*(J-1)
        XCOMB=WI(J)
        CALL RDTAB(NOB,NUB,NUB,NOB,HR3,(I3REC+I),98)
        CALL DAXPY(NOB2UB2,XCOMB,HR3,1,R3,1)
        CALL RDTAB(NOB,NUB,NUB,NOB,HR3,(I3REC+IHREC+I),98)
        CALL DAXPY(NOB2UB2,XCOMB,HR3,1,T2,1)
 1     CONTINUE
       CALL WRTAB(NOB,NUB,NUB,NOB,R3,(JROOT3+I),NFT825)
       CALL DAXPY(NOB2UB2,-XENE,R3,1,T2,1)
       CALL WRTAB(NOB,NUB,NUB,NOB,T2,(INTREC+IHREC+I),98)
       CALL ZEROMA(R3,1,NO2U2)
       CALL ZEROMA(T2,1,NO2U2)
       DO 2,J=1,ITER
        I3REC=((6*NACTB)+(4*NACTA))*(J-1)
        XCOMB=WI(J)
        CALL RDTAB(NOB,NUB,NUA,NOA,HR3,(I3REC+LREC1+I),98)
        CALL DAXPY(NO2U2AB,XCOMB,HR3,1,R3,1)
        CALL RDTAB(NOB,NUB,NUA,NOA,HR3,(I3REC+IHREC+LREC1+I),98)
        CALL DAXPY(NO2U2AB,XCOMB,HR3,1,T2,1)
 2     CONTINUE
       CALL WRTAB(NOB,NUB,NUA,NOA,R3,(JROOT3+LREC1+I),NFT825)
       CALL DAXPY(NO2U2AB,-XENE,R3,1,T2,1)
       CALL WRTAB(NOB,NUB,NUA,NOA,T2,(INTREC+IHREC+LREC1+I),98)
       CALL ZEROMA(R3,1,NO2U2)
       CALL ZEROMA(T2,1,NO2U2)
       DO 3,J=1,ITER
        I3REC=((6*NACTB)+(4*NACTA))*(J-1)
        XCOMB=WI(J)
        CALL RDTAB(NOA,NUA,NUA,NOA,HR3,(I3REC+LREC3+I),98)
        CALL DAXPY(NOA2UA2,XCOMB,HR3,1,R3,1)
        CALL RDTAB(NOA,NUA,NUA,NOA,HR3,(I3REC+IHREC+LREC3+I),98)
        CALL DAXPY(NOA2UA2,XCOMB,HR3,1,T2,1)
 3     CONTINUE
       CALL WRTAB(NOA,NUA,NUA,NOA,R3,(JROOT3+LREC3+I),NFT825)
       CALL DAXPY(NOA2UA2,-XENE,R3,1,T2,1)
       CALL WRTAB(NOA,NUA,NUA,NOA,T2,(INTREC+IHREC+LREC3+I),98)
       END IF
       CALL ZEROMA(R3,1,NO2U2)
       CALL ZEROMA(T2,1,NO2U2)
       DO 4,J=1,ITER
        I3REC=((6*NACTB)+(4*NACTA))*(J-1)
        XCOMB=WI(J)
        CALL RDTAB(NOB,NUB,NUA,NOB,HR3,(I3REC+LREC2+I),98)
        CALL DAXPY(NOB2UAB,XCOMB,HR3,1,R3,1)
        CALL RDTAB(NOB,NUB,NUA,NOB,HR3,(I3REC+IHREC+LREC2+I),98)
        CALL DAXPY(NOB2UAB,XCOMB,HR3,1,T2,1)
 4     CONTINUE
       CALL WRTAB(NOB,NUB,NUA,NOB,R3,(JROOT3+LREC2+I),NFT825)
       CALL DAXPY(NOB2UAB,-XENE,R3,1,T2,1)
       CALL WRTAB(NOB,NUB,NUA,NOB,T2,(INTREC+IHREC+LREC2+I),98)
       CALL ZEROMA(R3,1,NO2U2)
       CALL ZEROMA(T2,1,NO2U2)
       DO 5,J=1,ITER
        I3REC=((6*NACTB)+(4*NACTA))*(J-1)
        XCOMB=WI(J)
        CALL RDTAB(NOB,NUA,NUA,NOA,HR3,(I3REC+LREC4+I),98)
        CALL DAXPY(NOABUA2,XCOMB,HR3,1,R3,1)
        CALL RDTAB(NOB,NUA,NUA,NOA,HR3,(I3REC+IHREC+LREC4+I),98)
        CALL DAXPY(NOABUA2,XCOMB,HR3,1,T2,1)
 5     CONTINUE
       CALL WRTAB(NOB,NUA,NUA,NOA,R3,(JROOT3+LREC4+I),NFT825)
       CALL DAXPY(NOABUA2,-XENE,R3,1,T2,1)
       CALL WRTAB(NOB,NUA,NUA,NOA,T2,(INTREC+IHREC+LREC4+I),98)
 42   CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPDENA
      SUBROUTINE IPDENA(NOA,NUA,NOB,NUB,IRB,IRA,XENE,DHHA,DHHB,DPPA,
     *                 DPPB,R1,R2B,R2A,R3,INTREC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION DHHA(NOA,NOA),DHHB(NOB,NOB)
      DIMENSION DPPA(NUA,NUA),DPPB(NUB,NUB)
      DIMENSION R1(NOB),R2B(NOB,NUB,NOB),R2A(NOB,NUA,NOA)
      DIMENSION R3(1),IRB(NACTB),IRA(NACTA)
C
      DO 1,I=1,NOB
       XDEN=XENE+DHHB(I,I)
       R1(I)=R1(I)/XDEN
 1    CONTINUE
C
      DO 3,I=1,NOB
      DO 4,J=1,NOB
      DO 5,IB=1,NUB
       XDEN=XENE+DHHB(I,I)+DHHB(J,J)-DPPB(IB,IB)
       R2B(I,IB,J)=R2B(I,IB,J)/XDEN
 5    CONTINUE
 4    CONTINUE
 3    CONTINUE
C
      DO 13,I=1,NOB
      DO 14,J=1,NOA
      DO 15,IB=1,NUA
       XDEN=XENE+DHHB(I,I)+DHHA(J,J)-DPPA(IB,IB)
       R2A(I,IB,J)=R2A(I,IB,J)/XDEN
 15   CONTINUE
 14   CONTINUE
 13   CONTINUE
C
      DO 42,I=1,NACTA
      IF(I.LE.NACTB) THEN
      CALL RDTAB(NOB,NUB,NUB,NOB,R3,(INTREC+IHREC+I),98)
      CALL IPDENR3A(NOB,NUB,NUB,NOB,R3,DHHB,DPPB,DPPB,DHHB,
     *DHHB,XENE,IRB(I),NOB)
      CALL WRTAB(NOB,NUB,NUB,NOB,R3,(INTREC+IHREC+I),98)
C
      CALL RDTAB(NOB,NUB,NUA,NOA,R3,(INTREC+IHREC+LREC1+I),98)
      CALL IPDENR3A(NOB,NUB,NUA,NOA,R3,DHHB,DPPB,DPPA,DHHA,
     *DHHB,XENE,IRB(I),NOB)
      CALL WRTAB(NOB,NUB,NUA,NOA,R3,(INTREC+IHREC+LREC1+I),98)
C
      CALL RDTAB(NOA,NUA,NUA,NOA,R3,(INTREC+IHREC+LREC3+I),98)
      CALL IPDENR3A(NOA,NUA,NUA,NOA,R3,DHHA,DPPA,DPPA,DHHA,
     *DHHB,XENE,IRB(I),NOB)
      CALL WRTAB(NOA,NUA,NUA,NOA,R3,(INTREC+IHREC+LREC3+I),98)
C
      END IF
C
      CALL RDTAB(NOB,NUB,NUA,NOB,R3,(INTREC+IHREC+LREC2+I),98)
      CALL IPDENR3A(NOB,NUB,NUA,NOB,R3,DHHB,DPPB,DPPA,DHHB,
     *DHHA,XENE,IRA(I),NOA)
      CALL WRTAB(NOB,NUB,NUA,NOB,R3,(INTREC+IHREC+LREC2+I),98)
C
      CALL RDTAB(NOB,NUA,NUA,NOA,R3,(INTREC+IHREC+LREC4+I),98)
      CALL IPDENR3A(NOB,NUA,NUA,NOA,R3,DHHB,DPPA,DPPA,DHHA,
     *DHHA,XENE,IRA(I),NOA)
      CALL WRTAB(NOB,NUA,NUA,NOA,R3,(INTREC+IHREC+LREC4+I),98)
C
 42   CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPDENR3A
      SUBROUTINE IPDENR3A(N1,N2,N3,N4,R3,D1,D2,D3,D4,D5,
     *                    XENE,IA,N5)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(N1,N2,N3,N4)
      DIMENSION D1(N1,N1),D2(N2,N2),D3(N3,N3),D4(N4,N4)
      DIMENSION D5(N5,N5)
C
      DO 1,I1=1,N1
      DO 2,I2=1,N2
      DO 3,I3=1,N3
      DO 4,I4=1,N4
       XDEN=XENE+D1(I1,I1)-D2(I2,I2)-D3(I3,I3)+D4(I4,I4)
       XDEN=XDEN+D5(IA,IA)
       R3(I1,I2,I3,I4)=R3(I1,I2,I3,I4)/XDEN
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK NORMVAI
      SUBROUTINE NORMVAI(NOA,NOB,NUA,NUB,NOUP,RES,VEC,R3,HR3,INTREC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION VEC(NOUP),R3(1),HR3(1)
      NOABUA2=NOABUA*NUA
      NOB2UAB=NOB2UA*NUB
      RES=0.0D+00
      DO 1,I=1,NOUP
       RES=RES+VEC(I)*VEC(I)
 1    CONTINUE
      DO 2,I=1,NACTA
      IF(I.LE.NACTB) THEN
      CALL RDTAB(NOB,NUB,NUB,NOB,R3,(INTREC+IHREC+I),98)
      CALL DCOPY(NOB2UB2,R3,1,HR3,1)
      YYY=DDOT(NOB2UB2,R3,1,HR3,1)
      RES=RES+YYY
C
      CALL RDTAB(NOB,NUB,NUA,NOA,R3,(INTREC+IHREC+LREC1+I),98)
      CALL DCOPY(NO2U2AB,R3,1,HR3,1)
      YYY=DDOT(NO2U2AB,R3,1,HR3,1)
      RES=RES+YYY
C
      CALL RDTAB(NOA,NUA,NUA,NOA,R3,(INTREC+IHREC+LREC3+I),98)
      CALL DCOPY(NOA2UA2,R3,1,HR3,1)
      YYY=DDOT(NOA2UA2,R3,1,HR3,1)
      RES=RES+YYY
C
      END IF
C
      CALL RDTAB(NOB,NUB,NUA,NOB,R3,(INTREC+IHREC+LREC2+I),98)
      CALL DCOPY(NOB2UAB,R3,1,HR3,1)
      YYY=DDOT(NOB2UAB,R3,1,HR3,1)
      RES=RES+YYY
C
      CALL RDTAB(NOB,NUA,NUA,NOA,R3,(INTREC+IHREC+LREC4+I),98)
      CALL DCOPY(NOABUA2,R3,1,HR3,1)
      YYY=DDOT(NOABUA2,R3,1,HR3,1)
      RES=RES+YYY
C
 2    CONTINUE
      RES=DSQRT(RES)
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPORTHA
      SUBROUTINE IPORTHA(NOA,NUA,NOB,NUB,NOUP,ITER,INTREC,
     *                   VEC,AUX,R3,HR3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION VEC(1),AUX(1)
      DIMENSION R3(1),HR3(1)
C
      NOABUA2=NOABUA*NUA
      NOB2UAB=NOB2UA*NUB
C
      CALL DCOPY(NOUP,VEC,1,AUX,1)
      XNORM=DDOT(NOUP,VEC,1,AUX,1)
      DO 42,I=1,NACTA
       IF(I.LE.NACTB) THEN
       CALL RDTAB(NOB,NUB,NUB,NOB,R3,(INTREC+IHREC+I),98)
       CALL DCOPY(NOB2UB2,R3,1,HR3,1)
       YYY=DDOT(NOB2UB2,R3,1,HR3,1)
       XNORM=XNORM+YYY
C
       CALL RDTAB(NOB,NUB,NUA,NOA,R3,(INTREC+IHREC+LREC1+I),98)
       CALL DCOPY(NO2U2AB,R3,1,HR3,1)
       YYY=DDOT(NO2U2AB,R3,1,HR3,1)
       XNORM=XNORM+YYY
C
       CALL RDTAB(NOA,NUA,NUA,NOA,R3,(INTREC+IHREC+LREC3+I),98)
       CALL DCOPY(NOA2UA2,R3,1,HR3,1)
       YYY=DDOT(NOA2UA2,R3,1,HR3,1)
       XNORM=XNORM+YYY
       END IF
C
       CALL RDTAB(NOB,NUB,NUA,NOB,R3,(INTREC+IHREC+LREC2+I),98)
       CALL DCOPY(NOB2UAB,R3,1,HR3,1)
       YYY=DDOT(NOB2UAB,R3,1,HR3,1)
       XNORM=XNORM+YYY
C
       CALL RDTAB(NOB,NUA,NUA,NOA,R3,(INTREC+IHREC+LREC4+I),98)
       CALL DCOPY(NOABUA2,R3,1,HR3,1)
       YYY=DDOT(NOABUA2,R3,1,HR3,1)
       XNORM=XNORM+YYY
 42   CONTINUE
C
      XNORM=(1.0D+00)/(DSQRT(XNORM))
      CALL DSCAL(NOUP,XNORM,VEC,1)
      DO 43,I=1,NACTA
       IF(I.LE.NACTB) THEN
       CALL RDTAB(NOB,NUB,NUB,NOB,R3,(INTREC+IHREC+I),98)
       CALL DSCAL(NOB2UB2,XNORM,R3,1)
       CALL WRTAB(NOB,NUB,NUB,NOB,R3,(INTREC+IHREC+I),98)
C
       CALL RDTAB(NOB,NUB,NUA,NOA,R3,(INTREC+IHREC+LREC1+I),98)
       CALL DSCAL(NO2U2AB,XNORM,R3,1)
       CALL WRTAB(NOB,NUB,NUA,NOA,R3,(INTREC+IHREC+LREC1+I),98)
C
       CALL RDTAB(NOA,NUA,NUA,NOA,R3,(INTREC+IHREC+LREC3+I),98)
       CALL DSCAL(NOA2UA2,XNORM,R3,1)
       CALL WRTAB(NOA,NUA,NUA,NOA,R3,(INTREC+IHREC+LREC3+I),98)
       END IF
C
       CALL RDTAB(NOB,NUB,NUA,NOB,R3,(INTREC+IHREC+LREC2+I),98)
       CALL DSCAL(NOB2UAB,XNORM,R3,1)
       CALL WRTAB(NOB,NUB,NUA,NOB,R3,(INTREC+IHREC+LREC2+I),98)
C
       CALL RDTAB(NOB,NUA,NUA,NOA,R3,(INTREC+IHREC+LREC4+I),98)
       CALL DSCAL(NOABUA2,XNORM,R3,1)
       CALL WRTAB(NOB,NUA,NUA,NOA,R3,(INTREC+IHREC+LREC4+I),98)
 43   CONTINUE
C
      DO 1,I=1,ITER
       JREC=6*(I-1)
       I3REC=((6*NACTB)+(4*NACTA))*(I-1)
       CALL RDTAB1(NOB,AUX(1),(JREC+1),96)
       CALL RDTAB3(NOB,NUB,NOB,AUX(1+NOB),(JREC+2),96)
       CALL RDTAB3(NOB,NUA,NOA,AUX(1+NOB+NOB2UB),(JREC+3),96)
       YYY=-DDOT(NOUP,VEC,1,AUX,1)
       DO 44,J=1,NACTA
        IF(J.LE.NACTB) THEN
        CALL RDTAB(NOB,NUB,NUB,NOB,R3,(INTREC+IHREC+J),98)
        CALL RDTAB(NOB,NUB,NUB,NOB,HR3,(I3REC+J),98)
        YY3=-DDOT(NOB2UB2,R3,1,HR3,1)
        YYY=YYY+YY3
C
        CALL RDTAB(NOB,NUB,NUA,NOA,R3,(INTREC+IHREC+LREC1+J),98)
        CALL RDTAB(NOB,NUB,NUA,NOA,HR3,(I3REC+LREC1+J),98)
        YY3=-DDOT(NO2U2AB,R3,1,HR3,1)
        YYY=YYY+YY3
C
        CALL RDTAB(NOA,NUA,NUA,NOA,R3,(INTREC+IHREC+LREC3+J),98)
        CALL RDTAB(NOA,NUA,NUA,NOA,HR3,(I3REC+LREC3+J),98)
        YY3=-DDOT(NOA2UA2,R3,1,HR3,1)
        YYY=YYY+YY3
        END IF
C
        CALL RDTAB(NOB,NUB,NUA,NOB,R3,(INTREC+IHREC+LREC2+J),98)
        CALL RDTAB(NOB,NUB,NUA,NOB,HR3,(I3REC+LREC2+J),98)
        YY3=-DDOT(NOB2UAB,R3,1,HR3,1)
        YYY=YYY+YY3
C
        CALL RDTAB(NOB,NUA,NUA,NOA,R3,(INTREC+IHREC+LREC4+J),98)
        CALL RDTAB(NOB,NUA,NUA,NOA,HR3,(I3REC+LREC4+J),98)
        YY3=-DDOT(NOABUA2,R3,1,HR3,1)
        YYY=YYY+YY3
 44    CONTINUE
       CALL DAXPY(NOUP,YYY,AUX,1,VEC,1)
       DO 45,J=1,NACTA
        IF(J.LE.NACTB) THEN
        CALL RDTAB(NOB,NUB,NUB,NOB,R3,(INTREC+IHREC+J),98)
        CALL RDTAB(NOB,NUB,NUB,NOB,HR3,(I3REC+J),98)
        CALL DAXPY(NOB2UB2,YYY,HR3,1,R3,1)
        CALL WRTAB(NOB,NUB,NUB,NOB,R3,(INTREC+IHREC+J),98)
C
        CALL RDTAB(NOB,NUB,NUA,NOA,R3,(INTREC+IHREC+LREC1+J),98)
        CALL RDTAB(NOB,NUB,NUA,NOA,HR3,(I3REC+LREC1+J),98)
        CALL DAXPY(NO2U2AB,YYY,HR3,1,R3,1)
        CALL WRTAB(NOB,NUB,NUA,NOA,R3,(INTREC+IHREC+LREC1+J),98)
C
        CALL RDTAB(NOA,NUA,NUA,NOA,R3,(INTREC+IHREC+LREC3+J),98)
        CALL RDTAB(NOA,NUA,NUA,NOA,HR3,(I3REC+LREC3+J),98)
        CALL DAXPY(NOA2UA2,YYY,HR3,1,R3,1)
        CALL WRTAB(NOA,NUA,NUA,NOA,R3,(INTREC+IHREC+LREC3+J),98)
        END IF
C
        CALL RDTAB(NOB,NUB,NUA,NOB,R3,(INTREC+IHREC+LREC2+J),98)
        CALL RDTAB(NOB,NUB,NUA,NOB,HR3,(I3REC+LREC2+J),98)
        CALL DAXPY(NOB2UAB,YYY,HR3,1,R3,1)
        CALL WRTAB(NOB,NUB,NUA,NOB,R3,(INTREC+IHREC+LREC2+J),98)
C
        CALL RDTAB(NOB,NUA,NUA,NOA,R3,(INTREC+IHREC+LREC4+J),98)
        CALL RDTAB(NOB,NUA,NUA,NOA,HR3,(I3REC+LREC4+J),98)
        CALL DAXPY(NOABUA2,YYY,HR3,1,R3,1)
        CALL WRTAB(NOB,NUA,NUA,NOA,R3,(INTREC+IHREC+LREC4+J),98)
 45    CONTINUE
 1    CONTINUE
C
      CALL ZEROMA(AUX,1,NOUP)
      CALL DCOPY(NOUP,VEC,1,AUX,1)
      XNORM=DDOT(NOUP,VEC,1,AUX,1)
      DO 46,I=1,NACTA
       IF(I.LE.NACTB) THEN
       CALL RDTAB(NOB,NUB,NUB,NOB,R3,(INTREC+IHREC+I),98)
       CALL DCOPY(NOB2UB2,R3,1,HR3,1)
       YYY=DDOT(NOB2UB2,R3,1,HR3,1)
       XNORM=XNORM+YYY
C
       CALL RDTAB(NOB,NUB,NUA,NOA,R3,(INTREC+IHREC+LREC1+I),98)
       CALL DCOPY(NO2U2AB,R3,1,HR3,1)
       YYY=DDOT(NO2U2AB,R3,1,HR3,1)
       XNORM=XNORM+YYY
C
       CALL RDTAB(NOA,NUA,NUA,NOA,R3,(INTREC+IHREC+LREC3+I),98)
       CALL DCOPY(NOA2UA2,R3,1,HR3,1)
       YYY=DDOT(NOA2UA2,R3,1,HR3,1)
       XNORM=XNORM+YYY
       END IF
C
       CALL RDTAB(NOB,NUB,NUA,NOB,R3,(INTREC+IHREC+LREC2+I),98)
       CALL DCOPY(NOB2UAB,R3,1,HR3,1)
       YYY=DDOT(NOB2UAB,R3,1,HR3,1)
       XNORM=XNORM+YYY
C
       CALL RDTAB(NOB,NUA,NUA,NOA,R3,(INTREC+IHREC+LREC4+I),98)
       CALL DCOPY(NOABUA2,R3,1,HR3,1)
       YYY=DDOT(NOABUA2,R3,1,HR3,1)
       XNORM=XNORM+YYY
 46   CONTINUE
      XNORM=(1.0D+00)/(DSQRT(XNORM))
      CALL DSCAL(NOUP,XNORM,VEC,1)
      DO 47,I=1,NACTA
       IF(I.LE.NACTB) THEN
       CALL RDTAB(NOB,NUB,NUB,NOB,R3,(INTREC+IHREC+I),98)
       CALL DSCAL(NOB2UB2,XNORM,R3,1)
       CALL WRTAB(NOB,NUB,NUB,NOB,R3,(INTREC+I),98)
C
       CALL RDTAB(NOB,NUB,NUA,NOA,R3,(INTREC+IHREC+LREC1+I),98)
       CALL DSCAL(NO2U2AB,XNORM,R3,1)
       CALL WRTAB(NOB,NUB,NUA,NOA,R3,(INTREC+LREC1+I),98)
C
       CALL RDTAB(NOA,NUA,NUA,NOA,R3,(INTREC+IHREC+LREC3+I),98)
       CALL DSCAL(NOA2UA2,XNORM,R3,1)
       CALL WRTAB(NOA,NUA,NUA,NOA,R3,(INTREC+LREC3+I),98)
       END IF
C
       CALL RDTAB(NOB,NUB,NUA,NOB,R3,(INTREC+IHREC+LREC2+I),98)
       CALL DSCAL(NOB2UAB,XNORM,R3,1)
       CALL WRTAB(NOB,NUB,NUA,NOB,R3,(INTREC+LREC2+I),98)
C
       CALL RDTAB(NOB,NUA,NUA,NOA,R3,(INTREC+IHREC+LREC4+I),98)
       CALL DSCAL(NOABUA2,XNORM,R3,1)
       CALL WRTAB(NOB,NUA,NUA,NOA,R3,(INTREC+LREC4+I),98)
 47   CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IP3NORMA
      SUBROUTINE IP3NORMA(NOA,NUA,NOB,NUB,JROOT3,R1,R2B,R2A,R3,IRB,IRA)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION R1(NOB),R2B(NOB,NUB,NOB),R2A(NOB,NUA,NOA),R3(1)
      DIMENSION IRB(NACTB),IRA(NACTA)
      DATA ONE/1.0D+00/
      NOABUA2=NOABUA*NUA
      NOB2UAB=NOB2UA*NUB
C
      XNORM=0.00D+00
      DO 1,I=1,NOB
       YYY=R1(I)
       XNORM=XNORM+YYY*YYY
 1    CONTINUE
C
      DO 2,I=1,NOB
      DO 3,J=I+1,NOB
      DO 4,IB=1,NUB
       YYY=R2B(I,IB,J)
       XNORM=XNORM+YYY*YYY
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
C
      DO 5,I=1,NOB
      DO 6,J=1,NOA
      DO 7,IB=1,NUA
       YYY=R2A(I,IB,J)
       XNORM=XNORM+YYY*YYY
 7    CONTINUE
 6    CONTINUE
 5    CONTINUE
C
      DO 42,I=1,NACTA
       IF(I.LE.NACTB) THEN
       CALL RDTAB(NOB,NUB,NUB,NOB,R3,(JROOT3+I),NFT825)
       CALL NORI3BB(NOB,NUB,IRB(I),XNORM,R3)
       CALL RDTAB(NOB,NUB,NUA,NOA,R3,(JROOT3+LREC1+I),NFT825)
       CALL NORI3BA(NOB,NUB,NOA,NUA,IRB(I),XNORM,R3)
       CALL RDTAB(NOA,NUA,NUA,NOA,R3,(JROOT3+LREC3+I),NFT825)
       CALL NORI3AA(NOA,NUA,XNORM,R3)
       END IF
       CALL RDTAB(NOB,NUB,NUA,NOB,R3,(JROOT3+LREC2+I),NFT825)
       CALL NORI3AB(NOB,NUB,NUA,IRB(1),XNORM,R3)
       CALL RDTAB(NOB,NUA,NUA,NOA,R3,(JROOT3+LREC4+I),NFT825)
       CALL NORI3AA2(NOB,NUA,NOA,IRA(I),IRB(1),XNORM,R3)
  42  CONTINUE
C
      XNORM=ONE/DSQRT(XNORM)
C
      CALL DSCAL(NOB,XNORM,R1,1)
      CALL DSCAL(NOB2UB,XNORM,R2A,1)
      CALL DSCAL(NOABUA,XNORM,R2B,1)
C
      DO 43,I=1,NACTA
       IF(I.LE.NACTB) THEN
       CALL RDTAB(NOB,NUB,NUB,NOB,R3,(JROOT3+I),NFT825)
       CALL DSCAL(NOB2UB2,XNORM,R3,1)
       CALL WRTAB(NOB,NUB,NUB,NOB,R3,(JROOT3+I),NFT825)
C
       CALL RDTAB(NOB,NUB,NUA,NOA,R3,(JROOT3+LREC1+I),NFT825)
       CALL DSCAL(NO2U2AB,XNORM,R3,1)
       CALL WRTAB(NOB,NUB,NUA,NOA,R3,(JROOT3+LREC1+I),NFT825)
C
       CALL RDTAB(NOA,NUA,NUA,NOA,R3,(JROOT3+LREC3+I),NFT825)
       CALL DSCAL(NOA2UA2,XNORM,R3,1)
       CALL WRTAB(NOA,NUA,NUA,NOA,R3,(JROOT3+LREC3+I),NFT825)
C
       END IF
C
       CALL RDTAB(NOB,NUB,NUA,NOB,R3,(JROOT3+LREC2+I),NFT825)
       CALL DSCAL(NOB2UAB,XNORM,R3,1)
       CALL WRTAB(NOB,NUB,NUA,NOB,R3,(JROOT3+LREC2+I),NFT825)
C
       CALL RDTAB(NOB,NUA,NUA,NOA,R3,(JROOT3+LREC4+I),NFT825)
       CALL DSCAL(NOABUA2,XNORM,R3,1)
       CALL WRTAB(NOB,NUA,NUA,NOA,R3,(JROOT3+LREC4+I),NFT825)
C
 43   CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK NORI3BB
      SUBROUTINE NORI3BB(NOB,NUB,I,XNORM,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NOB,NUB,NUB,NOB)
C
      DO 1,J=1,I-1
      DO 2,K=1,J-1
      DO 3,IB=1,NUB
      DO 4,IC=IB+1,NUB
       XXX=R3(J,IB,IC,K)
       XNORM=XNORM+(XXX*XXX)
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK NORI3BA
      SUBROUTINE NORI3BA(NOB,NUB,NOA,NUA,I,XNORM,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NOB,NUB,NUA,NOA)
C
      DO 1,J=1,I-1
      DO 2,K=1,NOA
      DO 3,IB=1,NUB
      DO 4,IC=1,NUA
       XXX=R3(J,IB,IC,K)
       XNORM=XNORM+(XXX*XXX)
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK NORI3AA
      SUBROUTINE NORI3AA(NOA,NUA,XNORM,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NOA,NUA,NUA,NOA)
C
      DO 1,J=1,NOA
      DO 2,K=1,J-1
      DO 3,IB=1,NUA
      DO 4,IC=IB+1,NUA
       XXX=R3(J,IB,IC,K)
       XNORM=XNORM+(XXX*XXX)
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK NORI3AB
      SUBROUTINE NORI3AB(NOB,NUB,NUA,IACT,XNORM,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NOB,NUB,NUA,NOB)
C
      DO 1,I=1,IACT-1
      DO 2,J=1,I-1
      DO 3,IB=1,NUB
      DO 4,IC=1,NUA
       XXX=R3(I,IB,IC,J)
       XNORM=XNORM+(XXX*XXX)
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK NORI3AA2
      SUBROUTINE NORI3AA2(NOB,NUA,NOA,I,IACT,XNORM,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION R3(NOB,NUA,NUA,NOA)
C
      DO 1,J=1,IACT-1
      DO 2,K=1,I-1
      DO 3,IB=1,NUA
      DO 4,IC=IB+1,NUA
       XXX=R3(J,IB,IC,K)
       XNORM=XNORM+(XXX*XXX)
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK PRTIR3BB
      SUBROUTINE PRTIR3BB(NO,NU,JROOT3,R3,IRB)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /IOFILE/ IR,IW,IP,IJK,IJKT,IDAF,NAV,IODA(950)
      COMMON /CCOPIN/ IOPCCREF,IOPCCMET,NOPCCFC,MULOPCC,
     *                KMICRO,KREST,LMICRO,LREST
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      DIMENSION R3(NO,NU,NU,NO),IRB(NACTB)
C
      TOL=0.05D+00
C      TOL=0.0D+00
      DO 10,I=1,NACTB
      CALL RDTAB(NO,NU,NU,NO,R3,(JROOT3+I),NFT825)
      DO 1,J=1,IRB(I)-1
      DO 2,K=1,J-1
      DO 3,IB=1,NU
      DO 4,IC=IB+1,NU
       XXX=R3(J,IB,IC,K)
       IF(DABS(XXX).GT.TOL) THEN
        WRITE(IW,101)XXX,IRB(I)+NOPCCFC,J+NOPCCFC,
     *                K+NOPCCFC,IB+NOPCCFC+NO,
     *                IC+NOPCCFC+NO
        CALL FLSHBF(IW)
       END IF
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
 10   CONTINUE
      RETURN
 101  FORMAT(1X,'R(3H-2P)=',1X,F14.10,1X,'FOR IB, JB, KB -> BB, CB =',
     *5I4)
      END
C
C*MODULE EAIPCC  *DECK PRTIR3AA
      SUBROUTINE PRTIR3AA(NOA,NOB,NUA,JROOT3,R3,R3B,IRB,IRA)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /IOFILE/ IR,IW,IP,IJK,IJKT,IDAF,NAV,IODA(950)
      COMMON /CCOPIN/ IOPCCREF,IOPCCMET,NOPCCFC,MULOPCC,
     *                KMICRO,KREST,LMICRO,LREST
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION R3(NOA,NUA,NUA,NOA),R3B(NOB,NUA,NUA,NOA)
      DIMENSION IRB(NACTB),IRA(NACTA)
C
      TOL=0.05D+00
C      TOL=0.0D+00
      DO 10,I=1,NACTB
      CALL RDTAB(NOA,NUA,NUA,NOA,R3,(JROOT3+LREC3+I),NFT825)
      DO 1,J=1,NOA
      DO 2,K=1,J-1
      DO 3,IB=1,NUA
      DO 4,IC=IB+1,NUA
       XXX=R3(J,IB,IC,K)
       IF(DABS(XXX).GT.TOL) THEN
        WRITE(IW,101)XXX,IRB(I)+NOPCCFC,J+NOPCCFC,
     *                K+NOPCCFC,IB+NOPCCFC+NOA,
     *                IC+NOPCCFC+NOA
        CALL FLSHBF(IW)
       END IF
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
 10   CONTINUE
C
      DO 20,J=1,NACTA
      CALL RDTAB(NOB,NUA,NUA,NOA,R3B,(JROOT3+LREC4+J),NFT825)
      DO 21,I=1,IRB(1)-1
      DO 22,K=1,IRA(J)-1
      DO 23,IB=1,NUA
      DO 24,IC=IB+1,NUA
       XXX=R3B(I,IB,IC,K)
       IF(DABS(XXX).GT.TOL) THEN
        WRITE(IW,101)XXX,I+NOPCCFC,IRA(J)+NOPCCFC,
     *                K+NOPCCFC,IB+NOPCCFC+NOA,
     *                IC+NOPCCFC+NOA
        CALL FLSHBF(IW)
       END IF
 24   CONTINUE
 23   CONTINUE
 22   CONTINUE
 21   CONTINUE
 20   CONTINUE
      RETURN
 101  FORMAT(1X,'R(3H-2P)=',1X,F14.10,1X,'FOR IB, JA, KA -> BA, CA =',
     *5I4)
      END
C
C*MODULE EAIPCC  *DECK PRTIR3AB
      SUBROUTINE PRTIR3AB(NOA,NOB,NUA,NUB,JROOT3,R3,R3B,IRB)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /IOFILE/ IR,IW,IP,IJK,IJKT,IDAF,NAV,IODA(950)
      COMMON /CCOPIN/ IOPCCREF,IOPCCMET,NOPCCFC,MULOPCC,
     *                KMICRO,KREST,LMICRO,LREST
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION R3(NOB,NUB,NUA,NOA),R3B(NOB,NUB,NUA,NOB)
      DIMENSION IRB(NACTB)
C
      TOL=0.05D+00
C      TOL=0.0D+00
      DO 10,I=1,NACTB
      CALL RDTAB(NOB,NUB,NUA,NOA,R3,(JROOT3+LREC1+I),NFT825)
      DO 1,J=1,IRB(I)-1
      DO 2,K=1,NOA
      DO 3,IB=1,NUB
      DO 4,IC=1,NUA
       XXX=R3(J,IB,IC,K)
       IF(DABS(XXX).GT.TOL) THEN
        WRITE(IW,101)XXX,IRB(I)+NOPCCFC,J+NOPCCFC,
     *                K+NOPCCFC,IB+NOPCCFC+NOB,
     *                IC+NOPCCFC+NOA
        CALL FLSHBF(IW)
       END IF
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
 10   CONTINUE
C
      DO 20,K=1,NACTA
      CALL RDTAB(NOB,NUB,NUA,NOB,R3B,(JROOT3+LREC2+K),NFT825)
      DO 21,I=1,IRB(1)-1
      DO 22,J=1,I-1
      DO 23,IB=1,NUB
      DO 24,IC=1,NUA
       XXX=R3B(I,IB,IC,J)
       IF(DABS(XXX).GT.TOL) THEN
        WRITE(IW,101)XXX,I+NOPCCFC,J+NOPCCFC,
     *                IRB(K)+NOPCCFC,IB+NOPCCFC+NOB,
     *                IC+NOPCCFC+NOA
        CALL FLSHBF(IW)
       END IF
 24   CONTINUE
 23   CONTINUE
 22   CONTINUE
 21   CONTINUE
 20   CONTINUE
      RETURN
 101  FORMAT(1X,'R(3H-2P)=',1X,F14.10,1X,'FOR IB, JB, KA -> BB, CA =',
     *5I4)
      END
C
C*MODULE EAIPCC  *DECK HR3H2PA
      SUBROUTINE HR3H2PA(NOA,NUA,NOB,NUB,R1,HR1,R2B,R2A,HR2B,HR2A,
     *                  R3,R3B,HR3,FPPA,FPPB,FHPA,FHPB,FHHA,FHHB,
     *                  VHPPP1,VHPPP2,VPPP,VHPHP1,VHPHP2,VHPHP3,
     *                  VHPHP4,VHPHP5,VHPHP6,VHHHP1,VHHHP2,VHHHP3,
     *                  VHHHH1,VHHHH2,VHHHH3,T2,T2B,OHHHB,OHHHA,OHPPB,
     *                  OHPPA,OHPA2,OHHA2,OPHH,OPHH2,TI,IRB,IRA,I3REC)
C
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
C
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
      DATA TWO/2.0D+00/, HALF/0.5D+00/
      DATA QUART/0.25D+00/
C
      DIMENSION R1(1),HR1(1),R2A(1),R2B(1),HR2A(1),HR2B(1)
      DIMENSION R3(1),HR3(1),OPHH(1),OPHH2(1)
      DIMENSION FPPA(1),FPPB(1),FHPA(1),FHPB(1)
      DIMENSION VHPPP1(1),VHPPP2(1)
      DIMENSION VPPP(1),VHPHP1(1),VHPHP2(1),VHPHP3(1),T2(1),TI(1)
      DIMENSION VHHHP1(1),VHHHP2(1),VHHHP3(1)
      DIMENSION VHHHH1(1),VHHHH2(1),VHHHH3(1)
      DIMENSION OHHHB(1),OHHHA(1),OHPPB(1),OHPPA(1),OHHA2(1)
      DIMENSION VHPHP4(1),VHPHP5(1),VHPHP6(1),OHPA2(1)
      DIMENSION IRB(NACTB),IRA(NACTA)
C
      NO3=NO2*NOA
      NOA2B=NOA2*NOB
      NOA2B2=NOA2B*NOB
      NOAB2UA=NOA*NOB2*NUA
      NOAUAB2=NOAUAB*NUB
      NOBUB3=NOBUB2*NUB
      NOAUA3=NOAUA2*NUA
      INTREC=I3REC+((6*NACTB)+(4*NACTA))
      CALL ZEROMA(OHPPB,1,NOU2)
      CALL ZEROMA(OHHHB,1,NO3)
      CALL ZEROMA(OHPPA,1,NOU2)
      CALL ZEROMA(OHPA2,1,NOU2)
      CALL ZEROMA(OHHA2,1,NO3)
      CALL ZEROMA(OHHHA,1,NO3)
C
      CALL RDTAB(NUB,NOB,NUB,NOB,VHPHP1,2,NFT892)
      CALL RDTAB(NOB,NOB,NOB,NUB,VHHHP1,15,NFT891)
      CALL RDTAB(NOA,NOA,NOA,NUA,VHHHP2,14,NFT891)
      CALL RDTAB(NOA,NUB,NUA,NUB,VHPPP1,14,NFT892)
      CALL RDTAB(NOB,NUB,NUB,NUB,VHPPP2,12,NFT892)
      CALL RDTAB(NOB,NOB,NOB,NOB,VHHHH1,8,NFT891)
      CALL RDTAB(NOA,NOB,NOA,NOB,VHHHH2,9,NFT891)
      CALL CCMATMUL(VHHHH2,R1,OHHHA,NOA2B,1,NOB,1,1)
      CALL INSI12(NOA,NOB,NOA,TI,OHHHA)
      CALL INSI12(NOB,NUB,NOB,TI,R2B)
      CALL CCMATMUL(R2B,VHHHP1,OHPPB,NUB,NOBUB,NOB2,1,0)
      CALL DSCAL(NOBUB2,HALF,OHPPB,1)
      CALL CCMATMUL(VHPHP1,R1,OHPPB,NOBUB2,1,NOB,0,1)
      CALL TRT1(NUB,NOBUB,TI,OHPPB)
      CALL INSITU(NOA,NUB,NUA,NUB,TI,VHPPP1,23)
      CALL INSI23(NOB,NUA,NOA,TI,R2A)
      CALL CCMATMUL(R2A,VHPPP1,OHPPB,NOB,NUB2,NOAUA,0,0)
      CALL INSI13(NOB,NUB,NUB,TI,OHPPB)
      CALL TRAN14(NOB,NUB,NUB,NUB,TI,VHPPP2)
      CALL CCMATMUL(VHPPP2,R2B,OHPPB,NUB2,NOB,NOBUB,0,1)
      CALL TRAN1TO4(NOB,NOB,NOB,NUB,TI,VHHHP1)
      CALL CCMATMUL(VHHHP1,R2B,OHHHB,NOB2,NOB,NOBUB,1,0)
      CALL TRT1(NOB2,NOB,TI,OHHHB)
      CALL TRAN24(NOA,NOA,NOA,NUA,TI,VHHHP2)
      CALL CCMATMUL(R2A,VHHHP2,OHHHA,NOB,NOA2,NOAUA,0,1)
C
      CALL ZEROMA(VHHHP2,1,NO3U)
      CALL RDTAB(NUA,NOB,NUA,NOB,VHPHP2,4,NFT892)
      CALL RDTAB(NOA,NOB,NUA,NOB,VHHHP1,17,NFT891)
      CALL RDTAB(NOA,NOB,NOA,NUB,VHHHP2,16,NFT891)
      CALL RDTAB(NUA,NUB,NUA,NOB,VHPPP1,13,NFT892)
      CALL RDTAB(NOA,NUA,NUA,NUA,VHPPP2,11,NFT892)
      CALL CCMATMUL(VHPHP2,R1,OHPPA,NOBUA2,1,NOB,1,1)
      CALL TRT1(NUA,NOBUA,TI,OHPPA)
      CALL TRANMD(VHHHP1,NOA,NOB,NUA,NOB,24)
      CALL TRAN1TO4(NOA,NOB,NUA,NOB,TI,VHHHP1)
      CALL CCMATMUL(VHHHP1,R2A,OHPPA,NOBUA,NUA,NOAB,0,0)
      CALL CCMATMUL(R2A,VHPPP2,OHPPA,NOB,NUA2,NOAUA,0,1)
      CALL INSI13(NOB,NUA,NUA,TI,OHPPA)
      CALL INSITU(NUA,NUB,NUA,NOB,TI,VHPPP1,23)
      CALL CCMATMUL(VHPPP1,R2B,OHPPA,NUA2,NOB,NOBUB,0,1)
      CALL TRAN14(NOB,NUA,NOB,NOA,TI,VHHHP1)
      CALL CCMATMUL(R2A,VHHHP1,OHHHB,NOB,NOB2,NOAUA,0,0)
      CALL ASYMOH(NOB,OHHHB,TI)
      CALL TRANMD(OHHHB,NOB,NOB,NOB,1,23)
      CALL CCMATMUL(VHHHH1,R1,OHHHB,NOB3,1,NOB,0,0)
      CALL INSI12(NUB,NOB,NOB,TI,R2B)
      CALL TRAN14(NOA,NOB,NOA,NUB,TI,VHHHP2)
      CALL CCMATMUL(R2B,VHHHP2,OHHHA,NOB,NOA2,NOBUB,0,0)
      CALL TRT1(NOABUA,NOB,TI,VHHHP1)
      CALL TRT1(NOAB,NUA,TI,R2A)
      CALL TRANMD(OHHHA,NOB,NOA,NOA,1,23)
      CALL CCMATMUL(VHHHP1,R2A,OHHHA,NOAB,NOA,NOBUA,0,1)
C
      CALL RDTAB(NUB,NOB,NOA,NUA,VHPHP3,5,NFT892)
      CALL TRT1(NOBUB,NOAUA,TI,VHPHP3)
      CALL TRANMD(VHHHP2,NUB,NOB,NOA,NOA,34)
      CALL TRAN1TO4(NUB,NOB,NOA,NOA,TI,VHHHP2)
      CALL INSITU(NUA,NUA,NUB,NOB,TI,VHPPP1,23)
      CALL CCMATMUL(VHPHP3,R1,OHPA2,NOAUAB,1,NOB,1,1)
      CALL INSI12(NOA,NUA,NUB,TI,OHPA2)
      CALL CCMATMUL(R2A,VHHHP2,OHPA2,NUA,NOAUB,NOAB,0,1)
      CALL INSI23(NUA,NOA,NUB,TI,OHPA2)
      CALL CCMATMUL(VHPPP1,R2A,OHPA2,NUAB,NOA,NOBUA,0,0)
C
      CALL RDINT(1,NOBUB,NOBUB,VHPHP1,NFT830)
      CALL RDINT(1,NOBUB,NOAUA,VHPHP2,NFT833)
      CALL RDINT(1,NOAUA,NOAUA,VHPHP3,NFT829)
      CALL RDTAB(NOB,NUB,NUB,NUB,VHPPP1,12,NFT892)
      CALL RDTAB(NOA,NUB,NUA,NUB,VHPPP2,14,NFT892)
      CALL RDTAB(NUA,NUB,NUA,NOB,R3B,13,NFT892)
      CALL RDTAB(NOB,NOB,NOB,NUB,VHHHP1,15,NFT891)
      CALL RDTAB(NOA,NOB,NUA,NOB,VHHHP2,17,NFT891)
      CALL RDTAB(NOA,NOB,NOA,NUB,VHPHP6,16,NFT891)
      CALL RDTAB2(NOB,NUB,FHPB,6,NFT891)
      CALL RDTAB2(NOA,NUA,FHPA,5,NFT891)
      CALL INSITU(NUB,NOB,NUB,NOB,TI,VHPHP1,23)
      CALL TRT1(NOB,NOB2,TI,OHHHB)
      CALL INSITU(NUA,NOA,NUB,NOB,TI,VHPHP2,23)
      CALL INSITU(NUA,NUB,NOA,NOB,TI,VHPHP2,12)
      CALL TRAN34N(NUB,NUA,NOA,NOB,TI,VHPHP2)
      CALL DCOPY(NO2U2AB,VHPHP2,1,VHPHP4,1)
      CALL INSITU(NUA,NOA,NUA,NOA,TI,VHPHP3,23)
C
      CALL TRANMD(OHPPB,NUB,NUB,NOB,1,12)
      CALL TRT1(NUA,NOBUA,TI,OHPPA)
      CALL INSI12(NUA,NUB,NOA,TI,OHPA2)
      CALL ZEROMA(OPHH,1,NO2U)
      CALL ZEROMA(OPHH2,1,NO2U)
      CALL TRT1(NOB,NUB,TI,FHPB)
      CALL INSITU(NOB,NUB,NUB,NUB,TI,VHPPP1,13)
      CALL VECMUL(VHPPP1,NOBUB3,HALF)
      CALL VECMUL(VHPPP2,NOAUAB2,HALF)
      CALL TRAN1TO4(NOA,NUB,NUA,NUB,TI,VHPPP2)
      CALL TRAN1TO4(NUA,NUB,NUA,NOB,TI,R3B)
      CALL TRT1(NOB2,NOBUB,TI,VHHHP1)
      CALL TRT1(NOAB,NOBUA,TI,VHHHP2)
      CALL INSITU(NUA,NOB,NOA,NOB,TI,VHHHP2,12)
      CALL TRAN34N(NOB,NUA,NOA,NOB,TI,VHHHP2)
      CALL TRT1(NOAB,NOAUB,TI,VHPHP6)
      CALL TRAN34N(NOA,NUB,NOA,NOB,TI,VHPHP6)
      CALL TRANMD(HR2B,NOB,NUB,NOB,1,13)
      CALL VECMUL(FHPA,NOAUA,HALF)
      CALL TRT1(NOA,NUA,TI,FHPA)
      CALL IPLOOP1(NOA,NOB,NUA,NUB,IRB,IRA,HR1,R3,T2,HR3,T2B,
     *             VHHHH1,VHPHP1,VHPHP2,OHHHB,OHHHA,OHPPB,
     *             OHPPA,OHPA2,FHPB,FHPA,VHPPP1,VHPPP2,R3B,VHHHP1,
     *             VHHHP2,VHPHP6,OPHH,HR2B,OPHH2,HR2A,TI,I3REC,INTREC)
C
      CALL RDTAB(NOA,NUA,NUA,NUA,VHPPP1,11,NFT892)
      CALL RDTAB(NOA,NOA,NOA,NUA,VHHHP3,14,NFT891)
      CALL INSITU(NOA,NOB,NOA,NOB,TI,VHHHH2,12)
      CALL TRAN34N(NUB,NUA,NOB,NOA,TI,VHPHP2)
      CALL INSI13(NOB,NOA,NOA,TI,OHHHA)
      CALL INSI23(NUA,NOB,NUA,TI,OHPPA)
      CALL TRAN34N(NUB,NUA,NUB,NOA,TI,VHPPP2)
      CALL TRAN34N(NUB,NUA,NOB,NUA,TI,R3B)
      CALL TRT1(NUAB,NOBUA,TI,R3B)
      CALL TRAN34N(NOB,NUA,NOB,NOA,TI,VHHHP2)
      CALL DCOPY(NOAUA,FHPB,1,FPPB,1)
      CALL TRT1(NUB,NOB,TI,FHPB)
      CALL TRT1(NOB,NOAUA,TI,HR2A)
      CALL INSITU(NOA,NUA,NUA,NUA,TI,VHPPP1,13)
      CALL TRT1(NOA2,NOAUA,TI,VHHHP3)
      CALL TRAN34N(NOA,NUB,NOB,NOA,TI,VHPHP6)
      CALL IPLOOP2(NOA,NOB,NUA,NUB,IRB,IRA,HR1,R3,T2,HR3,T2B,
     *             VHHHH2,VHPHP2,VHPHP3,VHPHP4,OHHHB,OHHHA,OHHA2,
     *             OHPPB,OHPPA,OHPA2,FHPB,FPPB,FHPA,VHPPP2,R3B,VHPPP1,
     *             VHHHP2,VHPHP6,VHHHP3,OPHH,HR2B,OPHH2,HR2A,TI,
     *             I3REC,INTREC)
C
      CALL INSI12(NUA,NOA,NOB,TI,HR2A)
      CALL INSI13(NOB,NOA,NOA,TI,OHHA2)
      CALL DAXPY(NOA2B,1.00D+00,OHHA2,1,OHHHA,1)
      CALL RDTAB(NOA,NOA,NOA,NOA,VHHHH3,7,NFT891)
      CALL INSITU(NUB,NUB,NOB,NOB,TI,VHPHP1,23)
      CALL VECMUL(FHPA,NOAUA,TWO)
      CALL VECMUL(VHPPP1,NOAUA3,HALF)
      CALL TRT1(NOB,NOAUA,TI,OPHH2)
      CALL TRT1(NOAUB,NOAB,TI,VHPHP6)
      CALL TRAN34N(NOA,NOB,NOA,NUB,TI,VHPHP6)
      CALL IPLOOP3(NOA,NOB,NUA,NUB,IRB,IRA,HR1,R3,T2,HR3,
     *             VHHHH3,VHPHP3,VHPHP1,VHPHP2,OHHHA,OHPPA,OHPA2,
     *             FHPA,VHPPP1,VHHHP3,VHPHP6,VHHHP1,VHHHP2,HR2A,
     *             OPHH2,TI,I3REC,INTREC)
      CALL TRT1(NOAUA,NOB,TI,OPHH2)
      CALL INSI13(NOA,NUA,NOB,TI,HR2A)
      CALL DAXPY(NOABUA,1.00D+00,OPHH2,1,HR2A,1)
      CALL TRANMD(OPHH,NOB,NUB,NOB,1,13)
      CALL TRANMD(HR2B,NOB,NUB,NOB,1,13)
      CALL DAXPY(NOB2UB,1.00D+00,OPHH,1,HR2B,1)
      CALL TRANMD(HR2B,NOB,NUB,NOB,1,13)
      CALL ZEROIR2(NOB,NUB,IRB,OPHH)
      CALL DAXPY(NOB2UB,-1.00D+00,OPHH,1,HR2B,1)
      CALL TRANMD(HR2B,NOB,NUB,NOB,1,13)
C
      CALL RDTAB2(NOB,NOB,FHHB,4,NFT891)
      CALL RDTAB2(NUB,NUB,FPPB,2,NFT891)
      CALL RDTAB(NUB,NOB,NUB,NOB,VHPHP1,2,NFT892)
      CALL RDTAB(NUB,NOB,NUA,NOA,VHPHP2,6,NFT892)
      CALL RDTAB(NUB,NUB,NUB,NOB,VHPPP1,8,NFT892)
      CALL RDTAB(NOB,NOB,NOB,NUB,VHHHP1,11,NFT891)
      CALL RDTAB(NOB,NUB,NUB,NOB,T2,4,NFT825)
      CALL VECMUL(FHHB,NOB2,QUART)
      CALL VECMUL(VHPHP1,NOB2UB2,HALF)
      CALL VECMUL(VHPHP2,NO2U2AB,HALF)
      CALL VECMUL(R2B,NOB2UB,HALF)
      CALL VECMUL(T2,NOB2UB2,HALF)
      CALL VECMUL(VHHHH1,NOB4,HALF)
      CALL TRANSQ(FHHB,NOB)
      CALL TRANSQ(FPPB,NUB)
      CALL TRANMD(VHPPP1,NUB,NUB,NUB,NOB,13)
      CALL TRANMD(VHHHH1,NOB,NOB,NOB,NOB,23)
      CALL TRT1(NOB2,NOBUB,TI,VHHHP1)
      CALL IPLOOPBB(NOA,NUA,NOB,NUB,IRB,IRA,R3,HR3,FHHB,FPPB,VHPHP1,
     *              VHPHP2,VPPP,VHPPP1,VHHHP1,OHPPB,OHHHB,VHHHH1,T2,R2B,
     *              TI,I3REC,INTREC)
      CALL IPMAKEBB(NOB,NUB,R3,HR3,T2,IRB,I3REC,INTREC)
C
      CALL RDTAB2(NOA,NOA,FHHA,3,NFT891)
      CALL RDTAB2(NUA,NUA,FPPA,1,NFT891)
      CALL RDTAB(NUA,NOA,NUA,NOA,VHPHP3,1,NFT892)
      CALL RDTAB(NUB,NOB,NUA,NOA,VHPHP4,5,NFT892)
      CALL RDTAB(NUA,NOB,NUA,NOB,VHPHP5,4,NFT892)
      CALL RDTAB(NOA,NOB,NUA,NOB,VHHHP1,13,NFT891)
      CALL RDTAB(NOA,NOA,NOA,NUA,VHHHP3,10,NFT891)
      CALL RDTAB(NUA,NUA,NUA,NOA,VHPPP2,7,NFT892)
      CALL RDTAB(NOA,NUA,NUA,NOA,T2,3,NFT825)
      CALL RDTAB(NOA,NUA,NUB,NOB,T2B,5,NFT825)
      CALL DCOPY(NOAB2UA,VHHHP1,1,VHHHP2,1)
      CALL VECMUL(FHHB,NOB2,TWO)
      CALL VECMUL(FHHA,NOA2,HALF)
      CALL VECMUL(FPPA,NUA2,HALF)
      CALL VECMUL(T2,NOA2UA2,HALF)
      CALL TRANSQ(FHHB,NOB)
      CALL TRANSQ(FHHA,NOA)
      CALL TRANSQ(FPPA,NUA)
      CALL TRANSQ(VHPHP3,NOAUA)
      CALL TRAN34N(NUB,NOB,NOA,NUA,TI,VHPHP4)
      CALL INSITU(NUA,NOB,NUA,NOB,TI,VHPHP5,12)
      CALL TRAN34N(NOB,NUA,NUA,NOB,TI,VHPHP5)
      CALL TRT1(NOAB,NOBUA,TI,VHHHP2)
      CALL INSITU(NUA,NOB,NOA,NOB,TI,VHHHP2,12)
      CALL TRAN34N(NOA,NOA,NOA,NUA,TI,VHHHP3)
      CALL TRANMD(VHPPP2,NUA,NUA,NUA,NOA,13)
      CALL TRT1(NOBUA,NOA,TI,R2A)
      CALL TRANSQ(T2,NOAUA)
      CALL TRAN1TO4(NOB,NOA,NOA,NOB,TI,VHHHH2)
      CALL DCOPY(NOA2B2,VHHHH2,1,VHPPP1,1)
      CALL INSITU(NOA,NOA,NOB,NOB,TI,VHPPP1,23)
      CALL TRAN14(NOB,NUA,NOB,NUA,TI,VHPHP5)
      CALL IPLOOPAA(NOA,NUA,NOB,NUB,IRB,IRA,R3,HR3,FHHB,FHHA,FPPA,
     *              VPPP,VHPHP3,VHPHP4,VHPHP5,VHHHP2,VHHHP3,VHPPP2,
     *              VHHHH2,VHPPP1,R2A,T2,T2B,OHPPA,OHPA2,OHHHA,
     *              VHPHP6,TI,I3REC,INTREC)
      CALL VECMUL(FPPA,NUA2,TWO)
      CALL VECMUL(R2A,NOABUA,HALF)
      CALL VECMUL(VHHHP2,NOAB2UA,TWO)
      CALL VECMUL(VHHHP1,NOAB2UA,TWO)
      CALL VECMUL(VHHHP3,NOA3UA,TWO)
      CALL VECMUL(VHPPP1,NOA2B2,HALF)
      CALL VECMUL(VHHHH3,NOA4,HALF)
      CALL TRAN14(NUA,NUA,NOB,NOB,TI,VHPHP5)
      CALL INSI13(NOA,NOA,NOB,TI,OHHHA)
      CALL TRANSQ(T2,NOAUA)
      CALL INSI13(NUA,NUA,NOB,TI,OHPPA)
      CALL DCOPY(NOA2UA2,T2,1,VHPHP6,1)
      CALL VECMUL(VHPHP6,NOA2UA2,TWO)
      CALL INSITU(NOA,NUA,NUA,NOA,TI,VHPHP6,13)
      CALL TRAN14(NOA,NUA,NUB,NOB,TI,T2B)
      CALL INSI13(NOA,NUA,NOB,TI,R2A)
      CALL DCOPY(NOABUA,R2A,1,VPPP,1)
      CALL INSI12(NOB,NUA,NOA,TI,VPPP)
      CALL TRT1(NOA,NOB2UA,TI,VHHHP1)
      CALL TRANMD(VHHHP3,NOA,NOA,NUA,NOA,14)
      CALL INSITU(NOA,NOA,NUA,NOA,TI,VHHHP3,23)
      CALL TRAN14(NOA,NOB,NOA,NOB,TI,VHPPP1)
      CALL TRAN14(NOA,NOA,NOA,NOA,TI,VHHHH3)
      CALL DCOPY(NOA2B2,VHPPP1,1,VHHHH2,1)
      CALL INSITU(NOB,NOB,NOA,NOA,TI,VHHHH2,23)
      CALL INSITU(NUA,NOA,NUA,NOA,TI,VHPHP3,23)
      CALL INSITU(NUB,NOB,NUA,NOA,TI,VHPHP4,23)
      CALL IPLOOPAA2(NOA,NUA,NOB,NUB,IRB,IRA,R3,HR3,FHHB,FHHA,FPPA,
     *               VHPHP5,VHPPP2,VHHHP2,VHHHP1,VHHHP3,VHPPP1,VHHHH2,
     *               VHHHH3,VHPHP3,VHPHP4,R2A,VPPP,T2,VHPHP6,T2B,OHHHA,
     *               OHPPA,OHPA2,TI,I3REC,INTREC)
      CALL IPMAKEAA(NOA,NOB,NUA,R3,T2,HR3,VHPHP6,
     *              TI,IRA,IRB,I3REC,INTREC)
C
      CALL RDTAB(NUB,NOA,NUB,NOA,VHPHP6,3,NFT892)
      CALL RDTAB(NUA,NUB,NUA,NOB,VHPPP1,9,NFT892)
      CALL RDTAB(NUA,NUB,NOA,NUB,VHPPP2,10,NFT892)
      CALL RDTAB(NOA,NOB,NOA,NUB,VHHHP1,12,NFT891)
      CALL RDTAB(NOA,NOB,NUA,NOB,VHHHP2,13,NFT891)
      CALL RDTAB(NOB,NOB,NOB,NUB,VHHHP3,11,NFT891)
      CALL RDTAB(NOA,NOB,NOA,NOB,VHHHH2,9,NFT891)
      CALL RDTAB(NOB,NUB,NUB,NOB,T2,4,NFT825)
      CALL VECMUL(FHHB,NOB2,TWO)
      CALL VECMUL(FHHA,NOA2,TWO)
      CALL VECMUL(VHPHP1,NOB2UB2,TWO)
      CALL VECMUL(VHPHP2,NO2U2AB,TWO)
      CALL VECMUL(R2A,NOABUA,TWO)
      CALL VECMUL(R2B,NOB2UB,TWO)
      CALL VECMUL(VHHHH1,NOB4,TWO)
      CALL INSITU(NUB,NOB,NUA,NOA,TI,VHPHP2,12)
      CALL TRAN34N(NOB,NUB,NUA,NOA,TI,VHPHP2)
      CALL INSITU(NUB,NOB,NUB,NOB,TI,VHPHP1,12)
      CALL TRAN34N(NOB,NUB,NUB,NOB,TI,VHPHP1)
      CALL INSITU(NUB,NUA,NOB,NOA,TI,VHPHP4,23)
      CALL INSITU(NUA,NUA,NOA,NOA,TI,VHPHP3,23)
      CALL TRANSQ(VHPHP6,NOAUB)
      CALL INSI12(NOB,NUA,NOA,TI,R2A)
      CALL INSITU(NUA,NUB,NOA,NUB,TI,VHPPP2,12)
      CALL TRT1(NOAUAB,NUB,TI,VHPPP2)
      CALL TRT1(NOAB,NOAUB,TI,VHHHP1)
      CALL INSITU(NOA,NOB,NUA,NOB,TI,VHHHP2,12)
      CALL TRAN24(NOB,NOB,NOB,NUB,TI,VHHHP3)
      CALL INSI23(NOB,NOA,NOA,TI,OHHHA)
      CALL TRAN14(NOB,NUA,NUB,NOA,TI,T2B)
      CALL TRANMD(OHHHB,NOB,NOB,NOB,1,12)
      CALL TRT1(NOB,NUA2,TI,OHPPA)
      CALL TRANMD(VHHHH2,NOA,NOB,NOA,NOB,13)
      CALL INSITU(NOA,NOB,NOA,NOB,TI,VHHHH2,23)
      CALL DCOPY(NOA2B2,VHHHH2,1,VHHHH3,1)
      CALL TRAN14(NOA,NOA,NOB,NOB,TI,VHHHH3)
      CALL IPLOOPBA(NOA,NUA,NOB,NUB,IRB,IRA,R3,R3B,HR3,FHHB,FHHA,FPPB,
     *              FPPA,VPPP,VHPHP4,VHPHP3,VHPHP6,VHPHP5,VHPHP1,VHPHP2,
     *              VHPPP1,VHPPP2,VHHHP1,VHHHP2,VHHHP3,VHHHH1,VHHHH2,
     *              VHHHH3,R2B,R2A,T2,T2B,OHHHB,
     *              OHHHA,OHPPB,OHPPA,OHPA2,TI,I3REC,INTREC)
C
      CALL VECMUL(FPPA,NUA2,HALF)
      CALL VECMUL(FPPB,NUB2,HALF)
      CALL VECMUL(FHHA,NOA2,HALF)
      CALL VECMUL(VHHHP3,NOB3UB,HALF)
      CALL VECMUL(VHPPP2,NOAUAB2,HALF)
      CALL VECMUL(OHHHB,NOB3,HALF)
      CALL VECMUL(OHPA2,NOAUAB,HALF)
      CALL VECMUL(VHPHP6,NOA2UB2,HALF)
      CALL VECMUL(VHPHP4,NO2U2AB,HALF)
      CALL VECMUL(VHPHP3,NOA2UA2,HALF)
      CALL TRT1(NOAB,NOBUA,TI,VHHHP2)
      CALL INSITU(NUA,NOB,NOB,NOA,TI,VHHHP2,12)
      CALL TRAN14(NOA,NUB,NOA,NOB,TI,VHHHP1)
      CALL TRANMD(VHHHP1,NOB,NUB,NOA,NOA,34)
      CALL TRANMD(VHHHP3,NOB,NUB,NOB,NOB,34)
      CALL TRANMD(VHPPP1,NUA,NUB,NUA,NOB,13)
      CALL INSITU(NUB,NUB,NUA,NOA,TI,VHPPP2,13)
      CALL TRANSQ(T2,NOBUB)
      CALL TRAN1TO4(NOA,NUA,NUB,NOB,TI,T2B)
      CALL DCOPY(NO2U2AB,T2B,1,R3B,1)
      CALL INSITU(NUA,NUB,NOB,NOA,TI,R3B,12)
      CALL TRT1(NOBUA,NOA,TI,R2A)
      CALL INSI13(NOA,NUA,NOB,TI,R2A)
      CALL TRT1(NOAB,NOA,TI,OHHHA)
      CALL INSI13(NUB,NUB,NOB,TI,OHPPB)
      CALL TRT1(NUA2,NOB,TI,OHPPA)
      CALL INSITU(NOA,NOA,NOB,NOB,TI,VHHHH2,23)
      CALL INSITU(NOB,NOA,NOB,NOA,TI,VHHHH3,23)
      CALL INSITU(NUB,NOA,NUB,NOA,TI,VHPHP6,23)
      CALL INSITU(NUB,NOB,NUA,NOA,TI,VHPHP4,23)
      CALL INSITU(NUB,NUA,NOB,NOA,TI,VHPHP4,12)
      CALL INSITU(NUA,NOA,NUA,NOA,TI,VHPHP3,23)
      CALL INSITU(NUA,NUA,NOA,NOA,TI,VHPHP3,12)
      CALL IPLOOPBA2(NOA,NUA,NOB,NUB,IRB,IRA,R3,HR3,FHHB,FHHA,FPPB,
     *               FPPA,VHPHP1,VHPHP2,VHPHP5,VHPHP6,VHPHP4,VHPHP3,
     *               VHHHP1,VHHHP2,VHHHP3,VHPPP1,VHPPP2,VHHHH2,VHHHH3,
     *               R2B,R2A,T2,T2B,R3B,OHHHB,OHHHA,OHPPB,OHPPA,OHPA2,
     *               TI,I3REC,INTREC)
      CALL IPMAKEBA(NOA,NOB,NUA,NUB,R3,VHPHP6,HR3,
     *              T2,TI,IRA,IRB,I3REC,INTREC)
C
      RETURN
      END
C
      SUBROUTINE ASYMOH(NO,OHHH1,OHHH2)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION OHHH1(NO,NO,NO),OHHH2(NO,NO,NO)
      NO3=NO*NO*NO
C
      CALL DCOPY(NO3,OHHH1,1,OHHH2,1)
      CALL TRANMD(OHHH2,NO,NO,NO,1,13)
      CALL DAXPY(NO3,-1.0D+00,OHHH2,1,OHHH1,1)
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPLOOP1
      SUBROUTINE IPLOOP1(NOA,NOB,NUA,NUB,IRB,IRA,HR1,R3,R3B,GAMMA1,
     *                   GAMMA2,VHHHH,VHPHP1,VHPHP2,OHHHB,OHHHA,
     *                   OHPPB,OHPPA,OHPA2,FHPB,FHPA,VHPPP1,VHPPP2,
     *                   VHPPP3,VHHHP1,VHHHP2,VHHHP3,OPHH,HR2B,OPHH2,
     *                   HR2A,TI,I3REC,INTREC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION R3(NOB,NUB,NUB,NOB),R3B(NOB,NUB,NUA,NOB)
      DIMENSION GAMMA1(NOB,NUB,NUB,NOB),GAMMA2(NOB,NUB,NUA,NOB)
      DIMENSION FHPB(NUB,NOB),FHPA(NUA,NOA)
      DIMENSION VHHHH(NOB,NOB,NOB,NOB),TI(1)
      DIMENSION VHPHP1(NUB,NUB,NOB,NOB),VHPHP2(NUB,NUA,NOB,NOA)
      DIMENSION VHPPP1(NUB,NUB,NUB,NOB),VHPPP2(NUB,NUA,NUB,NOA)
      DIMENSION VHPPP3(1),VHHHP3(NOA,NUB,NOB,NOA)
      DIMENSION VHHHP1(NOB,NUB,NOB,NOB),VHHHP2(NOB,NUA,NOB,NOA)
      DIMENSION OHHHB(NOB,NOB,NOB),OHHHA(NOB,NOA,NOA)
      DIMENSION OHPPB(NUB,NUB,NOB),OHPPA(NUA,NOB,NUA)
      DIMENSION OHPA2(NUB,NUA,NOA),OPHH(NOB,NUB,NOB)
      DIMENSION OPHH2(NOB,NUA,NOA)
      DIMENSION HR2B(NOB,NUB,NOB),HR2A(NOB,NUA,NOA)
      DIMENSION IRB(NACTB),IRA(NACTA),HR1(NOB)
C
      DATA TWO/2.0D+00/, HALF/0.5D+00/
      DATA FOUR/4.00D+00/,FOURTH/0.25D+00/
C
      NOB2UAB=NOB2UA*NUB
C
      DO 1,I=1,NACTA
       IF(I.LE.NACTB) THEN
        CALL RDTAB(NOB,NUB,NUB,NOB,R3,(I3REC+I),98)
       ELSE
        CALL ZEROMA(R3,1,NO2U2)
       END IF
       CALL RDTAB(NOB,NUB,NUA,NOB,R3B,(I3REC+LREC2+I),98)
C
       CALL VECMUL(R3,NOB2UB2,HALF)
       CALL CCMATMUL(R3,FHPB,OPHH(1,1,IRB(I)),NOBUB,1,NOBUB,0,0)
       CALL CCMATMUL(R3,VHPPP1,OPHH(1,1,IRB(I)),NOB,NUB,NOBUB2,0,1)
       CALL CCMATMUL(R3,VHPHP1,OHHHB(1,1,IRB(I)),NOB,NOB,NOBUB2,0,1)
       CALL TRANSQ(R3,NOBUB)
       CALL CCMATMUL(VHHHP1,R3,HR2B(1,1,IRB(I)),NOB,NUB,NOB2UB,0,0)
       CALL INSI23(NOB,NUB,NOB,TI,HR2B)
       CALL VECMUL(R3,NOB2UB2,HALF)
       CALL TRAN24(NUB,NOB,NOB,NUB,TI,R3)
       CALL CCMATMUL(VHPHP1,R3,HR1(IRB(I)),1,1,NOB2UB2,0,1)
C
       CALL VECMUL(R3,NOB2UB2,HALF)
       CALL VECMUL(R3B,NOB2UAB,FOURTH)
       CALL TRT1(NUB2,NOB2,TI,R3)
       CALL TRAN24(NOB,NUB,NUA,NOB,TI,R3B)
       CALL CCMATMUL(VHHHH,R3,GAMMA1,NOB2,NUB2,NOB2,1,0)
       CALL CCMATMUL(VHHHH,R3B,GAMMA2,NOB2,NUAB,NOB2,1,0)
       IF(I.LE.NACTB) THEN
       CALL WRTAB(NOB,NOB,NUB,NUB,GAMMA1,(INTREC+I),98)
       END IF
       CALL WRTAB(NOB,NOB,NUA,NUB,GAMMA2,(INTREC+LREC2+I),98)
C
       CALL VECMUL(R3,NOB2UB2,FOUR)
       CALL INSITU(NOB,NOB,NUB,NUB,TI,R3,13)
       CALL CCMATMUL(VHPHP1,R3,OHPPB(1,1,IRB(I)),NUB,NUB,NOB2UB,0,0)
C
       CALL TRANSQ(R3,NOBUB)
       CALL ZEROIA(NOB,NUB,IRB,R3)     !R3(JB,BB,CB,KB)
       CALL TRANMD(OHHHB,NOB,NOB,NOB,1,13)
       CALL CCMATMUL(R3,VHPHP1,OHHHB(1,1,IRB(I)),NOB,NOB,NOBUB2,0,0)
       CALL TRANSQ(R3,NOBUB)
       CALL ZEROIC(NOB,NUB,I,IRB,R3)
       CALL TRT1(NOB2UB,NUB,TI,R3)
       CALL CCMATMUL(VHPHP1(1,1,1,IRB(I)),R3,HR1,1,NOB,NOBUB2,0,0)
       CALL TRT1(NUB,NOB2UB,TI,R3)
       CALL VECMUL(R3,NOB2UB2,TWO)
       CALL CCMATMUL(VHHHP1(1,1,1,IRB(I)),R3,HR2B,NOB,NOBUB,NOBUB,0,1)
       CALL INSI23(NUB,NUB,NOB,TI,OHPPB)
       CALL CCMATMUL(VHPHP1(1,1,1,IRB(I)),R3,OHPPB,NUB,NOBUB,NOBUB,0,1)
C
       CALL VECMUL(R3,NOB2UB2,HALF)
       CALL ZEROIC2(NOB,NUB,I,IRB,R3)
       CALL TRT1(NUB,NOB2UB,TI,R3)
       CALL TRT1(NOB2,NOB,TI,OHHHB)
       CALL CCMATMUL(R3,VHPHP1(1,1,1,IRB(I)),OHHHB,NOB2,NOB,NUB2,0,0)
       CALL CCMATMUL(R3,FHPB(1,IRB(I)),HR2B,NOB2UB,1,NUB,0,0)
       CALL TRAN34N(NUB,NUB,NOB,NUB,TI,VHPPP1)
       CALL CCMATMUL(R3,VHPPP1(1,1,1,IRB(I)),HR2B,NOB2,NUB,NUB2,0,1)
       CALL TRAN34N(NUB,NUB,NUB,NOB,TI,VHPPP1)
C
       CALL VECMUL(R3B,NOB2UAB,TWO)
       CALL TRT1(NOB2UA,NUB,TI,R3B)
       CALL CCMATMUL(VHHHP1,R3B,OPHH2(1,1,IRA(I)),NOB,NUA,NOB2UB,0,1)
       CALL CCMATMUL(VHPHP1,R3B,OHPA2(1,1,IRA(I)),NUB,NUA,NOB2UB,0,0)
       CALL TRT1(NUB,NOB2UA,TI,R3B)
C
       CALL TRAN24(NOB,NOB,NUA,NUB,TI,R3B)
       CALL VECMUL(R3B,NOB2UAB,TWO)
       CALL ZEROID(NOB,NUA,NUB,IRB,R3B)
       CALL INSITU(NOB,NUB,NUA,NOB,TI,R3B,23)
       CALL CCMATMUL(R3B,FHPB,HR2A(1,1,IRA(I)),NOBUA,1,NOBUB,0,0)
       CALL INSITU(NOB,NUA,NUB,NOB,TI,R3B,23)
       CALL CCMATMUL(R3B,VHPPP3,HR2A(1,1,IRA(I)),NOB,NUA,NOBUAB,0,0)
       CALL CCMATMUL(R3B,VHPHP2,OHHHA(1,1,IRA(I)),NOB,NOA,NOBUAB,0,0)
       CALL ZEROIE(NOB,NUA,NUB,IRB,R3B)
       CALL TRT1(NOBUAB,NOB,TI,R3B)
       CALL CCMATMUL(R3B,FHPA(1,IRA(I)),HR2B,NOB2UB,1,NUA,0,0)
       CALL CCMATMUL(R3B,VHPPP2(1,1,1,IRA(I)),HR2B,NOB2,NUB,NUAB,0,0)
       CALL CCMATMUL(R3B,VHPHP2(1,1,1,IRB(I)),OHHHB,NOB2,NOB,NUAB,0,0)
       CALL TRANMD(OHHHB,NOB,NOB,NOB,1,23)
       CALL TRT1(NOB2UB,NUA,TI,R3B)
       CALL CCMATMUL(VHHHP2(1,1,1,IRA(I)),R3B,HR2B,NOB,NOBUB,NOBUA,0,1)
       CALL CCMATMUL(VHPHP2(1,1,1,IRA(I)),R3B,OHPPB,NUB,NOBUB,NOBUA,0,1)
C
       CALL TRT1(NOB2UA,NUB,TI,R3B)
       CALL CCMATMUL(VHPHP2(1,1,1,IRA(I)),R3B,HR1,1,NOB,NOBUAB,0,0)
       CALL TRT1(NUB,NOB2UA,TI,R3B)
C
       CALL INSI23(NUB,NOB,NUB,TI,OHPPB)
       CALL TRAN14(NUA,NOB,NOB,NUB,TI,R3B)
       CALL INSITU(NUB,NUA,NOB,NOA,TI,VHPHP2,12)
       CALL CCMATMUL(VHPHP2(1,1,1,IRA(I)),R3B,OHPPA,NUA,NOBUA,NOBUB,0,1)
       CALL INSITU(NUA,NUB,NOB,NOA,TI,VHPHP2,12)
       CALL INSI23(NOB,NOB,NUB,TI,HR2B)
       CALL TRT1(NOBUA,NOA,TI,HR2A)
       CALL CCMATMUL(VHHHP3(1,1,1,IRA(I)),R3B,HR2A,NOA,NOBUA,NOBUB,0,1)
       CALL TRT1(NOA,NOBUA,TI,HR2A)
C
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPLOOP2
      SUBROUTINE IPLOOP2(NOA,NOB,NUA,NUB,IRB,IRA,HR1,R3,R3B,GAMMA1,
     *                   GAMMA2,VHHHH,VHPHP1,VHPHP2,VHPHP3,OHHHB,OHHHA,
     *                   OHHA2,OHPPB,OHPPA,OHPA2,FHPB,FHPB2,FHPA,VHPPP1,
     *                   VHPPP2,VHPPP3,VHHHP1,VHHHP2,VHHHP3,OPHH,HR2B,
     *                   OPHH2,HR2A,TI,I3REC,INTREC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION R3(NOB,NUB,NUA,NOA),R3B(NOB,NUA,NUA,NOA)
      DIMENSION GAMMA1(NOB,NUB,NUB,NOB),GAMMA2(NOB,NUB,NUA,NOB)
      DIMENSION FHPA(NUA,NOA),FHPB(NOB,NUB),FHPB2(NUB,NOB)
      DIMENSION VHHHH(NOB,NOA,NOA,NOB),TI(1)
      DIMENSION VHPHP1(NUB,NUA,NOA,NOB),VHPHP2(NUA,NUA,NOA,NOA)
      DIMENSION VHPHP3(NUB,NUA,NOB,NOA)
      DIMENSION VHPPP1(1)
      DIMENSION VHPPP2(NUB,NUA,NUA,NOB),VHPPP3(NUA,NUA,NUA,NOA)
      DIMENSION VHHHP1(NOB,NUA,NOA,NOB),VHHHP2(NOA,NUB,NOA,NOB)
      DIMENSION VHHHP3(NOA,NUA,NOA,NOA)
      DIMENSION OHHHB(NOB,NOB,NOB),OHHHA(NOA,NOA,NOB)
      DIMENSION OHHA2(NOB,NOA,NOA),OHPPB(NUB,NUB,NOB)
      DIMENSION OHPPA(NUA,NUA,NOB),OHPA2(NUB,NUA,NOA)
      DIMENSION OPHH(NOB,NUB,NOB),HR2B(NOB,NUB,NOB)
      DIMENSION OPHH2(NOB,NUA,NOA),HR2A(NUA,NOA,NOB)
      DIMENSION IRB(NACTB),IRA(NACTA),HR1(NOB)
C
      DATA TWO/2.0D+00/, HALF/0.5D+00/
      DATA FOUR/4.00D+00/,FOURTH/0.25D+00/
C
      NOABUA2=NOABUA*NUA
C
      DO 1,I=1,NACTA
       IF(I.LE.NACTB) THEN
        CALL RDTAB(NOB,NUB,NUA,NOA,R3,(I3REC+LREC1+I),98)
       ELSE
        CALL ZEROMA(R3,1,NO2U2)
       END IF
       CALL RDTAB(NOB,NUA,NUA,NOA,R3B,(I3REC+LREC4+I),98)
C
       CALL CCMATMUL(R3,FHPA,OPHH(1,1,IRB(I)),NOBUB,1,NOAUA,0,0)
       CALL CCMATMUL(R3,VHPPP1,OPHH(1,1,IRB(I)),NOB,NUB,NOAUAB,0,0)
       CALL CCMATMUL(R3,VHPHP1,OHHHB(1,1,IRB(I)),NOB,NOB,NOAUAB,0,0)
       CALL CCMATMUL(FHPB,R3,HR2A(1,1,IRB(I)),1,NOAUA,NOBUB,0,0)
       CALL CCMATMUL(VHPPP2,R3,HR2A(1,1,IRB(I)),NUA,NOA,NOBUAB,0,0)
       CALL TRT1(NOBUB,NOAUA,TI,R3)
       CALL CCMATMUL(VHHHP1,R3,HR2B(1,1,IRB(I)),NOB,NUB,NOABUA,0,1)
       CALL INSI23(NOB,NUB,NOB,TI,HR2B)
       CALL TRT1(NUA,NOABUB,TI,R3)
       CALL TRT1(NOBUA2,NOA,TI,R3B)
       CALL VECMUL(R3B,NOABUA2,HALF)
       CALL CCMATMUL(VHHHH,R3,GAMMA1,NOAB,NUAB,NOAB,1,0)
       CALL CCMATMUL(VHHHH,R3B,GAMMA2,NOAB,NUA2,NOAB,1,0)
       IF(I.LE.NACTB) THEN
       CALL WRTAB(NOB,NOA,NUB,NUA,GAMMA1,(INTREC+LREC1+I),98)
       END IF
       CALL WRTAB(NOB,NOA,NUA,NUA,GAMMA2,(INTREC+LREC4+I),98)
C
       CALL TRT1(NOAUAB,NOB,TI,VHPHP1)
       CALL CCMATMUL(R3,VHPHP1,OHHHA(1,1,IRB(I)),NOA,NOA,NOBUAB,0,0)
       CALL TRT1(NOBUB,NOAUA,TI,VHPHP1)
       CALL CCMATMUL(VHPHP1,R3,OHPPA(1,1,IRB(I)),NUA,NUA,NOABUB,0,1)
       CALL TRT1(NOABUA,NUB,TI,VHPHP1)
C
       CALL TRT1(NOABUB,NUA,TI,R3)
       CALL CCMATMUL(VHPHP1,R3,OHPPB(1,1,IRB(I)),NUB,NUB,NOABUA,0,1)
C
       CALL TRT1(NOAUA,NOBUB,TI,R3)
       CALL ZEROIB(NOA,NOB,NUA,NUB,IRB,R3)
       CALL TRANMD(OHHHB,NOB,NOB,NOB,1,13)
       CALL CCMATMUL(R3,VHPHP1,OHHHB(1,1,IRB(I)),NOB,NOB,NOAUAB,0,1)
       CALL TRANMD(OHHHB,NOB,NOB,NOB,1,13)
       CALL TRT1(NOBUB,NOAUA,TI,R3)
       CALL INSI23(NUB,NUB,NOB,TI,OHPPB)
       CALL CCMATMUL(VHPHP1(1,1,1,IRB(I)),R3,OHPPB,NUB,NOBUB,NOAUA,0,0)
C
       CALL TRT1(NOABUA,NUB,TI,R3)
       CALL CCMATMUL(VHPHP1(1,1,1,IRB(I)),R3,HR1,1,NOB,NOAUAB,0,1)
       CALL TRT1(NUB,NOABUA,TI,R3)
C
       CALL INSI23(NUA,NUA,NOB,TI,OHPPA)
       CALL TRAN14(NUA,NOA,NOB,NUB,TI,R3)
       CALL TRT1(NUA,NOAB,TI,HR2A)
       CALL CCMATMUL(VHHHP2(1,1,1,IRB(I)),R3,HR2A,NOA,NOBUA,NOAUB,0,0)
       CALL TRT1(NOAB,NUA,TI,HR2A)
       CALL INSITU(NUB,NUA,NOA,NOB,TI,VHPHP1,12)
       CALL CCMATMUL(VHPHP1(1,1,1,IRB(I)),R3,OHPPA,NUA,NOBUA,NOAUB,0,0)
       CALL INSITU(NUA,NUB,NOA,NOB,TI,VHPHP1,12)
       CALL TRAN14(NUB,NOA,NOB,NUA,TI,R3)
C
       CALL VECMUL(R3B,NOABUA2,TWO)
       CALL TRT1(NOABUA,NUA,TI,R3B)
       CALL CCMATMUL(VHHHP1,R3B,OPHH2(1,1,IRA(I)),NOB,NUA,NOABUA,0,1)
       CALL CCMATMUL(VHPHP1,R3B,OHPA2(1,1,IRA(I)),NUB,NUA,NOABUA,0,0)
       CALL TRT1(NOAUA,NOBUA,TI,R3B)
       CALL VECMUL(R3B,NOABUA2,HALF)
C
       CALL ZEROIF(NOB,NOA,NUA,IRB,IRA(1),1,R3B)
       CALL VECMUL(FHPA,NOAUA,FOUR)
       CALL CCMATMUL(R3B,FHPA,OPHH2(1,1,IRA(I)),NOBUA,1,NOAUA,0,0)
       CALL CCMATMUL(R3B,VHPPP3,OPHH2(1,1,IRA(I)),NOB,NUA,NOAUA2,0,1)
       CALL CCMATMUL(R3B,VHPHP2,OHHA2(1,1,IRA(I)),NOB,NOA,NOAUA2,0,1)
       CALL ZEROIG(NOB,NOA,NUA,I,IRB,IRA,R3B)
       CALL TRT1(NOBUA,NOAUA,TI,R3B)
       CALL VECMUL(R3B,NOABUA2,TWO)
       CALL CCMATMUL(VHPHP2(1,1,1,IRA(I)),R3B,OHPPA,NUA,NOBUA,NOAUA,0,0)
       CALL TRT1(NUA,NOAB,TI,HR2A)
       CALL CCMATMUL(VHHHP3(1,1,1,IRA(I)),R3B,HR2A,NOA,NOBUA,NOAUA,0,0)
       CALL TRT1(NOAB,NUA,TI,HR2A)
       CALL VECMUL(R3B,NOABUA2,HALF)
C
       CALL TRT1(NOABUA,NUA,TI,R3B)
       CALL CCMATMUL(VHPHP2(1,1,1,IRA(I)),R3B,HR1,1,NOB,NOAUA2,0,1)
       CALL TRT1(NUA,NOABUA,TI,R3B)
C
       CALL INSI23(NUA,NOB,NUA,TI,OHPPA)
C
       CALL ZEROIG2(NOB,NOA,NUA,I,IRB,IRA,R3B)
       CALL TRT1(NUA,NOABUA,TI,R3B)
       CALL INSI23(NOA,NOA,NOB,TI,OHHHA)
       CALL CCMATMUL(R3B,VHPHP2(1,1,1,IRA(I)),OHHHA,NOAB,NOA,NUA2,0,1)
C
       CALL TRAN14(NOA,NOB,NUA,NUA,TI,R3B)
       CALL CCMATMUL(FHPA(1,IRA(I)),R3B,OPHH2,1,NOABUA,NUA,0,1)
       CALL VECMUL(FHPA,NOAUA,FOURTH)
       CALL VECMUL(R3B,NOABUA2,TWO)
       CALL CCMATMUL(VHPHP3(1,1,1,IRA(I)),R3B,OHPA2,NUB,NOAUA,NOBUA,0,1)
       CALL VECMUL(R3B,NOABUA2,HALF)
       CALL TRT1(NOBUA,NOAUA,TI,R3B)
       CALL INSITU(NUA,NOA,NUA,NOB,TI,R3B,23)
       CALL TRT1(NOAUA2,NUA,TI,VHPPP3)
       CALL CCMATMUL(VHPPP3(1,1,1,IRA(I)),R3B,HR2A,NUA,NOAB,NUA2,0,0)
       CALL TRT1(NUA,NOAUA2,TI,VHPPP3)
       CALL VECMUL(R3B,NOABUA2,TWO)
       CALL TRAN24(NUA,NUA,NOA,NOB,TI,R3B)
       CALL TRAN34N(NUA,NOB,NOA,NUA,TI,R3B)
       CALL TRAN34N(NOB,NUA,NOA,NOB,TI,VHHHP1)
       CALL R3HHHP(NOA,NOB,NUA,IRA(I),R3B,VHHHP1,OPHH2)
       CALL TRAN34N(NOB,NUA,NOB,NOA,TI,VHHHP1)
C
       CALL CCMATMUL(VHHHP1(1,1,1,IRB(I)),R3,HR2B,NOB,NOBUB,NOAUA,0,0)
       CALL ZEROIH(NOA,NOB,NUA,NUB,IRB,IRA,R3)
       CALL CCMATMUL(R3,FHPB2(1,IRB(I)),HR2A,NOABUA,1,NUB,0,1)
       CALL TRT1(NUA,NOABUB,TI,R3)
       CALL CCMATMUL(R3,VHPHP1(1,1,1,IRB(I)),OHHHA,NOAB,NOA,NUAB,0,1)
       CALL TRT1(NUA,NOAB,TI,HR2A)
       CALL TRT1(NOBUA,NUAB,TI,VHPPP2)
       CALL CCMATMUL(R3,VHPPP2(1,1,1,IRB(I)),HR2A,NOAB,NUA,NUAB,0,1)
       CALL TRT1(NUAB,NOBUA,TI,VHPPP2)
       CALL TRT1(NOAB,NUA,TI,HR2A)
       CALL INSI23(NOA,NOB,NOA,TI,OHHHA)
       CALL INSI23(NUB,NOB,NUB,TI,OHPPB)
       CALL INSI23(NOB,NOB,NUB,TI,HR2B)
C
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK R3HHHP
      SUBROUTINE R3HHHP(NOA,NOB,NUA,I,R3,VHHHP,HR2A)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      DIMENSION R3(1),VHHHP(NOB,NUA,NOB,NOA),HR2A(1)
C
      CALL CCMATMUL(VHHHP(1,1,1,I),R3,HR2A,NOB,NOAUA,NOBUA,0,1)
C
      RETURN
      END
C*MODULE EAIPCC  *DECK IPLOOP3
      SUBROUTINE IPLOOP3(NOA,NOB,NUA,NUB,IRB,IRA,HR1,R3,R32,GAMMA1,
     *                   VHHHH,VHPHP1,VHPHP2,VHPHP3,OHHHA,OHPPA,OHPA2,
     *                   FHPA,VHPPP1,VHHHP1,VHHHP2,VHHHP3,VHHHP4,HR2A,
     *                   OPHH2,TI,I3REC,INTREC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION R3(NOA,NUA,NUA,NOA)
      DIMENSION GAMMA1(NOA,NUA,NUA,NOA)
      DIMENSION FHPA(NUA,NOA)
      DIMENSION VHHHH(NOA,NOA,NOA,NOA),TI(1)
      DIMENSION VHPHP1(NUA,NUA,NOA,NOA),VHPHP2(NUB,NOB,NUB,NOB)
      DIMENSION VHPHP3(NUB,NUA,NOA,NOB),VHPPP1(1)
      DIMENSION VHHHP1(1),VHHHP2(1),VHHHP3(NOB,NUB,NOB,NOB)
      DIMENSION VHHHP4(NOB,NUA,NOA,NOB)
      DIMENSION OHHHA(NOA,NOA,NOB),OHPPA(NUA,NUA,NOB)
      DIMENSION OHPA2(NUB,NUA,NOA)
      DIMENSION HR2A(NOA,NUA,NOB),OPHH2(NUA,NOA,NOB)
      DIMENSION IRA(NACTA),IRB(NACTB),HR1(NOB)
C
      DATA TWO/2.0D+00/, HALF/0.5D+00/
      DATA FOUR/4.00D+00/
C
      DO 1,I=1,NACTB
       CALL RDTAB(NOA,NUA,NUA,NOA,R3,(I3REC+LREC3+I),98)
       CALL RDTAB(NOB,NUB,NUA,NOA,R32,(I3REC+LREC1+I),98)
C
       CALL CCMATMUL(R3,FHPA,HR2A(1,1,IRB(I)),NOAUA,1,NOAUA,0,0)
       CALL CCMATMUL(R3,VHPPP1,HR2A(1,1,IRB(I)),NOA,NUA,NOAUA2,0,1)
       CALL TRT1(NOB,NOAUAB,TI,R32)
       CALL CCMATMUL(VHPHP3,R32,HR1(IRB(I)),1,1,NO2U2AB,0,0)
       CALL TRT1(NUB,NOABUA,TI,R32)
       CALL CCMATMUL(R32,VHHHP2,OPHH2(1,1,IRB(I)),NUA,NOA,NOABUB,0,1)
       CALL TRT1(NOAUA,NOBUB,TI,R32)
C
       CALL VECMUL(R3,NOA2UA2,HALF)
       CALL CCMATMUL(R3,VHPHP1,OHHHA(1,1,IRB(I)),NOA,NOA,NOAUA2,0,1)
       CALL VECMUL(R3,NOA2UA2,HALF)
       CALL INSITU(NOA,NUA,NUA,NOA,TI,R3,13)
       CALL CCMATMUL(VHPHP1,R3,HR1(IRB(I)),1,1,NOA2UA2,0,1)
       CALL VECMUL(R3,NOA2UA2,HALF)
       CALL TRT1(NUA2,NOA2,TI,R3)
       CALL CCMATMUL(VHHHH,R3,GAMMA1,NOA2,NUA2,NOA2,1,0)
       CALL WRTAB(NOA,NOA,NUA,NUA,GAMMA1,(INTREC+LREC3+I),98)
       CALL INSITU(NOA,NOA,NUA,NUA,TI,R3,13)
       CALL VECMUL(R3,NOA2UA2,FOUR)
       CALL CCMATMUL(VHHHP1,R3,HR2A(1,1,IRB(I)),NOA,NUA,NOA2UA,0,0)
       CALL CCMATMUL(VHPHP1,R3,OHPPA(1,1,IRB(I)),NUA,NUA,NOA2UA,0,0)
       CALL VECMUL(R3,NOA2UA2,TWO)
C
       CALL ZEROIJ(NOA,NUA,IRA,R3)
       CALL TRAN34N(NUA,NOA,NOA,NUA,TI,R3)
       CALL CCMATMUL(VHPHP3(1,1,1,IRB(I)),R3,OHPA2,NUB,NOAUA,NOAUA,0,0)
C
       CALL ZEROII(NOA,NOB,NUA,NUB,I,IRB,IRA,R32)
       CALL CCMATMUL(VHPHP2(1,1,1,IRB(I)),R32,OHPA2,NUB,NOAUA,NOBUB,0,1)
       CALL INSITU(NOB,NUB,NUA,NOA,TI,R32,12)
       CALL INSI13(NOA,NUA,NOB,TI,HR2A)
       CALL CCMATMUL(VHHHP3(1,1,1,IRB(I)),R32,HR2A,NOB,NOAUA,NOBUB,0,0)
       CALL CCMATMUL(VHHHP4(1,1,1,IRB(I)),R3,HR2A,NOB,NOAUA,NOAUA,0,1)
       CALL INSI13(NOB,NUA,NOA,TI,HR2A)
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPLOOPBB
      SUBROUTINE IPLOOPBB(NOA,NUA,NOB,NUB,IRB,IRA,R3,HR3,FHHB,FPPB,
     *                    VHPHP1,VHPHP2,VPPP,VHPPP1,VHHHP1,OHPPB,
     *                    OHHHB,VHHHH1,T2,R2B,TI,I3REC,INTREC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION R3(NUB,NOB,NOB,NUB),HR3(NOB,NUB,NUB,NOB)
      DIMENSION FHHB(NOB,NOB),FPPB(NUB,NUB),VPPP(NUB,NUB,NUB)
      DIMENSION VHPHP1(NUB,NUB,NOB,NOB),VHPHP2(NUB,NUA,NOB,NOA)
      DIMENSION VHHHH1(NOB,NOB,NOB,NOB)
      DIMENSION VHPPP1(NUB,NUB,NUB,NOB),VHHHP1(NOB,NUB,NOB,NOB)
      DIMENSION R2B(NOB,NUB,NOB),T2(NOB,NUB,NUB,NOB)
      DIMENSION OHPPB(NUB,NUB,NOB),OHHHB(NOB,NOB,NOB)
      DIMENSION TI(1),IRB(NACTB),IRA(NACTA)
      DATA TWO/2.0D+00/, HALF/0.5D+00/
      DATA EIGHTH/0.125D+00/,FOUR/4.0D+00/
C
      DO 1, I=1,NACTB
       CALL ZEROMA(HR3,1,NO2U2)
       CALL RDTAB(NOB,NUB,NUA,NOA,R3,(I3REC+LREC1+I),98)
       CALL TRT1(NOBUB,NOAUA,TI,R3)
       CALL CCMATMUL(VHPHP2,R3,HR3,NOBUB,NOBUB,NOAUA,1,1)
       CALL RDTAB(NOB,NUB,NUB,NOB,R3,(I3REC+I),98)
       CALL TRANSQ(R3,NOBUB)
       CALL CCMATMUL(VHPHP1,R3,HR3,NOBUB,NOBUB,NOBUB,0,1)
       CALL TRANSQ(HR3,NOBUB)
       CALL TRANSQ(R3,NOBUB)
       CALL CCMATMUL(R3,FHHB,HR3,NOBUB2,NOB,NOB,0,1)
       CALL WRTAB(NOB,NUB,NUB,NOB,HR3,(INTREC+IHREC+I),98)
       CALL VECMUL(HR3,NOB2UB2,TWO)
C
       CALL TRAN1TO4(NOB,NUB,NUB,NOB,TI,HR3)
       CALL VECMUL(R3,NOB2UB2,EIGHTH)
       CALL TRANSQ(R3,NOBUB)
       DO 2,IE=1,NUB
       READ(NFT899,REC=NUA+IE) VPPP
       CALL CCMATMUL(VPPP,R3(1,1,1,IE),HR3,NUB2,NOB2,NUB,0,1)
 2     CONTINUE
       CALL TRT1(NOB,NOBUB,TI,R2B)
       CALL CCMATMUL(R2B(1,1,IRB(I)),VHHHP1,HR3,NUB,NOB2UB,NOB,0,0)
       CALL TRT1(NOBUB,NOB,TI,R2B)
C
       CALL TRAN1TO4(NUB,NUB,NOB,NOB,TI,HR3)
       CALL VECMUL(R3,NOB2UB2,FOUR)
       CALL CCMATMUL(FPPB,R3,HR3,NUB,NOB2UB,NUB,0,0)
       CALL TRANSQ(T2,NOBUB)
       CALL CCMATMUL(T2,OHPPB(1,1,IRB(I)),HR3,NOB2UB,NUB,NUB,0,0)
       CALL TRANSQ(T2,NOBUB)
C
       CALL INSITU(NUB,NOB,NOB,NUB,TI,HR3,13)
       CALL INSI23(NOB,NUB,NOB,TI,R2B)
       CALL VECMUL(R2B,NOB2UB,HALF)
       CALL CCMATMUL(R2B,VHPPP1(1,1,1,IRB(I)),HR3,NOB2,NUB2,NUB,0,0)
       CALL INSI23(NOB,NOB,NUB,TI,R2B)
       CALL VECMUL(R2B,NOB2UB,TWO)
       CALL TRT1(NOB2,NOB,TI,OHHHB)
       CALL VECMUL(OHHHB,NOB3,HALF)
       CALL CCMATMUL(OHHHB,T2(1,1,1,IRB(I)),HR3,NOB2,NUB2,NOB,0,0)
       CALL TRT1(NOB,NOB2,TI,OHHHB)
       CALL VECMUL(OHHHB,NOB3,TWO)
C
       CALL TRAN24(NOB,NOB,NUB,NUB,TI,HR3)
       CALL CCMATMUL(R2B(1,1,IRB(I)),VHPPP1,HR3,NOB,NOBUB2,NUB,0,0)
       CALL VECMUL(R2B,NOB2UB,TWO)
       CALL CCMATMUL(R2B,VHHHP1(1,1,1,IRB(I)),HR3,NOBUB,NOBUB,NOB,0,1)
       CALL VECMUL(R2B,NOB2UB,HALF)
       CALL VECMUL(T2,NOB2UB2,TWO)
       CALL CCMATMUL(T2(1,1,1,IRB(I)),OHPPB,HR3,NOBUB,NOBUB,NUB,0,1)
       CALL VECMUL(T2,NOB2UB2,HALF)
       CALL CCMATMUL(OHHHB(1,1,IRB(I)),T2,HR3,NOB,NOBUB2,NOB,0,1)
C
       CALL INSITU(NUB,NOB,NUB,NOB,TI,VHPHP1,23)
       CALL INSITU(NUB,NOB,NUA,NOA,TI,VHPHP2,23)
       DO 3,M=1,NACTA
       IF(M.LE.NACTB) THEN
       CALL RDTAB(NOB,NUB,NUB,NOB,R3,(I3REC+M),98)
       CALL ZEROIK(NOB,NUB,M,IRB,R3)
       CALL CCMATMUL(VHHHH1(1,1,IRB(I),IRB(M)),R3,HR3,NOB,NOBUB2,NOB,
     *               0,0)
       CALL ZEROIK2(NOB,NUB,M,IRB,R3)
       CALL CCMATMUL(FHHB(IRB(M),IRB(I)),R3,HR3,1,NOB2UB2,1,0,1)
       CALL TRANSQ(R3,NOBUB)
       CALL TRANSQ(HR3,NOBUB)
       CALL CCMATMUL(VHPHP1(1,1,IRB(I),IRB(M)),R3,HR3,NUB,NOB2UB,NUB,
     *               0,1)
       ELSE
       CALL TRANSQ(HR3,NOBUB)
       END IF
       CALL RDTAB(NOB,NUB,NUA,NOB,R3,(I3REC+LREC2+M),98)
       CALL ZEROID(NOB,NUA,NUB,IRB,R3)
       CALL ZEROIE(NOB,NUA,NUB,IRB,R3)
       CALL TRT1(NOBUB,NOBUA,TI,R3)
       CALL CCMATMUL(VHPHP2(1,1,IRB(I),IRA(M)),R3,HR3,NUB,NOB2UB,NUA,
     *               0,1)
       CALL TRANSQ(HR3,NOBUB)
 3     CONTINUE
       CALL INSITU(NUB,NUB,NOB,NOB,TI,VHPHP1,23)
       CALL INSITU(NUB,NUA,NOB,NOA,TI,VHPHP2,23)
C
       CALL WRTAB(NOB,NUB,NUB,NOB,HR3,(I3REC+IHREC+I),98)
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPMAKEBB
      SUBROUTINE IPMAKEBB(NOB,NUB,R3,HR3,T2,IRB,I3REC,INTREC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION R3(NOB,NUB,NUB,NOB)
      DIMENSION HR3(NOB,NUB,NUB,NOB)
      DIMENSION T2(1),IRB(NACTB)
C
      DATA ONE/1.00D+00/
      DATA TWON/-2.0D+00/, ONEN/-1.0D+00/
C
      DO 1,I=1,NACTB
       CALL RDTAB(NOB,NUB,NUB,NOB,HR3,(I3REC+IHREC+I),98)
       CALL RDTAB(NOB,NOB,NUB,NUB,R3,(INTREC+I),98)
       CALL TRAN24(NOB,NOB,NUB,NUB,T2,R3)
       CALL DAXPY(NOB2UB2,ONE,R3,1,HR3,1)
       CALL ZEROMA(R3,1,NO2U2)
C
       DO 2,K=1,NACTB
        CALL RDTAB(NOB,NOB,NUB,NUB,R3,(INTREC+K),98)
        CALL TRAN1TO4(NOB,NOB,NUB,NUB,T2,R3)
        CALL DAXPY(NOBUB2,TWON,R3(1,1,1,IRB(I)),1,HR3(1,1,1,IRB(K)),1)
        CALL RDTAB(NOB,NUB,NUB,NOB,R3,(INTREC+IHREC+K),98)
        CALL TRANMD(HR3,NOB,NUB,NUB,NOB,14)
        CALL DAXPY(NOBUB2,ONE,R3(1,1,1,IRB(I)),1,HR3(1,1,1,IRB(K)),1)
        CALL TRANMD(HR3,NOB,NUB,NUB,NOB,14)
        CALL ZEROIA(NOB,NUB,IRB,R3)
        CALL DAXPY(NOBUB2,ONEN,R3(1,1,1,IRB(I)),1,HR3(1,1,1,IRB(K)),1)
 2     CONTINUE
C
       CALL ZEROMA(R3,1,NO2U2)
       CALL SYMETR2(HR3,NOB,NUB,R3)
       CALL WRTAB(NOB,NUB,NUB,NOB,HR3,(I3REC+IHREC+I),98)
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPLOOPAA
      SUBROUTINE IPLOOPAA(NOA,NUA,NOB,NUB,IRB,IRA,R3,HR3,FHHB,FHHA,
     *                    FPPA,VPPP,VHPHP1,VHPHP2,VHPHP3,VHHHP1,
     *                    VHHHP2,VHPPP1,VHHHH1,VHHHH2,R2A,T2,T2B,OHPPA,
     *                    OHPPA2,OHHHA,R3B,TI,I3REC,INTREC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION R3(NUA,NOA,NOA,NUA),HR3(1)
      DIMENSION FHHB(NOB,NOB),FHHA(NOA,NOA)
      DIMENSION VHPHP1(NUA,NOA,NUA,NOA),VHPHP2(NUB,NOB,NUA,NOA)
      DIMENSION VHPHP3(NUA,NUA,NOB,NOB),VPPP(NUA,NUA,NUA)
      DIMENSION VHHHP1(NOB,NUA,NOA,NOB),VHHHP2(NOA,NOA,NUA,NOA)
      DIMENSION VHPPP1(NUA,NUA,NUA,NOA)
      DIMENSION VHHHH1(NOA,NOA,NOB,NOB),VHHHH2(NOA,NOB,NOA,NOB)
      DIMENSION R2A(NOA,NUA,NOB),R3B(NUA,NOA,NOB,NUA)
      DIMENSION T2(1),T2B(NOA,NUA,NUB,NOB)
      DIMENSION OHPPA(NUA,NUA,NOB),OHPPA2(NUB,NUA,NOA)
      DIMENSION OHHHA(NOA,NOA,NOB)
      DIMENSION TI(1),IRB(NACTB),IRA(NACTA)
      DATA TWO/2.0D+00/, HALF/0.5D+00/
      DATA EIGHTH/0.125D+00/
C
      NOABUA2=NOABUA*NUA
      DO 1,I=1,NACTA
       IF(I.LE.NACTB) THEN
       CALL ZEROMA(HR3,1,NO2U2)
       CALL RDTAB(NOB,NUB,NUA,NOA,R3,(I3REC+LREC1+I),98)
       CALL TRAN14(NOB,NUB,NUA,NOA,TI,R3)
       CALL INSITU(NOA,NUB,NUA,NOB,TI,R3,23)
       CALL CCMATMUL(R3,VHPHP2,HR3,NOAUA,NOAUA,NOBUB,1,1)
       CALL RDTAB(NOA,NUA,NUA,NOA,R3,(I3REC+LREC3+I),98)
       CALL CCMATMUL(R3,FHHA,HR3,NOAUA2,NOA,NOA,0,1)
       CALL CCMATMUL(R3,VHPHP1,HR3,NOAUA,NOAUA,NOAUA,0,1)
       CALL WRTAB(NOA,NUA,NUA,NOA,HR3,(INTREC+IHREC+LREC3+I),98)
C
       CALL TRANSQ(HR3,NOAUA)
       CALL TRANSQ(R3,NOAUA)
       CALL CCMATMUL(FPPA,R3,HR3,NUA,NOA2UA,NUA,0,0)
       CALL CCMATMUL(T2,OHPPA(1,1,IRB(I)),HR3,NOA2UA,NUA,NUA,0,0)
C
       CALL TRT1(NOA2UA,NUA,TI,HR3)
       CALL VECMUL(R3,NOA2UA2,EIGHTH)
       CALL RDTAB(NOB,NUA,NUA,NOA,R3B,(I3REC+LREC4+I),98)
       CALL TRT1(NOBUA,NOAUA,TI,R3B)
       CALL ZEROMA(TI,1,NOU3)
       DO 2,IE=1,NUA
        READ(NFT899,REC=IE) VPPP
        CALL CCMATMUL(VPPP,R3(1,1,1,IE),HR3,NUA2,NOA2,NUA,0,1)
        CALL CCMATMUL(VPPP,R3B(1,1,1,IE),TI,NUA2,NOAB,NUA,0,1)
 2     CONTINUE
       CALL WRTAB(NUA,NUA,NOA,NOB,TI,(INTREC+IHREC+I),98)
C
       CALL TRT1(NUA2,NOA2,TI,HR3)
       CALL VECMUL(R2A,NOABUA,HALF)
       CALL CCMATMUL(VHHHP2,R2A(1,1,IRB(I)),HR3,NOA2UA,NUA,NOA,0,1)
C
       CALL TRAN1TO4(NOA,NOA,NUA,NUA,TI,HR3)
       CALL CCMATMUL(R2A(1,1,IRB(I)),VHPPP1,HR3,NOA,NOAUA2,NUA,0,1)
       CALL VECMUL(R2A,NOABUA,TWO)
       CALL CCMATMUL(R2A,VHHHP1(1,1,1,IRB(I)),HR3,NOAUA,NOAUA,NOB,0,1)
       CALL CCMATMUL(T2B(1,1,1,IRB(I)),OHPPA2,HR3,NOAUA,NOAUA,NUB,0,1)
       CALL TRANSQ(T2,NOAUA)
       CALL CCMATMUL(OHHHA(1,1,IRB(I)),T2,HR3,NOA,NOAUA2,NOA,0,1)
       CALL TRANSQ(T2,NOAUA)
C
       DO 3,M=1,NACTA
        IF(M.LE.NACTB) THEN
        CALL RDTAB(NOA,NUA,NUA,NOA,R3,(I3REC+LREC3+M),98)
        CALL VECMUL(R3,NOA2UA2,HALF)
        CALL ZEROIM(NOA,NUA,IRA,R3)
        CALL ZEROIM2(NOA,NUA,IRA,R3)
        CALL CCMATMUL(FHHB(IRB(I),IRB(M)),R3,HR3,1,NOA2UA2,1,0,1)
        CALL CCMATMUL(VHHHH1(1,1,IRB(M),IRB(I)),R3,HR3,NOA,NOAUA2,
     *                NOA,0,0)
        CALL TRANSQ(HR3,NOAUA)
        CALL TRANSQ(R3,NOAUA)
        CALL CCMATMUL(R3,VHPHP3(1,1,IRB(M),IRB(I)),HR3,NOA2UA,NUA,
     *                NUA,0,1)
        CALL TRANSQ(HR3,NOAUA)
        END IF
        CALL RDTAB(NOB,NUA,NUA,NOA,R3,(I3REC+LREC4+M),98)
        CALL VECMUL(R3,NOABUA2,HALF)
        CALL ZEROIG3(NOB,NOA,NUA,IRA,R3)
        CALL CCMATMUL(VHHHH2(1,1,IRA(M),IRB(I)),R3,HR3,NOA,NOAUA2,
     *                NOB,0,0)
 3     CONTINUE
C
       CALL WRTAB(NOA,NUA,NUA,NOA,HR3,(I3REC+IHREC+LREC3+I),98)
       ELSE
       CALL RDTAB(NOB,NUA,NUA,NOA,R3B,(I3REC+LREC4+I),98)
       CALL TRT1(NOBUA,NOAUA,TI,R3B)
       CALL ZEROMA(TI,1,NOU3)
       DO 12,IE=1,NUA
        READ(NFT899,REC=IE) VPPP
        CALL CCMATMUL(VPPP,R3B(1,1,1,IE),TI,NUA2,NOAB,NUA,0,1)
 12    CONTINUE
       CALL WRTAB(NUA,NUA,NOA,NOB,TI,(INTREC+IHREC+I),98)
       END IF
C
       CALL ZEROMA(HR3,1,NO2U2)
       CALL RDTAB(NOB,NUA,NUA,NOA,R3,(I3REC+LREC4+I),98)
       CALL CCMATMUL(R3,FHHA,HR3,NOBUA2,NOA,NOA,1,1)
       CALL CCMATMUL(R3,VHPHP1,HR3,NOBUA,NOAUA,NOAUA,0,1)
       CALL RDTAB(NOB,NUB,NUA,NOB,R3,(I3REC+LREC2+I),98)
       CALL INSITU(NOB,NUB,NUA,NOB,TI,R3,23)
       CALL CCMATMUL(R3,VHPHP2,HR3,NOBUA,NOAUA,NOBUB,0,1)
       CALL WRTAB(NOB,NUA,NUA,NOA,HR3,(INTREC+IHREC+LREC2+I),98)
C
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPLOOPAA2
      SUBROUTINE IPLOOPAA2(NOA,NUA,NOB,NUB,IRB,IRA,R3,HR3,FHHB,FHHA,
     *                     FPPA,VHPHP1,VHPPP1,VHHHP1,VHHHP2,VHHHP3,
     *                     VHHHH1,VHHHH2,VHHHH3,VHPHP2,VHPHP3,R2A,R2A2,
     *                     T2,T2A,T2B,OHHHA,OHPPA,OHPPA2,TI,I3REC,
     *                     INTREC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION R3(1),HR3(1)
      DIMENSION FHHB(NOB,NOB),FPPA(NUA,NUA),FHHA(NOA,NOA)
      DIMENSION VHPHP1(NOB,NUA,NOB,NUA),VHPHP2(NUA,NUA,NOA,NOA)
      DIMENSION VHPHP3(NUB,NUA,NOB,NOA)
      DIMENSION VHPPP1(NUA,NUA,NUA,NOA),VHHHP1(NOB,NUA,NOA,NOB)
      DIMENSION VHHHP2(NOB,NUA,NOB,NOA),VHHHP3(NOA,NOA,NUA,NOA)
      DIMENSION VHHHH1(NOB,NOB,NOA,NOA),VHHHH2(NOB,NOA,NOB,NOA)
      DIMENSION VHHHH3(NOA,NOA,NOA,NOA)
      DIMENSION OHHHA(NOB,NOA,NOA),OHPPA(NOB,NUA,NUA)
      DIMENSION OHPPA2(NUB,NUA,NOA),R2A2(NUA,NOB,NOA)
      DIMENSION T2(NOA,NUA,NUA,NOA),T2A(NUA,NUA,NOA,NOA)
      DIMENSION T2B(NOB,NUA,NUB,NOA),R2A(NOB,NUA,NOA)
      DIMENSION TI(1),IRB(NACTB),IRA(NACTA)
      DATA QUART/0.25D+00/
C
      NOABUA2=NOABUA*NUA
      DO 1,I=1,NACTA
       CALL ZEROMA(R3,1,NO2U2)
       CALL ZEROMA(HR3,1,NO2U2)
       CALL RDTAB(NOB,NUA,NUA,NOA,R3,(I3REC+LREC4+I),98)
       CALL CCMATMUL(FHHB,R3,HR3,NOB,NOAUA2,NOB,1,1)
       CALL CCMATMUL(VHPHP1,R3,HR3,NOBUA,NOAUA,NOBUA,0,1)
       CALL WRTAB(NOB,NUA,NUA,NOA,HR3,(INTREC+IHREC+LREC4+I),98)
C
       CALL TRT1(NOBUA,NOAUA,TI,HR3)
       CALL TRT1(NOBUA,NOAUA,TI,R3)
       CALL CCMATMUL(FPPA,R3,HR3,NUA,NOABUA,NUA,0,0)
C
       CALL TRT1(NOABUA,NUA,TI,HR3)
       CALL RDTAB(NUA,NUA,NOA,NOB,TI,(INTREC+IHREC+I),98)
       CALL DAXPY(NOABUA2,QUART,TI,1,HR3,1)
       CALL CCMATMUL(R2A2(1,1,IRA(I)),VHHHP1,HR3,NUA,NOABUA,NOB,0,1)
C
       CALL TRT1(NUA2,NOAB,TI,HR3)
       CALL TRT1(NOAB,NOA,TI,OHHHA)
       CALL CCMATMUL(OHHHA,T2(1,1,1,IRA(I)),HR3,NOAB,NUA2,NOA,0,0)
       CALL TRT1(NOA,NOAB,TI,OHHHA)
       CALL TRT1(NOBUAB,NOA,TI,T2B)
       CALL CCMATMUL(T2B,OHPPA2(1,1,IRA(I)),HR3,NOABUA,NUA,NUB,0,0)
       CALL TRT1(NOA,NOBUAB,TI,T2B)
       CALL TRT1(NOBUA,NOA,TI,R2A)
       CALL CCMATMUL(R2A,VHPPP1(1,1,1,IRA(I)),HR3,NOAB,NUA2,NUA,0,0)
       CALL TRT1(NOA,NOBUA,TI,R2A)
C
       CALL TRT1(NOA,NOBUA2,TI,HR3)
       CALL CCMATMUL(OHHHA(1,1,IRA(I)),T2,HR3,NOB,NOAUA2,NOA,0,1)
       CALL CCMATMUL(OHPPA,T2A(1,1,1,IRA(I)),HR3,NOBUA,NOAUA,NUA,0,0)
       CALL CCMATMUL(T2B(1,1,1,IRA(I)),OHPPA2,HR3,NOBUA,NOAUA,NUB,0,1)
       CALL CCMATMUL(R2A(1,1,IRA(I)),VHPPP1,HR3,NOB,NOAUA2,NUA,0,1)
       CALL CCMATMUL(VHHHP2(1,1,1,IRA(I)),R2A,HR3,NOBUA,NOAUA,NOB,0,1)
       CALL CCMATMUL(R2A,VHHHP3(1,1,1,IRA(I)),HR3,NOBUA,NOAUA,NOA,0,1)
C
       DO 2,J=1,NACTA
        CALL RDTAB(NOB,NUA,NUA,NOA,R3,(I3REC+LREC4+J),98)
        CALL ZEROIG3(NOB,NOA,NUA,IRA,R3)
        CALL CCMATMUL(VHHHH1(1,1,IRA(J),IRA(I)),R3,HR3,NOB,NOAUA2,
     *                NOB,0,0)
        CALL ZEROIF(NOB,NOA,NUA,IRB,IRA(1),2,R3)
        CALL CCMATMUL(FHHA(IRA(J),IRA(I)),R3,HR3,1,NOABUA2,1,0,1)
        CALL RDTAB(NOB,NUA,NUA,NOA,R3,(I3REC+LREC4+J),98)
        CALL ZEROIF(NOB,NOA,NUA,IRB,IRA(1),1,R3)
        CALL ZEROIG(NOB,NOA,NUA,J,IRB,IRA,R3)
        CALL CCMATMUL(R3,VHHHH3(1,1,IRA(J),IRA(I)),HR3,NOBUA2,NOA,
     *                NOA,0,0)
        CALL TRT1(NOBUA,NOAUA,TI,R3)
        CALL TRT1(NOBUA,NOAUA,TI,HR3)
        CALL ZEROIG2(NOB,NOA,NUA,J,IRB,IRA,R3)
        CALL CCMATMUL(R3,VHPHP2(1,1,IRA(J),IRA(I)),HR3,NOABUA,NUA,
     *                NUA,0,1)
        IF(J.LE.NACTB) THEN
        CALL RDTAB(NOB,NUB,NUA,NOA,R3,(I3REC+LREC1+J),98)
        CALL ZEROIB(NOA,NOB,NUA,NUB,IRB,R3)
        CALL TRT1(NOBUB,NOAUA,TI,R3)
        CALL ZEROIH(NOA,NOB,NUA,NUB,IRB,IRA,R3)
        CALL CCMATMUL(R3,VHPHP3(1,1,IRB(J),IRA(I)),HR3,NOABUA,NUA,
     *                NUB,0,0)
        CALL TRT1(NOAUA,NOBUA,TI,HR3)
        CALL RDTAB(NOA,NUA,NUA,NOA,R3,(I3REC+LREC3+J),98)
        CALL ZEROIM(NOA,NUA,IRA,R3)
        CALL ZEROIM2(NOA,NUA,IRA,R3)
        CALL CCMATMUL(VHHHH2(1,1,IRB(J),IRA(I)),R3,HR3,NOB,NOAUA2,
     *                NOA,0,0)
        ELSE
        CALL TRT1(NOAUA,NOBUA,TI,HR3)
        END IF
 2     CONTINUE
C
       CALL WRTAB(NOB,NUA,NUA,NOA,HR3,(I3REC+IHREC+LREC4+I),98)
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPMAKEAA
      SUBROUTINE IPMAKEAA(NOA,NOB,NUA,R3,R3B,HR3,HR3B,T2,
     *                    IRA,IRB,I3REC,INTREC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION R3(NOA,NUA,NUA,NOB)
      DIMENSION R3B(NOB,NUA,NUA,NOA)
      DIMENSION HR3(NOA,NUA,NUA,NOA),HR3B(NOB,NUA,NUA,NOA)
      DIMENSION T2(1),IRB(NACTB),IRA(NACTA)
C
      DATA ONE/1.00D+00/, HALF/0.5D+00/, HALFN/-0.5D+00/
      DATA ONEN/-1.0D+00/
C
      NOABUA2=NOABUA*NUA
      DO 1,I=1,NACTA
       IF(I.LE.NACTB) THEN
       CALL RDTAB(NOA,NUA,NUA,NOA,HR3,(I3REC+IHREC+LREC3+I),98)
       CALL RDTAB(NOA,NOA,NUA,NUA,R3,(INTREC+LREC3+I),98)
       CALL TRAN24(NOA,NOA,NUA,NUA,T2,R3)
       CALL DAXPY(NOA2UA2,ONE,R3,1,HR3,1)
       CALL ZEROMA(R3,1,NO2U2)
       DO 2,J=1,NACTA
        CALL RDTAB(NOB,NOA,NUA,NUA,R3,(INTREC+LREC4+J),98)
        CALL TRAN1TO4(NOB,NOA,NUA,NUA,T2,R3)
        CALL DAXPY(NOAUA2,ONEN,R3(1,1,1,IRB(I)),1,HR3(1,1,1,IRA(J)),1)
        CALL RDTAB(NOB,NUA,NUA,NOA,R3,(INTREC+IHREC+LREC4+J),98)
        CALL TRANMD(HR3,NOA,NUA,NUA,NOA,14)
        CALL TRAN14(NOB,NUA,NUA,NOA,T2,R3)
        CALL DAXPY(NOAUA2,HALF,R3(1,1,1,IRB(I)),1,HR3(1,1,1,IRA(J)),1)
        CALL TRANMD(HR3,NOA,NUA,NUA,NOA,14)
        CALL ZEROIL(NOB,NOA,NUA,IRA,IRB,R3)
        CALL DAXPY(NOAUA2,HALFN,R3(1,1,1,IRB(I)),1,HR3(1,1,1,IRA(J)),1)
 2     CONTINUE
C
       CALL ZEROMA(R3,1,NO2U2)
       CALL SYMETR2(HR3,NOA,NUA,R3)
       CALL WRTAB(NOA,NUA,NUA,NOA,HR3,(I3REC+IHREC+LREC3+I),98)
       END IF
C
       CALL RDTAB(NOB,NUA,NUA,NOA,HR3B,(I3REC+IHREC+LREC4+I),98)
       CALL RDTAB(NOB,NUA,NUA,NOA,R3B,(INTREC+IHREC+LREC2+I),98)
       CALL DAXPY(NOABUA2,ONE,R3B,1,HR3B,1)
       CALL RDTAB(NOB,NOA,NUA,NUA,R3B,(INTREC+LREC4+I),98)
       CALL TRAN24(NOB,NOA,NUA,NUA,T2,R3B)
       CALL DAXPY(NOABUA2,ONEN,R3B,1,HR3B,1)
C
       DO 3, J=1,NACTA
        CALL RDTAB(NOB,NOA,NUA,NUA,R3B,(INTREC+LREC4+J),98)
        CALL TRAN24(NOB,NOA,NUA,NUA,T2,R3B)
        CALL DAXPY(NOBUA2,ONE,R3B(1,1,1,IRA(I)),1,HR3B(1,1,1,IRA(J)),1)
        CALL RDTAB(NOB,NUA,NUA,NOA,R3B,(INTREC+IHREC+LREC2+J),98)
        CALL DAXPY(NOBUA2,ONEN,R3B(1,1,1,IRA(I)),1,HR3B(1,1,1,IRA(J)),1)
 3     CONTINUE
C
       CALL TRAN14(NOB,NUA,NUA,NOA,T2,HR3B)
       CALL IPMAKAA2(NOB,NOA,NUA,R3,HR3B,T2,IRA,IRB,I,INTREC)
       CALL TRAN14(NOA,NUA,NUA,NOB,T2,HR3B)
C
       CALL ZEROMA(R3,1,NO2U2)
       CALL SYMETR3BC(HR3B,NOA,NOB,NUA,R3)
       CALL WRTAB(NOB,NUA,NUA,NOA,HR3B,(I3REC+IHREC+LREC4+I),98)
C
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPMAKAA2
      SUBROUTINE IPMAKAA2(NOB,NOA,NUA,R3,HR3B,T2,IRA,IRB,I,INTREC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION R3(NOA,NUA,NUA,NOA),HR3B(NOA,NUA,NUA,NOB)
      DIMENSION T2(1),IRB(NACTB),IRA(NACTA)
C
      DATA TWON/-2.0D+00/, ONEN/-1.0D+00/
C
      DO 1,J=1,NACTB
       CALL RDTAB(NOA,NOA,NUA,NUA,R3,(INTREC+LREC3+J),98)
       CALL TRAN1TO4(NOA,NOA,NUA,NUA,T2,R3)
       CALL DAXPY(NOAUA2,TWON,R3(1,1,1,IRA(I)),1,HR3B(1,1,1,IRB(J)),1)
       CALL RDTAB(NOA,NOA,NUA,NUA,R3,(INTREC+IHREC+LREC3+J),98)
       CALL ZEROIM(NOA,NUA,IRA,R3)
       CALL DAXPY(NOAUA2,ONEN,R3(1,1,1,IRA(I)),1,HR3B(1,1,1,IRB(J)),1)
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPLOOPBA
      SUBROUTINE IPLOOPBA(NOA,NUA,NOB,NUB,IRB,IRA,R3,R3B,HR3,FHHB,FHHA,
     *                    FPPB,FPPA,VPPP,VHPHP1,VHPHP2,VHPHP3,VHPHP4,
     *                    VHPHP5,VHPHP6,VHPPP1,VHPPP2,VHHHP1,VHHHP2,
     *                    VHHHP3,VHHHH1,VHHHH2,VHHHH3,R2B,R2A,T2,T2B,
     *                    OHHHB,OHHHA,OHPPB,OHPPA,OHPA2,TI,I3REC,INTREC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /CCOPIO/ NFT820,NFT821,NFT822,NFT823,NFT825,NFT826,NFT827,
     *                NFT828,NFT829,NFT830,NFT831,NFT832,NFT833,NFT834,
     *                NFT835,NFT836,NFT837,NFT838,NFT839,NFT843,NFT848,
     *                NFT858,NFT859,NFT891,NFT892,NFT899
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION R3(NUA,NOB,NOA,NUB),HR3(1),R3B(NUA,NOB,NOB,NUB)
      DIMENSION FHHB(NOB,NOB),FHHA(NOA,NOA)
      DIMENSION FPPB(NUB,NUB),FPPA(NUA,NUA)
      DIMENSION VPPP(NUA,NUB,NUA)
      DIMENSION VHPHP1(1),VHPHP2(1)
      DIMENSION VHPHP3(1),VHPHP4(NUA,NUA,NOB,NOB)
      DIMENSION VHPHP5(NUB,NUB,NOB,NOB),VHPHP6(NUA,NUB,NOA,NOB)
      DIMENSION VHPPP1(NUA,NUB,NUA,NOB),VHPPP2(1)
      DIMENSION VHHHP1(NOA,NUB,NOA,NOB),VHHHP2(NOB,NUA,NOA,NOB)
      DIMENSION VHHHP3(NOB,NUB,NOB,NOB),VHHHH1(NOB,NOB,NOB,NOB)
      DIMENSION VHHHH2(NOA,NOA,NOB,NOB),VHHHH3(NOB,NOA,NOB,NOA)
      DIMENSION R2B(NOB,NUB,NOB),R2A(NUA,NOA,NOB)
      DIMENSION T2(NOB,NUB,NUB,NOB),T2B(NOA,NUA,NUB,NOB)
      DIMENSION OHHHB(NOB,NOB,NOB),OHHHA(NOA,NOA,NOB)
      DIMENSION OHPPB(NUB,NUB,NOB),OHPPA(NUA,NUA,NOB)
      DIMENSION OHPA2(NUB,NUA,NOA)
      DIMENSION TI(1),IRB(NACTB),IRA(NACTA)
C
      DO 1,I=1,NACTA
       IF(I.LE.NACTB) THEN
       CALL ZEROMA(HR3,1,NO2U2)
       CALL RDTAB(NOA,NUA,NUA,NOA,R3,(I3REC+LREC3+I),98)
       CALL CCMATMUL(VHPHP6,R3,HR3,NOBUB,NOAUA,NOAUA,1,1)
       CALL RDTAB(NOB,NUB,NUA,NOA,R3,(I3REC+LREC1+I),98)
       CALL CCMATMUL(FHHB,R3,HR3,NOB,NOAUAB,NOB,0,1)
       CALL CCMATMUL(VHPHP5,R3,HR3,NOBUB,NOAUA,NOBUB,0,1)
       CALL INSITU(NOB,NUB,NUA,NOA,TI,HR3,23)
       CALL INSITU(NOB,NUB,NUA,NOA,TI,R3,23)
       CALL CCMATMUL(VHPHP4,R3,HR3,NOBUA,NOAUB,NOBUA,0,1)
       CALL INSITU(NOB,NUA,NUB,NOA,TI,HR3,23)
       CALL WRTAB(NOB,NUB,NUA,NOA,HR3,(INTREC+IHREC+LREC1+I),98)
C
       CALL INSI12(NUA,NOB,NOA,TI,R2A)
       CALL CCMATMUL(VHHHP3(1,1,1,IRB(I)),R2A,HR3,NOBUB,NOAUA,NOB,0,0)
C
       CALL INSITU(NOB,NUB,NUA,NOA,TI,HR3,23)
       CALL CCMATMUL(R2A,VHHHP1(1,1,1,IRB(I)),HR3,NOBUA,NOAUB,NOA,0,0)
       CALL INSI12(NOB,NUA,NOA,TI,R2A)
C
       CALL TRT1(NOBUA,NOAUB,TI,HR3)
       CALL TRT1(NOBUA,NOAUB,TI,R3)
       CALL CCMATMUL(FPPB,R3,HR3,NUB,NOABUA,NUB,0,0)
C
       CALL TRAN14(NUB,NOA,NOB,NUA,TI,HR3)
       CALL TRAN14(NUB,NOA,NOB,NUA,TI,R3)
       CALL CCMATMUL(FPPA,R3,HR3,NUA,NOABUB,NUA,0,0)
C
       CALL TRAN34N(NUA,NOA,NOB,NUB,TI,HR3)
       CALL INSITU(NOA,NUA,NOB,NUB,TI,T2B,12)
       CALL CCMATMUL(OHPPA(1,1,IRB(I)),T2B,HR3,NUA,NOABUB,NUA,0,0)
       CALL INSITU(NUA,NOA,NOB,NUB,TI,T2B,12)
C
       CALL INSITU(NUA,NOA,NUB,NOB,TI,HR3,12)
       CALL TRT1(NOB,NOA2,TI,OHHHA)
       CALL CCMATMUL(OHHHA(1,1,IRB(I)),T2B,HR3,NOA,NOBUAB,NOA,0,1)
       CALL TRT1(NOA2,NOB,TI,OHHHA)
       CALL CCMATMUL(T2B,OHHHB(1,1,IRB(I)),HR3,NOAUAB,NOB,NOB,0,1)
       CALL CCMATMUL(T2B(1,1,1,IRB(I)),OHPPB,HR3,NOAUA,NOBUB,NUB,0,1)
       CALL T2OHPPA(NOA,NOB,NUA,NUB,IRB(I),T2B,OHPPA,HR3,TI)
C
       CALL TRAN1TO4(NOA,NUA,NUB,NOB,TI,HR3)
       CALL INSITU(NUA,NOA,NOB,NUB,TI,R3,23)
       CALL RDTAB(NOB,NUB,NUA,NOB,R3B,(I3REC+LREC2+I),98)
       CALL TRT1(NOBUB,NOBUA,TI,R3B)
       CALL ZEROMA(TI,1,NOU3)
       DO 2,IE=1,NUB
        READ(NFT899,REC=NUA+NUB+IE) VPPP
        CALL CCMATMUL(VPPP,R3(1,1,1,IE),HR3,NUAB,NOAB,NUA,0,0)
        CALL CCMATMUL(VPPP,R3B(1,1,1,IE),TI,NUAB,NOB2,NUA,0,1)
 2     CONTINUE
       CALL WRTAB(NUA,NUB,NOB,NOB,TI,(INTREC+IHREC+LREC3+I),98)
       CALL CCMATMUL(VHPPP1(1,1,1,IRB(I)),R2A,HR3,NUAB,NOAB,NUA,0,1)
       CALL TRAN34N(NUA,NUB,NUA,NOB,TI,VHPPP1)
       CALL TRAN34N(NOA,NUB,NOA,NOB,TI,VHHHP1)
       CALL INSI23(NUA,NOB,NOA,TI,R2A)
       CALL CCMATMUL(VHPPP1,R2A(1,1,IRB(I)),HR3,NOBUAB,NOA,NUA,0,0)
       CALL CCMATMUL(R2A(1,1,IRB(I)),VHHHP1,HR3,NUA,NOABUB,NOA,0,1)
       CALL INSI23(NUA,NOA,NOB,TI,R2A)
       CALL TRAN34N(NUA,NUB,NOB,NUA,TI,VHPPP1)
       CALL TRAN34N(NOA,NUB,NOB,NOA,TI,VHHHP1)
C
       CALL TRT1(NUAB,NOAB,TI,HR3)
       CALL CCMATMUL(VHHHP2,R2B(1,1,IRB(I)),HR3,NOABUA,NUB,NOB,0,0)
       CALL CCMATMUL(OHHHA,T2B(1,1,1,IRB(I)),HR3,NOAB,NUAB,NOA,0,0)
       CALL TRT1(NOAUAB,NOB,TI,T2B)
       CALL CCMATMUL(T2B,OHPPB(1,1,IRB(I)),HR3,NOABUA,NUB,NUB,0,0)
       CALL TRT1(NOB,NOAUAB,TI,T2B)
C
       CALL TRAN24(NOB,NOA,NUA,NUB,TI,HR3)
       CALL CCMATMUL(R2B(1,1,IRB(I)),VHPPP2,HR3,NOB,NOAUAB,NUB,0,1)
       CALL TRANMD(VHHHP2,NOB,NOA,NUA,NOB,14)
       CALL INSITU(NOB,NOA,NUA,NOB,TI,VHHHP2,23)
       CALL CCMATMUL(R2B,VHHHP2(1,1,1,IRB(I)),HR3,NOBUB,NOAUA,NOB,0,0)
       CALL INSITU(NOB,NUA,NOA,NOB,TI,VHHHP2,23)
       CALL TRANMD(VHHHP2,NOB,NOA,NUA,NOB,14)
       CALL CCMATMUL(T2(1,1,1,IRB(I)),OHPA2,HR3,NOBUB,NOAUA,NUB,0,1)
C
       CALL TRAN14(NOB,NUB,NOB,NUB,TI,VHPHP5)
       CALL TRAN14(NOB,NUA,NOB,NUA,TI,VHPHP4)
       CALL TRANMD(VHPHP4,NUA,NUA,NOB,NOB,12)
       CALL TRAN14(NOB,NUB,NOA,NUA,TI,VHPHP6)
       DO 3,M=1,NACTA
        IF(M.LE.NACTB) THEN
        CALL RDTAB(NOB,NUB,NUA,NOA,R3,(I3REC+LREC1+M),98)
        CALL ZEROII(NOA,NOB,NUA,NUB,M,IRB,IRA,R3)
        CALL CCMATMUL(VHHHH1(1,1,IRB(I),IRB(M)),R3,HR3,NOB,NOAUAB,NOB,
     *                0,0)
        CALL ZEROIB(NOA,NOB,NUA,NUB,IRB,R3)
        CALL CCMATMUL(FHHB(IRB(I),IRB(M)),R3,HR3,1,NO2U2AB,1,0,1)
        CALL RDTAB(NOB,NUB,NUA,NOA,R3,(I3REC+LREC1+M),98)
        CALL ZEROIB(NOA,NOB,NUA,NUB,IRB,R3)
        CALL CCMATMUL(R3,VHHHH2(1,1,IRB(I),IRB(M)),HR3,NOBUAB,NOA,NOA,
     *                0,0)
        CALL TRT1(NOBUB,NOAUA,TI,HR3)
        CALL TRT1(NOBUB,NOAUA,TI,R3)
        CALL ZEROIH(NOA,NOB,NUA,NUB,IRB,IRA,R3)
        CALL CCMATMUL(R3,VHPHP5(1,1,IRB(M),IRB(I)),HR3,NOABUA,NUB,NUB,
     *                0,1)
        CALL CCMATMUL(VHPHP4(1,1,IRB(M),IRB(I)),R3,HR3,NUA,NOABUB,NUA,
     *                0,1)
        ELSE
        CALL TRT1(NOBUB,NOAUA,TI,HR3)
        END IF
        CALL RDTAB(NOB,NUA,NUA,NOA,R3,(I3REC+LREC4+M),98)
        CALL ZEROIF(NOB,NOA,NUA,IRB,IRA,1,R3)
        CALL ZEROIG(NOB,NOA,NUA,M,IRB,IRA,R3)
        CALL TRT1(NOBUA,NOAUA,TI,R3)
        CALL ZEROIG2(NOB,NOA,NUA,M,IRB,IRA,R3)
        CALL CCMATMUL(R3,VHPHP6(1,1,IRA(M),IRB(I)),HR3,NOABUA,NUB,NUA,
     *                0,0)
        CALL TRT1(NOAUA,NOBUB,TI,HR3)
        CALL RDTAB(NOB,NUB,NUA,NOB,R3,(I3REC+LREC2+M),98)
        CALL ZEROID(NOB,NUA,NUB,IRB,R3)
        CALL ZEROIE(NOB,NUA,NUB,IRB,R3)
        CALL CCMATMUL(R3,VHHHH3(1,1,IRB(I),IRA(M)),HR3,NOBUAB,NOA,NOB,
     *                0,1)
 3     CONTINUE
       CALL TRAN14(NUB,NUB,NOB,NOB,TI,VHPHP5)
       CALL TRANMD(VHPHP4,NUA,NUA,NOB,NOB,12)
       CALL TRAN14(NUA,NUA,NOB,NOB,TI,VHPHP4)
       CALL TRAN14(NUA,NUB,NOA,NOB,TI,VHPHP6)
C
       CALL WRTAB(NOB,NUB,NUA,NOA,HR3,(I3REC+IHREC+LREC1+I),98)
C
       CALL ZEROMA(HR3,1,NO2U2)
       CALL RDTAB(NOB,NUB,NUB,NOB,R3,(I3REC+I),98)
       CALL CCMATMUL(R3,VHPHP1,HR3,NOBUB,NOAUA,NOBUB,1,1)
       CALL RDTAB(NOB,NUB,NUA,NOA,R3,(I3REC+LREC1+I),98)
       CALL CCMATMUL(R3,FHHA,HR3,NOBUAB,NOA,NOA,0,1)
       CALL CCMATMUL(R3,VHPHP2,HR3,NOBUB,NOAUA,NOAUA,0,1)
       CALL INSITU(NOB,NUB,NUA,NOA,TI,HR3,23)
       CALL INSITU(NOB,NUB,NUA,NOA,TI,R3,23)
       CALL CCMATMUL(R3,VHPHP3,HR3,NOBUA,NOAUB,NOAUB,0,1)
       CALL INSITU(NOB,NUA,NUB,NOA,TI,HR3,23)
       CALL WRTAB(NOB,NUB,NUA,NOA,HR3,(INTREC+IHREC+I),98)
       ELSE
       CALL RDTAB(NOB,NUB,NUA,NOB,R3B,(I3REC+LREC2+I),98)
       CALL TRT1(NOBUB,NOBUA,TI,R3B)
       CALL ZEROMA(TI,1,NOU3)
       DO 4,IE=1,NUB
        READ(NFT899,REC=NUA+NUB+IE) VPPP
        CALL CCMATMUL(VPPP,R3B(1,1,1,IE),TI,NUAB,NOB2,NUA,0,1)
 4     CONTINUE
       CALL WRTAB(NUA,NUB,NOB,NOB,TI,(INTREC+IHREC+LREC3+I),98)
       END IF
1     CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK T2OHPPA
      SUBROUTINE T2OHPPA(NOA,NOB,NUA,NUB,I,T2B,OHPPA,HR3,TI)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      DIMENSION T2B(NOA,NUB,NUA,NOB),OHPPA(1),HR3(1)
C
      CALL INSITU(NOA,NUA,NUB,NOB,TI,HR3,23)
      CALL INSITU(NOA,NUA,NUB,NOB,TI,T2B,23)
      CALL TRANMD(OHPPA,NUA,NUA,NOB,1,12)
      CALL CCMATMUL(T2B(1,1,1,I),OHPPA,HR3,NOAUB,NOBUA,NUA,0,1)
      CALL TRANMD(OHPPA,NUA,NUA,NOB,1,12)
      CALL INSITU(NOA,NUB,NUA,NOB,TI,T2B,23)
      CALL INSITU(NOA,NUB,NUA,NOB,TI,HR3,23)
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPLOOPBA2
      SUBROUTINE IPLOOPBA2(NOA,NUA,NOB,NUB,IRB,IRA,R3,HR3,FHHB,FHHA,
     *                     FPPB,FPPA,VHPHP1,VHPHP2,VHPHP3,VHPHP4,
     *                     VHPHP5,VHPHP6,VHHHP1,VHHHP2,VHHHP3,VHPPP1,
     *                     VHPPP2,VHHHH1,VHHHH2,R2B,R2A,T2,T2B,T2C,
     *                     OHHHB,OHHHA,OHPPB,OHPPA,OHPA2,TI,I3REC,
     *                     INTREC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION R3(NUA,NOA,NOA,NUA),HR3(1)
      DIMENSION FHHB(NOB,NOB),FHHA(NOA,NOA),FPPB(1),FPPA(1)
      DIMENSION VHPHP1(1),VHPHP2(1),VHPHP6(NUA,NUA,NOA,NOA)
      DIMENSION VHPHP3(1),VHHHP2(NOB,NUA,NOB,NOA)
      DIMENSION VHPHP4(NUB,NUB,NOA,NOA),VHPHP5(NUA,NUB,NOB,NOA)
      DIMENSION VHHHP1(NOB,NUB,NOA,NOA),VHHHP3(1)
      DIMENSION VHPPP1(1),VHPPP2(NUA,NUB,NUB,NOA)
      DIMENSION VHHHH1(NOA,NOB,NOA,NOB),VHHHH2(NOB,NOB,NOA,NOA)
      DIMENSION R2B(1),R2A(NOB,NUA,NOA)
      DIMENSION T2(1),T2B(NUA,NUB,NOB,NOA),T2C(NUB,NUA,NOB,NOA)
      DIMENSION OHHHB(1),OHHHA(NOA,NOB,NOA)
      DIMENSION OHPPB(1),OHPPA(1),OHPA2(NUB,NUA,NOA)
      DIMENSION TI(1),IRB(NACTB),IRA(NACTA)
      DATA HALF/0.5D+00/
C
      NOB2UAB=NOB2UA*NUB
      DO 1,I=1,NACTA
       CALL ZEROMA(HR3,1,NO2U2)
       CALL RDTAB(NOB,NUA,NUA,NOA,R3,(I3REC+LREC4+I),98)
       CALL TRAN14(NOB,NUA,NUA,NOA,TI,R3)
       CALL CCMATMUL(VHPHP2,R3,HR3,NOBUB,NOBUA,NOAUA,1,1)
       CALL RDTAB(NOB,NUB,NUA,NOB,R3,(I3REC+LREC2+I),98)
       CALL CCMATMUL(FHHB,R3,HR3,NOB,NOBUAB,NOB,0,1)
       CALL CCMATMUL(VHPHP1,R3,HR3,NOBUB,NOBUA,NOBUB,0,1)
       CALL INSITU(NOB,NUB,NUA,NOB,TI,R3,23)
       CALL INSITU(NOB,NUB,NUA,NOB,TI,HR3,23)
       CALL CCMATMUL(VHPHP3,R3,HR3,NOBUA,NOBUB,NOBUA,0,1)
       CALL INSITU(NOB,NUA,NUB,NOB,TI,HR3,23)
       CALL WRTAB(NOB,NUB,NUA,NOB,HR3,(INTREC+IHREC+LREC2+I),98)
C
       CALL INSITU(NOB,NUB,NUA,NOB,TI,HR3,23)
       CALL CCMATMUL(OHPPA,T2B(1,1,1,IRA(I)),HR3,NOBUA,NOBUB,NUA,0,0)
C
       CALL TRT1(NOBUA,NOBUB,TI,HR3)
       CALL TRT1(NOBUA,NOBUB,TI,R3)
       CALL CCMATMUL(FPPB,R3,HR3,NUB,NOB2UA,NUB,0,0)
       CALL CCMATMUL(T2,OHPA2(1,1,IRA(I)),HR3,NOB2UB,NUA,NUB,0,1)
C
       CALL TRAN14(NUB,NOB,NOB,NUA,TI,HR3)
       CALL TRAN14(NUB,NOB,NOB,NUA,TI,R3)
       CALL CCMATMUL(FPPA,R3,HR3,NUA,NOB2UB,NUA,0,0)
C
       CALL TRAN24(NUA,NOB,NOB,NUB,TI,HR3)
       CALL ZEROMA(TI,1,NOU3)
       CALL RDTAB(NUA,NUB,NOB,NOB,TI,(INTREC+IHREC+LREC3+I),98)
       CALL DAXPY(NOB2UAB,HALF,TI,1,HR3,1)
       CALL INSI12(NOB,NUB,NOB,TI,R2B)
       CALL CCMATMUL(VHPPP2(1,1,1,IRA(I)),R2B,HR3,NUAB,NOB2,NUB,0,0)
       CALL INSI12(NUB,NOB,NOB,TI,R2B)
       CALL CCMATMUL(T2B(1,1,1,IRA(I)),OHHHB,HR3,NUAB,NOB2,NOB,0,0)
       CALL CCMATMUL(T2B,OHHHA(1,1,IRA(I)),HR3,NOBUAB,NOB,NOA,0,0)
C
       CALL TRAN14(NUA,NUB,NOB,NOB,TI,HR3)
       CALL CCMATMUL(VHHHP3,R2A(1,1,IRA(I)),HR3,NOB2UB,NUA,NOB,0,0)
C
       CALL TRAN1TO4(NOB,NUB,NOB,NUA,TI,HR3)
C
       CALL INSITU(NUB,NOB,NUA,NOB,TI,HR3,12)
       CALL CCMATMUL(R2B,VHHHP2(1,1,1,IRA(I)),HR3,NOBUB,NOBUA,NOB,0,1)
       CALL INSI13(NOB,NUA,NOA,TI,R2A)
       CALL CCMATMUL(VHHHP1(1,1,1,IRA(I)),R2A,HR3,NOBUB,NOBUA,NOA,0,0)
       CALL INSI13(NOA,NUA,NOB,TI,R2A)
       CALL CCMATMUL(R2A(1,1,IRA(I)),VHPPP1,HR3,NOB,NOBUAB,NUA,0,0)
       CALL CCMATMUL(OHPPB,T2C(1,1,1,IRA(I)),HR3,NOBUB,NOBUA,NUB,0,0)
C
       DO 3,M=1,NACTA
        IF(M.LE.NACTB) THEN
        CALL RDTAB(NOB,NUB,NUA,NOA,R3,(I3REC+LREC1+M),98)
        CALL ZEROIB(NOA,NOB,NUA,NUB,IRB,R3)
        CALL CCMATMUL(R3,VHHHH1(1,1,IRA(I),IRB(M)),HR3,NOBUAB,NOB,NOA,
     *                0,1)
        CALL RDTAB(NOB,NUB,NUB,NOB,R3,(I3REC+M),98)
        CALL ZEROIA(NOB,NUB,IRB,R3)
        CALL TRANSQ(R3,NOBUB)
        CALL ZEROIC(NOB,NUB,M,IRB,R3)
        CALL ZEROIC2(NOB,NUB,M,IRB,R3)
        CALL TRT1(NOBUB,NOBUA,TI,HR3)
        CALL CCMATMUL(VHPHP5(1,1,IRB(M),IRA(I)),R3,HR3,NUA,NOB2UB,NUB,
     *                0,1)
        ELSE
        CALL TRT1(NOBUB,NOBUA,TI,HR3)
        END IF
        CALL RDTAB(NOB,NUB,NUA,NOB,R3,(I3REC+LREC2+M),98)
        CALL ZEROID(NOB,NUA,NUB,IRB,R3)
        CALL ZEROIE(NOB,NUA,NUB,IRB,R3)
        CALL TRT1(NOBUB,NOBUA,TI,R3)
        CALL CCMATMUL(R3,VHPHP4(1,1,IRA(M),IRA(I)),HR3,NOB2UA,NUB,NUB,
     *                0,1)
        CALL CCMATMUL(VHPHP6(1,1,IRA(M),IRA(I)),R3,HR3,NUA,NOB2UB,NUA,
     *                0,1)
        CALL TRT1(NOBUA,NOBUB,TI,HR3)
        CALL TRT1(NOBUA,NOBUB,TI,R3)
        CALL CCMATMUL(R3,VHHHH2(1,1,IRA(I),IRA(M)),HR3,NOBUAB,NOB,NOB,
     *                0,0)
        CALL CCMATMUL(FHHA(IRA(M),IRA(I)),R3,HR3,1,NOB2UAB,1,0,1)
 3     CONTINUE
C
       CALL WRTAB(NOB,NUB,NUA,NOB,HR3,(I3REC+IHREC+LREC2+I),98)
C
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPMAKEBA
      SUBROUTINE IPMAKEBA(NOA,NOB,NUA,NUB,R3,R3A,HR3,HR3B,
     *                    TI,IRA,IRB,I3REC,INTREC)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNMAX / NOU,NO2,NU2,NO2U2,NO4,NU3,NO3U,NOU3,NOU2,NO2U
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION R3(NOB,NUB,NUA,NOB),R3A(NOB,NUB,NUA,NOA)
      DIMENSION HR3(NOB,NUB,NUA,NOA),HR3B(NOB,NUB,NUA,NOB)
      DIMENSION TI(1),IRB(NACTB),IRA(NACTA)
C
      DATA ONE/1.00D+00/, HALFN/-0.5D+00/
      DATA TWO/2.0D+00/
C
      NOB2UAB=NOB2UA*NUB
      DO 1,I=1,NACTA
       IF(I.LE.NACTB) THEN
       CALL RDTAB(NOB,NUB,NUA,NOA,HR3,(I3REC+IHREC+LREC1+I),98)
       CALL RDTAB(NOB,NUB,NUA,NOA,R3,(INTREC+IHREC+I),98)
       CALL DAXPY(NO2U2AB,ONE,R3,1,HR3,1)
       CALL RDTAB(NOB,NOA,NUB,NUA,R3,(INTREC+LREC1+I),98)
       CALL INSITU(NOB,NOA,NUB,NUA,TI,R3,23)
       CALL TRAN34N(NOB,NUB,NOA,NUA,TI,R3)
       CALL DAXPY(NO2U2AB,ONE,R3,1,HR3,1)
       DO 2,J=1,NACTA
        IF(J.LE.NACTB) THEN
        CALL IPMAKBA2(NOA,NOB,NUA,NUB,IRB,I,J,INTREC,R3A,HR3,TI)
        END IF
        CALL RDTAB(NOB,NOB,NUA,NUB,R3,(INTREC+LREC2+J),98)
        CALL TRAN1TO4(NOB,NOB,NUA,NUB,TI,R3)
        CALL INSITU(NOB,NUA,NUB,NOB,TI,R3,23)
        CALL DAXPY(NOBUAB,TWO,R3(1,1,1,IRB(I)),1,HR3(1,1,1,IRA(J)),1)
        CALL RDTAB(NOB,NUB,NUA,NOB,R3,(INTREC+IHREC+LREC2+J),98)
        CALL TRAN14(NOB,NUB,NUA,NOB,TI,R3)
        CALL ZEROID(NOB,NUA,NUB,IRB,R3)
        CALL DAXPY(NOBUAB,ONE,R3(1,1,1,IRB(I)),1,HR3(1,1,1,IRA(J)),1)
 2     CONTINUE
C
       CALL WRTAB(NOB,NUB,NUA,NOA,HR3,(I3REC+IHREC+LREC1+I),98)
       END IF
C
       CALL RDTAB(NOB,NUB,NUA,NOB,HR3B,(I3REC+IHREC+LREC2+I),98)
       CALL RDTAB(NOB,NOB,NUA,NUB,R3A,(INTREC+LREC2+I),98)
       CALL TRAN24(NOB,NOB,NUA,NUB,TI,R3A)
       CALL DAXPY(NOB2UAB,ONE,R3A,1,HR3B,1)
       DO 3,J=1,NACTB
        CALL IPMAKBA3(NOA,NOB,NUA,NUB,IRB,IRA,I,J,INTREC,R3,HR3B,TI)
        CALL RDTAB(NOB,NUB,NUA,NOA,R3A,(INTREC+IHREC+J),98)
        CALL ZEROIB(NOA,NOB,NUA,NUB,IRB,R3A)
        CALL DAXPY(NOBUAB,HALFN,R3A(1,1,1,IRA(I)),1,HR3B(1,1,1,IRB(J)),
     *             1)
 3     CONTINUE
C
       CALL ZEROMA(R3,1,NO2U2)
       CALL SYMETR3JK(HR3B,NOB,NUB,NUA,R3)
       CALL WRTAB(NOB,NUB,NUA,NOB,HR3B,(I3REC+IHREC+LREC2+I),98)
C
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPMAKBA2
      SUBROUTINE IPMAKBA2(NOA,NOB,NUA,NUB,IRB,I,J,INTREC,R3,HR3,TI)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION R3(NOA,NUB,NUA,NOB),HR3(NOA,NUB,NUA,NOB)
      DIMENSION TI(1),IRB(NACTB)
      DATA ONEN/-1.0D+00/
C
      CALL TRAN14(NOB,NUB,NUA,NOA,TI,HR3)
      CALL RDTAB(NOB,NOA,NUB,NUA,R3,(INTREC+LREC1+J),98)
      CALL TRAN1TO4(NOB,NOA,NUB,NUA,TI,R3)
      CALL DAXPY(NOAUAB,ONEN,R3(1,1,1,IRB(I)),1,HR3(1,1,1,IRB(J)),1)
      CALL RDTAB(NOB,NUB,NUA,NOA,R3,(INTREC+IHREC+LREC1+J),98)
      CALL TRAN14(NOB,NUB,NUA,NOA,TI,R3)
      CALL DAXPY(NOAUAB,ONEN,R3(1,1,1,IRB(I)),1,HR3(1,1,1,IRB(J)),1)
      CALL TRAN14(NOA,NUB,NUA,NOB,TI,HR3)
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK IPMAKBA3
      SUBROUTINE IPMAKBA3(NOA,NOB,NUA,NUB,IRB,IRA,I,J,INTREC,R3,HR3,TI)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /NNROHF/ NOAUA,NOAUB,NOBUA,NOBUB,NOA2,NOA2UA,NOA4,NOB2,
     *                NOB2UB,NOB4,NUA2,NOAUA2,NUA4,NUB2,NOBUB2,NUB4,
     *                NUAB,NOAB,NO2AB,NU2AB,NOABUB,NOABUA,NOAUAB,
     *                NOBUAB,NOA2UA2,NOB2UB2,NOA2UB2,NOB2UA2,NO2U2AB,
     *                NUA3,NUB3,NOA3,NOB3,NOA3UA,NOB3UB,NOA2UB,NOAUB2,
     *                NOB2UA,NOBUA2,NUA2UB,NOA2OB,NOAOB2,NUA3NOA,
     *                NUAUB2,NOAOB2UA,NUB3NOB
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      COMMON /I3P2H / LREC1,LREC2,LREC3,LREC4,IHREC
      DIMENSION R3(NUB,NUA,NOB,NOA),HR3(NUB,NUA,NOB,NOB)
      DIMENSION TI(1),IRB(NACTB),IRA(NACTA)
      DATA ONE/1.00D+00/, HALF/0.5D+00/
C
      CALL TRT1(NOB,NOBUAB,TI,HR3)
      CALL RDTAB(NOB,NOA,NUB,NUA,R3,(INTREC+LREC1+J),98)
      CALL TRT1(NOAB,NUAB,TI,R3)
      CALL DAXPY(NOBUAB,ONE,R3(1,1,1,IRA(I)),1,HR3(1,1,1,IRB(J)),1)
      CALL RDTAB(NOB,NUB,NUA,NOA,R3,(INTREC+IHREC+J),98)
      CALL TRAN1TO4(NOB,NUB,NUA,NOA,TI,R3)
      CALL TRAN34N(NUB,NUA,NOA,NOB,TI,R3)
      CALL DAXPY(NOBUAB,HALF,R3(1,1,1,IRA(I)),1,HR3(1,1,1,IRB(J)),1)
      CALL TRT1(NOBUAB,NOB,TI,HR3)
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROIA
      SUBROUTINE ZEROIA(NO,NU,IRB,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      DIMENSION R3(NO,NU,NU,NO),IRB(NACTB)
C
      DO 1,I=1,NACTB
      DO 2,N=1,NO
      DO 3,IE=1,NU
      DO 4,IF=1,NU
       R3(IRB(I),IE,IF,N)=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROIB
      SUBROUTINE ZEROIB(NOA,NOB,NUA,NUB,IRB,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      DIMENSION R3(NOB,NUB,NUA,NOA),IRB(NACTB)
C
      DO 1,I=1,NACTB
      DO 2,N=1,NOA
      DO 3,IE=1,NUB
      DO 4,IF=1,NUA
       R3(IRB(I),IE,IF,N)=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROIC
      SUBROUTINE ZEROIC(NO,NU,IACT,IRB,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      DIMENSION R3(NU,NO,NO,NU),IRB(NACTB)
C
      DO 1,I=1,IRB(1)
      DO 2,J=IACT,NACTB
      DO 3,IE=1,NU
      DO 4,IF=1,NU
       R3(IF,IRB(J),I,IE)=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROIC2
      SUBROUTINE ZEROIC2(NO,NU,IACT,IRB,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      DIMENSION R3(NU,NO,NO,NU),IRB(NACTB)
C
      DO 1,I=1,IRB(1)
      DO 2,J=1,IACT
      DO 3,IE=1,NU
      DO 4,IF=1,NU
       R3(IF,IRB(J),I,IE)=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROID
      SUBROUTINE ZEROID(NOB,NUA,NUB,IRB,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      DIMENSION R3(NOB,NUB,NUA,NOB),IRB(NACTB)
C
      DO 1,I=1,NACTB
      DO 2,J=1,NOB
      DO 3,IE=1,NUB
      DO 4,IF=1,NUA
       R3(IRB(I),IE,IF,J)=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROIE
      SUBROUTINE ZEROIE(NOB,NUA,NUB,IRB,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      DIMENSION R3(NOB,NUB,NUA,NOB),IRB(NACTB)
C
      DO 10,I=1,IRB(1)
      DO 20,J=1,NACTB
      DO 30,IE=1,NUB
      DO 40,IF=1,NUA
       R3(I,IE,IF,IRB(J))=0.00D+00
 40   CONTINUE
 30   CONTINUE
 20   CONTINUE
 10   CONTINUE
C
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROIF
      SUBROUTINE ZEROIF(NOB,NOA,NUA,IRB,IRA,IPOS,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      DIMENSION R3(NOB,NUA,NUA,NOA),IRB(NACTB)
C
      IF(IPOS.EQ.1) THEN
       NFINAL=NOA
      ELSE
       NFINAL=IRA
      END IF
C
      DO 1,I=1,NACTB
      DO 2,N=1,NFINAL
      DO 3,IE=1,NUA
      DO 4,IF=1,NUA
       R3(IRB(I),IE,IF,N)=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROIG
      SUBROUTINE ZEROIG(NOB,NOA,NUA,IACT,IRB,IRA,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      DIMENSION R3(NOB,NUA,NUA,NOA),IRB(NACTB)
      DIMENSION IRA(NACTA)
C
      DO 1,I=1,IRB(1)
      DO 2,J=IACT,NACTA
      DO 3,IE=1,NUA
      DO 4,IF=1,NUA
       R3(I,IE,IF,IRA(J))=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROIG2
      SUBROUTINE ZEROIG2(NOB,NOA,NUA,IACT,IRB,IRA,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      DIMENSION R3(NUA,NOA,NOB,NUA),IRB(NACTB)
      DIMENSION IRA(NACTA)
C
      DO 1,I=1,IRB(1)
      DO 2,J=1,IACT
      DO 3,IE=1,NUA
      DO 4,IF=1,NUA
       R3(IF,IRA(J),I,IE)=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROIG3
      SUBROUTINE ZEROIG3(NOB,NOA,NUA,IRA,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      DIMENSION R3(NOB,NUA,NUA,NOA)
      DIMENSION IRA(NACTA)
C
      DO 1,I=1,NOB
      DO 2,J=1,NACTA
      DO 3,IE=1,NUA
      DO 4,IF=1,NUA
       R3(I,IE,IF,IRA(J))=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
      RETURN
      END
C
C
C*MODULE EAIPCC  *DECK ZEROIH
      SUBROUTINE ZEROIH(NOA,NOB,NUA,NUB,IRB,IRA,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      DIMENSION R3(NUA,NOA,NOB,NUB),IRB(NACTB)
      DIMENSION IRA(NACTA)
C
      DO 1,I=1,IRB(1)
      DO 2,J=1,NACTA
      DO 3,IE=1,NUB
      DO 4,IF=1,NUA
       R3(IF,IRA(J),I,IE)=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROII
      SUBROUTINE ZEROII(NOA,NOB,NUA,NUB,I,IRB,IRA,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      DIMENSION R3(NOB,NUB,NUA,NOA),IRB(NACTB)
      DIMENSION IRA(NACTA)
C
      DO 1,N=1,NOB
      DO 2,J=1,NACTA
      DO 3,IB=1,NUA
      DO 4,IF=1,NUB
       R3(N,IF,IB,IRA(J))=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      DO 11,N=I,NACTB
      DO 12,J=1,IRA(1)
      DO 13,IB=1,NUA
      DO 14,IF=1,NUB
       R3(IRB(N),IF,IB,J)=0.00D+00
 14   CONTINUE
 13   CONTINUE
 12   CONTINUE
 11   CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROIJ
      SUBROUTINE ZEROIJ(NO,NU,IRA,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      DIMENSION R3(NU,NO,NO,NU),IRA(NACTA)
C
      DO 1,J=1,NACTA
      DO 2,N=1,NO
      DO 3,IB=1,NU
      DO 4,IF=1,NU
       R3(IF,N,IRA(J),IB)=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROIK
      SUBROUTINE ZEROIK(NO,NU,MACT,IRB,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      DIMENSION R3(NO,NU,NU,NO),IRB(NACTB)
C
      DO 1,N=1,NO
      DO 2,K=1,NACTB
      DO 3,IB=1,NU
      DO 4,IC=1,NU
       R3(N,IB,IC,IRB(K))=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      DO 11,N=MACT,NACTB
      DO 12,K=1,IRB(1)
      DO 13,IB=1,NU
      DO 14,IC=1,NU
       R3(IRB(N),IB,IC,K)=0.00D+00
 14   CONTINUE
 13   CONTINUE
 12   CONTINUE
 11   CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROIK2
      SUBROUTINE ZEROIK2(NO,NU,MACT,IRB,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      DIMENSION R3(NO,NU,NU,NO),IRB(NACTB)
C
      DO 11,N=1,MACT
      DO 12,K=1,IRB(1)
      DO 13,IB=1,NU
      DO 14,IC=1,NU
       R3(IRB(N),IB,IC,K)=0.00D+00
 14   CONTINUE
 13   CONTINUE
 12   CONTINUE
 11   CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROIL
      SUBROUTINE ZEROIL(NOB,NOA,NUA,IRA,IRB,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      DIMENSION R3(NOA,NUA,NUA,NOB),IRB(NACTB),IRA(NACTA)
C
      DO 1,I=1,NACTA
      DO 2,N=1,NACTB
      DO 3,IE=1,NUA
      DO 4,IF=1,NUA
       R3(IRA(I),IE,IF,IRB(N))=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROIM
      SUBROUTINE ZEROIM(NO,NU,IRA,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      DIMENSION R3(NO,NU,NU,NO),IRA(NACTA)
C
      DO 1,I=1,NACTA
      DO 2,N=1,NO
      DO 3,IE=1,NU
      DO 4,IF=1,NU
       R3(IRA(I),IE,IF,N)=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROIM2
      SUBROUTINE ZEROIM2(NO,NU,IRA,R3)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
      DIMENSION R3(NO,NU,NU,NO),IRA(NACTA)
C
      DO 1,I=1,IRA(1)
      DO 2,N=1,NACTA
      DO 3,IE=1,NU
      DO 4,IF=1,NU
       R3(I,IE,IF,IRA(N))=0.00D+00
 4    CONTINUE
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
      RETURN
      END
C
C*MODULE EAIPCC  *DECK ZEROIR2
      SUBROUTINE ZEROIR2(NOB,NUB,IRB,OPHH)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z)
      DIMENSION OPHH(NOB,NUB,NOB),IRB(NACTB)
      COMMON /EAIP  / MULEAIP,JREST,NACTA,NACTB
C
      DO 1,I=1,NACTB
      DO 2,IB=1,NUB
      DO 3,J=1,NOB
       OPHH(J,IB,IRB(I))=0.00D+00
 3    CONTINUE
 2    CONTINUE
 1    CONTINUE
C
      RETURN
      END
C
